"use strict";!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ES6Promise=e()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){I=t}function r(t){J=t}function o(){return function(){return process.nextTick(a)}}function i(){return"undefined"!=typeof H?function(){H(a)}:c()}function s(){var t=0,e=new V(a),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=a,function(){return t.port2.postMessage(0)}}function c(){var t=setTimeout;return function(){return t(a,1)}}function a(){for(var t=0;t<G;t+=2){var e=$[t],n=$[t+1];e(n),$[t]=void 0,$[t+1]=void 0}G=0}function f(){try{var t=require,e=t("vertx");return H=e.runOnLoop||e.runOnContext,i()}catch(n){return c()}}function l(t,e){var n=arguments,r=this,o=new this.constructor(p);void 0===o[et]&&k(o);var i=r._state;return i?!function(){var t=n[i-1];J(function(){return x(i,o,t,r._result)})}():E(r,o,t,e),o}function h(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(p);return g(n,t),n}function p(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(e){return it.error=e,it}}function y(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function m(t,e,n){J(function(t){var r=!1,o=y(n,e,function(n){r||(r=!0,e!==n?g(t,n):S(t,n))},function(e){r||(r=!0,j(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,j(t,o))},t)}function b(t,e){e._state===rt?S(t,e._result):e._state===ot?j(t,e._result):E(e,void 0,function(e){return g(t,e)},function(e){return j(t,e)})}function w(t,n,r){n.constructor===t.constructor&&r===l&&n.constructor.resolve===h?b(t,n):r===it?(j(t,it.error),it.error=null):void 0===r?S(t,n):e(r)?m(t,n,r):S(t,n)}function g(e,n){e===n?j(e,v()):t(n)?w(e,n,_(n)):S(e,n)}function A(t){t._onerror&&t._onerror(t._result),T(t)}function S(t,e){t._state===nt&&(t._result=e,t._state=rt,0!==t._subscribers.length&&J(T,t))}function j(t,e){t._state===nt&&(t._state=ot,t._result=e,J(A,t))}function E(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+rt]=n,o[i+ot]=r,0===i&&t._state&&J(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?x(n,r,o,i):o(i);t._subscribers.length=0}}function M(){this.error=null}function P(t,e){try{return t(e)}catch(n){return st.error=n,st}}function x(t,n,r,o){var i=e(r),s=void 0,u=void 0,c=void 0,a=void 0;if(i){if(s=P(r,o),s===st?(a=!0,u=s.error,s.error=null):c=!0,n===s)return void j(n,d())}else s=o,c=!0;n._state!==nt||(i&&c?g(n,s):a?j(n,u):t===rt?S(n,s):t===ot&&j(n,s))}function C(t,e){try{e(function(e){g(t,e)},function(e){j(t,e)})}catch(n){j(t,n)}}function O(){return ut++}function k(t){t[et]=ut++,t._state=void 0,t._result=void 0,t._subscribers=[]}function Y(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[et]||k(this.promise),B(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):j(this.promise,q())}function q(){return new Error("Array Methods must be provided an Array")}function F(t){return new Y(this,t).promise}function D(t){var e=this;return new e(B(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function K(t){var e=this,n=new e(p);return j(n,t),n}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(t){this[et]=O(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&L(),this instanceof U?C(this,t):N())}function W(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(e){}if("[object Promise]"===r&&!n.cast)return}t.Promise=U}var z=void 0;z=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var B=z,G=0,H=void 0,I=void 0,J=function(t,e){$[G]=t,$[G+1]=e,G+=2,2===G&&(I?I(a):tt())},Q="undefined"!=typeof window?window:void 0,R=Q||{},V=R.MutationObserver||R.WebKitMutationObserver,X="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),tt=void 0;tt=X?o():V?s():Z?u():void 0===Q&&"function"==typeof require?f():c();var et=Math.random().toString(36).substring(16),nt=void 0,rt=1,ot=2,it=new M,st=new M,ut=0;return Y.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===nt&&n<t;n++)this._eachEntry(e[n],n)},Y.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===h){var o=_(t);if(o===l&&t._state!==nt)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===U){var i=new n(p);w(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},Y.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===nt&&(this._remaining--,t===ot?j(r,n):this._result[e]=n),0===this._remaining&&S(r,this._result)},Y.prototype._willSettleAt=function(t,e){var n=this;E(t,void 0,function(t){return n._settledAt(rt,e,t)},function(t){return n._settledAt(ot,e,t)})},U.all=F,U.race=D,U.resolve=h,U.reject=K,U._setScheduler=n,U._setAsap=r,U._asap=J,U.prototype={constructor:U,then:l,"catch":function(t){return this.then(null,t)}},U.polyfill=W,U.Promise=U,U.polyfill(),U});'use strict';function $id(a){return document.getElementById(a)}function $(a,b){b||(b=document);return b.querySelector(a)}function $$(a,b){b||(b=document);return b.querySelectorAll(a)}function $trim(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;0<=b;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a}
function $ajax(a){return new Promise(function(b,d){var c=new XMLHttpRequest;c.open(a.type,a.url);c.onload=function(){200<=this.status&&300>this.status?b(c.response):d({status:this.status,responseText:c.responseText,statusText:c.statusText})};c.onerror=function(){d({status:this.status,responseText:c.responseText,statusText:c.statusText})};if(a.headers)for(var g in a.headers)c.setRequestHeader(g,a.headers[g]);var e=a.data,f="";if(e&&"string"==typeof e)f=e;else if(e&&"object"==typeof e){for(g in e)temp.push(encodeURIComponent(g)+
"="+encodeURIComponent(e[g]));f=""}!1===a.cache&&(0<f.length&&(f+="&"),f+="_="+(new Date).getTime());c.send(f)})}var Pg={inLogin:0};
function showMessage(a){var b=document.createElement("div");b.setAttribute("class","hmi-overlay");var d=document.createElement("div");d.setAttribute("class","hmi-msg");d.innerHTML="<div class='hmi-msg-hdr'>Warning</div><div class='hmi-msg-cnt'><p>"+a+"</p><div class='round-button hmi-msg-close'><div class='round-button-circle'><a>OK</a></div></div></div></div>";$("body").appendChild(b);$("body").appendChild(d);$(".hmi-msg-close").addEventListener("click",function(){$("body").removeChild($(".hmi-overlay"));
$("body").removeChild($(".hmi-msg"))},!1)}function extractQueryString(){var a={},b=location.search.substr(1);if(""!==b)for(var b=b.split("&"),d=0;d<b.length;d++){var c=b[d].split("=");1<c.length&&0<c[1].length&&(a[c[0]]=decodeURI(c[1]))}return a}function extractActiveProject(a){var b="",d=$trim(a).toLowerCase().indexOf("s_ok");0<=d&&(b=$trim(a.substr(d+4)),""!==b&&(b=b.replace(/\\/g,"/"),b=b.split("/").pop()));return b}
function isActiveProject(a){a=extractActiveProject(a);if(""!==a){a=a.replace(/ /g,"%20").toLowerCase();var b=ServerStatus.activeProject.replace(/ /g,"%20").toLowerCase();if(b&&0>a.indexOf(b))return!1}return!0}function userAgentPath(a){"undefined"===typeof a&&(a=!0);var b="_web";/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?b="_mobi":/iPad|RIM Tablet OS/i.test(navigator.userAgent)&&(b="_tablet");return b+"main.html"+(a?"":"?_="+(new Date).getTime())}
function checkActiveProject(a){var b=window.location.protocol;return $ajax({type:"GET",url:b+"//"+window.location.host+"/cgi/getProperties?n=1&it1=projectRelativePath",cache:!1}).then(function(d){var c=extractActiveProject(d);""!==c?$ajax({type:"GET",url:b+"//"+window.location.host+"/"+c+"/web/web/index.html",cache:!1}).then(function(b){location.href="/"+c+"/web/web/"+userAgentPath()+(0<=a.indexOf("?")?a.substring(a.indexOf("?")):"")}).catch(function(){location.href="/public/notfound.html"}):0<=d.indexOf("E_PROPERTY_NOT_MAPPED")?
location.href="/web/"+userAgentPath(!1)+(0<=a.indexOf("?")?"&"+a.substring(a.indexOf("?")+1):""):location.href="/public/notfound.html";return{status:!0,data:d,err:-1}})}function doLogout(){$ajax({type:"GET",url:window.location.protocol+"//"+window.location.host+"/cgi/logout",cache:!1})}function umFormRedirect(a,b){var d=window.location.protocol,c=window.location.host;null!=b?location.href=d+"//"+c+"/"+a:checkLogin(a)}
var errMsgs={"#e_too_many_users":{s:"Reached Maximum Active Connections Limit.",c:0},"#e_pass_dont_match":{s:"Passwords do not match.",c:1},"#e_user_dont_exist":{s:"User doesn't exist.",c:2},"#e_unauthorized_user":{s:"Unauthorized User.",c:3},"#e_password_expired":{s:"Your password has expired.",c:4},"#e_login_fail":{s:"Login Failure.",c:5},"#e_change_password":{s:"Need to change password.",c:6},"#e_need_login":{s:"Need login.",c:7},"#e_fail":{s:"Access failure.",c:8},"#e_group_dont_exist":{s:"Groups dont exist.",
c:9},"#e_no_group_specified":{s:"No group specified.",c:10},"#e_user_already_exist":{s:"User already exist.",c:11},"#e_no_session_exist":{s:"No session exist.",c:12},"#e_session_expired":{s:"Session expired.",c:13},"#e_session_already_exist":{s:"Session already exists.",c:14},"#e_re-login_attempt":{s:"Re-login attempt.",c:15},"#e_not_allowed":{s:"Passwords do not match",c:16},"#e_invalidarg":{s:"Invalid argument.",c:17},"#e_illegal_format":{s:"Illegal format.",c:18},"#e_access_denied":{s:"Access denied.",
c:19},"#e_must_contain_special_char":{s:"Password must contain special characters.",c:20},"#e_must_contain_numbers":{s:"Password must contain numbers.",c:21},"#e_password_too_short":{s:"Password length too short.",c:22},"#e_similar_prev_pswd":{s:"Password must be different than previous passwords.",c:23},"#s_ok_need_paswd_change":{s:"",c:24},"#s_ok_pwd_will_expire":{s:"",c:25},"#s_ok":{s:"",c:26}};
function loginDefaultUser(a){var b=window.location.protocol,d,c,g,e;-1==a.indexOf("denyDefUser=true")&&(d=b+"//"+window.location.host+"/cgi/loginDefaultUser");var f=-1;return $ajax({url:d,type:"GET",cache:!1,data:"",dataType:"html"}).then(function(b){g=b.split("\n");for(var d=0;d<g.length;d++)if(1<g[d].split("INFO=").length){e=JSON.parse(g[d].split("INFO=")[1]);break}if(-1!==b.toLowerCase().split("\n").indexOf("#s_ok")){var l;b=b.toLowerCase().split("\n")[2];null!=b&&(b=b.trim(),l=b.split("=")[1]);
null==c&&(c=e.u);a+=-1!=a.indexOf("?")?"&usr="+c:"?usr="+c;a+="&token="+l;null!=e.g&&(a+="&g="+e.g);null!=e.ot&&(a+="&ot="+e.ot);return checkActiveProject(a)}l=parseFloat(b.toLowerCase().split("\n")[0].trim());for(d in errMsgs)if(-1!==b.toLowerCase().split("\n").indexOf(d)){f=errMsgs[d].c;break}if(-1!=b.toLowerCase().split("\n").indexOf("#s_ok_need_paswd_change")||-1!=b.toLowerCase().split("\n").indexOf("#e_password_expired")){null==c&&(c=e.u);var h;e&&(h=null==e.ppath.split("/")[1]?"":e.ppath.split("/")[1]);
""!=h?(d=e.pname.split(".")[0],a=h+"/web/web/umtemplates/changepassword.html?usr="+c+"&addjs=true&chpswd="+l+"&pname="+d+"&ppath="+(e.ppath+".jpr")):a="web/umtemplates/changepassword.html?usr="+c+"&addjs=true&chpswd="+l;umFormRedirect(a,h)}-1!=b.toLowerCase().split("\n").indexOf("#s_ok_pwd_will_expire")&&(null==c&&(c=e.u),a+=-1!=a.indexOf("?")?"&usr="+c:"?usr="+c,a+="&chpswd="+l,null!=e.g&&(a+="&g="+e.g),null!=e.ot&&(a+="&ot="+e.ot),umFormRedirect(a));if(-1!==b.toLowerCase().split("\n").indexOf("#e_re-login_attempt"))return checkActiveProject(a);
-1!=b.toLowerCase().split("\n").indexOf("#e_change_password")&&(f=errMsgs["#e_change_password"].c,doLogout());-1!=b.toLowerCase().split("\n").indexOf("#e_need_login")&&(f=errMsgs["#e_need_login"].c,doLogout());Pg.inLogin=0;return Promise.resolve({status:!1,data:a,err:f})},function(){Pg.inLogin=0;return Promise.resolve({status:!1,data:a,err:f})})}
function login(a){var b=window.location.protocol,d,c,g,e;c="";d=$id("username").value;c=$id("passwd").value;if(d==String.fromCharCode(101,120,111,114))return k=errMsgs["#e_login_fail"].s,f=errMsgs["#e_login_fail"].c,showMessage(k),Pg.inLogin=0,Promise.resolve({status:!1,data:a,err:f});b=b+"//"+window.location.host+"/cgi/login";c="username="+encodeURIComponent(d)+"&password="+encodeURIComponent(c);var f=-1,k="Login Failure, Check the project's User Management Settings";return $ajax({url:b,type:"POST",
cache:!1,data:c,dataType:"html"}).then(function(b){g=b.split("\n");for(var c=0;c<g.length;c++)if(1<g[c].split("INFO=").length){e=JSON.parse(g[c].split("INFO=")[1]);break}if(-1!==b.toLowerCase().split("\n").indexOf("#s_ok")){var h;b=b.toLowerCase().split("\n")[2];null!=b&&(b=b.trim(),h=b.split("=")[1]);null==d&&(d=e.u);a+=-1!=a.indexOf("?")?"&usr="+d:"?usr="+d;a+="&token="+h;null!=e.g&&(a+="&g="+e.g);null!=e.ot&&(a+="&ot="+e.ot);return checkActiveProject(a)}var n=!0;h=parseFloat(b.toLowerCase().split("\n")[0].trim());
for(c in errMsgs)if(-1!==b.toLowerCase().split("\n").indexOf(c)){k=errMsgs[c].s;f=errMsgs[c].c;break}if(-1!=b.toLowerCase().split("\n").indexOf("#s_ok_need_paswd_change")||-1!=b.toLowerCase().split("\n").indexOf("#e_password_expired")){null==d&&(d=e.u);var m;e&&(m=null==e.ppath.split("/")[1]?"":e.ppath.split("/")[1]);""!=m?(c=e.pname.split(".")[0],a=m+"/web/web/umtemplates/changepassword.html?usr="+d+"&addjs=true&chpswd="+h+"&pname="+c+"&ppath="+(e.ppath+".jpr")):a="web/umtemplates/changepassword.html?usr="+
d+"&addjs=true&chpswd="+h;n=!1;umFormRedirect(a,m)}-1!=b.toLowerCase().split("\n").indexOf("#s_ok_pwd_will_expire")&&(null==d&&(d=e.u),a+=-1!=a.indexOf("?")?"&usr="+d:"?usr="+d,a+="&chpswd="+h,null!=e.g&&(a+="&g="+e.g),null!=e.ot&&(a+="&ot="+e.ot),n=!1,umFormRedirect(a));n&&showMessage(k);Pg.inLogin=0;return Promise.resolve({status:!1,data:a,err:f})},function(b){b=b.responseText;if(-1!==b.toLowerCase().split("\n").indexOf("#e_re-login_attempt"))return checkActiveProject(a);for(var c in errMsgs)if(-1!==
b.toLowerCase().split("\n").indexOf(c)){k=errMsgs[c].s;f=errMsgs[c].c;break}-1!=b.toLowerCase().split("\n").indexOf("#e_change_password")&&(f=errMsgs["#e_change_password"].c,doLogout());showMessage(k);-1!=b.toLowerCase().split("\n").indexOf("#e_need_login")&&(f=errMsgs["#e_need_login"].c,doLogout());Pg.inLogin=0;return Promise.resolve({status:!1,data:a,err:f})})}function doLogin(a,b){if(Pg.inLogin)return!1;Pg.inLogin=1;return b?loginDefaultUser(a):login(a)}
function attachLoginEventHandler(a){$id("ok").addEventListener("click",function(b){doLogin(a,!1)});$id("passwd").addEventListener("keyup",function(b){13===b.keyCode&&doLogin(a,!1)})}
function checkLogin(a){var b=window.location.protocol;$ajax({type:"GET",url:b+"//"+window.location.host+"/cgi/getProperties?n=1&it1=projectRelativePath",timeout:1E4,cache:!1}).then(function(d){var c=extractActiveProject(d);""!==c?$ajax({type:"GET",url:b+"//"+window.location.host+"/"+c+"/web/web/index.html",cache:!1}).then(function(b){location.href="/"+c+"/web/web/"+userAgentPath()+(0<=a.indexOf("?")?a.substring(a.indexOf("?")):"")}).catch(function(a,b,c){location.href="/public/notfound.html"}):0<=
d.indexOf("E_PROPERTY_NOT_MAPPED")?$ajax({type:"GET",url:b+"//"+window.location.host+"/web/"+userAgentPath(!1),timeout:1E4,cache:!1}).then(function(b){location.href="/web/"+userAgentPath(!1)+(0<=a.indexOf("?")?"&"+a.substring(a.indexOf("?")+1):"")}).catch(function(a,b,c){console.log("Ajax error: "+c+"-> request: http://"+window.location.host+"/web/"+userAgentPath(!1))}):location.href="/public/notfound.html"},function(a){$(".centeredcontent").style.opacity=1;$id("username").focus()})}
function loginFailed(a){if(0==a.status){-1!=a.data.indexOf("forceLogin=true")||-1!=a.data.indexOf("denyDefUser=true")||-1<a.err&&5>a.err?($(".centeredcontent").style.opacity=1,$id("username").focus()):checkLogin(a.data);var b=extractQueryString();a.data+="undefined"!==typeof b.pg?"#"+b.pg:"";window.scrollTo(0,window.innerHeight);attachLoginEventHandler(a.data)}};

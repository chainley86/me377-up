/*
 version 2.8.0.424, Copyright (c) 2014, Exor International SpA., http://www.jmobile.net
*/
'use strict';(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var f=(new Date).getTime(),g=Math.min(Math.max(0,16-(f-a)),1E3),h=window.setTimeout(function(){b(f+g)},g);a=f+g;return h});window.cancelAnimationFrame||
(window.cancelAnimationFrame=function(a){clearTimeout(a)})})();Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b});Date.now||(Date.now=function(){return(new Date).getTime()});
(function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var d=document.createEvent("CustomEvent");d.initCustomEvent(a,c.bubbles,c.cancelable,c.detail);return d}if("function"===typeof window.CustomEvent)return!1;a.prototype=window.Event.prototype;window.CustomEvent=a})();Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});
Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};this.prototype&&(d.prototype=this.prototype);e.prototype=new d;return e});
(function(a){a.forEach(function(a){a.hasOwnProperty("remove")||Object.defineProperty(a,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){null!==this.parentNode&&this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);function Cache(){this.cache.tags={};this.cache.props={}}Cache.prototype.constructor=Cache;Cache.prototype.cache={};
Cache.prototype.updateTag=function(a,b){var c=this.cache.tags[a];if(null==c)return this.cache.tags[a]=new Tag(b.n,-1,b.v.v,"S_OK",b.v.q,b.v.ts),!0;if(b.constructor===Tag){if(b.isQualityGood()&&c.isQualityGood()&&b.value==c.value&&b.ts==c.ts&&null!=c.ts)return!1;this.cache.tags[a]=b}else{if(Quality.isQualityGood(b.v.q)&&c.isQualityGood()&&b.v.v==c.value&&b.v.ts==c.ts&&null!=c.ts)return!1;this.cache.tags[a].setState(b.n,-1,b.v.v,"S_OK",b.v.q,b.v.ts)}return!0};Cache.prototype.getTag=function(a){return this.cache.tags[a]};
Cache.prototype.clone=function(){var a={};if(this.cache)for(var b in this.cache.tags)a[b]=this.cache.tags[b].clone();return a};Cache.prototype.setWgtProp=function(a,b,c){this.cache.props[a]||(this.cache.props[a]={});this.cache.props[a][b]=c};Cache.prototype.getWgtProp=function(a,b){if(this.cache.props[a])return this.cache.props[a][b]};Cache.prototype.hasWgtProps=function(a){return this.cache.props[a]?!0:!1};Cache.prototype.clear=function(){this.cache.tags={};this.cache.props={}};
function DateTime(){this.date=moment();this.start()}DateTime.prototype.setTime=function(a,b){this.date.hour(a);this.date.minutes(b)};DateTime.prototype.setDate=function(a,b,c){this.date.dates(a);this.date.month(b);this.date.year(c)};DateTime.prototype.getValue=function(a,b,c){return this.date.clone().toDate()};DateTime.prototype.getUTCValue=function(a,b,c){return this.date.clone().utc().toDate()};
DateTime.prototype.start=function(){var a=this;this.interval=setInterval(function(){a.date.add(1,"s")},1E3)};DateTime.prototype.stop=function(){clearInterval(this.interval)};function DateFormat(a,b){this.date=a;this.format=b}
DateFormat.prototype.formatDateTimeValue=function(){var a=this.format,b=!1;a.match(/(ap|a)/i)&&(b=!0);b=this.computeTimeParams(b);a=a.replace(/(ap|a)/i,b.amPm);a=a.replace(/MMM/,b.months[b.dt.getMonth()]);a=a.replace(/DD/,b.cdate);a=a.replace(/YYYY/,b.cyear4);a=a.replace(/YY/,b.cyear2);a=a.replace(/MM/,b.cmonth);a=a.replace(/(hh|h)/,b.hrs);a=a.replace(/mm/,b.mts);a=a.replace(/ss/,b.sec);return a.trim()};
DateFormat.prototype.computeTimeParams=function(a){var b={months:"Jan Feb Mar Apr May June July Aug Sep Oct Nov Dec".split(" ")};if("date"!=$.type(this.date).toLowerCase())return null;b.dt=this.date;b.cdate=10>this.date.getDate()?"0"+this.date.getDate():this.date.getDate();b.cmonth=10>this.date.getMonth()+1?"0"+(this.date.getMonth()+1):this.date.getMonth()+1;b.cyear2=this.date.getFullYear().toString().slice(2);b.cyear4=this.date.getFullYear();b.hrs=10>this.date.getHours()?"0"+this.date.getHours():
this.date.getHours();b.mts=10>this.date.getMinutes()?"0"+this.date.getMinutes():this.date.getMinutes();b.sec=10>this.date.getSeconds()?"0"+this.date.getSeconds():this.date.getSeconds();a&&(b.amPm=12>parseInt(b.hrs)?"AM":"PM",b.hrs=13>parseInt(b.hrs)?b.hrs:10>parseInt(b.hrs)-12?"0"+(parseInt(b.hrs)-12):parseInt(b.hrs)-12);return b};
function Quality(a){a&&(this.qual=(a&Quality.prototype.MASKQUALITY)>>6,this.substatus=(a&Quality.prototype.MASKSUBSTATUS)>>2,this.limit=a&Quality.prototype.MASKLIMITS)}Quality.prototype.constructor=Quality;Quality.prototype.MASKQUALITY=192;Quality.prototype.MASKSUBSTATUS=60;Quality.prototype.MASKLIMITS=3;Quality.prototype.QualityStatus={QUALITY_BAD:0,QUALITY_UNCERTAIN:1,QUALITY_GOOD:3};
Quality.prototype.BadQualitySubstatus={SUBSTATUS_NON_SPECIFIC:0,SUBSTATUS_CONFIGURATION_ERROR:1,SUBSTATUS_NOT_CONNECTED:2,SUBSTATUS_DEVICE_FAILURE:3,SUBSTATUS_TIMEOUT_FAILURE:4,SUBSTATUS_COMMUNICATION_FAILURE:6,SUBSTATUS_NOBOUNDS:7,SUBSTATUS_NODATA:8};Quality.prototype.UncertainQualitySubstatus={SUBSTATUS_ENGINEERING_UNITS_EXCEEDED:5};Quality.prototype.LimitType={LT_NOT_LIMITED:0,LT_LOW_LIMITED:1,LT_HIGH_LIMITED:2,LT_CONSTANT:3};Quality.prototype.qual=null;Quality.prototype.substatus=null;
Quality.prototype.limit=null;Quality.prototype.getStatus=function(){return this.qual};Quality.prototype.setState=function(a){this.qual=(a&Quality.prototype.MASKQUALITY)>>6;this.substatus=(a&Quality.prototype.MASKSUBSTATUS)>>2;this.limit=a&Quality.prototype.MASKLIMITS};Quality.prototype.setStatus=function(a){this.qual=a};Quality.prototype.clone=function(){var a=new Quality;a.qual=this.qual;a.substatus=this.substatus;a.limit=this.limit;return a};
Quality.prototype.toString=function(){return this.qual<<6|this.substatus<<2|this.limit};Quality.prototype.isQualityGood=function(){return this.qual==this.QualityStatus.QUALITY_GOOD};Quality.isQualityGood=function(a){return(a&Quality.prototype.MASKQUALITY)>>6==Quality.prototype.QualityStatus.QUALITY_GOOD};Quality.prototype.isQualityUncertain=function(){return this.qual==this.QualityStatus.QUALITY_UNCERTAIN};Quality.prototype.isQualityBad=function(){return this.qual==this.QualityStatus.QUALITY_BAD};
function State(a,b,c,d,e){this.setState(a,b,c,d,e)}State.prototype.constructor="State";State.prototype.timestamp=null;State.prototype.value=null;State.prototype.quality=null;State.prototype.type=null;State.prototype.setState=function(a,b,c,d,e){this.quality=a&&a.constructor==Quality?a:new Quality(a);this.value=void 0;this.quality.isQualityGood()&&(this.value=b);this.type=c;this.ts=new Date(e);this.code=new MessageStatus(d);return this};State.prototype.setValue=function(a){this.value=a};
State.prototype.getValue=function(){return this.value};State.prototype.getQuality=function(){return this.quality};State.prototype.getTimestamp=function(){return this.ts.getTime()};State.prototype.setTimestamp=function(a){this.ts=new Date(a)};State.prototype.isQualityGood=function(){return this.quality.isQualityGood()};State.prototype.setQualityStatus=function(a){if(this.quality)this.quality.setStatus(a);else{var b=new Quality;b.setStatus(a);this.quality=b}};
State.prototype.getQualityBits=function(){return this.quality.qual<<6|this.quality.substatus<<2|this.quality.limit};State.prototype.setMessageCode=function(a){this.code=a};State.prototype.getMessageStatus=function(){return this.code};function Group(){}Group.prototype.info=null;Group.prototype.tags=null;
Group.prototype.setState=function(a,b,c){this.info={name:a,code:new MessageStatus(b)};if(c instanceof Array)for(this.tags=Array(c.length),a=0,b=c.length;a<b;a++){var d=c[a];this.tags[a]=(new Tag).setState(d.name,-1,d.value,d.code,d.quality)}return this};Group.prototype.getTag=function(a){for(var b=0,c=this.tags.length;b<c;b++)if(this.tags[b].name==a)return this.tags[b].value};Group.prototype.getCount=function(){return this.tags.length};
Group.prototype.getTags=function(){for(var a=[],b=0;b<this.tags.length;b++)a.push(this.tags[b].name);return a};Group.prototype.getTagArray=function(){return this.tags};Group.prototype.getMessageStatus=function(){return this.info.code};function Tag(a,b,c,d,e,f){this.setState(a,b,c,d,e,f)}Tag.prototype.name="";Tag.prototype.type="";Tag.prototype.index=-1;Tag.prototype.code=null;Tag.prototype.quality=null;Tag.prototype.value=null;Tag.prototype.ts=null;Tag.prototype.getQuality=function(){return this.quality};
Tag.prototype.enumType={BOOLEAN:0,BYTE:1,SHORT:2,INT:3,UNSIGNEDBYTE:4,UNSIGNEDSHORT:5,UNSIGNEDINT:6,FLOAT:7,DOUBLE:8,STRING:9,BINARY:10,TIME:11,INT64:12,UINT64:13,INT64A:14,UINT64A:15};
Tag.prototype.getNumberOfBits=function(a){var b=Tag.prototype.enumType;switch(a){case b.BOOLEAN:return 1;case b.UNSIGNEDBYTE:case b.BYTE:return 8;case b.UNSIGNEDSHORT:case b.SHORT:return 16;case b.UNSIGNEDINT:case b.FLOAT:case b.INT:return 32;case b.DOUBLE:case b.UINT64:return 64;case b.STRING:case b.BINARY:case b.TIME:return 0;case b.INT64:case b.UINT64:case b.INT64A:case b.UINT64A:return 64}};
Tag.prototype.getTypeRange=function(a){var b=Tag.prototype.enumType;switch(a){case b.BOOLEAN:return{min:0,max:1};case b.BYTE:return{min:-128,max:127};case b.SHORT:return{min:-32768,max:32767};case b.INT:return{min:-21E8,max:21E8};case b.UNSIGNEDBYTE:return{min:0,max:255};case b.UNSIGNEDSHORT:return{min:0,max:65535};case b.UNSIGNEDINT:return{min:0,max:42E8};case b.FLOAT:return{min:-3.4E38,max:3.4E38};case b.DOUBLE:return{min:-1.79E308,max:1.79E308};case b.STRING:case b.BINARY:case b.TIME:return null;
case b.INT64A:case b.INT64:return{min:-Math.pow(2,63),max:Math.pow(2,63)-1};case b.UINT64A:case b.UINT64:return{min:0,max:Math.pow(2,64)-1}}};Tag.prototype.setQuality=function(a){this.quality=a};
Tag.prototype.setState=function(a,b,c,d,e,f){this.name=a;this.index=b;this.value=c;(b=$hmi.activeProject.getWidget("_TagMgr",!0).tagsInfo)&&null!=b[a]&&$hmi.activeProject.getWidget("_TagMgr",!0).tagsInfo[a].t==this.enumType.TIME&&"string"==typeof c&&(this.value=(new Date(c)).getTime()/1E3);null!=this.code?this.code.setState(d):this.code=new MessageStatus(d);null!=this.quality?this.quality.setState(e):this.quality=new Quality(e);this.ts=f;return this};
Tag.prototype.clone=function(a){var b=void 0==a?!0:a;a=this.value;a=this.value instanceof Array?b?a.slice():this.value:$.extend(b,{},this.value);b=new Tag;b.name=this.name;b.index=this.index;b.value=a;b.code=this.code.clone();b.quality=this.quality.clone();return b};Tag.prototype.getState=function(a){return new State(this.quality,this.getValue(a),"",this.code,this.ts)};Tag.prototype.getMessageStatus=function(){return this.code};Tag.prototype.getTimestamp=function(){return this.ts};
Tag.prototype.getValue=function(a){return Array.isArray(this.value)&&0<=a?this.value[a]:this.value};Tag.prototype.setValue=function(a){this.value=a};Tag.prototype.isQualityGood=function(){return this.quality.isQualityGood()};Tag.prototype.compareTo=function(a){return a.value===this.value?0:-1};Tag.prototype.constructor=Tag;Tag.prototype.QUALITY_GOOD=new Quality(192);function Property(a,b){this.name=a;this.value=b}Property.prototype.name=null;Property.prototype.value=null;
Property.prototype.setState=function(a,b,c){this.name=a;this.value=b;this.code=new MessageStatus(c);return this};Property.prototype.getMessageStatus=function(){return this.code};Property.prototype.getValue=function(){return this.value};Property.prototype.constructor=Property;function Alarm(a,b,c,d,e,f,g,h){this.setState(a,b,c,d,e,f,g,h)}
Alarm.prototype.stateType={STATE_NOT_TRIGGERED:0,STATE_DISABLED:1,STATE_TRIGGERED:2,STATE_TRIGGERED_NOT_ACKED:3,STATE_NOT_TRIGGERED_ACKED:4,STATE_NOT_TRIGGERED_NOT_ACKED:5,STATE_TRIGGERED_ACKED:6,STATE_ALARM_MAX:7};Alarm.prototype.constructor=Alarm;Alarm.prototype.dirty=!1;Alarm.prototype.alarmId=null;Alarm.prototype.liveData=null;Alarm.prototype.liveTags=null;Alarm.prototype.alDate=null;Alarm.prototype.alDateTime=null;Alarm.prototype.alDescription=null;Alarm.prototype.alEnable=!1;
Alarm.prototype.alName=null;Alarm.prototype.alSelect=!1;Alarm.prototype.alState=Alarm.prototype.stateType.STATE_DISABLED;Alarm.prototype.alValue=null;Alarm.prototype.comment=null;Alarm.prototype.alGroups=null;Alarm.prototype.alRemoteEnable=null;Alarm.prototype.alSeverity=null;Alarm.prototype.alTime=null;Alarm.prototype.BGColor=null;Alarm.prototype.FGColor=null;Alarm.prototype.disBGColor=null;Alarm.prototype.disTXColor=null;Alarm.prototype.tBGColor=null;Alarm.prototype.tTXColor=null;
Alarm.prototype.tNABGColor=null;Alarm.prototype.tNATXColor=null;Alarm.prototype.nTABGColor=null;Alarm.prototype.nTATXColor=null;Alarm.prototype.nTNABGColor=null;Alarm.prototype.nTNATXColor=null;Alarm.prototype.tABGColor=null;Alarm.prototype.tATXColor=null;Alarm.prototype.blink=null;Alarm.prototype.code=null;Alarm.prototype.xmlOrder=0;
Alarm.prototype.setState=function(a,b,c,d,e,f,g,h){this.alName=a;void 0!==b&&(this.alState=parseInt(b));this.alEnable=this.alState==Alarm.prototype.stateType.STATE_DISABLED?!1:!0;this.alValue=parseFloat(c);d&&(this.alDateTime=d,this.alDate=e,this.alTime=f);g&&(this.code=new MessageStatus(g));this.liveTags=h;return this};
Alarm.prototype.stateToString=function(){switch(this.alState){case Alarm.prototype.stateType.STATE_NOT_TRIGGERED:return"Not Triggered";case Alarm.prototype.stateType.STATE_TRIGGERED:return"Triggered";case Alarm.prototype.stateType.STATE_TRIGGERED_NOT_ACKED:return"Triggered Not Acked";case Alarm.prototype.stateType.STATE_NOT_TRIGGERED_ACKED:return"Not Triggered Acked";case Alarm.prototype.stateType.STATE_NOT_TRIGGERED_NOT_ACKED:return"Not Triggered Not Acked";case Alarm.prototype.stateType.STATE_TRIGGERED_ACKED:return"Triggered Acked";
case Alarm.prototype.stateType.STATE_DISABLED:return"Disabled";default:return"unknown"}};
Alarm.prototype.update=function(a){var b=!1;if(null==this.alEnable||this.alEnable!=a.alEnable)this.alEnable=a.alEnable,b=!0;if(null==this.alState||this.alState!=a.alState)this.alState=a.alState,b=!0;if(null==this.alValue||this.alValue!=a.alValue)this.alValue=a.alValue,b=!0;if(null==this.alDateTime||this.alDateTime!=a.alDateTime)this.alDateTime=a.alDateTime,this.alDate=a.alDate,this.alTime=a.alTime,b=!0;if(this.liveTags)for(var c in this.liveTags)if(this.liveTags[c]!=a.liveTags[c]){b=!0;break}this.liveTags=
a.liveTags;return b};Alarm.prototype.updateProperty=function(a,b){return"undefined"!=typeof this[a]&&this[a]!=b?(this[a]=b,!0):!1};Alarm.prototype.getMessageStatus=function(){return this.code};Alarm.prototype.isDirty=function(){return this.dirty};Alarm.prototype.setDirty=function(a){this.dirty=a};function IDALEvent(a,b,c,d,e,f){this.setState(a,b,c,d,e,f)}IDALEvent.prototype.type=null;IDALEvent.prototype.subtype=null;IDALEvent.prototype.evtType=null;IDALEvent.prototype.time=null;
IDALEvent.prototype.code=null;IDALEvent.prototype.data=null;IDALEvent.prototype.setState=function(a,b,c,d,e,f){this.type=parseFloat(a);this.subtype=parseFloat(b);this.evtType=c;this.time=d;this.data=e;this.code=new MessageStatus(f);return this};IDALEvent.prototype.getMessageStatus=function(){return this.code};IDALEvent.prototype.getData=function(){return this.data};IDALEvent.prototype.setData=function(a){this.data=a};IDALEvent.prototype.constructor=IDALEvent;
function Sample(a,b,c,d){this.setState(a,b,c,d)}Sample.prototype.x=null;Sample.prototype.q=null;Sample.prototype.y=null;Sample.prototype.selected=!1;Sample.prototype.drw=!0;Sample.prototype.setState=function(a,b,c){this.x=a;this.y=b;this.q=new Quality(c);return this};Sample.prototype.setDrawable=function(a){this.drw=a};Sample.prototype.select=function(a){this.selected=a};Sample.prototype.getValue=function(){return this.v};Sample.prototype.constructor=Sample;function RecipeObj(){}
function Recipe(a,b,c,d,e,f,g){this.id=a;this.Name=b;this.Status=c;this.RecipeSetList=d;this.selSet=e;this.lastSet=f;g&&(this.rcList=g)}Recipe.prototype=Object.create(RecipeObj.prototype);Recipe.prototype.Name=null;Recipe.prototype.Status=null;Recipe.prototype.RecipeSetList=null;Recipe.prototype.selSet=null;Recipe.prototype.lastSet=null;Recipe.prototype.rcList=null;Recipe.prototype.constructor=Recipe;function RecipeSet(a,b,c,d){this.id=a;this.Name=b;this.Value=c;this.elemList=d}
RecipeSet.prototype=Object.create(RecipeObj.prototype);RecipeSet.prototype.id=null;RecipeSet.prototype.Name=null;RecipeSet.prototype.Value=null;RecipeSet.prototype.elemList=null;RecipeSet.prototype.constructor=RecipeSet;function RecipeSetElem(a,b,c){this.id=a;this.Name=b;this.Value=c}RecipeSetElem.prototype=Object.create(RecipeObj.prototype);RecipeSetElem.prototype.id=null;RecipeSetElem.prototype.Name=null;RecipeSetElem.prototype.Value=null;RecipeSetElem.prototype.constructor=RecipeSetElem;
function MessageStatus(a){a&&(this.code=this.status[a])}MessageStatus.prototype.code=null;MessageStatus.prototype.status={E_FAIL:0,S_OK:1,E_INVALIDARG:2,E_NO_SESSION_EXIST:3,E_NEED_LOGIN:4,E_UNKNOWNGROUP:5,E_INACTIVEGROUP:6,E_PROPERTY_NOT_MAPPED:7,E_RESOURCE_LOCATOR_NOT_FOUND:8,E_CONFIG_FILE_NOT_FOUND:9,E_INVALID_PROPERTY:10,E_READ_FORBIDDEN:11,E_INACTIVETAG:12,E_NOT_BINDED_TO_PROTOCOL:13,E_UNKNOWNTAG:14,E_TIMEOUT:15,E_INIT:16};MessageStatus.prototype.setState=function(a){this.code=this.status[a]};
MessageStatus.prototype.toString=function(){switch(this.code){case this.status.E_FAIL:return"Request Failed";case this.status.S_OK:return"Success";case this.status.E_INVALIDARG:return"Invalid Arguments";case this.status.E_NO_SESSION_EXIST:return"No Session Exists";case this.status.E_NEED_LOGIN:return"Need New Login";case this.status.E_UNKNOWNGROUP:return"Unknown Group";case this.status.E_INACTIVEGROUP:return"Inactive Group";case this.status.E_PROPERTY_NOT_MAPPED:return"Property Not Mapped";case this.status.E_RESOURCE_LOCATOR_NOT_FOUND:return"Resource Not Found";
case this.status.E_CONFIG_FILE_NOT_FOUND:return"Configuration File Not Found";case this.status.E_INVALID_PROPERTY:return"Invalid Property";case this.status.E_READ_FORBIDDEN:return"Read Forbidden";case this.status.E_INACTIVETAG:return"Tag is not active";case this.status.E_NOT_BINDED_TO_PROTOCOL:return"Protocol is not binded";case this.status.E_UNKNOWNTAG:return"Tag Name Is Not Known";case this.status.E_TIMEOUT:return"Timeout Request";case this.status.E_INIT:return"Error on Initialization"}};
MessageStatus.prototype.getValue=function(){return this.code};MessageStatus.prototype.clone=function(){var a=new MessageStatus;a.code=this.code;return a};function ServerInterface(a){}
ServerInterface.prototype.getServerConf=function(){var a=window.location.href.substring(0,window.location.href.lastIndexOf("/web/")+5),b={};$.ajax({type:"GET",url:a+"config/server.json",dataType:"JSON",async:!1,cache:!1}).always(function(a){a.status?200!=a.status&&(b={active:"offline",offline:{pollRate:"0",status:-1}}):b=a});return b};ServerInterface.prototype.getAlarmConf=function(){};ServerInterface.prototype.getGroupsConf=function(){};ServerInterface.prototype.getTagsConf=function(){};
ServerInterface.prototype.getTrendsConf=function(){};ServerInterface.prototype.isLogged=function(){};ServerInterface.prototype.readTag=function(a,b){};ServerInterface.prototype.writeTag=function(a,b){};ServerInterface.prototype.readGroup=function(a,b){};ServerInterface.prototype.readGroups=function(a,b){};ServerInterface.prototype.readTrend=function(a,b,c,d,e){};ServerInterface.prototype.deleteTrend=function(a,b){};ServerInterface.prototype.dumpTrend=function(a,b,c,d,e,f,g){};
ServerInterface.prototype.activateGroup=function(a,b){};ServerInterface.prototype.deactivateGroup=function(a,b){};ServerInterface.prototype.readAlarms=function(a,b){};ServerInterface.prototype.resetAlarms=function(a,b){};ServerInterface.prototype.acknowledgeAlarms=function(a,b){};ServerInterface.prototype.enableAlarms=function(a,b,c){};ServerJMobile.prototype.saveConfiguration=function(a){};ServerInterface.prototype.readTags=function(a,b){};ServerInterface.prototype.writeTags=function(a,b,c){};
ServerInterface.prototype.activateGroups=function(a,b){};ServerInterface.prototype.deactivateGroups=function(a,b){};ServerInterface.prototype.deleteEventArchive=function(a,b){};ServerInterface.prototype.setLocalTime=function(a,b,c,d,e,f,g){};ServerInterface.prototype.getLocalTime=function(a){};ServerInterface.prototype.getDLSSettings=function(a){};ServerInterface.prototype.getProperty=function(a,b){};ServerInterface.prototype.getRecipeList=function(a){};
ServerInterface.prototype.getRecipeSetList=function(a,b){};ServerInterface.prototype.getRecipeSet=function(a,b,c){};ServerInterface.prototype.getRecipeParams=function(a,b,c){};ServerInterface.prototype.getRecipeElemParam=function(a,b,c,d,e){};ServerInterface.prototype.setRecipeParam=function(a,b,c){};ServerInterface.prototype.setRecipeSetParam=function(a,b,c,d,e){};ServerInterface.prototype.setRecipeElemParam=function(a,b,c,d,e,f){};ServerInterface.prototype.downloadRecipe=function(a,b,c){};
ServerInterface.prototype.uploadRecipe=function(a,b,c){};ServerInterface.prototype.setRecipeSet=function(a,b,c){};ServerInterface.prototype.setCurrentRecipe=function(a,b,c){};ServerInterface.prototype.resetRecipe=function(a,b){};ServerInterface.prototype.dumpRecipeData=function(a,b,c,d,e,f,g,h){};ServerInterface.prototype.restoreRecipeData=function(a,b,c,d,e,f,g,h){};ServerInterface.prototype.getProperties=function(a,b){};ServerInterface.prototype.setProperties=function(a,b){};
ServerInterface.prototype.subscribeNotification=function(a,b){};ServerInterface.prototype.unsubscribeNotification=function(a,b){};ServerInterface.prototype.subscribeAlarms=function(a,b){};ServerInterface.prototype.subscribeEvent=function(a,b){};ServerInterface.prototype.unsubscribeEvent=function(a){};ServerInterface.prototype.subscribeGroups=function(a,b){};ServerInterface.prototype.unsubscribeGroups=function(a){};ServerInterface.prototype.subscribeTags=function(a,b){};
ServerInterface.prototype.unsubscribeTags=function(a,b){};ServerInterface.prototype.subscribeRecipe=function(a,b){};ServerInterface.prototype.subscribeRecipeSetList=function(a,b){};ServerInterface.prototype.subscribeRecipeSet=function(a,b,c){};ServerInterface.prototype.subscribeRecipeSetElem=function(a,b,c,d){};ServerInterface.prototype.isSessionAlive=function(){};ServerInterface.prototype.onConnectionReady=function(a){};ServerInterface.prototype.getConnectionStatus=function(){};
ServerInterface.prototype.conf={exception:{ipad1:!1},ssemode:0};ServerInterface.prototype.getOptions=function(){return this.conf};ServerInterface.prototype.enableOption=function(a){};ServerInterface.prototype.logOut=function(){};ServerInterface.prototype.changePwd=function(){};ServerInterface.prototype.getResource=function(a){};function ServerFactory(){}
ServerFactory.prototype.createServer=function(a){switch(a.active){case "PollingInterface":this.serverClass=PollingInterface;break;case "SSEInterface":this.serverClass=SSEInterface;break;case "offline":this.serverClass=SSEInterface}return new this.serverClass(a)};
function jsonPRequest(a){var b=navigator.userAgent,c=document.createElement("script"),b=-1!=b.indexOf("Chrome")?"text/javascript":"text/html";c.setAttribute("class","hmi-jsonp-req");c.setAttribute("src",a);c.setAttribute("type",b);document.head.appendChild(c)}
function WebWorkerPromise(a){this.idSeed=0;this.resolves={};this.rejects={};this.worker=a;var b=this;this.worker.addEventListener("message",function(a){var d=a.data;if(d&&"API"==d.e){a=d.id;var e=d.err,d=d.data;e?(d=b.rejects[a])&&d(e):(e=b.resolves[a])&&e(d);delete b.resolves[a];delete b.rejects[a]}})}WebWorkerPromise.prototype.postMessage=function(a){var b=this.idSeed++;a.id=b;var c=this;return new Promise(function(d,e){c.rejects[b]=e;c.resolves[b]=d;c.worker.postMessage(a)})};
function ServerJMobile(a){this.url=window.location.protocol+"//"+window.location.host;this.pathName=window.location.pathname;this.projectName=a.projectName;var b=this;-1!=a[a.active].status&&this.getProperty("projectRelativePath",!0).then(function(a){var c=a.getMessageStatus().getValue();c==MessageStatus.prototype.status.S_OK?(b.projectPath=a.getValue().substring(10),b.webProjectUrl=b.url+"/"+b.projectPath+"/web/web",b.loginStatus=!0):c==MessageStatus.prototype.status.E_PROPERTY_NOT_MAPPED&&(b.webProjectUrl=
b.url+"/web",b.loginStatus=!0)},function(a){a.getMessageStatus().getValue()==MessageStatus.prototype.status.E_NEED_LOGIN&&(location.href=b.url+b.getLoginRoute())});for(var c in a)this[c]=a[c]}ServerJMobile.prototype=Object.create(ServerInterface.prototype);ServerJMobile.prototype.projectPath="";ServerJMobile.prototype.loginStatus=!1;ServerJMobile.prototype.setUrl=function(a){this.url=a};ServerJMobile.prototype.isLogged=function(){return this.loginStatus};
ServerJMobile.prototype.getProperty=function(a,b){return $.ajax({url:this.url+"/cgi/getProperties",data:"n=1&it1="+a+"&nocache=1",async:!b,cache:!1}).then(function(a){var b=new Property;a=a.split("\t");var e=a[1].trim();return"S_OK"==e?b.setState(a[0],a[2],e):b.setState(a[0],null,e)},function(a){var b=new Property;return a.responseText?b.setState(null,null,a.responseText.trim().replace("#","")):b.setState(null,null,"E_TIMEOUT")})};
ServerJMobile.prototype.activateTag=function(a,b,c){return $.ajax({type:"POST",url:this.url+"/cgi/"+(b?"":"de")+"activateTags",data:"n=1&t1="+a,async:c})};ServerJMobile.prototype.configuration={};ServerJMobile.prototype.defConf=null;ServerJMobile.prototype.requestConf=function(){this.defConf=$.ajax({type:"GET",dataType:"json",url:this.webProjectUrl+"/config/conf.json",cache:!1})};ServerJMobile.prototype.getConf=function(){return this.defConf};
ServerJMobile.prototype.getAlarmConf=function(){return $.ajax({type:"GET",dataType:"json",url:this.webProjectUrl+"/config/alarms.json",cache:!1})};ServerJMobile.prototype.getPropsMap=function(){return this._getConf("propsMap.json")};ServerJMobile.prototype.getGroupsConf=function(){return this._getConf("groups.json")};ServerJMobile.prototype.getTagsConf=function(){return this._getConf("tags.json")};ServerJMobile.prototype.getTrendsConf=function(){return this._getConf("trends.json")};
ServerJMobile.prototype.getRecipesConf=function(){return this._getConf("recipes.json")};ServerJMobile.prototype._getConf=function(a){return $.ajax({type:"GET",dataType:"json",url:this.webProjectUrl+"/config/"+a,cache:!1})};
ServerJMobile.prototype.readTags=function(a,b){for(var c="",d=a.length,e=0;e<d;e++)c+="&t"+(e+1)+"="+a[e];var c="n="+d+c+"&nocache=1",f=this;return this.activateTags(a,b).then(function(a){if(0<=a.indexOf("S_OK"))return $.ajax({type:"POST",dataType:"json",url:f.url+"/cgi/readTags.json",data:c,async:!b})}).then(function(a){var b=[];if(null!=a)for(var c=0;c<a.tgs.length;c++){var d=a.tgs[c];b.push((new Tag).setState(d.name,-1,d.value,d.code,d.quality))}return b}).fail(function(a){return[]})};
ServerJMobile.prototype.activateTags=function(a,b){return this._activateTags(a,!0,b)};ServerJMobile.prototype.deactivateTags=function(a,b){return this._activateTags(a,!1,b)};ServerJMobile.prototype._activateTags=function(a,b,c){for(var d="",e=a.length,f=0;f<e;f++)d+="&t"+(f+1)+"="+a[f];return $.ajax({type:"POST",url:this.url+"/cgi/"+(b?"":"de")+"activateTags",data:"n="+e+d,async:!c})};
ServerJMobile.prototype.readTag=function(a,b){return b?this._readTagsJsonSync(a.name,a.index):this._readTagsJsonAsynch(a.name,a.index)};
ServerJMobile.prototype._readTagsJsonSync=function(a,b){var c=this.url+"/cgi/readTags.json",d="returnType=true&returnTS=true&n=1&t1="+encodeURIComponent(a)+"."+b+"&nocache=1",e=this;return this.activateTag(a,!0,!1).then(function(a){if(0<=a.indexOf("S_OK"))return $.ajax({dataType:"json",url:c,data:d,async:!1})}).then(function(b){var c=new State;null!=b&&(b=b.tgs[0],c.setState(b.quality,b.value,b.type,b.code,b.ts),e.activateTag(a,!1,!0));return c}).fail(function(){var a=new State;a.setMessageCode(MessageStatus.prototype.status.E_TIMEOUT);
return a})};
ServerJMobile.prototype._readTagsJsonAsynch=function(a,b){var c=this.url+"/cgi/readTags.json",d="returnType=true&returnTS=true&n=1&t1="+encodeURIComponent(a)+"."+b+"&nocache=1",e=this;return this.activateTag(a,!0,!0).then(function(a){if(0<=a.indexOf("S_OK"))return $.getJSON(c,d);if(0<=a.indexOf("E_UNKNOWNTAG")){a=a.split("\t");var b=new MessageStatus("E_UNKNOWNTAG");$hmi.showErrorMessage("Communication Error",b.toString()+": "+a[0])}return null}).then(function(b){var c=new State;null!=b&&(b=b.tgs[0],
c.setState(b.quality,b.value,b.type,b.code,b.ts),e.activateTag(a,!1,!0));return c}).fail(function(){var a=new State;a.setMessageCode(MessageStatus.prototype.status.E_TIMEOUT);return a})};
ServerJMobile.prototype.writeTag=function(a,b,c,d){a="n=1&t1="+encodeURIComponent(a.name)+"."+a.index+"&v1="+encodeURIComponent(b)+"&nocache=1";var e={};return $.ajax({type:"POST",dataType:"JSON",url:this.url+"/cgi/writeTags.json",data:a,timeout:3E4,async:!d}).then(function(a){null!=a&&(e=a.tgs[0],c.setState(e));return a})};ServerJMobile.prototype.readGroup=function(a,b,c){return c?this.readGroupJsonSync(a,b):this.readGroupJsonAsync(a,b)};
ServerJMobile.prototype.readGroupJsonAsync=function(a,b){return $.ajax({type:"GET",dataType:"JSON",url:this.url+"/cgi/readGroups.json",data:"n=1&gr1="+encodeURIComponent(a),cache:!1,timeout:12E3}).then(function(a){a=a.gs[0];b.setState(a.g.name,a.g.code,a.tgs);return b})};
ServerJMobile.prototype.readGroupJsonSync=function(a,b){return $.ajax({type:"GET",dataType:"JSON",url:this.url+"/cgi/readGroups.json",data:"n=1&gr1="+encodeURIComponent(a),cache:!1,timeout:12E3,async:!1}).then(function(a){var d=a.gs[0];b.setState(d.g.name,d.g.code,d.tgs);return a})};
ServerJMobile.prototype.readGroups=function(a,b,c){for(var d=a.length,e="",f=1;f<=d;f++)e+="gr"+f+"="+a[f-1],f!=d&&(e+="&");return $.ajax({type:"GET",dataType:"JSON",url:this.url+"/cgi/readGroups.json",data:"n="+d+"&"+encodeURIComponent(e),cache:!1,async:!c,timeout:12E3}).then(function(a){for(var c=0;c<a.gs.length;c++){var d=a.gs[c],e=[];if(d.tgs)for(var f=d.tgs.length,m=0;m<f;m++){var p=d.tgs[m];e.push((new Tag).setState(p.name,-1,p.value,p.code,p.quality))}b.push((new Group).setState(d.g.name,d.g.code,
e))}})};ServerJMobile.prototype.activateGroup=function(a,b,c){return this._activateGroupsJson(a,b,!0,c)};ServerJMobile.prototype.deactivateGroup=function(a,b,c){return this._activateGroupsJson(a,b,!1,c)};ServerJMobile.prototype._activateGroupsJson=function(a,b,c,d){var e=this.url;return $.ajax({type:"POST",url:c?e+"/cgi/activateGroups.json":e+"/cgi/deactivateGroups.json",data:"n=1&gr1="+a,dataType:"JSON",async:!d}).then(function(a){a=a.gs[0];c&&b.setState(a.name,a.code);return b})};
ServerJMobile.prototype.getDLSSettings=function(a){return $.ajax({type:"GET",url:this.url+"/cgi/getDLSSettings",async:!a}).then(function(a){a=a.split("\n");var c={};"#S_OK"==a[0]?(c.status=a[0],c.stdoff=parseFloat(a[1]),c.stdw=parseFloat(a[2]),c.stdd=parseFloat(a[3]),c.stdm=parseFloat(a[4]),c.stdhh=parseFloat(a[5]),c.stdmm=parseFloat(a[6]),c.dlsoff=parseFloat(a[7]),c.dlsw=parseFloat(a[8]),c.dlsd=parseFloat(a[9]),c.dlsm=parseFloat(a[10]),c.dlshh=parseFloat(a[11]),c.dlsmm=parseFloat(a[12]),c.mode=parseFloat(a[13])):
c.status=a[0];return c})};ServerJMobile.prototype.getLocalTime=function(a){return $.ajax({type:"GET",url:this.url+"/cgi/getLocalTime",async:!a}).then(function(a){a=a.split("\n");var c={};"#S_OK"==a[0]?(c.status=a[0],c.time=a[1]):c.status=a[0];return c})};ServerJMobile.prototype.setLocalTime=function(a,b,c,d,e,f,g){return $.ajax({type:"GET",url:this.url+"/cgi/setLocalTime",data:"sec="+a+"&min="+b+"&hour="+c+"&day="+d+"&month="+e+"&year="+f,async:!g}).then(function(a){return{status:a}})};
ServerJMobile.prototype.getTime=function(a){return $.ajax({type:"GET",url:this.url+"/cgi/getTime?nocache=1",async:!a}).then(function(a){a=a.split("\n");var c={};"#S_OK"==a[0]?(c.status=a[0],c.time=1E3*parseFloat(a[1])):c.status=a[0];return c})};ServerJMobile.prototype.setTime=function(a,b){return $.ajax({type:"GET",url:this.url+"/cgi/setTime",data:"time="+a,async:!b}).then(function(a){return{status:a}})};
ServerJMobile.prototype.readAlarms=function(a,b){for(var c="",d=0,e=a.length,f=0;f<e;f++)c+="&al"+ ++d+"="+a[f];return $.ajax({type:"POST",url:this.url+"/cgi/readAlarms",data:"n="+d+c,timeout:12E3,async:!b}).then(function(a){return a})};ServerJMobile.prototype.resetAlarms=function(a,b){for(var c="",d=0,e=a.length,f=0;f<e;f++)c+="&al"+ ++d+"="+a[f];return $.ajax({type:"POST",url:this.url+"/cgi/resetAlarms",data:"n="+d+c,async:!b})};
ServerJMobile.prototype.acknowledgeAlarms=function(a,b){for(var c="",d=0,e=a.length,f=0;f<e;f++)c+="&al"+ ++d+"="+a[f];return $.ajax({type:"POST",url:this.url+"/cgi/acknowledgeAlarms",data:"n="+d+c,async:!b})};ServerJMobile.prototype.enableAlarms=function(a,b,c){for(var d="",e=0,f=a.length,g=0;g<f;g++)d+="&al"+ ++e+"="+a[g];return $.ajax({type:"POST",url:this.url+"/cgi/enableAlarms",data:"n="+e+d+"&enableflag="+b,async:!c})};
ServerJMobile.prototype.saveConfiguration=function(a){return $.ajax({type:"GET",url:this.url+"/cgi/saveConfiguration",cache:!1,async:!a})};ServerJMobile.prototype.getAlarms=function(){var a=this;$.get(this.strURL+"/browse?maxWait=10000&maxResult=3000&where=alarmName&hasValue=*").done(function(b){a.decodeAlarmList(b)}).done(function(){jQuery.isEmptyObject(a.alarmsBuffer)||a.requestData()})};ServerJMobile.prototype.readEvent=function(a,b){return this._GET(this.url+"/cgi/readEvent.json",a.toURL(),!1)};
ServerJMobile.prototype.getLoginRoute=function(){var a="_web";/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?a="_mobi":/iPad|RIM Tablet OS/i.test(navigator.userAgent)&&(a="_tablet");return"/public/"+a+"login.html?_="+(new Date).getTime()};ServerJMobile.prototype.deleteEventArchive=function(a){return $.ajax({type:"GET",url:this.url+"/cgi/deleteEventArchive",data:"archive="+a,timeout:12E3})};
ServerJMobile.prototype.deleteTrend=function(a,b){return this._GET(this.url+"/cgi/deleteTrendFile.json","tr="+a,b)};ServerJMobile.prototype.dumpTrend=function(a,b,c,d,e,f,g){var h=this.url+"/cgi/dumpTrendFile.json";a="tr="+a+"&folder="+b+"&dformat="+c+"&dtPrefix="+d+"&localTs="+e;f&&(a+="&fformat="+f);return this._POST(h,a,g)};
ServerJMobile.prototype.readTrend=function(a,b,c,d,e){a="tr="+a+"&returnTS=true&returnRT=false&startTime="+parseInt(b/1E3)+"&endTime="+parseInt(c/1E3);a=d?a+("&nSamples="+d):a+"&nSamples=0";a=(e?a+("&deltaTime="+e):a+"&deltaTime=0")+"&bounds=true";return $.ajax({type:"GET",url:this.url+"/cgi/readTrend.json",data:a,timeout:12E3}).then(function(a){a=JSON.parse(a);var b={n:a.n};if("S_OK"==a.code||"S_MOREDATA"==a.code){var c=a.d.length;b.d=Array(c);for(var d=0;d<c;d++){var e=a.d[d];(new Quality(e.q)).isQualityBad()&&
(e.v=void 0);b.d[d]=new Sample(1E3*e.rts,e.v,e.q)}}return{s:b,c:a.code}})};ServerJMobile.prototype._GET=function(a,b,c){return this._request("GET",a,b,c)};ServerJMobile.prototype._POST=function(a,b,c){return this._request("POST",a,b,c)};ServerJMobile.prototype._request=function(a,b,c,d){return $.ajax({type:a,dataType:"json",url:b,data:encodeURI(c),cache:!1,timeout:12E3,async:!d})};
ServerJMobile.prototype.downloadRecipe=function(a,b,c){return this._GET(this.url+"/cgi/downloadRecipe.json","rc="+a+"&st="+b,c)};ServerJMobile.prototype.uploadRecipe=function(a,b,c){return this._GET(this.url+"/cgi/uploadRecipe.json","rc="+a+"&st="+b,c)};ServerJMobile.prototype.setCurrentRecipe=function(a,b,c){var d=this.url+"/cgi/setCurrRecipe.json";a="rc="+a;null!==b&&void 0!==b&&(a+="&st="+b);return this._GET(d,a,c)};
ServerJMobile.prototype.setRecipeSet=function(a,b,c){return this._GET(this.url+"/cgi/setRecipeSet.json","rc="+a+"&st="+b,c)};ServerJMobile.prototype.resetRecipe=function(a,b){return this._GET(this.url+"/cgi/resetRecipe.json","rc="+a,b)};ServerJMobile.prototype.getRecipeList=function(a){return this._GET(this.url+"/cgi/getRecipeList.json","",a).then(function(a){return"S_OK"==a.code?a.rc:null})};
ServerJMobile.prototype.addRecipeDataSet=function(a,b,c,d,e){return this._GET(this.url+"/cgi/addRecipeDataSet.json","rc="+a+"&cp="+b+"&ns="+c+"&nt="+d,e)};ServerJMobile.prototype.delRecipeDataSet=function(a,b,c){return this._GET(this.url+"/cgi/delRecipeDataSet.json","rc="+a+"&s="+b,c)};
ServerJMobile.prototype.dumpRecipeData=function(a,b,c,d,e,f,g,h){var k=this.url+"/cgi/dumpRecipe.json";a="rc="+a+"&ds="+b+"&path="+encodeURIComponent(c)+"&fname="+d+"&dt="+f+"&ts="+g;void 0!=e&&(a+="&tname="+e);return this._GET(k,a,h)};ServerJMobile.prototype.restoreRecipeData=function(a,b,c,d,e,f,g,h){var k=this.url+"/cgi/restoreRecipe.json";a="rc="+a+"&st="+b+"&path="+c+"&fname="+d+"&rt="+g+"&browse="+f;void 0!=e&&(a+="&tname="+e);return this._GET(k,a,h)};
ServerJMobile.prototype.getRecipeSetList=function(a,b){return this._GET(this.url+"/cgi/getRecipeSets.json","rc="+a,b)};ServerJMobile.prototype._decodeRecipe=function(a){var b;a.p&&a.p.s&&a.p.s.el?b=new RecipeSetElem(a.p.s.el.id,a.p.s.el.n,a.p.s.el.v):a.p&&a.p.s?b=new RecipeSet(a.p.s.id,a.p.s.n,a.p.s.v):a.p&&(b=new Recipe(a.p.id,a.p.n,a.p.status,a.p.slist,a.p.selset,a.p.lastset));return b};
ServerJMobile.prototype.getRecipeParams=function(a,b,c){var d=this.url+"/cgi/getRecipeParams.json",e="";"all"==b&&(e="rc="+a+"&getid=true&getlastdwnset=true&getselset=true&getstatus=true&getsetlist=true");var f=this;return this._GET(d,e,c).then(function(a){if("S_OK"==a.code)return f._decodeRecipe(a)})};ServerJMobile.prototype.setRecipeParam=function(a,b,c){return this._GET(this.url+"/cgi/setRecipeParam.json","rc="+a+"&v="+b,c)};
ServerJMobile.prototype.setRecipeSetParam=function(a,b,c,d,e){return this._GET(this.url+"/cgi/setRecipeSetParam.json","rc="+a+"&s="+b+"&a="+c+"&v="+d,e)};ServerJMobile.prototype.setRecipeElemParam=function(a,b,c,d,e,f){return this._GET(this.url+"/cgi/setRecipeElemParam.json","rc="+a+"&s="+b+"&e="+c+"&a="+d+"&v="+e,f)};ServerJMobile.prototype._getRFlag=function(a){var b="";a=a.toLowerCase();"name"==a?b+="&getname=true":"status"==a?b+="&getstatus=true":"value"==a&&(b+="&getvalue=true");return b};
ServerJMobile.prototype.getRecipeParam=function(a,b,c){var d=this.url+"/cgi/getRecipeParams.json",e="&getid=true"+this._getRFlag(b),f=this;return this._GET(d,"rc="+a+e,c).then(function(a){return a&&"S_OK"==a.code?{v:f._decodeRecipe(a)[b]}:{err:a.code}})};
ServerJMobile.prototype.getRecipeSetParam=function(a,b,c,d){var e=this.url+"/cgi/getRecipeSetsParams.json",f="&getid=true"+this._getRFlag(c),g=this;return this._GET(e,"rc="+a+"&st="+b+f,d).then(function(a){return a&&"S_OK"==a.code?{v:g._decodeRecipe(a)[c]}:{err:a.code}})};
ServerJMobile.prototype.getRecipeElemParam=function(a,b,c,d){var e=this.url+"/cgi/getRecipeSetsParams.json",f="&getid=true&getelems=true"+this._getRFlag(d),g=this;return this._GET(e,"rc="+a+"&st="+b+"&i="+c+f,!0).then(function(a){return a&&"S_OK"==a.code?{v:g._decodeRecipe(a)[d]}:{err:a.code}})};ServerJMobile.prototype.changePwd=function(a,b,c,d){return this._GET(this.url+"/cgi/changePassword","username="+a+"&oldpswd="+b+"&newpswd="+c,d)};
ServerJMobile.prototype.logOut=function(){this.loginStatus=!1;return $.ajax({type:"GET",url:this.url+"/cgi/logout",cache:!1})};ServerJMobile.prototype.getResource=function(a){return xhrRequest({type:"GET",url:"../modules/resources/"+a,cache:!1})};
function SSEInterface(a){ServerJMobile.call(this,a);if(-1!=a[a.active].status){var b=this.projectName.split("/");this.currPrjName=b[b.length-1];this.projectPath=b.slice(0,b.length-1).join("/");this.lastConnStatus=1;this.event={};this.clientId=(new Date).getTime()+""+Math.floor(1E3*Math.random());this.sseRoute=this.url+"/cgi/sse";this.minPeriod=this.SSEInterface.pollRate;b=this.pathName.split("/");b="web"==b[b.length-2]?"js/comWorker.min.js":"../js/comWorker.min.js";this.communicationWorker=this.sseWorker=
window.MSInputMethodContext&&document.documentMode?new PseudoWorker(b):new Worker(b);this.RESTWorker=null;this.rQueue=[];this.connReadyQueue=[];this.connSatus=0;this.workerInit=!1;var c=this;this.sseWorker.addEventListener("message",function(b){b=b.data;if("ready"==b.e){c.addTagListener();c.addAlarmsListener();c.addEventBufferListener();c.addRecipeListener();c.addTrendListener();c.RESTWorker=new WebWorkerPromise(c.sseWorker);c.sseWorker.postMessage({c:1});c.connSatus=1;c.conf.ssemode=b.data.mode;
c.keepConnectionAlive();b=0;for(var e=c.rQueue.length;b<e;b++)c._sendMessage(c.rQueue[b]);b=0;for(e=c.connReadyQueue.length;b<e;b++)c.connReadyQueue[b]()}else"bootstrap"==b.e&&(c.sseWorker.postMessage({c:0,url:c.url,pollRate:c.minPeriod,ttl:c.ttl,maxBandwidth:a.maxBandwidth,connectionMode:a.connectionMode}),c.workerInit=!0)})}}SSEInterface.prototype=Object.create(ServerJMobile.prototype);SSEInterface.constructor=SSEInterface;SSEInterface.prototype.clientId=null;SSEInterface.prototype.maxSize=1024;
SSEInterface.prototype.minPeriod=1E3;SSEInterface.prototype.communicationWorker=null;SSEInterface.prototype.tagsCallbacks={};SSEInterface.prototype.recipeCb={};SSEInterface.prototype.trendCb={};SSEInterface.prototype.WORKER_MSG_CODE={INIT:0,START:1,SBSGROUP:2,USBSGROUP:3,GETDATA:4,SBSALARMS:5,ADDEVTBUFFLST:6,RMEVTBUFFLST:7,SBSTAGS:8,ALIVE:9,RSTSSE:10,SBSRCP:11,SBSRCPSET:12,SBSRCPSETEL:13,SBSRCPLST:14,RCPRATE:15,SBSTRENDDATA:16,UPTRENDDATA:17,USBSTRENDDATA:18};
SSEInterface.prototype.RCP_CB_TYPE={RC:0,RC_LST:1,RC_SET:2,RC_EL:3};SSEInterface.prototype.systemReadyForData=function(){null!==this.communicationWorker&&this.workerInit&&this.communicationWorker.postMessage({c:4})};SSEInterface.prototype.onConnectionReady=function(a){"function"==typeof a&&this.connReadyQueue.push(a)};SSEInterface.prototype.getConnectionStatus=function(){return this.connSatus};
SSEInterface.prototype.addTagListener=function(){var a=this;this.sseWorker.addEventListener("message",function(b){b=b.data;if("tags"==b.e)for(var c in a.tagsCallbacks)if("function"==typeof a.tagsCallbacks[c])a.tagsCallbacks[c](b.data)})};SSEInterface.prototype.addAlarmsListener=function(){var a=this;this.sseWorker.addEventListener("message",function(b){b=b.data;"alarms"==b.e&&(b=a.decodeAlarms(b.data),a.alarmCallback(b))})};
SSEInterface.prototype.addTrendListener=function(){var a=this;this.sseWorker.addEventListener("message",function(b){b=b.data;if("trend"==b.e&&"function"==typeof a.trendCb[b.id])a.trendCb[b.id](b.id,b.data)})};
SSEInterface.prototype.addRecipeListener=function(){var a=this;this.sseWorker.addEventListener("message",function(b){b=b.data;if("recipe"==b.e){b=JSON.parse(b.data);var c=b.data,d=!1,e;if(c.p&&c.p.s&&c.p.s.el)e=new RecipeSetElem(c.p.s.el.id,c.p.s.el.n,c.p.s.el.v);else if(c.p&&c.p.s)e=new RecipeSet(c.p.s.id,c.p.s.n,c.p.s.v);else if(c.p)e=new Recipe(c.p.id,c.p.n,c.p.status,c.p.slist,c.p.selset,c.p.lastset,c.p.rclist),d=c.p.c;else return;d&&a.recipeCb.curRecipe.cb("curRecipe",e);for(var f in a.recipeCb)if("function"==
typeof a.recipeCb[f].cb&&b.id==f){switch(a.recipeCb[f].type){case a.RCP_CB_TYPE.RC:a.recipeCb[f].cb(f+".Name",e);a.recipeCb[f].cb(f+".Status",e);break;case a.RCP_CB_TYPE.RC_LST:a.recipeCb[f].cb(f,e);break;case a.RCP_CB_TYPE.RC_SET:case a.RCP_CB_TYPE.RC_EL:a.recipeCb[f].cb(f+".Name",e),a.recipeCb[f].cb(f+".Value",e)}break}}})};
SSEInterface.prototype.keepConnectionAlive=function(){var a=this;this.sseWorker.postMessage({c:9});this.sseWorker.addEventListener("message",function(b){b=b.data;"connection"==b.e&&(a.lastConnStatus=b.data.status,b.data.prjName&&(a.currPrjName=b.data.prjName))})};SSEInterface.prototype.decodeTags=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(new Tag(e.n,-1,e.v.v,"S_OK",e.v.q,e.v.ts))}return b};
SSEInterface.prototype.decodeAlarms=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];b.push(new Alarm(e.n,e.v.st,e.v.v1,e.v.dtt,e.v.dt,e.v.tm,"S_OK",e.v.d))}return b};SSEInterface.prototype.subscribeTags=function(a,b){var c=a.join("");this.tagsCallbacks[a.join("")]=b;this._sendMessage({c:8,tags:a});return c};SSEInterface.prototype.unsubscribeTags=function(a,b){this._sendMessage({c:19,tags:a})};
SSEInterface.prototype.subscribeNotification=function(a,b){var c;if("tags"==a){do c=(new Date).getTime();while(this.tagsCallbacks[c]);this.tagsCallbacks[c]=b}return c};SSEInterface.prototype.unsubscribeNotification=function(a,b){"tags"==a&&delete this.tagsCallbacks[b]};SSEInterface.prototype.subscribeGroups=function(a,b){if(0==a.length)return-1;for(var c=0,d=a.length;c<d;c++)b&&"function"==typeof b[c]&&(this.tagsCallbacks[a[c]]=b[c]);this._sendMessage({c:2,groups:a,callbacks:b});return a};
SSEInterface.prototype.unsubscribeGroups=function(a){for(var b=0,c=a.length;b<c;b++)delete this.tagsCallbacks[a[b]];this._sendMessage({c:3,groups:a})};SSEInterface.prototype.subscribeAlarms=function(a,b){this.alarmCallback=b;this._sendMessage({c:5,alarms:a});return"*"};SSEInterface.prototype.subscribeEvent=function(a,b){var c=a.getId();this.event[c]||(this.event[c]=[]);this.event[c].push({ref:a.getBufferId(),cb:b});this.sseWorker.postMessage({c:6,id:c,request:a.toURL()});return c};
SSEInterface.prototype.addEventBufferListener=function(){var a=this;this.sseWorker.addEventListener("message",function(b){if("events"==b.data.e){b=JSON.parse(b.data.data);var c=b.data,d=[];if("S_NODATA"!=c.st)for(var c=c.data,e=0,f=c.length;e<f;e++){var g=c[e];d.push(new IDALEvent(g.t,g.s,g.at,g.ts,g.v))}for(var h in a.event)if(h==b.id)for(e=0,f=a.event[h].length;e<f;e++)a.event[h][e].cb(d)}})};
SSEInterface.prototype.unsubscribeEvent=function(a){var b=a.getId();if(this.event[b]){this.sseWorker.postMessage({c:7,id:b});for(var c=0,d=this.event[b].length;c<d;c++)if(this.event[b][c].ref==a.getBufferId()){this.event[b].splice(c,1);break}0==this.event[b].length&&delete this.event[b]}};SSEInterface.prototype.isSessionAlive=function(){return{status:this.lastConnStatus,projectName:this.projectPath+"/"+this.currPrjName}};
SSEInterface.prototype._sendMessage=function(a){0==this.connSatus?this.rQueue.push(a):this.sseWorker.postMessage(a)};SSEInterface.prototype.conf.exception.ipad1=-1!=navigator.userAgent.indexOf("AppleWebKit/534")&&-1!=navigator.userAgent.indexOf("Safari")&&-1!=navigator.userAgent.indexOf("iPad;")&&-1!=navigator.userAgent.indexOf("Mac OS X")&&-1!=navigator.userAgent.indexOf("7534");SSEInterface.prototype.enableOption=function(a){"ipad1fix"==a&&this.sseWorker.postMessage({c:10})};
SSEInterface.prototype.setRecipeNotificationRate=function(a){this._sendMessage({c:this.WORKER_MSG_CODE.RCPRATE,r:a})};SSEInterface.prototype.subscribeRecipe=function(a,b){if(!this.recipeCb[a])return this.recipeCb[a]={cb:b,type:this.RCP_CB_TYPE.RC},this._sendMessage({c:this.WORKER_MSG_CODE.SBSRCP,en:!0,rc:a}),a};
SSEInterface.prototype.subscribeRecipeSetList=function(a,b){var c=a+".RecipeSetList";if(!this.recipeCb[c])return this.recipeCb[c]={cb:b,type:this.RCP_CB_TYPE.RC_LST},this._sendMessage({c:14,en:!0,rc:a}),c};SSEInterface.prototype.subscribeRecipeSet=function(a,b,c){var d=a+"."+b;if(!this.recipeCb[d])return this.recipeCb[d]={cb:c,type:this.RCP_CB_TYPE.RC_SET},this._sendMessage({c:12,en:!0,rc:a,st:b}),d};
SSEInterface.prototype.subscribeRecipeSetElem=function(a,b,c,d){var e=a+"."+b+"."+c;if(!this.recipeCb[e])return this.recipeCb[e]={cb:d,type:this.RCP_CB_TYPE.RC_EL},this._sendMessage({c:13,en:!0,rc:a,set:b,el:c}),e};SSEInterface.prototype.unsubscribeRecipe=function(a){this._sendMessage({c:11,en:!1,rc:a});delete this.recipeCb[a];return a};SSEInterface.prototype.unsubscribeRecipeSetList=function(a){this._sendMessage({c:14,en:!1,rc:a});delete this.recipeCb[a+".RecipeSetList"];return a};
SSEInterface.prototype.unsubscribeRecipeSet=function(a,b){var c=a+"."+b;this._sendMessage({c:12,en:!1,rc:a,st:b});delete this.recipeCb[c];return c};SSEInterface.prototype.unsubscribeRecipeSetElem=function(a,b,c){var d=a+"."+b+"."+c;this._sendMessage({c:13,en:!1,rc:a,set:b,el:c});delete this.recipeCb[d];return d};
SSEInterface.prototype.subscribeTrend=function(a,b){if(!this.trendCb[a.wgtId])return this.trendCb[a.wgtId]=b,this._sendMessage({c:this.WORKER_MSG_CODE.SBSTRENDDATA,id:a.wgtId,start:a.hStartTime,end:a.hEndTime,trendName:a.hTrendName,maxSamp:a.hMaxNSamples,delta:a.deltaTime}),a.wgtId};SSEInterface.prototype.unsubscribeTrend=function(a,b){this._sendMessage({c:this.WORKER_MSG_CODE.USBSTRENDDATA,id:a.wgtId});delete this.trendCb[a.wgtId];return a.wgtId};
SSEInterface.prototype.ttObj={c:SSEInterface.prototype.WORKER_MSG_CODE.UPTRENDDATA,id:"",start:0,end:0,trendName:"",maxSamp:0,delta:0};SSEInterface.prototype.updateTrendSubscription=function(a){this.ttObj.id=a.wgtId;this.ttObj.start=a.hStartTime;this.ttObj.end=a.hEndTime;this.ttObj.trendName=a.hTrendName;this.ttObj.maxSamp=a.hMaxNSamples;this.ttObj.delta=a.deltaTime;this._sendMessage(this.ttObj)};
SSEInterface.prototype._readTagsJsonAsynch=function(a,b){return this.RESTWorker?this.RESTWorker.postMessage({id:0,c:20,tagName:a,index:b}).then(function(a){var b=new State;null!=a&&(a=JSON.parse(a).tgs[0],b.setState(a.quality,a.value,a.type,a.code,a.ts));return b}).catch(function(a){a=new State;a.setMessageCode(MessageStatus.prototype.status.E_TIMEOUT);return a}):ServerJMobile.prototype._readTagsJsonSync.call(this,a,b)};
SSEInterface.prototype.writeTag=function(a,b,c,d){b=b!==b?"nan":b==Number.POSITIVE_INFINITY?"inf":b==Number.NEGATIVE_INFINITY?"-inf":b;return!this.RESTWorker||d?ServerJMobile.prototype.writeTag.call(this,a,b,c,d):this.RESTWorker.postMessage({id:0,c:21,name:encodeURIComponent(a.name),index:a.index,value:b,sync:d}).then(function(a){if(null!=a)try{var b=JSON.parse(a),d={};b&&(d=JSON.parse(a).tgs[0]);c.setState(d);return b}catch(h){return null}else return null})};
SSEInterface.prototype.getTime=function(a){return!this.RESTWorker||a?ServerJMobile.prototype.getTime.call(this,a):this.RESTWorker.postMessage({id:0,c:22})};var hmiMgr=function(a){return new hmiMgr.fn.instantiate(a)};hmiMgr.activeProject=null;hmiMgr.activePage=null;hmiMgr.currentPage=null;hmiMgr.prevPage=null;hmiMgr.prevPageID=null;hmiMgr.pagesBlock="hmi-pages-container";hmiMgr.dlgsBlock="hmi-dlgs-container";hmiMgr.pageNavigationOptions={pageToLeave:null,pageToLoad:null};hmiMgr.isProjectReady=!1;
hmiMgr.focusPage=null;hmiMgr.globalMouse=!1;hmiMgr.mouseDisable=!1;hmiMgr.mouseInitX=0;hmiMgr.mouseInitY=0;hmiMgr.cache=new Cache;hmiMgr.wgts=null;hmiMgr.mapId={};hmiMgr.isInited=!1;hmiMgr.inActivity={timer:null,interval:6E5,callback:null};hmiMgr.serverInterface=null;hmiMgr.xforms={};hmiMgr.initPageLogic=!1;hmiMgr.renderingQueue={};hmiMgr.globaID=0;hmiMgr.debugMode=!1;hmiMgr.defs={};hmiMgr.cwJS={};hmiMgr.urlParameters={usr:"",g:"",ot:"",token:""};hmiMgr.limitPages=6;hmiMgr.dataLinkSeed=0;
hmiMgr.browserWindow={width:window.innerWidth,height:window.innerHeight};hmiMgr.modernBrowser=!0;hmiMgr.initServerInterface=function(a){$hmi.isTestModeActive()||(hmiMgr.serverInterface=(new ServerFactory).createServer(a))};hmiMgr.fps=10;hmiMgr.then=Date.now();hmiMgr.interval=1E3/hmiMgr.fps;hmiMgr.renderingStatus=0;hmiMgr.rQueueLen=0;hmiMgr.timerData=null;hmiMgr.enablePjctWidgetServerReq=!0;hmiMgr.umTemplates=["changepassword"];hmiMgr.testModeActive=!1;
hmiMgr.activateTestMode=function(){this.testModeActive=!0};hmiMgr.disableTestMode=function(){this.testModeActive=!1};hmiMgr.toggleTestMode=function(){this.testModeActive=!this.testModeActive};hmiMgr.isTestModeActive=function(){return this.testModeActive};hmiMgr.render=function(){var a=hmiMgr.renderingQueue,b;for(b in a){var c=a[b];c.v&&(c.w.render(),c.v=0,hmiMgr.rQueueLen--)}};hmiMgr.getData=function(){$hmi.isTestModeActive()||$hmi.activeProject.srv.systemReadyForData()};
hmiMgr.disableData=function(){clearTimeout(hmiMgr.timerData);hmiMgr.timerData=null};hmiMgr.renderingCycle=function(a){hmiMgr.render();hmiMgr.actionMgr.doActions();0<hmiMgr.rQueueLen?hmiMgr.globaID=requestAnimationFrame(hmiMgr.renderingCycle):hmiMgr.renderingStatus=0};hmiMgr.clearRenderingQueue=function(){this.renderingQueue={}};
hmiMgr.renderingCycleFixed=function(a){hmiMgr.now=Date.now();hmiMgr.delta=hmiMgr.now-hmiMgr.then;hmiMgr.delta>hmiMgr.interval&&(hmiMgr.then=hmiMgr.now,hmiMgr.render(),$hmi.actionMgr.doActions());0<hmiMgr.rQueueLen?hmiMgr.globaID=requestAnimationFrame(hmiMgr.renderingCycleFixed):hmiMgr.renderingStatus=0};
hmiMgr.addToRender=function(a){var b=hmiMgr.renderingQueue[a.wgtId];void 0===b?(hmiMgr.renderingQueue[a.wgtId]={w:a,v:1},hmiMgr.rQueueLen++):0==b.v&&(b.v=1,hmiMgr.rQueueLen++);0===hmiMgr.renderingStatus&&hmiMgr.enableRendering()};hmiMgr.clearRenderingQueue=function(){hmiMgr.renderingQueue={};hmiMgr.rQueueLen=0;$hmi.disableRendering()};
hmiMgr.enableRendering=function(){0===hmiMgr.renderingStatus&&(hmiMgr.renderingStatus=1,hmiMgr.globaID=requestAnimationFrame(hmiMgr.modernBrowser?hmiMgr.renderingCycle:hmiMgr.renderingCycleFixed))};hmiMgr.disableRendering=function(){hmiMgr.renderingStatus=0;window.cancelAnimationFrame(hmiMgr.globaID)};
hmiMgr.init=function(){!1===this.isInited&&(this.mouseMgr.init(),this.mouseDisable=!1,this.globalMouse=!0,document.documentElement.style.webkitTapHighlightColor="rgba( 0,0,0,0 )",document.documentElement.style.webkitTouchCallout="none",document.documentElement.style.webkitUserSelect="none",this.isInited=!0);$(window).error(function(a){$hmi.showErrorMessage("General javascript:","<br>"+a.originalEvent.message+"<br>url: "+a.originalEvent.filename+"<br>line: "+a.originalEvent.lineno+"<br>line: "+a.originalEvent.lineNumber+
"<br>stack: "+a.originalEvent.stack)})};hmiMgr.getWidget=function(a,b){var c=null;null!==this.focusPage&&null!==this.activePage&&(c=this.focusPage.getWidget(a,b),null===c&&null!==this.activePage&&this.focusPage.wgtId!==this.activePage.wgtId&&(c=this.activePage.getWidget(a,b)));null===c&&null!==hmiMgr.activeProject&&(c=hmiMgr.activeProject.getWidget(a,b));b&&(a=this.mapId[a]);null===c&&this.wgts&&(c=this.wgts[a]);return c};
hmiMgr.addWidget=function(a,b){b&&b.wgtPage?b.wgtPage.addWidget(a,b):(null===this.wgts&&(this.wgts={}),this.wgts[a]=b);this.mapId[b.studioId]=a};hmiMgr.setActivePage=function(a){this.activePage=a};hmiMgr.setFocusPage=function(a){this.focusPage=a};hmiMgr.getFocusPage=function(a){return this.focusPage};hmiMgr.getPage=function(a){return this.wgts[a]};hmiMgr.getActivePage=function(){return this.activePage};hmiMgr.getActiveProject=function(){return this.activeProject};
hmiMgr.startInActivityTimer=function(a,b){0<a&&(this.inActivity.callback=b,this.inActivity.interval=a,this.inActivity.timer=setTimeout(b,a))};hmiMgr.resetInActivityTimer=function(){this.inActivity.timer&&(clearTimeout(this.inActivity.timer),this.inActivity.timer=setTimeout(this.inActivity.callback,this.inActivity.interval))};
hmiMgr.initWidgetEngine=function(a,b){if($hmi.enablePjctWidgetServerReq){var c=window._ProjectPage(),d=c.getWidget("_UserGroupMgr",!0);null!=b&&(a=d.isUMTemplate(b)?b:c.getWidget("_PageMgr",!0).getWebPage(b.toLowerCase()));c.loadStartPage(a)}else this.initOfflineUMPage()};
hmiMgr.initOfflineUMPage=function(){var a=new hmiProject({wgtId:"chPrj0"},$hmi.urlParameters.pname,{prefix:"p0",projectName:$hmi.urlParameters.ppath,timeout:6E5,pollRate:100,maxBandwidth:0,modernBrowser:!0,connectionMode:null,hT:2E3,aRT:250,webSysIconDelay:0}),b=new hmiUserGroupMgr({wgtId:"chWgt0"},"_UserGroupMgr",{},a,a);new hmiTagMgr({wgtId:"chWgt1"},"_TagMgr",{},a,a);null!=$hmi.urlParameters.usr&&b.setCurrentUser($hmi.urlParameters.usr);a=document.getElementById("container");b={prevPage:null,errorMessage:null,
activePage:"changepassword",toPage:"changepassword"};$hmi.evtMgr.trigger(a,"hmichange",b);$hmi.evtMgr.trigger(a,"hmiafterchange",b)};hmiMgr.scrubId=function(a){var b=a;0==a.indexOf("#")&&(b=a.substring(1,a.length));return b};hmiMgr.wgtPagePos=function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;while(a&&"BODY"!=a.nodeName);return{left:b,top:c}};hmiMgr.addWidgetDefinition=function(a,b){this.defs[a]=b};hmiMgr.addAction=function(a,b){this.actionMgr.addActionDefinition(a,b)};
hmiMgr.getAction=function(a){return this.actionMgr.getActionInstance(a)};hmiMgr.doAction=function(a,b,c){var d=this.actionMgr.enActionType.NORMAL;"undefined"!=typeof b.t&&(d=b.t);var e=b.c,f=b.p;if(null!=e){var g="";d==this.actionMgr.enActionType.JS?(g=this.actionMgr.getActionInstance("hmiActionJS"))&&this.actionMgr.execute(g,f,a,e,c):this.actionMgr.execute(b,f,a,e)}};hmiMgr.createDataLink=function(a,b,c){a=new hmiDataLink(this.dataLinkSeed,a,b,c);this.dataLinkSeed++;return a};
hmiMgr.addPagePrefixId=function(a){this.activePage&&(a=this.activePage+"_"+a);return a};hmiMgr.fn=hmiMgr.prototype={constructor:hmiMgr,widget:function(){return this.hmiWgt},hmiAttachAlias:function(a,b,c){this.hmiWgt.dataLinks&&(a=this.hmiWgt.getDatalink(a))&&$hmi.hmiAttach($hmi.getWidget(b),a.dataSrcId,{tag:a.tag,rw:a.rw,attr:c})},hmiSubscribeGroup:function(a,b){__project.getWidget("_TagMgr",!0).subscribeGroup(a,b)}};
hmiMgr.hmiAttach=function(a,b,c){if(null!=c){if(void 0==a||a instanceof HTMLElement)return null;if(0==c.wT)b=this.activeProject.getWidget(b);else{var d=a.getGraphicModule();b="*"==b.charAt(0)&&null!=d?d.getWidget(b.replace("*.",d.wgtId+".")):this.focusPage.getWidget(b)}d=c.xforms&&1==c.xforms.length&&this.focusPage.getXForm(c.xforms[0])instanceof hmiFormulaXForm;if((b||d)&&a)return a=this.createDataLink(a,b,c),a.update(),a.mount(),a}return null};
hmiMgr.hmiSubscribeGroup=function(a,b){var c=hmiMgr.activeProject;c&&c.getTagMgr().subscribeGroup(a,b)};
hmiMgr._calculateOffsetMargin=function(a,b){var c={left:0,top:0},d;if(a.css("margin")){if(d=a.css("margin-left"))c.left=parseFloat(d.split("px")[0]);if(d=a.css("margin-top"))c.top=parseFloat(d.split("px")[0])}else{if(0==b.top&&a[0].parentNode==a[0].offsetParent)c.top=a[0].offsetTop;else if(d=a.css("margin-top"))c.top=parseFloat(d.split("px")[0]);if(0==b.left&&a[0].parentNode==a[0].offsetParent)c.left=a[0].offsetLeft;else if(d=a.css("margin-left"))c.left=parseFloat(d.split("px")[0])}return c};
hmiMgr._getPointInWidgetCoordinateSystem=function(a,b,c){if(!a)return null;var d=[],e={chain:[],offset:[],pos:[]},f=null,g=a,f=$hmi.computeGroupsScrollOffset(a,b,c);b+=f.x;c+=f.y;if(a&&!a.initInvMtxChain){do f=g,d.push(f),g=f.parentWidget;while(!(f instanceof hmiPage))}g=c;if(a.initInvMtxChain)for(c=0;c<a.invMtxChain.length;c++)d=a.wgtPos[c],f=a.wgtOffset[c],b-=d.left+f.left,g-=d.top+f.top,h=a.invMtxChain[c],g=multiply(h,[[b],[g],[1]]),b=g[0][0],g=g[1][0];else{for(c=d.length-1;0<=c;c--){var f=d[c],
h=d[c].getTransformMatrix(),k=f.left,l=f.top,f={left:f.getOffsetLeft(),top:f.getOffsetTop()};b-=k+f.left;var g=g-(l+f.top),h=inverse(h[0][0],h[1][0],h[0][1],h[1][1],h[0][2],h[1][2]),g=multiply(h,[[b],[g],[1]]);b=g[0][0];g=g[1][0];e.chain.push(h);e.offset.push(f);e.pos.push({left:k,top:l})}a.saveInvMtxChain(e)}return{x:b,y:g}};
hmiMgr.computeGroupsScrollOffset=function(a,b,c){if(!a)return null;var d=a;c=b=0;do(a=d)&&a.constructor==hmiGroup&&a.hasGridLayout()&&(d=a.getScrollbarOffsets(),b+=d.left,c+=d.top),d=a.parentWidget;while(!(a instanceof hmiPage));return{x:b,y:c}};hmiMgr.isPointInsideWidget=function(a,b,c){var d=a.elem.style.width.split("px")[0],e=a.elem.style.height.split("px")[0];return(a=this._getPointInWidgetCoordinateSystem(a,b,c))&&0<=a.x&&a.x<=d&&0<=a.y&&a.y<=e?!0:!1};
hmiMgr.isPointInsideBoundingRect=function(a,b,c){b-=window.pageXOffset;c-=window.pageYOffset;a=a.getBoundingClientRect();return b>=a.left&&b<=a.left+a.width&&c>=a.top&&c<=a.top+a.height};hmiMgr.updateTagsCache=function(a,b){return this.cache.updateTag(a,b)};hmiMgr.getTagFromCache=function(a){return this.cache.getTag(a)};hmiMgr.clearCache=function(){this.cache.clearTags()};hmiMgr.cloneCache=function(){return this.cache.clone()};
hmiMgr.getDialog=function(a){return __project&&__project.isActiveDialog(a)?this.getWidget(a):null};hmiMgr.showErrorMessage=function(a,b){var c="<p style='font-weight: bold;'>"+a+"</p><br>"+b;$hmi.getAction("hmiActionShowMessage").execute(null,{msg:c},1)};hmiMgr.showMessage=function(a,b){var c="<p style='font-weight: bold;'>"+a+"</p><br>"+b;$hmi.getAction("hmiActionShowMessage").execute(null,{msg:c},0)};
hmiMgr.isCoreWidgetsReady=function(){var a=$hmi.activeProject,a=[a.getWidget("_AlarmsMgr",!0).waitWgtReady(),a.getWidget("_TagMgr",!0).waitWgtReady(),a.getWidget("_UserGroupMgr",!0).waitWgtReady(),a.getCWidgetMgr().waitWgtReady()];return Promise.all(a)};hmiMgr.notifyWarning=function(a,b){var c=a+" : "+b;$hmi.getAction("hmiActionShowMessage").execute(null,{msg:c},3)};hmiMgr.getEventMgr=function(){return this.evtMgr};
var instantiate=hmiMgr.fn.instantiate=function(a){void 0!=a&&(a.wgtId?(this.wgtId=a.wgtId,this.hmiWgt=a):(this.wgtId=$hmi.scrubId(a),this.hmiWgt=$hmi.getWidget(this.wgtId)),this.hmiElem=null)};instantiate.prototype=hmiMgr.fn;window.hmiMgr=window.$hmi=hmiMgr;hmiMgr.hmiActivatePage=function(a){a.execTemplateJS();a.tOnActivateActions();a&&a.pageactivate();a.execJS()};
hmiMgr.attachPageEvents=function(){var a=$("#container")[0],b=this;this.evtMgr.on(a,"hmibeforechange",function(a){if($hmi.activePage&&$hmi.activePage.wgtId==$hmi.pageNavigationOptions.pageToLeave){a=document.getElementsByClassName(".bad");for(var d=0,e=a.length;d<e;d++){var f=a.item(d);f.parentNode.removeChild(f)}$hmi.activeProject.unsubscribeDynamicTags();$hmi.activePage.pagedeactivate();b.evtMgr.trigger($hmi.activePage.elem,"unloadWgt")}});this.evtMgr.on(a,"hmicontentload",function(a){a=a.detail.activePage;
""!=a&&(a=hmiMgr.getNextPageId($hmi.pageNavigationOptions.pageToLoad?$hmi.pageNavigationOptions.pageToLoad:a),null==document.querySelector("link[rel='stylesheet'][href='"+a+".css']")&&$("head").append($("<link rel='stylesheet' href='"+a+".css'>")))});this.evtMgr.on(a,"hmipageremoved",function(a){a=a.detail;a.removedPage&&$('link[rel=stylesheet][href="../css/pages/_'+a.removedPage+'.css"]').remove()});this.evtMgr.on(a,"hmichange",function(a){a=a.detail;var d=a.prevPage;d&&d!=a.toPage&&($hmi.prevPageID=
d);a.prevPage&&$hmi.activePage.hidePageContainer();d=document.getElementById("kpd");null!=d&&d.parentNode.removeChild(d);$hmi.initPageLogic=!0;var d=a.activePage,e="_"+d;a.cachedPage?(a=$hmi.getPage(d),$hmi.setActivePage(a),$hmi.setFocusPage(a),a.setCached(!0)):(a=window[e](),a.setCached(!1),a.bindCWJSClass(),$hmi.activeProject.subscribeDynamicTags());a.show();b.evtMgr.trigger(a.elem,"loadWgt");$hmi.activeProject.hideLoadingPage();$hmi.initPageLogic=!1});this.evtMgr.on(a,"hmiafterchange",function(a){a=
a.detail;$hmi.activeProject&&$hmi.activeProject.srv&&0==$hmi.activeProject.srv.getOptions().ssemode&&$hmi.activeProject.srv.getOptions().exception.ipad1&&$hmi.activeProject.srv.enableOption("ipda1fix");var b=$hmi.getPage(a.activePage);$hmi.activeProject.isProjectReady()?hmiMgr.hmiActivatePage(b):$hmi.enablePjctWidgetServerReq?$hmi.isCoreWidgetsReady().then(function(){hmiMgr.hmiActivatePage(b)}):hmiMgr.hmiActivatePage(b);setTimeout(function(){requestAnimationFrame(function(){$hmi.activeProject.showSpinner(!1)})},
0)})};hmiMgr.loadLoginPage=function(){$hmi.focusPage&&$($hmi.focusPage.elem).trigger("pagestop");var a="_web";/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?a="_mobi":/iPad|RIM Tablet OS/i.test(navigator.userAgent)&&(a="_tablet");location.href="/public/"+a+"login.html?_="+(new Date).getTime()};
hmiMgr.getNextPageId=function(a){var b=$hmi.activeProject.getWidget("_UserGroupMgr",!0);a instanceof Array&&(a=a[0]);b.isUMTemplate(a)?(a=a.split("/"),a=a[a.length-1],b="../css/umtemplates/"):b="../css/pages/";return b+"_"+a};
var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();hmiMgr.loadedPages=[];hmiMgr._isChangingPage=!1;
$.fn.onAvailable=function(a){var b=this.selector,c;0<this.length?a.call(this):c=setInterval(function(){0<$(b).length&&(a.call($(b)),clearInterval(c))},50)};
hmiMgr.hmiGC=function(a,b){var c=1,d=0,e=Array(c),f=this.loadedPages.length;if(f>this.limitPages){for(var g=0;g<f&&0!==c;g++)if(this.loadedPages[g]!=a){var h=this.loadedPages[g];this.getPage(h).destroy();b.removedPage=e[d++]=h;this.evtMgr.trigger(document.getElementById("container"),"hmipageremoved",b);h="_"+h;window[h]=null;this.getActiveProject().getCWidgetMgr().freeCWInstances(h);$("#"+h).remove();c--}if(0===c)for(c=0,d=e.length;c<d;c++)f=this.loadedPages.indexOf(e[c]),this.loadedPages.splice(f,
1)}};hmiMgr.setPagesCacheSize=function(a){this.limitPages=a};hmiMgr.isPageInCache=function(a){return-1!=this.loadedPages.indexOf(a)};function showLoadingError(a){var b="top:"+window.innerHeight/2+"px;left:"+window.innerWidth/2+"px;";$("#container").append("<div style='"+b+" ' class='errLoadPage'>"+a+"<div>");setTimeout(function(){$(".errLoadPage").remove()},2E3)}
hmiMgr.changePage=function(a,b){this.render();this.clearRenderingQueue();if(this._isChangingPage)return!1;this.mouseDisable=this._isChangingPage=!0;var c=document.getElementById("container"),d=c.getAttribute("data-active"),e=c.querySelector("div[data-role='page']"),f=null,g=null,f=!1,h={activePage:null,prevPage:null,toPage:null,errorMessage:null,cachedPage:!1};if(null==d)if(e)if(h.activePage=e.getAttribute("id").substr(1),h.activePage==b.dst)c.setAttribute("data-active",h.activePage),e.setAttribute("data-url",
a),f=!0;else{var e="_"+h.activePage,k=document.getElementById(e);void 0!=e&&k.parentNode.removeChild(k)}else if(e=a&&a.split("/"))h.activePage=e[e.length-1].split(".html")[0];else return this.mouseDisable=!1,h.errorMessage="First loading error",this.evtMgr.trigger(c,"hmiloadingerror",h),!1;if(f)return this.evtMgr.trigger(c,"hmibeforechange",h),this.evtMgr.trigger(c,"hmicontentload",h),this.loadedPages.push(h.activePage),f=document.querySelector("div[data-role='page']"),null!=b.beautify&&b.beautify(f),
this.evtMgr.trigger(c,"hmichange",h),this._isChangingPage=!1,this.evtMgr.trigger(c,"hmiafterchange",h),this.mouseDisable=!1,!0;if(""!=d&&"undefined"!=typeof d&&(f=document.getElementById("_"+d),null!=f&&(f=f.getAttribute("data-url"),a==f)))return this.mouseDisable=this._isChangingPage=!1;this.evtMgr.trigger(c,"hmibeforechange",h);f=document.querySelector("div[data-url='"+a+"']");if(null!=f)h.activePage=f.getAttribute("id").substr(1),h.prevPage=d,h.toPage=h.activePage,h.cachedPage=!0,window.history.replaceState("state",
document.title,a),c.setAttribute("data-active",h.activePage),this.evtMgr.trigger(c,"hmicontentload",h),this.evtMgr.trigger(c,"hmichange",h),this._isChangingPage=!1,this.evtMgr.trigger(c,"hmiafterchange",h),this.mouseDisable=!1;else{var l=this;$.ajax({url:a,dataType:"html"}).done(function(e){window.history.replaceState("state",document.title,a);l.evtMgr.trigger(c,"hmicontentload",h);var f=document.createElement("div");f.innerHTML=e;e=f.querySelector("div[data-role='page']");g=b.dst;for(var f=f.getElementsByTagName("script"),
k,q,r=0,t=f.length;r<t;r++){var u=f[r].id;"hmi-page"===u?k=f[r].textContent:"hmi-init"===u&&(q=f[r].textContent)}e.setAttribute("data-url",a);c.setAttribute("data-active",g);null!=q&&eval(q);null!=b.beautify&&b.beautify(e);c.appendChild(e);null!=k&&eval(k);h.activePage=g;h.prevPage=d;h.toPage=g;l.loadedPages.push(g);l.hmiGC(g,h);h.activePage=g;h.prevPage=d;h.toPage=g;l.evtMgr.trigger(c,"hmichange",h);l._isChangingPage=!1;l.evtMgr.trigger(c,"hmiafterchange",h);l.mouseDisable=!1}).fail(function(a){l.mouseDisable=
!1;h.errorMessage="First loading error";l.evtMgr.trigger(c,"hmiloadingerror",h)})}return!0};$("#container").on("hmiloadingerror",function(a){a.detail?showLoadingError(a.detail.errorMessage):showLoadingError("Error")});
var Linkable=function(){function a(){this.dataLinks=null}a.prototype.addDataLink=function(a){this.parentPage?this.parentPage.registerLink(a):this.registerLink&&this.registerLink(a);this.subscribeDataLink(a)};a.prototype.subscribeDataLink=function(a){void 0==this.dataLinks&&(this.dataLinks={});this.dataLinks[a.getId()]=a};a.prototype.removeDataLink=function(a){delete this.dataLinks[a.getId()]};a.prototype.registerLink=function(a){};a.prototype.getWidget=function(a,c,d){return null};a.prototype.setValue=
function(a,c,d,e,f){};a.prototype.getValue=function(a){return null};a.prototype.getId=function(){return""};a.prototype.destroy=function(){for(var a in this.dataLinks){var c=this.dataLinks[a];c.dataSrc.getId()!=this.getId()?c.dataSrc.removeDataLink(c):c.tgtWgt.getId()!=this.getId()&&c.tgtWgt.removeDataLink(c)}};a.prototype.unmountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].unmount()};a.prototype.mountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].mount(),this.dataLinks[a].update()};
return a}(),JMActionMgr=function(){function a(){this.enActionType={NORMAL:0,JS:1};this.defs={};this.queue=[];this.lastLoadPageIdx=-1;this.executionStatus=0}a.prototype.isActionAllowed=function(a,c,d){this.umgr||(this.umgr=$hmi.activeProject.getWidget("_UserGroupMgr",!0));a=$hmi.getFocusPage().getWidget(a);return(this.umgr.isSecurityEnabled()?this.umgr.getActionTreeAuthorizations(a,c+"Action",d.actID):this.umgr.actAuth.DEFAULT)==this.umgr.actAuth.NOTALLOWED?!1:!0};a.prototype.execute=function(a,c,
d,e,f){a.constructor==hmiActionLoadPage&&(-1!=this.lastLoadPageIdx&&this.queue.splice(this.lastLoadPageIdx,1),this.lastLoadPageIdx=this.queue.length-1);var g=this;this.queue.push(function(){a.addActionListener(g);g.isActionAllowed(d,e,c)?a.execute(d,c,e,f):a.done()});$hmi.enableRendering()};a.prototype.doActions=function(){0<this.queue.length&&0==this.executionStatus&&(this.executionStatus=1,this.queue.shift()())};a.prototype.done=function(){0<this.queue.length&&1==this.executionStatus?this.queue.shift()():
this.executionStatus=0};a.prototype.addActionDefinition=function(a,c){this.defs[a]=c};a.prototype.getActionDefinition=function(a){return this.defs[a]};a.prototype.getActionInstance=function(a){return new this.defs[a]};return a}();hmiMgr.actionMgr=new JMActionMgr;
var JMPointerEvents=function(){function a(){this.startY=this.startX=0;this.oneTouch=!1;this.mouseWgt=null;this.wgtPagePos={left:0,top:0};this.holdIsFired=this.wgtIsMouseDown=!1}a.prototype.init=function(){var a=this;"ontouchstart"in window&&"ontouchend"in document?this.bindTouchEvents():this.bindMouseEvents();var c=/firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";$(document).bind(c,function(c){a.doMouseScroll(c)})};a.prototype.bindMouseEvents=function(){var a=this;$(document).mousedown(function(c){a.doMouseDown(c)});
$(document).mouseup(function(c){a.doMouseUp(c)});$(document).mousemove(function(c){a.doMouseMove(c)})};a.prototype.bindTouchEvents=function(){var a=this;$(document).on("touchstart mousedown",function(c){"touchstart"==c.type?(a.oneTouch=!0,a.doMouseDown(c)):(a.oneTouch||a.doMouseDown(c),a.oneTouch=!1)});$(document).on("touchend mouseup",function(c){"touchend"==c.type?(a.oneTouch=!0,a.doMouseUp(c)):(a.oneTouch||a.doMouseUp(c),a.oneTouch=!1);a.doMouseUp(c)});$(document).on("touchcancel",function(c){a.doMouseUp(c)});
$(document).on("touchmove",function(c){a.doMouseMove(c)});$(document).mousemove(function(c){a.doMouseMove(c)})};a.prototype.getTargetOfParentWidget=function(a){for(a=a.parentElement;a;){if(null!=a.getAttribute("data-widget"))return a;a=a.parentElement}return null};a.prototype.getMouseWgt=function(a,c,d,e){if(null==a)return null;if(a!=document&&null==a.getAttribute("data-widget")){var f=this.getTargetOfParentWidget(a);null!=f&&(a=f)}var g=(f=$hmi.focusPage.getWidget(a.id))?f.events:null;if(e&&e==a)return null;
if(g&&(g.mousedown||g.touchstart))return f;e=a.parentNode;if(null!=e){e=e.childNodes;for(var f=!1,h=e.length-1;0<=h;h--)if(e[h].nodeType==Node.ELEMENT_NODE)if(f){if($hmi.isPointInsideBoundingRect(e[h],c,d)){if("GroupWgt"==e[h].getAttribute("data-widget")){for(var g=e[h].childNodes,k=null,l=g.length-1;0<=l;l--)if(g[l].nodeType==Node.ELEMENT_NODE){k=g[l];break}if(g=this.getMouseWgt(k,c,d,e[h]))return g}if((g=(k=$hmi.focusPage.getWidget(e[h].id))?k.events:null)&&(g.mousedown||g.touchstart)&&$hmi.isPointInsideWidget(k,
c,d))return k}}else e[h].id==a.id&&(f=!0)}return this.getMouseWgt(a.parentNode,c,d)};a.prototype.doMouseDown=function(a){if(!$hmi.mouseDisable){this.holdIsFired=!1;var c;a&&a.originalEvent&&"object"===typeof a.originalEvent.touches?0<a.originalEvent.touches.length&&(c=a.originalEvent.touches[0]):c=a||event;var d=a.target;this.startY=c.pageY;this.startX=c.pageX;if(!this.mouseWgt){var e=this.mouseWgt=this.getMouseWgt(d,c.pageX,c.pageY);this.wgtIsMouseDown=!0;if(null!=e){$hmi.focusPage=e.parentPage;
a&&a.preventDefault&&a.preventDefault();var f;if(e.doMouseDown)if(c=this.wgtEventInfo(e,a),$hmi.mouseInitX=c.x,$hmi.mouseInitY=c.y,c){if(0==e.doMouseDown(c,a))return}else return;var g=e.getAutoRepeatMode(),h=e.getAutoRepeatPeriod();e.onMousePress&&(c=this.wgtEventInfo(e,a),f=this.jsEventInfo(c),this.doWidgetActions(e,"onMousePress",f));var k=this,d=e.getHoldTime();c=this.wgtEventInfo(e,a);f=this.jsEventInfo(c);this.holdTimer=window.setTimeout(function(){k.holdIsFired=!0;e.onMouseHold&&(k.doWidgetActions(e,
"onMouseHold",f),2==g&&e.onMouseHoldRepeat&&k.doMouseRepeat(e,g,h,f))},d);1==g&&e.onMousePressRepeat&&(c=this.wgtEventInfo(e,a),f=this.jsEventInfo(c),this.doMouseRepeat(e,g,h,f))}}}};a.prototype.doMouseRepeat=function(a,c,d,e){var f=this;this.repeatTimer=window.setTimeout(function(){var g;1==c?g="onMousePressRepeat":2==c&&(g="onMouseHoldRepeat");f.doWidgetActions(a,g,e);f.doMouseRepeat(a,c,d,e)},d)};a.prototype.loseFocus=function(){clearTimeout(this.holdTimer);clearTimeout(this.repeatTimer);null!=
this.mouseWgt&&this.mouseWgt.doMouseUp(null,null)};a.prototype.doWidgetActions=function(a,c,d){c=a[c];for(var e=0;e<c.length;e++)$hmi.doAction(a.wgtId,c[e],d)};a.prototype.doMouseUp=function(a){a&&a.stopPropagation();this.wgtIsMouseDown=!1;clearTimeout(this.holdTimer);clearTimeout(this.repeatTimer);if(null!=this.mouseWgt){var c=this.mouseWgt;this.mouseWgt=null;var d,e;if(c.doMouseUp)if(d=this.wgtEventInfo(c,a),$hmi.mouseInitX=0,$hmi.mouseInitY=0,d){if(0==c.doMouseUp(d,a))return}else return;if(null!=
c.onMouseClick||null!=c.onMouseRelease)d=this.wgtEventInfo(c,a),e=this.jsEventInfo(d);null==c.onMouseClick||this.holdIsFired||this.doWidgetActions(c,"onMouseClick",e);null!=c.onMouseRelease&&this.doWidgetActions(c,"onMouseRelease",e)}$hmi.resetInActivityTimer();this.umgr||(this.umgr=$hmi.activeProject.getWidget("_UserGroupMgr",!0));this.umgr.resetTimer()};a.prototype.doMouseMove=function(a){var c=!1;if($hmi.mouseDisable)return c;var d=this.mouseWgt;if(null!=d){if(a&&a.originalEvent&&"object"===typeof a.originalEvent.touches&&
0>=a.originalEvent.touches.length)return c;a&&a.preventDefault&&a.preventDefault();var e;if(d.doMouseMove){var f=!1;if(e=this.wgtEventInfo(d,a))0==d.doMouseMove(e,a)&&(f=!0),c=!0;else return c}if(d&&d.onMouseDrag&&!f)for(f=d.onMouseDrag,e=this.wgtEventInfo(d,a),a=this.jsEventInfo(e),e=0;e<f.length;e++)$hmi.doAction(d.wgtId,f[e],a)}return c};a.prototype.doMouseScroll=function(a){$hmi.resetInActivityTimer();this.umgr||(this.umgr=$hmi.activeProject.getWidget("_UserGroupMgr",!0));this.umgr.resetTimer()};
a.prototype.wgtEventInfo=function(a,c){var d=!0,e,f,g,h={};if(c&&c.originalEvent&&"object"===typeof c.originalEvent.touches){g=c.originalEvent.touches.length;2<g&&(g=2);if(0<g){switch(g){case 1:h["0"]=c.originalEvent.touches[0];break;case 2:h["0"]=c.originalEvent.touches[0],h["1"]=c.originalEvent.touches[1]}e=h}d=!1}else g=1,e=c||event;var k=0,l=0;if(e){for(var n=!1,m=0;m<g;m++){d||(e=h[m],n=1==m?!0:!1);k=e.pageX+document.body.scrollLeft+document.documentElement.scrollLeft;l=e.pageY+document.body.scrollTop+
document.documentElement.scrollTop;if(!a||!a.elem)return null;var p=$hmi._getPointInWidgetCoordinateSystem(a,k,l),q=p.x-$hmi.mouseInitX,r=p.y-$hmi.mouseInitY;n?f.nxtPoints={x:p.x,y:p.y}:f={wgt:a,isMouseDown:this.wgtIsMouseDown,pageX:k,pageY:l,x:p.x,y:p.y,deltaX:q,deltaY:r}}return f}return{wgt:a,noInfo:!0}};a.prototype.jsEventInfo=function(a){return{posX:Math.floor(a.x),posY:Math.floor(a.y),pagePosX:Math.floor(a.pageX),pagePosY:Math.floor(a.pageY),wheelDelta:null}};return a}();hmiMgr.mouseMgr=new JMPointerEvents;
var WAITABLE_ERROR_MSG;(function(a){a[a.INIT_PRM=0]="INIT_PRM"})(WAITABLE_ERROR_MSG||(WAITABLE_ERROR_MSG={}));
var Waitable=function(){function a(){this._prmWgtReady=null}a.prototype.resolveWgtReady=function(a){throw WAITABLE_ERROR_MSG.INIT_PRM;};a.prototype.rejectWgtReady=function(a){throw WAITABLE_ERROR_MSG.INIT_PRM;};a.prototype.initPromiseReady=function(){var a=this;this._prmWgtReady=new Promise(function(c,d){a.resolveWgtReady=c;a.rejectWgtReady=c})};a.prototype.waitWgtReady=function(){if(this._prmWgtReady)return this._prmWgtReady;throw WAITABLE_ERROR_MSG.INIT_PRM;};return a}(),PageType;
(function(a){a[a.NORMAL=0]="NORMAL";a[a.TEMPLATE=1]="TEMPLATE"})(PageType||(PageType={}));
var CWidgetMgr=function(a){function b(b){var d=a.call(this)||this;d.project=b;d.cwgts={};d.instancesMap={};d.HTMLTemplatePolyfillEnabled=HTMLTemplateElement.bootstrap instanceof Function;b=document.getElementById("hmi-templates");var e=!1;d.initPromiseReady();b&&(e=0!=b.childNodes.length);if($hmi.isTestModeActive())d.resolveWgtReady(!0);else if(e)d.resolveWgtReady(!0);else d.project.getCommunticationObj().getResource("templates.xml").then(function(a){document.getElementById("hmi-templates").innerHTML=a;
d.HTMLTemplatePolyfillEnabled&&HTMLTemplateElement.bootstrap(document);d.resolveWgtReady(!0)})["catch"](function(){d.resolveWgtReady(!1)});return d}__extends(b,a);b.prototype.setCWMap=function(a,b){null==this.instancesMap[a]&&(this.instancesMap[a]=b)};b.prototype.getCWMap=function(a){a=this.instancesMap[a];return void 0!=a?a:null};b.prototype.freeCWInstances=function(a){delete this.instancesMap[a]};b.prototype.getAttributeLink=function(a,b){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==
this.cwgts[a].props?this.cwgts[a].props.attr[b]:[]};b.prototype.hasAttribute=function(a,b){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==this.cwgts[a].props};b.prototype.getParameters=function(a){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==this.cwgts[a].props?this.cwgts[a].props.par:[]};b.prototype.isRegisteredModule=function(a){a=a.toLowerCase();return void 0!==this.cwgts[a]};b.prototype.hasGfxInheritance=function(a){a=a.toLowerCase();a=this.cwgts[a];return null!=a&&null!=a.conf&&
null!=a.conf.w};b.prototype.findCustomWidget=function(a,b){var e=null,f=null;void 0!=b&&(f=this.getCWMap(b));for(var g=a.querySelectorAll("[data-ctype]"),h=0,k=g.length;h<k;h++){var l=g[h],n=l.getAttribute("data-ctype"),m="1"==l.getAttribute("data-tmpl");this.isRegisteredModule(n)&&(null===e&&(e={p:[],t:[]}),l={webId:l.getAttribute("id"),studioId:l.getAttribute("data-sid"),moduleName:n},m?(e.t.push(l),null!=f&&f.t.push(l)):(e.p.push(l),null!=f&&f.p.push(l)))}return e};b.prototype.addModule=function(a){this.cwgts[a.name]=
a};b.prototype.injectCWTemplates=function(a,b){var e=this.getCWMap(b),f=a.getAttribute("id")!=b;if(null==e||f){e=this.findCustomWidget(a,b);if(null==e)return;f||this.setCWMap(b,e)}this.injectCW(a,e.t,b,PageType.TEMPLATE);this.injectCW(a,e.p,b,PageType.NORMAL)};b.prototype.injectCW=function(a,b,e,f){if(void 0!==b)for(var g=0,h=b.length;g<h;g++){var k=b[g].webId,l=b[g].studioId,n=b[g].moduleName.toLowerCase(),m=this.cwgts[n];if(void 0!==m){null===m.template&&(m.template=document.getElementById(n));
m=m.template;n=a.querySelector("#"+CSS.escape(k));null!=m&&null!=n&&n.appendChild(m.content.cloneNode(!0));for(var m=n.querySelectorAll(".wgt, .wgt>div, .hmi-col"),p=0,q=m.length;p<q;p++){var r=m[p];if("*"===r.id.charAt(0)&&"."===r.id.charAt(1)){r.id=r.id.replace("*",k);var t=r.getAttribute("data-sid");null!=t&&r.setAttribute("data-sid",t.replace("*",l))}f==PageType.TEMPLATE&&r.setAttribute("data-tmpl","1")}this.injectCWTemplates(n,e)}}};b.prototype.instantiateCW=function(a,b){b=b.toLowerCase();var e=
this.cwgts[b],f=this.project.getWidgetDefinitions(),g=this.project.getActionMgr(),h=(k={},k[b]=a,k);if(null!=e&&null!=e.conf&&null!=e.conf.w){a.setModule();e.conf.grid&&a.setGridLayout(e.conf.grid);for(var k=e.conf.w,l=0,n=k.length;l<n;l++){var m=k[l],p=m.w.replace("*",a.wgtId),q=this.deepClonePlainObject(m.p),r=void 0,r=void 0!==m.s?m.s.replace("*",a.studioId):p,t=h[m.f.toLowerCase()];-1!=m.t.indexOf("hmiAction")?(q.module=a,r=g.getActionDefinition(m.t),h[m.w]=new r({wgtId:p},m.e,q,this.project.getFocusPage(),
t)):"hmiAttach"===m.t?$hmi.hmiAttach(h[m.w],m.s,q):(q.isTemplateWgt=a.isTemplateWgt,q.module=a,"hmiCWMLTextMgr"==m.t&&e.tr&&this.applyMLPatch(q.texts,e.tr),h[m.w]=new f[m.t]({wgtId:p},r,q,this.project.getFocusPage(),t))}this.subscribeAttributeLinks(e,a);g=f=void 0;isIdentityMatrix(a.mtx)?(f=a.width,g=a.height):(g=a._map(a.mtx,{x:a.width,y:a.height}),f=g.x,g=g.y);h=a.left;k=a.top;a.width=e.conf.br.width;a.height=e.conf.br.height;a.left=0;a.top=0;a.setParentBounds(h,k,f,g,a.parentWidget);this.bindJSClass(a)}var k};
b.prototype.subscribeAttributeLinks=function(a,b){if(null!==a.props&&null!==a.props.attr)for(var e in a.props.attr){var f=a.props.attr[e];if(0<f.length)for(var g=0,h=f.length;g<h;g++){var k=f[g].lastIndexOf("."),l=f[g].substring(0,k),k=b.getWidget(l,!0,b.isTemplateWgt);if(null==k){var n=l.replace(/[0-9]/g,""),l=parseInt(l.substring(n.length));isNaN(l)&&(l=1);var m=[];b.getWidgetsByJMClass(n,l,m);m.length==l&&(k=m[l-1])}null!=k&&k.subscribeWgt(b,function(a,b){return function(c,d){"mdup"==c&&a.sendUpdate(b,
d.v,d.q)}}(b,e))}}};b.prototype.applyMLPatch=function(a,b){for(var e in b){var f=a[e],g=b[e],h;for(h in g)f[h]=g[h]}};b.prototype.bindJSClass=function(a){var b=this.cwgts[a.ctype.toLowerCase()];void 0!==b&&null!=b.js&&b.js.call(a,a)};b.prototype.bindCWLogicClass=function(a){var b=this.getCWMap("_"+a.wgtId);if(null!==b){for(var e=b.t,f=0,g=e.length;f<g;f++){var h=e[f];this.hasGfxInheritance(h.moduleName)||(h=a.getWidget(h.webId),this.subscribeAttributeLinks(this.cwgts[h.ctype.toLowerCase()],h),this.bindJSClass(h))}e=
b.p;f=0;for(g=e.length;f<g;f++)h=e[f],this.hasGfxInheritance(h.moduleName)||(h=a.getWidget(h.webId),this.subscribeAttributeLinks(this.cwgts[h.ctype.toLowerCase()],h),this.bindJSClass(h));(0<b.t.length||0<b.p.length)&&a.bindCWCallbacks()}};b.prototype.deepCloneArray=function(a){for(var b=a.length,e=Array(b),f=0;f<b;f++){var g=a[f],h=typeof g;e[f]="number"==h||"boolean"==h?g:this.deepClonePlainObject(g)}return e};b.prototype.deepClonePlainObject=function(a){if(null===a)return null;switch(typeof a){case "string":return a.slice(0);
case "object":if(Array.isArray(a))return this.deepCloneArray(a);var b={},e;for(e in a){var f=a[e];if(Array.isArray(f))b[e]=this.deepCloneArray(f);else{var g=typeof f;b[e]="number"==g||"boolean"==g?f:this.deepClonePlainObject(f)}}return b;default:return a}};return b}(Waitable),SyntheticEventMgr=function(){function a(){}a.trigger=function(a,c,d){c=new CustomEvent(c,{detail:d});a.dispatchEvent(c)};a.on=function(a,c,d){a.addEventListener(c,d)};a.off=function(a,c,d){a.removeEventListener(c,d)};return a}();
hmiMgr.evtMgr=SyntheticEventMgr;function inverse(a,b,c,d,e,f){var g=a*d-b*c;return[[d/g,-c/g,(c*f-d*e)/g],[-b/g,a/g,-(a*f-b*e)/g],[0,0,1]]}function inverseMtx(a){var b=a[0][0],c=a[1][0],d=a[0][1],e=a[1][1],f=a[0][2];a=a[1][2];var g=b*e-c*d;return[[e/g,-d/g,(d*a-e*f)/g],[-c/g,b/g,-(b*a-c*f)/g],[0,0,1]]}function multiply(a,b){for(var c=[[1,0,0],[0,1,0],[0,0,1]],d=0,e=a.length;d<e;d++)for(var f=0,g=b[0].length;f<g;f++){for(var h=0,k=0,l=a[0].length;k<l;k++)h+=a[d][k]*b[k][f];c[d][f]=h}return c}
function cssTransformToMatrix(a){if(a&&-1!=a.indexOf("matrix")){var b=a.indexOf("("),c=a.indexOf(")");a=a.substring(b+1,c).split(",");return[[parseFloat(a[0]),parseFloat(a[2]),parseFloat(a[4])],[parseFloat(a[1]),parseFloat(a[3]),parseFloat(a[5])],[0,0,1]]}return[[1,0,0],[0,1,0],[0,0,1]]}function AffineMatrixToCss(a){return"matrix("+a[0][0]+","+a[1][0]+","+a[0][1]+","+a[1][1]+","+a[0][2]+","+a[1][2]+")"}
function GetParentTransform(a){var b=[],c=null,d=null,c=a;a=$hmi.focusPage.getWidget(a.id);var e=!0;do if((d=a)?b.push(d.getTransformMatrix()):b.push(cssTransformToMatrix($(c).css("transform"))),c=c.parentElement,d&&(a=d.parentWidget),d.constructor==hmiPage||d.constructor==hmiDialog)e=!1;while(e);d=[[1,0,0],[0,1,0],[0,0,1]];for(c=b.length-1;0<=c;c--)d=multiply(d,b[c]);return d}
function trunc(a,b){b||(b=.6);if(0<a){var c;return a%1>b?Math.ceil(a):Math.floor(a)}return c<-b?Math.floor(a):Math.ceil(a)}var polarToCartesian=function(a,b,c,d,e){e=e*Math.PI/180;return{x:a-c*Math.cos(e),y:b-d*Math.sin(e)}},generateArcCode=function(a,b,c,d,e,f){var g=polarToCartesian(a,b,c,d,f);a=polarToCartesian(a,b,c,d,e);return["M",g.x,g.y,"A",c,d,0,180>=f-e?"0":"1",0,a.x,a.y].join(" ")},isFloat=function(a){return"number"==typeof a&&0!=a%1};
function isIdentityMatrix(a){for(var b=[[1,0,0],[0,1,0],[0,0,1]],c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)if(a[c][d]!=b[c][d])return!1;return!0}function setTransition(a,b){a&&(a.style.transition=b,a.style["-webkit-transition"]=b,a.style["-ms-transition"]=b,a.style["-moz-transition"]=b)}function setTransform(a,b){a&&(a.style.transform=b,a.style["-webkit-transform"]=b,a.style["-ms-transform"]=b,a.style["-moz-transform"]=b)}
function setCSSTransform(a,b){a&&(a.style["-webkit-transform"]=b,a.style["-moz-transform"]=b,a.style["-ms-transform"]=b,a.style.transform=b)}function setVendorCSS(a,b,c){a&&(a.style["webkit"+b]=c,a.style["moz"+b]=c,a.style["ms"+b]=c,a.style["o"+b]=c)}function setTransformOrigin(a,b){a.style.transformOrigin=b;a.style["-webkit-transform-origin"]=b;a.style["-ms-transform-origin"]=b;a.style["-moz-transform-origin"]=b}
function getTransformOrigin(a){var b=[];if(""!=a.style.transformOrigin){a=a.style.transformOrigin.split(" ");for(var c=0;c<a.length;c++)b.push(parseFloat(a[c]))}return b}Element.prototype.appendAfter=function(a){a.parentNode.insertBefore(this,a.nextSibling)};Element.prototype.appendBefore=function(a){a.parentNode.insertBefore(this,a)};
function getMeasureText(a,b,c){if("string"!=typeof a||"string"!=typeof b||"number"!=typeof c)throw"getMeasureText(): Invalid parameter type !";var d=document.createElement("canvas").getContext("2d");d.font=c+"px "+b;return{width:d.measureText(a).width,height:c}}function DisableScrollPlugin(){window.Scrollbar.ScrollbarPlugin.apply(this,arguments)}DisableScrollPlugin.prototype=Object.create(window.Scrollbar.ScrollbarPlugin.prototype);
DisableScrollPlugin.prototype.transformDelta=function(a){this.options.direction&&(a[this.options.direction]=0);return a};DisableScrollPlugin.pluginName="disableScroll";DisableScrollPlugin.defaultOptions={direction:null};
function xhrRequest(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open(a.type,a.url);d.onload=function(){200<=this.status&&300>this.status?b(d.response):c({status:this.status,responseText:d.responseText,statusText:d.statusText})};d.onerror=function(){c({status:this.status,responseText:d.responseText,statusText:d.statusText})};if(a.headers)for(var e in a.headers)d.setRequestHeader(e,a.headers[e]);var f=a.data,g="";if(f&&"string"==typeof f)g=f;else if(f&&"object"==typeof f){g=[];for(e in f)g.push(encodeURIComponent(e)+
"="+encodeURIComponent(f[e]));g=g.join("&")}!1===a.cache&&(0<g.length&&(g+="&"),g+="_="+(new Date).getTime());d.send(g)})}function extractValue(a){return parseFloat(a.replace("px",""))}function resetViewport(){}function parseRequest(){var a={};if(window.location.search)for(var b=window.location.search.substring(1).split("&"),c=0,d=b.length;c<d;c++){var e=b[c].split("=");a[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return a}function fuzzyCompare(a,b){return 1E-5>=Math.abs(a-b)}
function dayOfYear(a){var b=a.getFullYear(),c=[31,28,31,30,31,30,31,31,30,31,30,31];0!=b%4||0==b%100&&0==b%400||(c[1]=29);b=a.getDate();a=a.getMonth();for(var d=0,e=0;e<c.length;e++)if(e<a)d+=c[e];else if(e==a)d+=b;else break;return d}function getSecsUpToCurTime(a){var b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);a=a.getTime();b=b.getTime();return parseInt((a-b)/1E3)}function getSecsFromCurTime(a){return 86400-getSecsUpToCurTime(a)}
function LineChart(a,b,c){this.canvas=a;this.ctx=a.getContext("2d");this.strWidth=b.strokeWidth;""!==b.stroke&&(this.strStyle=b.stroke);this.wSize={width:b.width||300,height:b.height||250};this.pathLimitBuffer=100>this.wSize.width?Math.floor(this.wSize/2):100;this.xSize={min:b.minX,max:b.maxX};this.ySize={min:b.minY,max:b.maxY};this._drawable=this._isNativeCompatible=!0;a=navigator.userAgent;if(-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPad")||-1!=a.indexOf("WebKit/534")||-1!=a.indexOf("Safari")&&-1==
a.indexOf("Chrome"))this._isNativeCompatible=!1;this.drawStatus={brushType:LineChart.BrushType.LINE,prevPoint:{x:void 0,y:void 0},currPoint:{x:void 0,y:void 0,selected:!1},lineBufferSize:0,operation:0};this.curveWgt=c}LineChart.prototype.strStyle="rgb(0,0,0)";LineChart.prototype.lineCap="butt";LineChart.prototype.lineJoin="bevel";LineChart.prototype.TYPE={STEP:1,LINE:0};LineChart.prototype.pathLimitBuffer=100;LineChart.prototype.curveWgt=null;
LineChart.prototype.setXRange=function(a,b){this.curveXRange={min:a,max:b}};LineChart.prototype.setYRange=function(a,b){this.curveYRange={min:a,max:b}};LineChart.prototype.mapToCoordinatesSystem=function(a){a.x=a.x;a.y=this.wSize.height-a.y};LineChart.prototype.mapToRange=function(a,b,c){a.x=(b-this.curveXRange.min)*this.wSize.width/(this.curveXRange.max-this.curveXRange.min);a.y=(c-this.curveYRange.min)*this.wSize.height/(this.curveYRange.max-this.curveYRange.min)};
LineChart.prototype.updateCurve=function(a,b,c){this.data=a;this.type=b;this._drawable=c};LineChart.BrushType={LINE:0,DASHED:1};LineChart.prototype._resetDrawStatus=function(){this.drawStatus.prevPoint.x=void 0;this.drawStatus.prevPoint.y=void 0;this.drawStatus.currPoint.x=void 0;this.drawStatus.currPoint.y=void 0;this._isNativeCompatible&&this.drawStatus.brushType!=LineChart.BrushType.LINE&&this.ctx.setLineDash([0,0]);this.drawStatus.brushType=LineChart.BrushType.LINE};
LineChart.prototype.drawCurve=function(){if(null!=this.curveWgt){var a=this.data;if(this._drawable&&a){this.ctx.lineWidth=this.strWidth;this.ctx.strokeStyle=this.strStyle;this.ctx.lineCap=this.lineCap;this.ctx.lineJoin=this.lineJoin;this.drawStatus.lineBufferSize=this.pathLimitBuffer;for(var b=this.drawStatus.prevPoint,c=this.drawStatus.currPoint,d=this.drawStatus.brushType,e=this.curveWgt.getValue("cursor-ts"),f=a.length-1,g=0,h=a.length;g<h;g++)if(0==this.drawStatus.lineBufferSize&&this.endLine(),
void 0!==a[g]&&a[g].q.isQualityGood()){if(g<h-1&&void 0!==a[g+1]){var k=a[g+1].x;e>=a[g].x&&e<=k&&this.curveWgt.setValue("cursor-value",a[g].y,null)}c.selected=a[g].selected;this.mapToRange(c,a[g].x,a[g].y);this.mapToCoordinatesSystem(c);0>c.x&&!this.isScatter?(this.isOutFromBounds(c)&&!this.isScatter?(this.moveToBoundary(c),d=LineChart.BrushType.DASHED):d=LineChart.BrushType.LINE,b.x=c.x,b.y=c.y,b.selected=c.selected):(void 0!=b.x&&void 0!=c.x&&(this.isOutFromBounds(c)&&!this.isScatter?(this.moveToBoundary(c),
d==LineChart.BrushType.LINE&&(this.endLine(),d=LineChart.BrushType.DASHED,this.beginLine(b,d)),0==this.drawStatus.operation&&this.beginLine(b,d),this.appendSegment(b,c)):d==LineChart.BrushType.DASHED?(this.appendSegment(b,c),this.endLine(),d=LineChart.BrushType.LINE,this.beginLine(c,d)):(0==this.drawStatus.operation&&this.beginLine(b,d),this.appendSegment(b,c))),b.x=c.x,b.y=c.y,b.selected=c.selected,this.isOutFromBounds(b)&&!this.isScatter&&(d=LineChart.BrushType.DASHED),g==f&&this.endLine())}else this.endLine(),
b.x=b.y=void 0,d=LineChart.BrushType.LINE;this._resetDrawStatus()}}};LineChart.prototype.isOutFromBounds=function(a){return 0>a.y||a.y>this.wSize.height?!0:!1};LineChart.prototype.moveToBoundary=function(a){var b=0;0>a.y&&(a.y=0,b=-1);a.y>this.wSize.height&&(a.y=this.wSize.height,b=1);return b};
LineChart.prototype.beginLine=function(a,b){1==this.drawStatus.operation&&(this.ctx.stroke(),this.drawStatus.lineBufferSize=this.pathLimitBuffer);if(this._isNativeCompatible&&b!=this.drawStatus.brushType)if(b==LineChart.BrushType.LINE)this.ctx.setLineDash([0,0]);else if(b==LineChart.BrushType.DASHED){var c=this.ctx.lineWidth;this.ctx.setLineDash([2*c,3*c])}this.drawStatus.brushType=b;a.selected&&this.drawBigPoint(a);this.ctx.beginPath();this.ctx.moveTo(a.x,a.y);this.drawStatus.operation=1};
LineChart.prototype.appendSegment=function(a,b){0==this.drawStatus.lineBufferSize&&(this.ctx.stroke(),this.drawStatus.lineBufferSize=this.pathLimitBuffer,a.selected&&this.drawBigPoint(a),this.ctx.beginPath(),this.ctx.moveTo(a.x,a.y));this.drawStatus.brushType==LineChart.BrushType.LINE?(this.type==this.TYPE.STEP&&a.x!=b.x&&this.ctx.lineTo(b.x,a.y),this.ctx.lineTo(b.x,b.y)):this.drawStatus.brushType==LineChart.BrushType.DASHED&&(this._isNativeCompatible?(this.type==this.TYPE.STEP&&a.x!=b.x&&this.ctx.lineTo(b.x,
a.y),this.ctx.lineTo(b.x,b.y)):(this.type==this.TYPE.STEP&&a.x!=b.x&&this.dashedLine(a.x,a.y,b.x,b.y),this.dashedLine(a.x,a.y,b.x,b.y)));this.drawStatus.lineBufferSize--;b.selected&&(this.ctx.stroke(),this.drawBigPoint(b),this.drawStatus.lineBufferSize=this.pathLimitBuffer,this.ctx.beginPath(),this.ctx.moveTo(b.x,b.y))};LineChart.prototype.endLine=function(){1==this.drawStatus.operation&&(this.ctx.stroke(),this.ctx.closePath(),this.drawStatus.operation=0)};
LineChart.prototype.drawBigPoint=function(a){this.ctx.beginPath();this.ctx.fillStyle=this.strStyle;this.ctx.arc(a.x,a.y,2.5*this.strWidth,0,2*Math.PI);this.ctx.fill();this.ctx.stroke()};LineChart.prototype.dashedLine=function(a,b,c,d){for(var e=this.ctx.lineWidth+2,f=c-a,g=d-b,e=Math.floor(Math.sqrt(f*f+g*g)/e),f=f/e,g=g/e,h=0;h<e;)a+=f,b+=g,this.ctx[0==h%2?"moveTo":"lineTo"](a,b),h++;this.ctx[0==h%2?"moveTo":"lineTo"](c,d)};LineChart.prototype.enableDrawing=function(a){this._drawable=a};
LineChart.prototype.clearCanvasContext=function(){this.ctx.clearRect(0,0,this.wSize.width+5,this.wSize.height+5)};LineChart.prototype.clearData=function(){this.data=null};LineChart.prototype.updateCanvasContainerSize=function(a){var b=this.canvas.parentNode;b.style.width=a.w+"px";b.style.height=a.h+"px";b.style.left=a.x+"px";b.style.top=a.y+"px"};LineChart.prototype.updateSize=function(a,b){this.canvas.width=a;this.canvas.height=b;this.wSize.width=a;this.wSize.height=b};
LineChart.prototype.destroy=function(){this.ctx.clearRect(0,0,this.wSize.width,this.wSize.height);this.curveWgt=null};function Cursor(a,b){this.canvas=a;this.ctx=a.getContext("2d");this.strokeColor=b.cursorColor;this.strokeWidth=b.cursorWidth;this.xCursorShow=b.xCursorShow;this.yCursorShow=b.yCursorShow;this._xSize={};this._ySize={};this._wSize={width:b.width||300,height:b.height||250};this._pos={x:this._wSize.width/2,y:b.yCursorPos||this._wSize.height}}Cursor.prototype.constructor=Cursor;
Cursor.prototype.isVisible=!1;Cursor.prototype.getLinePoints=function(a,b){var c=[];c.push({x:a,y:0});c.push({x:a,y:this._wSize.height});c.push({x:0,y:b});c.push({x:this._wSize.width,y:b});return c};Cursor.prototype.mapToCoordinatesSystem=function(a,b,c){a.x=b;a.y=this._wSize.height-c};Cursor.prototype.mapToRange=function(a,b,c){a.x=Math.floor((b-this._xSize.min)*this._wSize.width/(this._xSize.max-this._xSize.min));a.y=Math.floor((c-this._ySize.min)*this._wSize.height/(this._ySize.max-this._ySize.min))};
Cursor.prototype.drawCursor=function(a){var b={x:0,y:0};a?b={x:this._pos.x,y:this._pos.y}:(this.mapToRange(b,this._pos.x,this._pos.y),this.mapToCoordinatesSystem(b,b.x,b.y));if(!this.xCursorShow&&!this.yCursorShow)return this.isVisible&&(this.ctx.clearRect(0,0,this._wSize.width,this._wSize.height),this.isVisible=!1),!1;this.isVisible=!0;a=this.getLinePoints(b.x,b.y);this.ctx.clearRect(0,0,this._wSize.width,this._wSize.height);this.ctx.beginPath();this.xCursorShow&&(this.ctx.moveTo(a[0].x,a[0].y),
this.ctx.lineTo(a[1].x,a[1].y));this.yCursorShow&&(this.ctx.moveTo(a[2].x,a[2].y),this.ctx.lineTo(a[3].x,a[3].y));this.ctx.lineWidth=this.strokeWidth;this.ctx.strokeStyle=this.strokeColor;this.ctx.stroke();this.ctx.closePath()};Cursor.prototype._getValidValue=function(a){var b=null;if(a<this._xSize.min||a>this._xSize.max){if(this._pos.x<this._xSize.min||this._pos.x>this._xSize.max)a=(this._xSize.max-this._xSize.min)/2,b=this._xSize.max-a}else b=a;return b};
Cursor.prototype.setXCursorPos=function(a){a=this._getValidValue(a);null!=a&&(this._pos.x=a)};Cursor.prototype.setYCursorPos=function(a){this._pos.y=a};Cursor.prototype.setCursorVisibility=function(a){this.xCursorShow=a};Cursor.prototype.setXMin=function(a){this._xSize.min=a};Cursor.prototype.setXMax=function(a){this._xSize.max=a};Cursor.prototype.setYMin=function(a){this._ySize.min=a};Cursor.prototype.setYMax=function(a){this._ySize.max=a};Cursor.prototype.getXPosition=function(){if(this._pos)return this._pos.x};
Cursor.prototype.getYPosition=function(){if(this._pos)return this._pos.y};Cursor.prototype.isCursorVisible=function(){return this.xCursorShow};Cursor.prototype.clearCanvasContext=function(){this.ctx.clearRect(0,0,this._wSize.width+5,this._wSize.height+5)};Cursor.prototype.updateSize=function(a,b){this.canvas.width=a;this.canvas.height=b;this._wSize.width=a;this._wSize.height=b};function CursorXY(a,b){Cursor.call(this,a,b)}CursorXY.prototype=Object.create(Cursor.prototype);
CursorXY.prototype.constructor=CursorXY;CursorXY.prototype.xyGrid=null;CursorXY.prototype.xyIdx=null;CursorXY.prototype.lowerSnap=null;CursorXY.prototype.upperSnap=null;CursorXY.prototype.isOnTheGrid=!1;
CursorXY.prototype.stepXY=function(a,b){a=0==a?1:-1;var c=this._pos.x,d;if(this.isOnTheGrid)d=this.xyIdx;else{--b;var e=!1;1===a?c>this.xyGrid[this.xyGrid.length-1]?e=!0:d=this.xyGrid.indexOf(this.upperSnap):-1===a&&(c<this.xyGrid[0]?e=!0:d=this.xyGrid.lastIndexOf(this.lowerSnap));if(e)return{xvalue:"",yoccurence:0}}c=d+b*a;c>=this.xyGrid.length?c=this.xyGrid.length-1:0>c&&(c=0);this.xyIdx=c;this.isOnTheGrid=!0;c=this.xyGrid[c];this._pos.x=c;d=this.xyGrid.indexOf(c);d=0<this.xyGrid.lastIndexOf(c)-
d?this.xyIdx-d:0;return{xvalue:c,yoccurence:d}};
CursorXY.prototype.updateXYGrid=function(a){this.xyGrid=[];for(var b={},c=0,d=a.length;c<d;c++){var e=a[c].xvalue;if(void 0!==e)for(var f=0,g=e.length;f<g;f++){var h=e[f];if(e.indexOf(h)!=f){var k=a[c].wgtId;void 0===b[h]&&(b[h]={},b[h][k]=0);b[h][k]++}else this.insert(h),this.updateLowerUpperSnap(h)}}for(var l in b){c=b[l];a=0;for(k in c)c[k]>a&&(a=c[k]);for(c=0;c<a;c++)this.xyGrid.splice(this.xyGrid.indexOf(parseFloat(l)),0,parseFloat(l))}this.isOnTheGrid&&(this.xyIdx=this.xyGrid.indexOf(this._pos.x))};
CursorXY.prototype.insert=function(a){if(-1==this.xyGrid.indexOf(a)){for(var b=this.xyGrid.length,c=0;c<b&&this.xyGrid[c]<a;)c++;this.xyGrid.splice(c,0,a);return c}return-1};
CursorXY.prototype.updateLowerUpperSnap=function(a){if(!this.isOnTheGrid){var b=this._pos.x;b===a?this.isOnTheGrid=!0:null===this.lowerSnap&&b>a?this.lowerSnap=a:null===this.upperSnap&&b<a?this.upperSnap=a:b>a&&Math.abs(b-a)<Math.abs(b-this.lowerSnap)?this.lowerSnap=a:b<a&&Math.abs(b-a)<Math.abs(b-this.upperSnap)&&(this.upperSnap=a)}};
CursorXY.prototype.resetXYCursor=function(){if(null!==this.xyGrid){var a=this.xyGrid.indexOf(this._pos.x);this.xyIdx=(this.isOnTheGrid=-1!==this.xyGrid.indexOf(this._pos.x))?a:null}for(var a=0,b=this.xyGrid.length;a<b;a++)this.updateLowerUpperSnap(this.xyGrid[a])};CursorXY.prototype.getValueXY=function(){return this.xyGrid[this.xyIdx]};
CursorXY.prototype.getOccurenceXY=function(){var a=this.xyGrid[this.xyIdx];if(void 0!==a){var b=this.xyGrid.indexOf(a);return 0<this.xyGrid.lastIndexOf(a)-b?this.xyIdx-b:0}return 0};CursorXY.prototype.getXPosition=function(){return null!==this.xyGrid&&null!==this.xyIdx?this.xyGrid[this.xyIdx]:""};
function ColorBand(a,b){this.ctx=document.getElementById(a).getContext("2d");this.id=a;this.wSize={width:b.width||300,height:b.height||250};this.xSize={min:b.minX||0,max:b.maxX||1};this.ySize={min:b.minY||0,max:b.maxY||1};this.bands=b.bands}ColorBand.prototype.setXRange=function(a,b){this.xSize.min=a;this.xSize.max=b};ColorBand.prototype.setYRange=function(a,b){this.ySize.min=a;this.ySize.max=b};
ColorBand.prototype.mapToRange=function(a,b){return Math.floor((a-b)*this.wSize.width/(this.xSize.max-this.xSize.min))};
ColorBand.prototype.drawBands=function(){var a=new Date(this.xSize.max),b=new Date(this.xSize.min),c=this.getPointsInWindow(b,a);this.ctx.clearRect(0,0,this.wSize.width,this.wSize.height);var d;if(0==c.length)d=b.getDay(),b=b.getHours(),this.draw(0,this.wSize.width,d,b-2);else{for(var e=0,f=0,g=0;g<c.length;g++)e=c[g].x-f,d=c[g].d,b=c[g].h,this.draw(f,e,d,b-2),f=c[g].x;e=this.wSize.width-f;d=a.getDay();b=a.getHours();this.draw(f,e,d,b-1)}};
ColorBand.prototype.getPointsInWindow=function(a,b){for(var c=[],d=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours()+1,0);d<=b;)c.push({x:this.mapToRange(d,a),d:d.getDay(),h:d.getHours()}),d=new Date(d.getTime()+36E5);return c};ColorBand.prototype.draw=function(a,b,c,d){if(c=this.bands.clrs[this.bands.tmtx[c][d]])this.ctx.beginPath(),this.ctx.rect(a,0,b,this.wSize.height),this.ctx.fillStyle=c,this.ctx.fill()};
ColorBand.prototype.clearCanvasContext=function(){this.ctx.clearRect(0,0,this.wSize.width+5,this.wSize.height+5)};ColorBand.prototype.updateSize=function(a,b){var c=document.getElementById(this.id);c.width=a;c.height=b;this.wSize.width=a;this.wSize.height=b};
function Grid(a,b){this.canvas=a;this.ctx=a.getContext("2d");this.gridX=b.gridX;this.gridY=b.gridY;this.colorX=b.colorX;this.colorY=b.colorY;this.xanchor=b.xanchor;this.yanchor=b.yanchor;this.xspacing=b.xspacing;this.yspacing=b.yspacing;this.wSize={width:b.width||300,height:b.height||250};this.xSize={min:b.minX,max:b.maxX};this.ySize={min:b.minY,max:b.maxY}}
Grid.prototype.drawBGGrid=function(){var a=1,b=1;this.ctx.clearRect(0,0,this.wSize.width,this.wSize.height);this.ctx.beginPath();this.ctx.fillStyle=this.colorX;for(var c=Math.ceil(this.wSize.width/(this.gridX+1-2)),d=Math.ceil(this.wSize.height/(this.gridY+1-2)),e=c,f=0;a<this.gridX-1;)this.ctx.fillRect(e,0,1,this.wSize.height),e+=c,a++;this.ctx.beginPath();for(this.ctx.fillStyle=this.colorY;b<this.gridY;)this.ctx.fillRect(0,f,this.wSize.width,1),f+=d,b++;this.ctx.closePath()};
Grid.prototype.setGridX=function(a){this.gridX=a};Grid.prototype.setGridY=function(a){this.gridY=a};Grid.prototype.setColorX=function(a){this.colorX=a};Grid.prototype.setColorY=function(a){this.colorY=a};Grid.prototype.setXAnchor=function(a){this.xanchor=a};Grid.prototype.setYAnchor=function(a){this.yanchor=a};Grid.prototype.setXSpacing=function(a){this.xspacing=a};Grid.prototype.setYSpacing=function(a){this.yspacing=a};
Grid.prototype.clearCanvasContext=function(){this.ctx.clearRect(0,0,this.wSize.width+5,this.wSize.height+5)};Grid.prototype.updateSize=function(a,b){this.canvas.width=a;this.canvas.height=b;this.wSize.width=a;this.wSize.height=b};
function generateCloseButton(a,b){var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("a"),g=document.createTextNode("X");c.setAttribute("class","hmi-button-close hacklayer");c.setAttribute("style","left:"+b+"px;top:"+a+"px;");d.setAttribute("class","round-button");e.setAttribute("style","position:absolute;");e.setAttribute("class","round-button-circle");f.appendChild(g);e.appendChild(f);d.appendChild(e);c.appendChild(d);return c}
function ComboWrapper(a){var b=a.parentWidget,c=a.parentPage,d=a.elem,e=a.select;this.baseWgt=a;this._initEmptyElem=this._updateClone=!1;this._parentPage=c;this._select=e;c=d.style;this._el={id:a.wgtId,w:a.width,h:a.height,t:a.top,l:a.left,fs:parseFloat(c.fontSize),ff:c.fontFamily};this._getOffset(b);this._frame=a.frame?!0:!1;this._isMsgTextWgt=!1;a.constructor==hmiMsgText?(this._isMsgTextWgt=!0,this._frameSize=this._frame?a.frameSize:1):this._frameSize=1;this._init(d)}
ComboWrapper.prototype.constructor=ComboWrapper;
ComboWrapper.prototype._init=function(a){var b,c,d,e,f="line-height:"+90*this._el.h/100+"px",g="position:relative;width:"+(this._el.w+2*this._frameSize-2)+"px;height:"+(this._el.h+2*this._frameSize-2)+"px;font-family:"+this._el.ff+";font-size:"+this._el.fs+"px;";this._frame&&(g+="left:-"+this._frameSize+"px;top:-"+this._frameSize+"px;");b=document.createElement("div");c=document.createElement("p");d=document.createElement("b");e=document.createTextNode("");this._select.style.display="none";b.setAttribute("class",
"selectric");b.setAttribute("style",g);c.setAttribute("class","label");c.setAttribute("style",f);d.setAttribute("class","button");c.appendChild(e);b.appendChild(c);b.appendChild(d);$(a).prepend(b);this._lbl=c;this._sel=b;this._clone=a.cloneNode(!1)};
ComboWrapper.prototype._cloneCombobox=function(){var a=this.baseWgt;this._setMaxSelectricHeight();this._hasEmptyElem();this._clone.hasChildNodes()&&$(this._clone).children().remove();this._updateCloneStyles(a);this._clSelect=this._select.cloneNode(!0);this._clSelect.selectedIndex=this._select.selectedIndex;this._clone.appendChild(this._clSelect);$(this._clSelect).selectric({nativeOnMobile:!1,disableOnMobile:!1,onClose:function(){a.onClose()},onChange:function(){a.onChange(this.selectedIndex)}});this._selectric=
$(this._clSelect).data("selectric");this._appendCustomSelectricStyles();this._open()};
ComboWrapper.prototype._updateCloneStyles=function(a){this._getOffset(a.parentWidget);this._clone.style.fontFamily=this._el.ff;this._clone.style.fontSize=this._el.fs;this._clone.style.width=this._el.w+2*this._frameSize+"px";this._clone.style.height=this._el.h+2*this._frameSize-2+"px";this._clone.style.left=this._offset.l+"px";this._clone.style.top=this._offset.t+"px";this._isMsgTextWgt&&(this._clone.style.border="none",this._clone.style.overflow="visible")};
ComboWrapper.prototype._open=function(){this._selectric.open();this._updateCloneStyles(this.baseWgt);this._parentPage.elem.appendChild(this._clone);var a=this.baseWgt.parentWidget;a.constructor==hmiGroup&&a.addActiveElement(this._clone)};ComboWrapper.prototype._hasEmptyElem=function(){"empty"==this._select.firstChild.getAttribute("value")&&(this._initEmptyElem=!0)};
ComboWrapper.prototype._appendCustomSelectricStyles=function(){var a;a=1>=this._frameSize?0:2*this._frameSize-2;$(".label",this._clone).css("line-height",90*this._el.h/100+"px");$(".selectric-items",this._clone).css({width:this._el.w+a+"px",height:this._maxH+"px"});this.upDir&&$(".selectric-items",this._clone).css("top",-this._maxH+"px");this._initEmptyElem&&($(".selectric-scroll",this._clone).children()[0].firstChild.style.display="none",this._initEmptyElem=!1)};
ComboWrapper.prototype._setMaxSelectricHeight=function(){var a=this._parentPage.height-(this._offset.t+this._el.h)-1,b=this._el.fs+2,c=this._select.childNodes.length;this._parentPage.constructor==hmiDialog&&(a-=this._parentPage.hdrHeight);"empty"==this._select.firstChild.getAttribute("value")&&--c;c*=b;c>10*b&&(c=10*b);this._offset.t+(this._el.h+c)>this._parentPage.height&&(a>2*b?(this.upDir=!1,c=a):(this.upDir=!0,c>this._offset.t&&(c=0)));this._maxH=c};
ComboWrapper.prototype._getOffset=function(a){var b,c,d,e,f,g=this._el.l,h=this._el.t;c=d=e=f=0;isNaN(g)&&(g=0);isNaN(h)&&(h=0);b=a;b.constructor==hmiRecipeWgt&&(isNaN(b.left)||(d=b.left),isNaN(b.top)||(f=b.top),b=b.parentWidget);for(;b!=hmiPage&&null!=b;)b.constructor==hmiGroup&&(isNaN(b.left)||(c+=b.left),isNaN(b.top)||(e+=b.top),null!=b.scrollbar&&(c-=b.scrollbar.offset.x,e-=b.scrollbar.offset.y)),b=b.parentWidget;a.constructor==hmiRecipeWgt?(c=g+c+d,e=h+e+f):(c=g+c,e=h+e);this._offset={l:c,t:e}};
ComboWrapper.prototype.update=function(a){-1==a?this._lbl.textContent="":this._select.options[a]&&(this._lbl.textContent=this._select.options[a].textContent);this._updateClone=!0};ComboWrapper.prototype.updateFont=function(a){this._el.ff=a;this._sel.style.fontFamily=a;this._updateClone=!0};
ComboWrapper.prototype.bindEvents=function(){var a=this;$(this._sel).bind("touchstart click",function(b){b.preventDefault();b.stopPropagation();null==a._clSelect||a._updateClone?(a._updateClone=!1,a._cloneCombobox()):a._open()})};ComboWrapper.prototype.unbindEvents=function(){$(this._sel).off()};ComboWrapper.prototype.showWrapper=function(){this._sel.style.display="block"};ComboWrapper.prototype.hideWrapper=function(){this._sel.style.display="none"};ComboWrapper.prototype.removeWrapper=function(){$(this._sel).remove()};
ComboWrapper.prototype.detachClone=function(){this._clone&&$(this._clone).detach()};ComboWrapper.prototype.removeClone=function(){this._clone&&$(this._clone).remove()};ComboWrapper.prototype.removeObjects=function(){this.removeClone();this.removeWrapper();this.unbindEvents();this._selectric&&this._selectric.destroy()};function hmiAction(a,b,c,d,e){var f=null;null!=a&&(f=a.wgtId);hmiWidget.call(this,f,null,c,d,e);this.event=b;this.parentWidget&&this.parentWidget.addAction(b,this)}
hmiAction.prototype=Object.create(hmiWidget.prototype);hmiAction.prototype.constructor=hmiAction;hmiAction.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};hmiAction.prototype.initDataLinkSideEffects=function(a,b){"tagSrc"==b&&(this.p.tag=a.tag,this.p.src=a.dataSrc.studioId,this.p.aIdx=a.tagIndex,this.p.srcType=a.srcType)};hmiAction.prototype.setValue=function(a,b,c){};hmiAction.prototype.getValue=function(a){};
hmiAction.prototype.destroy=function(){hmiWidget.prototype.destroy.call(this)};$hmi.fn.hmiAction=function(a,b,c,d){var e=hmiAction;if(1==b.t)e=hmiActionJS;else if(b.c){var f=$hmi.getAction(b.c);f&&(e=f.constructor)}return new e(this,a,b,d,c)};hmiAction.prototype.isFloat=function(a){return"number"===typeof a&&0!==a%1?!0:!1};hmiAction.prototype.execute=function(a,b,c){this.done()};hmiAction.prototype.addActionListener=function(a){this.listener=a};
hmiAction.prototype.done=function(){this.listener&&this.listener.done&&this.listener.done()};hmiAction.prototype.getSelectedAlarms=function(){for(var a=[],b=0,c=$hmi.getWidget("_AlarmsMgr",!0),d=0;d<c.vars.alSelect.length;d++)c.vars.alSelect[d]&&a.push("al"+ ++b+"="+c.vars.alName[d]);0<a.length&&a.push("n="+a.length);return a.join("&")};
hmiAction.prototype.parseTagActions=function(a){var b,c;a=$.extend(!0,{},a);if("Alias"==a.srcType){b=$hmi.activeProject.getWidget(a.src,!0).getNameByTagAlias(a.tag);var d;null!=b&&(d=b.tag,b=b.idx,-1!=b&&(a.aIdx=b));a.tag=d;a.src="_TagMgr";a.srcType="Tag"}a.src&&1<a.src.split(":").length&&(a.wgtPage=a.src.split(":")[0],a.src=a.src.split(":")[1]);if(a.tag)d=a.tag,b=$hmi.getWidget(a.src,!0),!a.wgtPage&&b&&b.constructor==hmiGroup?(b=$hmi.getWidget(a.src,!0),c=b.ctype,a.wgtId=b.wgtId,c&&$hmi.activeProject.props[c][d]?
(a.aliases=$hmi.activeProject.props[c][d],a.propType=0):1<d.split(".").length?(a.aliases=d.split(),a.propType=1):(a.prop=d,a.propType=2)):(a.prop=d,a.propType=2);else return null;a.rw="rw";return a};hmiAction.prototype.changePage=function(a,b){$hmi.activeProject.changePage(a,b)};
hmiAction.prototype._updateWidgets=function(a,b){var c,d,e;e=0==b.propType||1==b.propType?b.aliases:[b.prop];var f=b.propType;try{var g;g=b.wgtId?$hmi.focusPage.getWidget(b.wgtId):"_TagMgr"==b.src?$hmi.activeProject.getTagMgr():$hmi.getWidget(b.src,!0);for(var h=0,k=e.length;h<k;h++){var l={wgt:null,prop:null};0==f||1==f?g.resolveAliasAttribute(e[h],l):l={wgt:g,prop:e[h]};var n=!1,m;b.wgtPage?(n=!0,m=$hmi.activeProject.getWidget("_TagMgr",!0)):(m=l.wgt,m.constructor==hmiTagMgr&&(n=!0));d=l.prop;if(n){var p=
this;"rw"==b.rw?m.getTagValue(d,b.aIdx).then(function(e){e=e.getValue();if(p.constructor==hmiActionStepTag){if(isNaN(e))return p.done(),!1}else if(isNaN(e)||p.isFloat(e))return p.done(),!1;b.tagType=p.getTagTypeByName(b.tag);c=a(e,b);$.when(m.setValue(d,c,b.aIdx,!0)).done(function(){p.done()}).fail(function(){p.done()})},function(){p.done()}):"w"==b.rw?$.when(m.setValue(d,b.v,b.aIdx,!0)).done(function(){p.done()}).fail(function(){p.done()}):this.done()}else{if("rw"==b.rw){var q=parseFloat(m.getValue(d));
if(isNaN(q)||this.isFloat(q))return this.done(),!1;c=a(q,b);m.setValue(d,c)}else"w"==b.rw&&m.setValue(d,b.v);this.done()}}}catch(r){throw"Action execution: "+this.constructor.name+". JS error: "+r.message;}};hmiAction.prototype.exist=function(a){return $hmi.getWidget(a)?!0:!1};hmiAction.prototype.getDataLinkByAttr=function(a){for(var b in this.dataLinks){var c=this.dataLinks[b];if(c.getAttribute()==a)return c}return null};hmiAction.prototype.setParameters=function(a){this.c=a.c;this.p=a.p};
hmiAction.prototype.getTagTypeByName=function(a){return __tagMgr.getTagInfo(a).t};$hmi.addWidgetDefinition("hmiAction",hmiAction);function hmiActionAckAlarm(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionAckAlarm.prototype=Object.create(hmiAction.prototype);hmiActionAckAlarm.prototype.constructor=hmiActionAckAlarm;hmiActionAckAlarm.prototype.execute=function(a,b){$hmi.getWidget("_AlarmsMgr",!0).ackSelectedAlarms();this.done()};$hmi.addAction("hmiActionAckAlarm",hmiActionAckAlarm);
function hmiActionEnableAlarm(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionEnableAlarm.prototype=Object.create(hmiAction.prototype);hmiActionEnableAlarm.prototype.constructor=hmiActionEnableAlarm;hmiActionEnableAlarm.prototype.execute=function(a,b){$hmi.getWidget("_AlarmsMgr",!0).enableAlarms();this.done()};$hmi.addAction("hmiActionEnableAlarm",hmiActionEnableAlarm);function hmiActionRefreshEvent(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionRefreshEvent.prototype=Object.create(hmiAction.prototype);
hmiActionRefreshEvent.prototype.constructor=hmiActionRefreshEvent;
hmiActionRefreshEvent.prototype.execute=function(a,b){var c=$hmi.activeProject.getWidget("_SysPropMgr",!0).getValue("System Time"),d;d=b.wgtName;if(null!=this.parentWidget.module&&"*"==d.charAt(0)&&"."==d.charAt(1)){d=this.parentWidget.module;for(var e=!1;null!=d&&!(e=this.project.getCWidgetMgr().hasGfxInheritance(d.ctype));)d=d.module;d=e?d.getWidget(b.wgtName,!0):this.parentWidget.module.getWidget(b.wgtName,!0)}else d=$hmi.focusPage.getWidget(b.wgtName,!0);d.setValue("max",Math.ceil(c/1E3));this.done()};
$hmi.addAction("hmiActionRefreshEvent",hmiActionRefreshEvent);function hmiActionResetAlarm(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionResetAlarm.prototype=Object.create(hmiAction.prototype);hmiActionResetAlarm.prototype.constructor=hmiActionResetAlarm;hmiActionResetAlarm.prototype.execute=function(a,b){var c=__project.getCommunticationObj(),d=$hmi.getWidget("_AlarmsMgr",!0).getSelectedAlarms();0<d.length&&c.resetAlarms(d,!1);this.done()};$hmi.addAction("hmiActionResetAlarm",hmiActionResetAlarm);
function hmiActionSaveConfiguration(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionSaveConfiguration.prototype=Object.create(hmiAction.prototype);hmiActionSaveConfiguration.prototype.constructor=hmiActionSaveConfiguration;hmiActionSaveConfiguration.prototype.execute=function(a,b){$hmi.getWidget("_AlarmsMgr",!0).saveConfiguration();this.done()};$hmi.addAction("hmiActionSaveConfiguration",hmiActionSaveConfiguration);
function hmiActionSelectAllAlarms(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e);this.select=!1}hmiActionSelectAllAlarms.prototype=Object.create(hmiAction.prototype);hmiActionSelectAllAlarms.prototype.constructor=hmiActionSelectAllAlarms;hmiActionSelectAllAlarms.prototype.checkAll=!0;
hmiActionSelectAllAlarms.prototype.execute=function(a,b){if(__alarmsMgr){var c=__alarmsMgr;if(b&&void 0!==b.md){var d=b.md,e=b.flt,f=b.wgt,g;if(e){var h,k,l,n;f&&(g=$hmi.focusPage.getWidget(f,!0),h=g.getValue("filterAttr"),k=g.getValue("filterString"),l=g.getValue("filterAttr1"),n=g.getValue("filterString1"));g=c.getSelectAlarmsByFilter(h,k,l,n)}h=!0;if(0==d)if(e)for(d=0,e=g.length;d<e&&h;d++)c.isAlarmSelected(g[d])&&(h=!1);else h=c.getSelectedToogleStatus();else 2==d&&(h=!1);c.doSelectAlarms(h,g)}else this.select=
b&&void 0!=b.enable?b.enable:!this.select,c.selectAllAlarms(this.select);this.done()}};$hmi.addAction("hmiActionSelectAllAlarms",hmiActionSelectAllAlarms);function hmiActionScrollEventsBackward(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionScrollEventsBackward.prototype=Object.create(hmiAction.prototype);hmiActionScrollEventsBackward.prototype.constructor=hmiActionScrollEventsBackward;
hmiActionScrollEventsBackward.prototype.execute=function(a,b){var c=$hmi.getWidget(a);b&&b.wgt&&(c=c.parentPage.getWidget(b.wgt,!0),0<c.getValue("PageDuration")&&(c.setValue("min",c.getValue("min")-c.getTimeFrame()),c.setValue("max",c.getValue("max")-c.getTimeFrame())));this.done()};$hmi.addAction("hmiActionScrollEventsBackward",hmiActionScrollEventsBackward);function hmiActionScrollEventsForward(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionScrollEventsForward.prototype=Object.create(hmiAction.prototype);
hmiActionScrollEventsForward.prototype.constructor=hmiActionScrollEventsForward;hmiActionScrollEventsForward.prototype.execute=function(a,b){var c=$hmi.getWidget(a);b&&b.wgt&&(c=c.parentPage.getWidget(b.wgt,!0),0<c.getValue("PageDuration")&&(c.setValue("min",c.getValue("min")+c.getTimeFrame()),c.setValue("max",c.getValue("max")+c.getTimeFrame())));this.done()};$hmi.addAction("hmiActionScrollEventsForward",hmiActionScrollEventsForward);
function hmiActionSetLanguage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionSetLanguage.prototype=Object.create(hmiAction.prototype);hmiActionSetLanguage.prototype.constructor=hmiActionSetLanguage;hmiActionSetLanguage.prototype.execute=function(a,b){b&&"string"==typeof b.id&&$hmi.getWidget("_MultiLangMgr",!0).changeLanguage(b.id);this.done()};$hmi.addAction("hmiActionSetLanguage",hmiActionSetLanguage);function hmiActionHomePage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}
hmiActionHomePage.prototype=Object.create(hmiAction.prototype);hmiActionHomePage.prototype.constructor=hmiActionHomePage;
hmiActionHomePage.prototype.execute=function(a,b,c){var d=this;setTimeout(function(){if(d.exist(a)){var b;if(null!=pageMgr&&(b=/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?pageMgr.homePages.mobile:/iPad|RIM Tablet OS/i.test(navigator.userAgent)?pageMgr.homePages.tablet:pageMgr.homePages.web,null!=b)){for(var c=0;c<pageMgr.pages.length;c++)if(pageMgr.pages[c][0]==b){pageMgr.setCurrentPage(c);break}d.changePage($hmi.activePage.wgtId,b)}}},0);this.done()};
$hmi.addAction("hmiActionHomePage",hmiActionHomePage);function hmiActionLastPage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e);this.prevPageID=$hmi.prevPageID}hmiActionLastPage.prototype=Object.create(hmiAction.prototype);hmiActionLastPage.prototype.constructor=hmiActionLastPage;
hmiActionLastPage.prototype.execute=function(a,b){var c=this;this.prevPageID=$hmi.prevPageID;setTimeout(function(){if(c.exist(a)){var b;if(null!=pageMgr){b=$hmi.activeProject.getWidget("_UserGroupMgr",!0);if(null==c.prevPageID)if(null!=b.loadLastPageUsed())c.prevPageID=pageMgr.map[b.loadLastPageUsed().toLowerCase()];else if($hmi.enablePjctWidgetServerReq)c.prevPageID=pageMgr.getHomePageId();else{$hmi.getAction("hmiActionLogOut").execute();c.done();return}for(b=0;b<pageMgr.pages.length;b++)if(pageMgr.pages[b][0]==
c.prevPageID){pageMgr.setCurrentPage(b);break}c.changePage($hmi.activePage.wgtId,c.prevPageID)}else null!=$hmi.urlParameters.code&&(-1==$hmi.urlParameters.code?($hmi.getAction("hmiActionLogOut").execute(),c.done()):location.href=window.location.protocol+"//"+location.host+"/index.html?denyDefUser=true&forceLogin=true")}},0);this.done()};$hmi.addAction("hmiActionLastPage",hmiActionLastPage);function hmiActionLaunchBrowser(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionLaunchBrowser.prototype=Object.create(hmiAction.prototype);
hmiActionLaunchBrowser.prototype.constructor=hmiActionLaunchBrowser;hmiActionLaunchBrowser.prototype.execute=function(a,b,c){b.pg&&""!==$.trim(b.pg)&&(a=$.trim(b.pg),a=-1===a.indexOf("://")?"http://"+a:a,a=0===a.indexOf("://")?"http"+a:a,a=window.open(a,"_blank"),void 0!==a&&null!=a&&a.focus?a.focus():$hmi.notifyWarning("Launch Browser","We can not open a new tab or window, please check browser pop-up blocker settings."));$hmi.mouseMgr.loseFocus();this.done()};
$hmi.addAction("hmiActionLaunchBrowser",hmiActionLaunchBrowser);function hmiActionLoadPage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionLoadPage.prototype=Object.create(hmiAction.prototype);hmiActionLoadPage.prototype.constructor=hmiActionLoadPage;
hmiActionLoadPage.prototype.execute=function(a,b,c){var d=this;if(this.exist(a)){var e=b.pg?b.pg:null,f;if(null!==e){for(f=0;f<pageMgr.pages.length&&pageMgr.pages[f][0]!=e;f++);if(!e){showLoadingError("Error: Page not exists");return}e!=$hmi.activePage.wgtId&&(!$hmi.activeProject.getValue("changePageAnimationOnCache")&&$hmi.isPageInCache(e)||$hmi.activeProject.showSpinner(!0));requestAnimationFrame(function(){pageMgr.setCurrentPage(f);d.changePage($hmi.activePage.wgtId,e)})}}this.done()};
$hmi.addAction("hmiActionLoadPage",hmiActionLoadPage);function hmiActionNextPage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionNextPage.prototype=Object.create(hmiAction.prototype);hmiActionNextPage.prototype.constructor=hmiActionNextPage;
hmiActionNextPage.prototype.execute=function(a,b,c){var d=this;setTimeout(function(){if(d.exist(a)){var b,c,g,h,k;if(null!=pageMgr){k=pageMgr.pages.length;switch(pageMgr.userAgent){case "web":g=0;break;case "tablet":g=1;break;case "mobi":g=2;break;default:g=0}var l=pageMgr.currentPage;for(h=l+1;h<=k;h++)if(h==k)h=-1;else if(h==l)break;else if(c=pageMgr.pages[h],1==c[1][g]){b=c[0];break}pageMgr.setCurrentPage(h);b&&d.changePage($hmi.activePage.wgtId,b)}}},0);this.done()};
$hmi.addAction("hmiActionNextPage",hmiActionNextPage);function hmiActionPrevPage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionPrevPage.prototype=Object.create(hmiAction.prototype);hmiActionPrevPage.prototype.constructor=hmiActionPrevPage;
hmiActionPrevPage.prototype.execute=function(a,b,c){var d=this;setTimeout(function(){if(d.exist(a)){var b,c,g,h,k;if(null!=pageMgr){k=pageMgr.pages.length;switch(pageMgr.userAgent){case "web":g=0;break;case "tablet":g=1;break;case "mobi":g=2;break;default:g=0}var l=pageMgr.currentPage;for(h=l-1;-1<=h;h--)if(-1==h)h=k;else if(h==l)break;else if(c=pageMgr.pages[h],1==c[1][g]){b=c[0];break}pageMgr.setCurrentPage(h);b&&d.changePage($hmi.activePage.wgtId,b)}}},0);this.done()};
$hmi.addAction("hmiActionPrevPage",hmiActionPrevPage);function hmiActionShowDialog(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionShowDialog.prototype=Object.create(hmiAction.prototype);hmiActionShowDialog.prototype.constructor=hmiActionShowDialog;
hmiActionShowDialog.prototype.execute=function(a,b){var c=b.pg?b.pg:null;null!=c&&-1==$hmi.activeProject.activeDialogs.indexOf(c)&&$.ajax({url:c+".html",dataType:"html",success:function(a,b){var f,g,h;f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("href","../css/pages/_"+c+".css");g=document.createElement("div");g.innerHTML=a;h=g.querySelector("div[data-role='hmi-dialog']");requestAnimationFrame(function(){setVendorCSS(h,"Transform","translateZ(0) scale(0)")});
document.head.appendChild(f);f=g.getElementsByTagName("script");for(var k=g=null,l=0,n=f.length;l<n;l++){var m=f[l].id;"hmi-page"===m?g=f[l].textContent:"hmi-init"===m&&(k=f[l].textContent)}null!=k&&eval(k);$hmi.getActiveProject().getCWidgetMgr().injectCWTemplates(h,h.getAttribute("id"));container.appendChild(h);null!=g&&eval(g);f=window["_"+c]();f.bindCWJSClass();$hmi.activeProject.subscribeDynamicTags();$hmi.getEventMgr().trigger($hmi.getFocusPage().getHTMLElement(),"loadWgt");f.show();f.execJS();
f.pageactivate()}});this.done()};$hmi.addAction("hmiActionShowDialog",hmiActionShowDialog);function hmiActionCloseDialog(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e);this.prevPageID=null}hmiActionCloseDialog.prototype=Object.create(hmiAction.prototype);hmiActionCloseDialog.prototype.constructor=hmiActionCloseDialog;
hmiActionCloseDialog.prototype.execute=function(a,b){var c=__project;if("*"==b.pg)c.closeAllDialogs();else{var d;d=".*"==b.pg?$hmi.getFocusPage().getId():pageMgr.getWebPage(b.pg);c.isActiveDialog(d)&&c.closeDialog(d)}this.done()};$hmi.addAction("hmiActionCloseDialog",hmiActionCloseDialog);function hmiActionShowMessage(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e);this.nMessage=0;this.setAsDefaultAlert()}hmiActionShowMessage.prototype=Object.create(hmiAction.prototype);
hmiActionShowMessage.prototype.constructor=hmiActionShowDialog;hmiActionShowMessage.prototype.setAsDefaultAlert=function(){var a=this;window.alert=function(b){a.execute(null,{msg:b},2)}};
hmiActionShowMessage.prototype.execute=function(a,b,c){var d,e;if(b){var f=$hmi.activePage.wgtId;null!=b.msg&&(d=b.msg);"undefined"!=typeof b.id&&(e=b.id,$hmi.getWidget(a,!1).isActiveAlarm?(d=__alarmsMgr,a=d.getPageMLTextMgr(),d=d.alarmsConf.mlTexts[e][d.currLang]):(a?a=this.parentWidget.getPageMLTextMgr():(f=$("#container").attr("data-active"),a=$hmi.getWidget(f).getPageMLTextMgr()),d=a.getText(e),null==d&&(f=$hmi.focusPage.getTemplateMLTextMgr(),null!=f&&(d=f.getText(e),a=f))),e=a.getMultiLanguagesMgr().getLanguageFont(a.getCurrentLanguage()));
var g=this.wgtId+"_"+this.nMessage;this.nMessage++;a="<div id='msg-o-"+g+"' class='hmi-overlay'></div><div id='msg-b-"+g+"' class='hmi-msg'>";f="round-button-circle";switch(c){case 1:a+="<div class='hmi-msg-hdr bk-error'>Error</div>";f+=" rnd-btn-c-bk-err";break;case 2:a+="<div class='hmi-msg-hdr'>Alert</div>";f+=" rnd-btn-c-bk-alrt";break;case 3:a+="<div class='hmi-msg-hdr cm-error'>Communication error</div>";f+=" rnd-btn-c-bk-cmerr";break;default:a+="<div class='hmi-msg-hdr'>Message</div>"}a+="<div class='hmi-msg-cnt'><p style=\"margin:5px;"+
(e?"font-family:'"+e:"")+'">'+d+"</p><div class='round-button hmi-msg-close'><div class='"+f+"'><a>OK</a></div></div></div></div>";var h=$("#container");h.append(a);var k=this;$("#msg-b-"+g+" .hmi-msg-close").click(function(){h[0].removeChild(document.getElementById("msg-o-"+g));h[0].removeChild(document.getElementById("msg-b-"+g));delete k.nMessage;$hmi.mouseDisable=!1});$hmi.mouseDisable=!0;$hmi.mouseMgr.loseFocus();this.done()}};$hmi.addAction("hmiActionShowMessage",hmiActionShowMessage);
function hmiActionResetBit(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionResetBit.prototype=Object.create(hmiAction.prototype);hmiActionResetBit.prototype.constructor=hmiActionResetBit;hmiActionResetBit.prototype.execute=function(a,b,c){a=this._parse(b);null==a?this.done():this._updateWidgets(this._apply,a)};hmiActionResetBit.prototype._apply=function(a,b){return a&~(1<<b.idx)};hmiActionResetBit.prototype._parse=function(a){return this.parseTagActions(a)};
hmiActionResetBit.prototype.setValue=function(a,b,c){"tagSrc"==a&&(a=this.getDataLinkByAttr("tagSrc"),null!=a&&this.p.aIdx!=a.tagIndex&&(this.p.aIdx=a.tagIndex))};$hmi.addAction("hmiActionResetBit",hmiActionResetBit);function hmiActionSetBit(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionSetBit.prototype=Object.create(hmiAction.prototype);hmiActionSetBit.prototype.constructor=hmiActionSetBit;
hmiActionSetBit.prototype.execute=function(a,b,c){a=this._parse(b);null==a?this.done():this._updateWidgets(this._apply,a)};hmiActionSetBit.prototype._parse=function(a){return this.parseTagActions(a)};hmiActionSetBit.prototype._apply=function(a,b){var c=b.tagType,d=1<<b.idx,e=64;"Tag"==b.srcType&&(e=Tag.prototype.getNumberOfBits(c)-1);return b.idx>e?a:a|d};
hmiActionSetBit.prototype.setValue=function(a,b,c){"tagSrc"==a&&(a=this.getDataLinkByAttr("tagSrc"),null!=a&&this.p.aIdx!=a.tagIndex&&(this.p.aIdx=a.tagIndex))};$hmi.addAction("hmiActionSetBit",hmiActionSetBit);function hmiActionStepTag(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionStepTag.prototype=Object.create(hmiAction.prototype);hmiActionStepTag.prototype.constructor=hmiActionStepTag;
hmiActionStepTag.prototype.execute=function(a,b,c){a=this._parse(b);null==a?this.done():this._updateWidgets(this._apply,a)};hmiActionStepTag.prototype._parse=function(a){return this.parseTagActions(a)};
hmiActionStepTag.prototype.setValue=function(a,b,c){if(!c||c.isQualityGood())"overLimitTagSrc"==a||"StepOverLimit"==a?this.p.over=b:"stepLimitTagSrc"==a||"StepLimit"==a?this.p.limit=b:"stepSizeTagSrc"==a||"Step"==a?this.p.step=b:"tagSrc"==a&&(a=this.getDataLinkByAttr("tagSrc"),null!=a&&this.p.aIdx!=a.tagIndex&&(this.p.aIdx=a.tagIndex))};hmiActionStepTag.prototype._apply=function(a,b){var c=a+b.step,d=c;b.over&&(d=0>b.step?c<b.limit?b.limit:c:c>b.limit?b.limit:c);return d};
$hmi.addAction("hmiActionStepTag",hmiActionStepTag);function hmiActionToggleBit(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionToggleBit.prototype=Object.create(hmiAction.prototype);hmiActionToggleBit.prototype.constructor=hmiActionToggleBit;hmiActionToggleBit.prototype.execute=function(a,b,c){a=this._parse(b);null==a?this.done():this._updateWidgets(this._apply,a)};hmiActionToggleBit.prototype._parse=function(a){return this.parseTagActions(a)};
hmiActionToggleBit.prototype._apply=function(a,b){return 0!==(a>>b.idx)%2?a&~(1<<b.idx):a|1<<b.idx};hmiActionToggleBit.prototype.setValue=function(a,b,c){"tagSrc"==a&&(a=this.getDataLinkByAttr("tagSrc"),null!=a&&this.p.aIdx!=a.tagIndex&&(this.p.aIdx=a.tagIndex))};$hmi.addAction("hmiActionToggleBit",hmiActionToggleBit);function hmiActionWriteTag(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionWriteTag.prototype=Object.create(hmiAction.prototype);hmiActionWriteTag.prototype.constructor=hmiActionWriteTag;
hmiActionWriteTag.prototype.execute=function(a,b,c){a=this._parse(b);null==a?this.done():(a.rw="w",this._updateWidgets(this._apply,a))};hmiActionWriteTag.prototype._parse=function(a){return this.parseTagActions(a)};hmiActionWriteTag.prototype._apply=function(a,b){return b.value};hmiActionWriteTag.prototype.setValue=function(a,b,c){"tagSrc"==a&&(a=this.getDataLinkByAttr("tagSrc"),null!=a&&this.p.aIdx!=a.tagIndex&&(this.p.aIdx=a.tagIndex))};$hmi.addAction("hmiActionWriteTag",hmiActionWriteTag);
function hmiActionJS(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionJS.prototype=Object.create(hmiAction.prototype);hmiActionJS.prototype.constructor=hmiActionJS;
hmiActionJS.prototype.execute=function(a,b,c,d){if(a=$hmi.getWidget(a)){c=a.constructor==hmiPage?a.callbacks[c].fn:a.parentPage.callbacks&&a.parentPage.callbacks[c]?a.parentPage.callbacks[c].fn:__project.callbacks[c].fn;try{"function"==typeof c&&c(a,d)}catch(e){d="Generated by javascript action",a&&(d+=" on the widget: "+a.studioId),$hmi.showErrorMessage(d+" :",e.name+" : "+e.message)}}this.done()};$hmi.addAction("hmiActionJS",hmiActionJS);
function hmiActionDeleteEventArchive(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDeleteEventArchive.prototype=Object.create(hmiAction.prototype);hmiActionDeleteEventArchive.prototype.constructor=hmiActionDeleteEventArchive;hmiActionDeleteEventArchive.prototype.execute=function(a,b){var c=__project.getCommunticationObj();b&&"undefined"!=typeof b.id&&c.deleteEventArchive(b.id);this.done()};$hmi.addAction("hmiActionDeleteEventArchive",hmiActionDeleteEventArchive);
function hmiActionDeleteTrend(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDeleteTrend.prototype=Object.create(hmiAction.prototype);hmiActionDeleteTrend.prototype.constructor=hmiActionDeleteTrend;hmiActionDeleteTrend.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();b&&d.deleteTrend(b.n,!1).then(function(a){c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("DeleteTrend","REST status: request failed.");c.done()});this.done()};
$hmi.addAction("hmiActionDeleteTrend",hmiActionDeleteTrend);function hmiActionDumpTrend(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDumpTrend.prototype=Object.create(hmiAction.prototype);hmiActionDumpTrend.prototype.constructor=hmiActionDumpTrend;
hmiActionDumpTrend.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();b?d.dumpTrend(b.n,b.f,b.fmt,b.dt,b.dts,b.fnformat,!1).then(function(a){c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("DumpTrend","REST status: request failed.");c.done()}):c.done()};$hmi.addAction("hmiActionDumpTrend",hmiActionDumpTrend);function hmiActionAddRecipeDataSet(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionAddRecipeDataSet.prototype=Object.create(hmiAction.prototype);
hmiActionAddRecipeDataSet.prototype.constructor=hmiActionAddRecipeDataSet;hmiActionAddRecipeDataSet.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();b?d.addRecipeDataSet(b.rc,b.cp,b.ns,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("AddRecipeDataSet","REST status:"+a.code);c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("AddRecipeDataSet","REST status: request failed.");c.done()}):this.done()};
$hmi.addAction("hmiActionAddRecipeDataSet",hmiActionAddRecipeDataSet);function hmiActionDelRecipeDataSet(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDelRecipeDataSet.prototype=Object.create(hmiAction.prototype);hmiActionDelRecipeDataSet.prototype.constructor=hmiActionDelRecipeDataSet;
hmiActionDelRecipeDataSet.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();b?d.delRecipeDataSet(b.rc,b.s,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("DelRecipeDataSet","REST status:"+a.code);c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("DelRecipeDataSet","REST status: request failed.");c.done()}):this.done()};$hmi.addAction("hmiActionDelRecipeDataSet",hmiActionDelRecipeDataSet);
function hmiActionDownLoadCurRecipe(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDownLoadCurRecipe.prototype=Object.create(hmiAction.prototype);hmiActionDownLoadCurRecipe.prototype.constructor=hmiActionDownLoadCurRecipe;
hmiActionDownLoadCurRecipe.prototype.execute=function(a,b){var c=$hmi.activeProject,d=c.getCommunticationObj(),e=c.getWidget("_RecipeMgr",!0),c=e.getValue("curRecipe"),e=e.getValue("curRecipeSet"),f=this;d.downloadRecipe(c,e,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("DownLoadCurRecipe","REST status:"+a.code);f.done()}).fail(function(a,b,c){$hmi.debugMode&&$hmi.notifyWarning("DownLoadCurRecipe","REST status: request failed.");f.done()})};
$hmi.addAction("hmiActionDownLoadCurRecipe",hmiActionDownLoadCurRecipe);function hmiActionDownLoadRecipe(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDownLoadRecipe.prototype=Object.create(hmiAction.prototype);hmiActionDownLoadRecipe.prototype.constructor=hmiActionDownLoadRecipe;
hmiActionDownLoadRecipe.prototype.execute=function(a,b){var c=$hmi.activeProject.getCommunticationObj();if(b){var d=this;c.downloadRecipe(b.r,b.s,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("DownLoadRecipe","REST status:"+a.code);d.done()}).fail(function(a,b,c){$hmi.debugMode&&$hmi.notifyWarning("DownLoadRecipe","REST status: request failed.");d.done()})}else this.done()};$hmi.addAction("hmiActionDownLoadRecipe",hmiActionDownLoadRecipe);
function hmiActionDumpRecipeData(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDumpRecipeData.prototype=Object.create(hmiAction.prototype);hmiActionDumpRecipeData.prototype.constructor=hmiActionDumpRecipeData;hmiActionDumpRecipeData.prototype.STATUS={DEFAULT:0,PROG:1,SUCC:2,FAILED:3};
hmiActionDumpRecipeData.prototype.execute=function(a,b){var c=this;this.srv=__project.getCommunticationObj();if(b){var d=b.r,e=b.ds,f=b.p,g=b.fn,h=b.dt,k=b.ts,l=b.tagName,c=this;this.srv.dumpRecipeData(d,e,f,g,l,h,k,!1).then(function(a){a.status==c.STATUS.FAILED&&(a.msg?$hmi.showMessage("Dump Recipe Data",a.msg):$hmi.showMessage("Dump Recipe Data","Error status code:"+a.status));c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("DumpRecipeData","REST status: request failed.");c.done()})}else this.done()};
$hmi.addAction("hmiActionDumpRecipeData",hmiActionDumpRecipeData);function hmiActionResetRecipe(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionResetRecipe.prototype=Object.create(hmiAction.prototype);hmiActionResetRecipe.prototype.constructor=hmiActionResetRecipe;
hmiActionResetRecipe.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();b&&d.resetRecipe(b.r,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("UpLoadCurRecipe","REST status:"+a.code);c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("UpLoadCurRecipe","REST status: request failed.");c.done()})};$hmi.addAction("hmiActionResetRecipe",hmiActionResetRecipe);function hmiActionRestoreRecipeData(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}
hmiActionRestoreRecipeData.prototype=Object.create(hmiAction.prototype);hmiActionRestoreRecipeData.prototype.constructor=hmiActionRestoreRecipeData;hmiActionRestoreRecipeData.prototype.STATUS={DEFAULT:0,PROG:1,SUCC:2,FAILED:3};
hmiActionRestoreRecipeData.prototype.execute=function(a,b){var c=this;this.srv=__project.getCommunticationObj();if(b){var d=b.r,e=b.s,f=b.p,g=b.fn,h=b.br,k=b.tagName,l=b.rtype,c=this;this.srv.restoreRecipeData(d,e,f,g,k,h,l,!1).then(function(a){a.status==c.STATUS.FAILED&&(a.msg?$hmi.showMessage("Restore Recipe Data",a.msg):$hmi.showMessage("Restore Recipe Data","Error status code:"+a.status));c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("RestoreRecipeData","REST status: request failed.");
c.done()})}};$hmi.addAction("hmiActionRestoreRecipeData",hmiActionRestoreRecipeData);function hmiActionUpLoadCurRecipe(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionUpLoadCurRecipe.prototype=Object.create(hmiAction.prototype);hmiActionUpLoadCurRecipe.prototype.constructor=hmiActionUpLoadCurRecipe;
hmiActionUpLoadCurRecipe.prototype.execute=function(a,b){var c=$hmi.activeProject,d=c.getCommunticationObj(),e=c.getWidget("_RecipeMgr",!0),c=e.getValue("curRecipe"),e=e.getValue("curRecipeSet"),f=this;d.uploadRecipe(c,e,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("UpLoadCurRecipe","REST status:"+a.code);f.done()}).fail(function(a,b,c){$hmi.debugMode&&$hmi.notifyWarning("UpLoadCurRecipe","REST status: request failed.");f.done()})};
$hmi.addAction("hmiActionUpLoadCurRecipe",hmiActionUpLoadCurRecipe);function hmiActionUpLoadRecipe(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionUpLoadRecipe.prototype=Object.create(hmiAction.prototype);hmiActionUpLoadRecipe.prototype.constructor=hmiActionUpLoadRecipe;
hmiActionUpLoadRecipe.prototype.execute=function(a,b){var c=$hmi.activeProject.getCommunticationObj();if(b){var d=this;c.uploadRecipe(b.r,b.s,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("UpLoadRecipe","REST status:"+a.code);d.done()}).fail(function(a,b,c){$hmi.debugMode&&$hmi.notifyWarning("UpLoadRecipe","REST status: request failed.");d.done()})}else this.done()};$hmi.addAction("hmiActionUpLoadRecipe",hmiActionUpLoadRecipe);
function hmiActionWriteCurrentRecipeSet(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionWriteCurrentRecipeSet.prototype=Object.create(hmiAction.prototype);hmiActionWriteCurrentRecipeSet.prototype.constructor=hmiActionWriteCurrentRecipeSet;
hmiActionWriteCurrentRecipeSet.prototype.execute=function(a,b){var c=this,d=__project.getCommunticationObj();if(b){var e=b.r,f=b.s,c=this;d.setCurrentRecipe(e,f,!1).then(function(a){"S_OK"!=a.code&&$hmi.debugMode&&$hmi.notifyWarning("WriteCurrentRecipeSet","REST status:"+a.code);c.done()}).fail(function(a,b,d){$hmi.debugMode&&$hmi.notifyWarning("WriteCurrentRecipeSet","REST status: request failed.");c.done()})}else this.done()};$hmi.addAction("hmiActionWriteCurrentRecipeSet",hmiActionWriteCurrentRecipeSet);
function hmiActionLogOut(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionLogOut.prototype=Object.create(hmiAction.prototype);hmiActionLogOut.prototype.constructor=hmiActionLogOut;
hmiActionLogOut.prototype.execute=function(a,b){var c=this,d=$hmi.activeProject.getWidget("_UserGroupMgr",!0);d.useLastGroupPage()&&!d.isUMTemplate($hmi.activePage.studioId)&&d.storeLastPageUsed();null!=d.isSecurityEnabled()?d.isSecurityEnabled()&&$hmi.activeProject.getCommunticationObj().logOut().then(function(){c.done();location.href=window.location.protocol+"//"+location.host+"/index.html"+(d.isDefaultUser()?"?denyDefUser=true":"?denyDefUser=false")+(d.isForceRemoteLoginEnabled()?"&forceLogin=true":
"&forceLogin=false")}):location.href=window.location.protocol+"//"+location.host+"/index.html?denyDefUser=true&forceLogin=true";this.done()};$hmi.addAction("hmiActionLogOut",hmiActionLogOut);function hmiActionChangePwd(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionChangePwd.prototype=Object.create(hmiAction.prototype);hmiActionChangePwd.prototype.constructor=hmiActionChangePwd;
hmiActionChangePwd.prototype.execute=function(a,b,c){this.exist(a)&&($hmi.activeProject.getWidget("_UserGroupMgr",!0).changePwdAction(),this.done())};$hmi.addAction("hmiActionChangePwd",hmiActionChangePwd);function hmiActionChangePassword(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionChangePassword.prototype=Object.create(hmiAction.prototype);hmiActionChangePassword.prototype.constructor=hmiActionChangePassword;
hmiActionChangePassword.prototype.execute=function(a,b,c){this.exist(a)&&($hmi.activeProject.getWidget("_UserGroupMgr",!0).loadUMForm(a,c.toLowerCase()),this.done())};$hmi.addAction("hmiActionChangePassword",hmiActionChangePassword);function hmiActionApplyEdit(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionApplyEdit.prototype=Object.create(hmiAction.prototype);hmiActionApplyEdit.prototype.constructor=hmiActionApplyEdit;hmiActionApplyEdit.prototype.execute=function(a,b){this.done()};
$hmi.addAction("hmiActionApplyEdit",hmiActionApplyEdit);function hmiActionAddUser(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionAddUser.prototype=Object.create(hmiAction.prototype);hmiActionAddUser.prototype.constructor=hmiActionAddUser;hmiActionAddUser.prototype.execute=function(a,b,c){this.done()};$hmi.addAction("hmiActionAddUser",hmiActionAddUser);function hmiActionDeleteUser(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionDeleteUser.prototype=Object.create(hmiAction.prototype);
hmiActionDeleteUser.prototype.constructor=hmiActionDeleteUser;hmiActionDeleteUser.prototype.execute=function(a,b,c){this.done()};$hmi.addAction("hmiActionDeleteUser",hmiActionDeleteUser);function hmiActionEditUsers(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionEditUsers.prototype=Object.create(hmiAction.prototype);hmiActionEditUsers.prototype.constructor=hmiActionEditUsers;hmiActionEditUsers.prototype.execute=function(a,b,c){this.done()};$hmi.addAction("hmiActionEditUsers",hmiActionEditUsers);
function hmiActionSwitchUser(a,b,c,d,e){hmiAction.call(this,a,b,c,d,e)}hmiActionSwitchUser.prototype=Object.create(hmiAction.prototype);hmiActionSwitchUser.prototype.constructor=hmiActionSwitchUser;hmiActionSwitchUser.prototype.execute=function(a,b,c){this.done()};$hmi.addAction("hmiActionSwitchUser",hmiActionSwitchUser);
var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),hmiActionSetTrendView=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=$hmi.activeProject.getWidget(b.src,
!0),f=b.n;"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f));if(f=e.getSubscribedWgtId(f)){var g=b.xMax instanceof Date?b.xMax.getTime()/1E3:b.xMax,h=b.xMin instanceof Date?b.xMin.getTime()/1E3:b.xMin;e.setTrendView(f,h,g,b.yMin,b.yMax)}this.done()};b.prototype.setValue=function(a,b,e){e&&!e.isQualityGood()||this.p[a]==b||(this.p[a]=b)};return b}(hmiAction);$hmi.addAction("hmiActionSetTrendView",hmiActionSetTrendView);
var hmiActionShowTrendCursor=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=b[2],h=$hmi.getActiveProject();if(e="_TrendMgr"==e?h.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.showTrendCursor(f,"true"==g);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionShowTrendCursor",hmiActionShowTrendCursor);
var hmiActionPageDownTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"down","page");this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPageDownTrend",hmiActionPageDownTrend);
var hmiActionPageDurationTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=b[2],h=$hmi.getActiveProject();if(e="_TrendMgr"==e?h.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.changePageDuration(f,parseInt(g));this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPageDurationTrend",hmiActionPageDurationTrend);
var hmiActionPageLeftTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"left","page");this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPageLeftTrend",hmiActionPageLeftTrend);
var hmiActionPageRightTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"right","page");this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPageRightTrend",hmiActionPageRightTrend);
var hmiActionPageUpTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"up","page");this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPageUpTrend",hmiActionPageUpTrend);
var hmiActionPauseTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.pauseTrend(f);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionPauseTrend",hmiActionPauseTrend);
var hmiActionRefreshTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.refreshTrend(f);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionRefreshTrend",hmiActionRefreshTrend);
var hmiActionRestoreTrendDefault=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b.wgt,f=b.n,g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.restoreTrendDefault(f);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionRestoreTrendDefault",hmiActionRestoreTrendDefault);
var hmiActionResumeTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.resumeTrend(f);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionResumeTrend",hmiActionResumeTrend);
var hmiActionScrollDownTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"down",null);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionScrollDownTrend",hmiActionScrollDownTrend);
var hmiActionScrollLeftTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"left",null);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionScrollLeftTrend",hmiActionScrollLeftTrend);
var hmiActionScrollRightTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"right",null);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionScrollRightTrend",hmiActionScrollRightTrend);
var hmiActionScrollTrendCursor=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g,h,k;b[2]&&(k=parseInt(b[2]));b[3]&&(g=parseInt(b[3]));b[4]&&(h=parseFloat(b[4]));var l=$hmi.getActiveProject();if(e="_TrendMgr"==e?l.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.scrollTrendCursor(f,k,g,h);this.done()};return b}(hmiAction);
$hmi.addAction("hmiActionScrollTrendCursor",hmiActionScrollTrendCursor);
var hmiActionScrollTrendToTime=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=b[2],h=b[3],k=b[4],l,n="_TrendMgr"==e?$hmi.activeProject.getTrendMgr():$hmi.getWidget(e,!0);if(n){"*"==h.charAt(0)&&(h=this.parentWidget.resolveId(h));var m=n.getSubscribedWgtId(h);if(m){e=$hmi.cache.getTag(f);switch(g){case "Start":l=0;break;case "Center":l=1;break;case "End":l=2}e?(f=e.value,n.scrollTrendToTime(m,l,f)):(g=null,
-1!=k.indexOf("Project:")?(k=k.substring(8),g=$hmi.activeProject.getWidget(k,!0)):g=$hmi.getWidget(k,!0),f=g.getValue(f),f instanceof Promise?f.then(function(a){n.scrollTrendToTime(m,l,parseFloat(a))}):(moment.isMoment(f)&&(f=(new Date(f)).getTime()/1E3),n.scrollTrendToTime(m,l,f)))}}this.done()};return b}(hmiAction);$hmi.addAction("hmiActionScrollTrendToTime",hmiActionScrollTrendToTime);
var hmiActionScrollUpTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.moveTrendWindow(f,"up",null);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionScrollUpTrend",hmiActionScrollUpTrend);
var hmiActionZoomInTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.zoomTrendWindow(f,!0,!0),this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomInTrend",hmiActionZoomInTrend);
var hmiActionZoomInYAxisTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.zoomTrendWindow(f,!0,!1);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomInYAxisTrend",hmiActionZoomInYAxisTrend);
var hmiActionZoomOutTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.zoomTrendWindow(f,!1,!0);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomOutTrend",hmiActionZoomOutTrend);
var hmiActionZoomOutYAxisTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.zoomTrendWindow(f,!1,!1);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomOutYAxisTrend",hmiActionZoomOutYAxisTrend);
var hmiActionZoomResetTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.resetZoom(f,!0);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomResetTrend",hmiActionZoomResetTrend);
var hmiActionZoomResetYAxisTrend=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.execute=function(a,b){var e=b[0],f=b[1],g=$hmi.getActiveProject();if(e="_TrendMgr"==e?g.getTrendMgr():$hmi.getWidget(e,!0))"*"==f.charAt(0)&&(f=this.parentWidget.resolveId(f)),(f=e.getSubscribedWgtId(f))&&e.resetZoom(f,!1);this.done()};return b}(hmiAction);$hmi.addAction("hmiActionZoomResetYAxisTrend",hmiActionZoomResetYAxisTrend);
function hmiWidget(a,b,c,d,e){this.wgts=null;this.js=this;this.initInvMtxChain=!1;this.wgtId=a;this.studioId=b;this.parentPage=d;this.mapId={};e&&(this.parentWidget=e);this.elem=document.getElementById(a);this.parentPage||(this.parentPage=null);c&&this.setOptions(c);if(this.elem){null==this.mtx&&(this.mtx=[[1,0,0],[0,1,0],[0,0,1]]);this.cx=parseFloat(this.elem.getAttribute("data-cx"));this.cy=parseFloat(this.elem.getAttribute("data-cy"));if(void 0===this.left||isNaN(this.left))this.left=0;if(void 0===
this.top||isNaN(this.top))this.top=0;this.parentPage&&(this.hideQualityIcon(),this.qualityIcon=-1);this.elem.getAttribute("class")&&-1!=this.elem.getAttribute("class").indexOf("blink")&&(this.blink=1)}this.parentWidget?(this.parentWidget.addWidget(this.wgtId,this),this.parentWidget!==this.parentPage&&this.parentPage.addWidget(this.wgtId,this),this.parentWidget.isModuleInstance()?this.module=this.parentWidget:this.module=this.parentWidget.getModule()):$hmi.addWidget(this.wgtId,this);if((a=this.project=
$hmi.activeProject)&&null!=this.elem){this.umgr=a.getWidget("_UserGroupMgr",!0);var f;this.getAuthorizations()==this.umgr.wgtAuth.HIDE?this.constructor==hmiPage?(this.elem.style.backgroundImage=null,f=!0):f=!1:"none"==this.elem.style.display&&1==this.visible?f=!0:"none"!=this.elem.style.display&&0==this.visible&&(f=!1);null!=f&&(this.setVisibility(f),this._baseRenderMask|=this._baseRenderFlags.VISIBLE,$hmi.addToRender(this))}this._subscriptions={};this._eQueue=[];this._eStatus=0;this.ml=this.destroyed=
!1}hmiWidget.prototype.opacity=1;hmiWidget.prototype.visible=!0;hmiWidget.prototype.blink=0;hmiWidget.prototype.x=null;hmiWidget.prototype.y=null;hmiWidget.prototype.parentWidget=null;hmiWidget.prototype.xFromScaling=!1;hmiWidget.prototype.isTemplateWgt=!1;hmiWidget.prototype.hT=-1;hmiWidget.prototype.aRT=-1;hmiWidget.prototype.aRM=0;hmiWidget.prototype.disabled=!1;hmiWidget.prototype.nWgts=0;hmiWidget.prototype.qualityIcon=-1;hmiWidget.prototype.firstQualityShow=!0;
hmiWidget.prototype._initialized=!1;hmiWidget.prototype._currentRot=null;hmiWidget.prototype._center=null;hmiWidget.prototype._boundingRect=null;hmiWidget.prototype._dirtyBRect=!1;hmiWidget.prototype._subscriptions=null;hmiWidget.prototype._renderMask=0;hmiWidget.prototype._baseRenderMask=0;hmiWidget.prototype._baseRenderFlags={X:2,Y:4,CX:8,CY:16,WIDTH:32,HEIGHT:64,ROTATION:128,BLINK:512,VISIBLE:1024,OPACITY:2048,SHOWQUALITY:4096};hmiWidget.prototype.invokablePropsList=["visible"];
hmiWidget.prototype.invokableFunList=[];hmiWidget.prototype._userValue=null;hmiWidget.prototype.module=null;hmiWidget.prototype._$elem=void 0;hmiWidget.prototype.masked=!1;hmiWidget.prototype.maskChar="*";hmiWidget.jmType=null;Object.defineProperty(hmiWidget.prototype,"$elem",{get:function(){void 0===this._$elem&&(this._$elem=$(this.elem));return this._$elem},set:function(a){this._$elem=a}});
Object.defineProperty(hmiWidget.prototype,"currentRot",{get:function(){null==this._currentRot&&(this._currentRot=this._getCurrentRotation());return this._currentRot},set:function(a){this._currentRot=a}});Object.defineProperty(hmiWidget.prototype,"center",{get:function(){null==this._center&&(this._center=this._map(inverseMtx(this.mtx),{x:this.cx,y:this.cy}));return this._center},set:function(a){this._center=a}});
Object.defineProperty(hmiWidget.prototype,"boundingRect",{get:function(){if(null==this._boundingRect||this._dirtyBRect){var a=GetParentTransform(this.elem);this._boundingRect=this._mapRect(a,{x:0,y:0,width:this.width,height:this.height});this._dirtyBRect=!1}return this._boundingRect},set:function(a){this._boundingRect=a}});Object.defineProperty(hmiWidget.prototype,"id",{get:function(){return this.studioId}});
hmiWidget.prototype._registerJSAction=function(a){for(var b=$hmi.actionMgr.enActionType.JS,c=0,d=a.length;c<d;c++)if(a[c].t==b){var e;e=this.constructor==hmiPage?this:this.parentPage;a[c].alAction&&(e=__project);e=e.registerPageCallback(a[c].c,this);a[c].c=e}return a};hmiWidget.prototype.updateTransform=function(){this.mtx=this._getTransformMtx($(this.elem).css("transform"));this.currentRot=this._getCurrentRotation()};hmiWidget.prototype.setId=function(a){this.wgtId=a};
hmiWidget.prototype._getCurrentRotation=function(){var a=this.mtx;return Math.atan2(a[1][0],a[0][0])*(180/Math.PI)};hmiWidget.prototype._setRotation=function(a){var b=a-this.currentRot,c=this.center.x,d=this.center.y,e=Math.PI/180,f=Math.cos(b*e),b=Math.sin(b*e),f=multiply([[1,0,c],[0,1,d],[0,0,1]],[[f,-b,0],[b,f,0],[0,0,1]]),f=multiply(f,[[1,0,-c],[0,1,-d],[0,0,1]]);this.mtx=f=multiply(f,this.mtx);this.currentRot=a;this._dirtyBRect=!0};
hmiWidget.prototype.render=function(){if(!this.elem)return!1;this._baseRenderMask&this._baseRenderFlags.ROTATION&&($hmi.modernBrowser?(this.elem.style.msTransform="translateZ(0) "+AffineMatrixToCss(this.mtx),this.elem.style.webkitTransform="translateZ(0) "+AffineMatrixToCss(this.mtx),this.elem.style.transform="translateZ(0) "+AffineMatrixToCss(this.mtx)):(this.elem.style.msTransform=AffineMatrixToCss(this.mtx),this.elem.style.webkitTransform=AffineMatrixToCss(this.mtx),this.elem.style.transform=AffineMatrixToCss(this.mtx)));
this._baseRenderMask&this._baseRenderFlags.VISIBLE&&(this.elem.style.display=this.visible?"block":"none");this._baseRenderMask&this._baseRenderFlags.OPACITY&&(this.elem.style.opacity=this.opacity);this._baseRenderMask&this._baseRenderFlags.BLINK&&(this.blink?this.elem.classList.add("blink"):this.elem.classList.remove("blink"));this._baseRenderMask&this._baseRenderFlags.X&&(this.elem.style.left=this.x+"px");this._baseRenderMask&this._baseRenderFlags.Y&&(this.elem.style.top=this.y+"px");this._baseRenderMask&
this._baseRenderFlags.WIDTH&&(this.elem.style.width=this.width+"px");this._baseRenderMask&this._baseRenderFlags.HEIGHT&&(this.elem.style.height=this.height+"px");this._baseRenderMask&this._baseRenderFlags.SHOWQUALITY&&-1!=this.project.iconStatusDelay&&(-1==this.qualityIcon?this.hideQualityIcon():this.showQualityIcon(this.qualityIcon));this._baseRenderMask=0;return!0};hmiWidget.prototype.getTransformMatrix=function(){return this.mtx};hmiWidget.prototype._getTransformMtx=function(a){return cssTransformToMatrix(a)};
hmiWidget.prototype.setElem=function(a){this.elem=a};hmiWidget.prototype.setOptions=function(a){if(null!=a)for(var b in a)switch(b){case "br":this.boundingRect={x:0,y:0,height:a[b][3],width:a[b][2]};break;case "x":this.left=a.x;break;case "y":this.top=a.y;break;case "w":this.width=a.w;break;case "h":this.height=a.h;break;default:this[b]=a[b]}};hmiWidget.prototype.setOption=function(a,b){this.setValue(a,b)};hmiWidget.prototype.getOption=function(a,b){return this.getValue(a)};
hmiWidget.prototype.init=function(){};
hmiWidget.prototype.setValue=function(a,b,c,d,e){d=!1;if(this.isBadValue(b,!1,c))return!1;if("visibility"==a||"visible"==a)"boolean"!=typeof b&&(b=parseInt(b)),b!=this.visible&&(this.visible=b,this.getAuthorizations()==this.umgr.wgtAuth.HIDE&&(this.constructor==hmiPage?this.elem.style.backgroundImage=null:this.visible=!1),this.setVisibility(this.visible),this._baseRenderMask|=this._baseRenderFlags.VISIBLE,d=!0);else if("opacity"===a||"fill-opacity"===a)b="boolean"==typeof b?1==b?1:0:parseFloat(b),
this.opacity!=b&&(this.opacity=b,this._baseRenderMask|=this._baseRenderFlags.OPACITY,d=!0);else if("blink"===a){b="boolean"==typeof b?1==b?1:0:parseFloat(b);if(1<b||0>b)b=1;this.blink!=b&&(this.blink=b,this._baseRenderMask|=this._baseRenderFlags.BLINK,d=!0)}else"x"===a?(b=parseFloat(b),this.x!=b&&(this.x=b,this._baseRenderMask|=this._baseRenderFlags.X,d=!0)):"y"===a?(b=parseFloat(b),this.y!=b&&(this.y=b,this._baseRenderMask|=this._baseRenderFlags.Y,d=!0)):"rot"==a?(b=parseFloat(b),this.rot!=b&&(this._setRotation(b),
this._baseRenderMask|=this._baseRenderFlags.ROTATION,d=!0)):"disabled"==a&&this.disabled!=b&&(this.disabled=1==b,d=!0);d&&($hmi.addToRender(this),this.sendUpdate(a,b,c))};hmiWidget.prototype.setVisibility=function(a){this.visible=a};
hmiWidget.prototype.getValue=function(a){var b={x:"left",y:"top",height:"height",width:"width"};return"id"==a||"objectName"==a?this.studioId:"visibility"==a?null==this.elem.style.display||"none"==this.elem.style.display?0:1:"opacity"==a||"fill-opacity"==a?this.opacity:"undefined"!==typeof b[a]?this.elem?this.elem.style[b[a]].split("px")[0]:null:this[a]};hmiWidget.prototype.getProperty=hmiWidget.prototype.getParameter=function(a,b){return this.getValue(a,b)};hmiWidget.prototype.getHTMLElement=function(){return this.elem};
hmiWidget.prototype.hasPropInDatalinks=function(a){this["has"+a+"PropInDatalinks"]=null!=a?!0:!1};hmiWidget.prototype.addDataLink=function(a){this.parentPage?this.parentPage.registerLink(a):this.registerLink&&this.registerLink(a);this.subscribeDataLink(a)};hmiWidget.prototype.initDataLinkSideEffects=function(a,b){};hmiWidget.prototype.subscribeDataLink=function(a){void 0==this.dataLinks&&(this.dataLinks={});this.dataLinks[a.getId()]=a};
hmiWidget.prototype.removeDataLink=hmiWidget.prototype.unsubscribeDataLink=function(a){delete this.dataLinks[a.getId()]};hmiWidget.prototype.sendUpdate=function(a,b,c){if(null!=this.dataLinks){var d,e;for(e in this.dataLinks)d=this.dataLinks[e],d.dataSrcId===this.wgtId&&d.tag===a&&d.setWgtValue(b,void 0,c)}null!=this.module&&this.sendNotification("mdup",{attr:a,v:b,q:c})};hmiWidget.prototype.areAliases=function(a,b){return!1};
hmiWidget.prototype.doWriteValue=function(a,b){var c;if(this.dataLinks)for(var d in this.dataLinks)c=this.dataLinks[d],c.attr!==a&&!c.tgtWgt.areAliases(c.attr,a)||c.dataSrc===this||this._addToExecutionQueue(this,c,b);else this.module&&(c=this.studioId.indexOf(this.module.studioId),-1!==c&&(c="*."+this.studioId.substr(c+this.module.studioId.length+1)+".",c="*"==a.charAt(0)&&"."==a.charAt(1)?c+a.substr(2):c+a,this.module.doWriteValue(c,b)))};
hmiWidget.prototype._addToExecutionQueue=function(a,b,c){this._eQueue.push(function(){$.when(b.setTagValue(c)).done(function(){a._doNextWrite()}).fail(function(){a._doNextWrite()})});0<this._eQueue.length&&0==this._eStatus&&(this._eStatus=1,this._eQueue.shift()())};hmiWidget.prototype._doNextWrite=function(){0<this._eQueue.length&&1==this._eStatus?this._eQueue.shift()():this._eStatus=0};
hmiWidget.prototype.isBadValue=function(a,b,c){if(this.elem&&"none"==this.elem.style.display||null===c)return!1;if(c){if(c.isQualityGood())return-1!=this.qualityIcon&&(this.qualityIcon=-1,this._baseRenderMask|=this._baseRenderFlags.SHOWQUALITY,$hmi.addToRender(this)),!1;c.isQualityUncertain()?this.qualityIcon=0:this.qualityIcon=1;this._baseRenderMask|=this._baseRenderFlags.SHOWQUALITY;$hmi.addToRender(this);return!0}if(null===a||void 0===a||void 0===b&&isNaN(a))return this.qualityIcon=0,this._baseRenderMask|=
this._baseRenderFlags.SHOWQUALITY,$hmi.addToRender(this),!0;this.qualityIcon=-1;this._baseRenderMask|=this._baseRenderFlags.SHOWQUALITY;$hmi.addToRender(this);return!1};
hmiWidget.prototype.showQualityIcon=function(a){var b=this;this.elem&&(!0===this.firstQualityShow?(this.firstQualityShow=!1,setTimeout(function(){b.elem&&-1!=b.qualityIcon&&(b.hideQualityIcon(),b.addQualityIcon())},this.project.iconStatusDelay)):this.elem&&(-1!=this.qualityIcon&&this.hideQualityIcon(),setTimeout(function(){b.elem&&-1!=b.qualityIcon&&(b.hideQualityIcon(),b.addQualityIcon())},this.project.iconStatusDelay)))};
hmiWidget.prototype.hideQualityIcon=function(){this.elem&&(-1<this.elem.className.indexOf("bad-a")&&(this.removeValueIcon(1),this.elem.classList.remove("bad-a")),-1<this.elem.className.indexOf("unc-a")&&(this.removeValueIcon(0),this.elem.classList.remove("unc-a")))};
hmiWidget.prototype.addQualityIcon=function(){if(this.elem){var a;0==this.qualityIcon?(this.elem.classList.add("unc-a"),a="unc"):(this.elem.classList.add("bad-a"),a="bad");var b=this.wgtId+"_"+a;a='<div id="'+b+'" class="'+a+'"></div>';this.parentWidget?$(this.parentWidget.elem).append(a):$(this.elem).append(a);var c=parseFloat(this.elem.style.left.split("px")[0]),d=parseFloat(this.elem.style.width.split("px")[0]);a=parseFloat(this.elem.style.top.split("px")[0]);c+=d;(b=$("#"+b))&&b.css({position:"absolute",
left:c,top:a,width:16,height:16})}};hmiWidget.prototype.removeValueIcon=function(a){var b;1==a?b=this.wgtId+"_bad":0==a&&(b=this.wgtId+"_unc");void 0!==b&&(a=document.getElementById(b),null!=a&&a.parentNode.removeChild(a))};hmiWidget.prototype.addWidget=function(a,b){this.wgts||(this.wgts={});this.wgts[a]=b;this.nWgts++;this.mapId[b.studioId]=a};hmiWidget.prototype.removeWidget=function(a){this.wgts&&void 0!==this.wgts[a]&&(delete this.wgts[a],this.nWgts--)};
hmiWidget.prototype.getWidget=function(a,b,c){var d=this.wgts;if(b&&a==this.studioId)return this;if(null===d)return null;b&&void 0!==this.mapId[a]&&(a=this.mapId[a]);var e=d[a];if(void 0!==e)return c?e.isTemplateWgt?e:null:e;for(var f in d)if(e=d[f].getWidget(a,b,c),null!==e)if(c){if(e.isTemplateWgt)return e}else return e;return null};
hmiWidget.prototype.getWidgetByClass=function(a){for(var b=[this];0<b.length;){var c=b.pop(),d;for(d in c.wgts){c=this.wgts[d];if(c.constructor==a)return c;0<c.nWgts&&b.push(c)}}return null};hmiWidget.prototype.resolveAliasAttribute=function(a,b){var c=a.split("."),d=c[0],c=c[1],e=d.replace(/[0-9]/g,""),d=parseInt(d.substring(e.length));isNaN(d)&&(d=1);e=$("div[data-widget='"+e+"']",this.elem);0<e.length?(d=e[d-1].getAttribute("id"),b.wgt=this.getWidget(d),b.prop=c):b.wgt=null};
hmiWidget.prototype.getWebIdFromAlias=function(a){for(var b=[],c,d=0;d<a.length;d++)c=a[d].split(".")[0],b.push(c);return b};hmiWidget.prototype.getPropFromAlias=function(a){for(var b=[],c,d=0;d<a.length;d++)c=a[d].split(".")[1],b.push(c);return b};hmiWidget.prototype.getJsObject=function(){return this.constructor==hmiGroup&&this.js?this.js:this.parentWidget?this.parentWidget.getJsObject():null};
hmiWidget.prototype.getParentTransform=function(a){for(var b=this.parentWidget,c=[];b!=a;)d=b.mtx,c.push([[d[0][0],d[0][1],d[0][2]+b.left],[d[1][0],d[1][1],d[1][2]+b.top],[d[2][0],d[2][1],d[2][2]]]),b=b.parentWidget;var d=this.mtx;a=[[1,0,0],[0,1,0],[0,0,1]];for(b=c.length-1;0<=b;b--)a=multiply(a,c[b]);return a=multiply(a,[[d[0][0],d[0][1],d[0][2]+this.left],[d[1][0],d[1][1],d[1][2]+this.top],[d[2][0],d[2][1],d[2][2]]])};
hmiWidget.prototype.setParentBounds=function(a,b,c,d,e){e=e!=this.parentWidget?this.getParentTransform(e):[[1,0,0],[0,1,0],[0,0,1]];var f=inverseMtx(e),g=this._mapRect(multiply(e,this.mtx),{x:0,y:0,width:this.width,height:this.height}),h=1,k=1,h=0==g.width?0==c?1:c/1E-6:c/g.width,k=0==g.height?0==d?1:d/1E-6:d/g.height;d=[[h,0,0],[0,k,0],[0,0,1]];c=multiply(e,this.mtx);c=multiply(d,c);c=multiply(f,c);d=multiply(d,e);d=multiply(f,d);g=Math.sqrt(c[0][0]*c[0][0]+c[1][0]*c[1][0]);h=Math.sqrt(c[0][1]*c[0][1]+
c[1][1]*c[1][1]);k=[[1/g,0,0],[0,1/h,0],[0,0,1]];this.xformScaling?this.mtx=multiply(d,this.mtx):(this.mtx=multiply(c,k),this.center.x*=g,this.center.y*=h,this.width*=g,this.height*=h,this.elem.style.width=this.width+"px",this.elem.style.height=this.height+"px");setTransform(this.elem,AffineMatrixToCss(this.mtx));this.updateBoundingRect();this._normalizePosition(e,f,{x:a,y:b});a=this._map(this.mtx,this.center);this.cx=a.x;this.cy=a.y};
hmiWidget.prototype._normalizePosition=function(a,b,c){var d=[[this.mtx[0][0],this.mtx[0][1],0],[this.mtx[1][0],this.mtx[1][1],0],[this.mtx[2][0],this.mtx[2][1],1]],e={x:0,y:0,width:this.width,height:this.height},f=this._mapRect(d,e);a=multiply(a,d);e=this._mapRect(a,e);e=this._map(b,{x:e.x,y:e.y});b=this._map(b,c);c=[[this.mtx[0][0],this.mtx[0][1],-f.x],[this.mtx[1][0],this.mtx[1][1],-f.y],[this.mtx[2][0],this.mtx[2][1],1]];this.top=b.y-(e.y-f.y);this.left=b.x-(e.x-f.x);this.elem.style.top=this.top+
"px";this.elem.style.left=this.left+"px";setTransform(this.elem,AffineMatrixToCss(c));this.mtx=c;this.updateBoundingRect()};hmiWidget.prototype.getParentBounds=function(a){a=this.getParentTransform(a);return this._mapRect(a,{x:0,y:0,width:this.width,height:this.height})};
hmiWidget.prototype._mapRect=function(a,b){b.right=b.x+b.width;b.bottom=b.y+b.height;b.top=b.y;b.left=b.x;var c=this._map(a,{x:b.left,y:b.top}),d=c.x,e=c.y,f=c.x,g=c.y,c=this._map(a,{x:b.right,y:b.top}),d=Math.min(d,c.x),e=Math.min(e,c.y),f=Math.max(f,c.x),g=Math.max(g,c.y),c=this._map(a,{x:b.right,y:b.bottom}),d=Math.min(d,c.x),e=Math.min(e,c.y),f=Math.max(f,c.x),g=Math.max(g,c.y),c=this._map(a,{x:b.left,y:b.bottom}),d=Math.min(d,c.x),e=Math.min(e,c.y),f=Math.max(f,c.x),g=Math.max(g,c.y);return{x:d,
y:e,width:f-d,height:g-e}};hmiWidget.prototype.updateBoundingRect=function(){var a=this.getParentTransform(null);this.boundingRect=this._mapRect(a,{x:this.left,y:this.top,width:this.width,height:this.height})};hmiWidget.prototype._map=function(a,b){var c=multiply(a,[[b.x],[b.y],[1]]);return{x:c[0][0],y:c[1][0]}};hmiWidget.prototype.getParentWgt=function(){return this.parentWidget};
hmiWidget.prototype.getInvokablePropsList=function(){for(var a=hmiWidget.prototype.invokablePropsList,b=this.invokablePropsList,c=0,d=a.length;c<d;c++){var e=a[c];-1==this.invokablePropsList.indexOf(e)&&(b=b.concat(e))}return b};hmiWidget.prototype.getInvokableFunList=function(){for(var a=hmiWidget.prototype.invokableFunList,b=this.invokableFunList,c=0,d=a.length;c<d;c++){var e=a[c];-1==this.invokableFunList.indexOf(e)&&(b=b.concat(e))}return b};
hmiWidget.prototype.getPageMLTextMgr=function(){for(var a=!1,b=this.module;null!=b&&!a&&!(a=this.project.getCWidgetMgr().hasGfxInheritance(b.ctype));)b=b.module;return a?b.getCWMLTextMgr():this.isTemplateWgt?this.parentPage.getTemplateMLTextMgr():this.parentPage.getPageMLTextMgr()};function WgtSubscription(a,b){this.w=a;this.cb=[b]}WgtSubscription.prototype.getWidget=function(){return this.w};WgtSubscription.prototype.getCallbacks=function(){return this.cb};WgtSubscription.prototype.addCallback=function(a){return this.cb.push(a)};
WgtSubscription.prototype.getCallbacks=function(){return this.cb};hmiWidget.prototype.subscribeWgt=function(a,b){a&&(void 0===this._subscriptions[a.wgtId]?this._subscriptions[a.wgtId]=new WgtSubscription(a,b):this._subscriptions[a.wgtId].addCallback(b))};hmiWidget.prototype.unsubscribeWgt=function(a){a&&delete this._subscriptions[a.wgtId]};hmiWidget.prototype.sendNotification=function(a,b){for(var c in this._subscriptions)for(var d=this._subscriptions[c].cb,e=0,f=d.length;e<f;e++)d[e](a,b)};
hmiWidget.prototype.removeSubscriptions=function(){this._subscriptions={}};hmiWidget.prototype.getAllSubscriptions=function(){return this._subscriptions};hmiWidget.prototype.getWidgetSubscribed=function(a){return this._subscriptions[a].getWidget()||null};hmiWidget.prototype.trigger=function(a,b){};hmiWidget.prototype.updateLanguage=function(){for(var a in this.wgts)this.ml&&this.wgts[a].updateLanguage()};hmiWidget.prototype.unmountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].unmount()};
hmiWidget.prototype.mountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].mount()};hmiWidget.prototype.destroy=function(){if(this.destroyed)return!1;var a=this.wgts;if(a)for(var b in a)a[b].destroyed||a[b].destroy();delete $hmi.renderingQueue[this.wgtId];this.elem&&(this.elem=null);this.wgtPos=this.wgtOffset=this.invMtxChain=this.js=null;this.unmountLinks();this.dataLinks=null;this.removeAllActions();this._userValue=this.parentPage=this.parentWidget=null;return this.destroyed=!0};
hmiWidget.prototype.countDataLinks=function(){if(this.dataLinks){if("object"==typeof this.dataLinks)return Object.keys(this.dataLinks).length;if(this.dataLinks.constructor==Array)return this.dataLinks.length}return 0};hmiWidget.prototype._isNativeSelectCompatible=function(){var a=navigator.userAgent;return/Android/i.test(a)&&(/Chrome\/[.0-9]* (?!Mobile)/i.test(a)||/Chrome\/[.0-9]* Mobile/i.test(a))||/iPhone/i.test(a)||/iPad/i.test(a)?!1:null!=a.match(/webkit/i)||null!=a.match(/firefox/i)?!0:!1};
hmiWidget.supportedEvents="onMousePress onMouseRelease onMouseClick onMouseHold onMouseHoldRepeat onMousePressRepeat onDataUpdate onActivate onDeactivate tonActivate tonDeactivate onDraw onMouseDrag".split(" ");
hmiWidget.prototype.addAction=function(a,b){-1!=hmiWidget.supportedEvents.indexOf(a)&&(this[a]?this[a].push(b):this[a]=[b],"tonActivate"==a?(this.isTemplateWgt=!0,this.tonActivate=this._registerJSAction(this.tonActivate),this.isTemplateWgt=!1):"tonDeactivate"==a?(this.isTemplateWgt=!0,this.tonDeactivate=this._registerJSAction(this.tonDeactivate),this.isTemplateWgt=!1):this[a]=this._registerJSAction(this[a]))};
hmiWidget.prototype.invalidateMtxChain=function(){this.initInvMtxChain=!1;for(var a in this.wgts)this.wgts[a].initInvMtxChain=!1,this.wgts[a].wgts&&this.wgts[a].invalidateMtxChain()};hmiWidget.prototype.saveInvMtxChain=function(a){this.invMtxChain=a.chain;this.wgtOffset=a.offset;this.wgtPos=a.pos;this.initInvMtxChain=!0};hmiWidget.prototype.removeAllActions=function(){delete this.onMousePress;delete this.onMouseRelease;delete this.onMouseClick;delete this.onDataUpdate};
hmiWidget.prototype.saveValue=function(a){var b=__project.projectName;if(Modernizr.localstorage){var c=window.localStorage.getItem("hmi");if(c)try{c=JSON.parse(c)}catch(d){c={}}else c={};c[b]||(c[b]={});if(null!=this[a]&&void 0!=typeof this[a])return c[b][this.wgtId]=this[a],window.localStorage.hmi=JSON.stringify(c),!0}return!1};hmiWidget.prototype.loadValue=function(a){a=__project.projectName;if(Modernizr.localstorage)try{return JSON.parse(window.localStorage.getItem("hmi"))[a][this.wgtId]}catch(b){return null}else return null};
hmiWidget.prototype.getDatalink=function(a){for(var b in this.dataLinks){var c=this.dataLinks[b];if(c.attr==a)return c}return null};hmiWidget.prototype.getAuthorizations=function(){return this.umgr.isSecurityEnabled()?this.umgr.getWidgetTreeAuthorizations(this):this.umgr.wgtAuth.FULL};hmiWidget.prototype.ERROR_MSG={INIT_PRM:"Promise Widget Ready is not initialized"};hmiWidget.prototype.resolveWgtReady=function(){throw this.ERROR_MSG.INIT_PRM;};
hmiWidget.prototype.rejectWgtReady=function(){throw this.ERROR_MSG.INIT_PRM;};hmiWidget.prototype.initPromiseReady=function(){var a=this;this._prmWgtReady=new Promise(function(b,c){a.resolveWgtReady=b;a.rejectWgtReady=b})};hmiWidget.prototype.waitWgtReady=function(){if(this._prmWgtReady)return this._prmWgtReady;throw this.ERROR_MSG.INIT_PRM;};hmiWidget.prototype.getHoldTime=function(){return this.project!==this&&-1==this.hT?this.project.getHoldTime():this.hT};
hmiWidget.prototype.getAutoRepeatPeriod=function(){return this.project!==this&&-1==this.aRT?this.project.getAutoRepeatPeriod():this.aRT};hmiWidget.prototype.getAutoRepeatMode=function(){return this.aRM};hmiWidget.prototype.load=function(){};hmiWidget.prototype.unload=function(){};hmiWidget.prototype.findJSFunction=function(a){var b=this[a];return void 0!==b?b:null!=this.parentWidget?this.parentWidget.findJSFunction(a):null};hmiWidget.prototype.getId=function(){return this.wgtId};
hmiWidget.prototype.getUserId=function(){return this.studioId};hmiWidget.prototype.setAsVisible=function(a){this.elem&&(this.elem.style.display=a?"block":"none")};hmiWidget.prototype.getLayout=function(){var a;null!=this.parentWidget&&this.parentWidget.constructor==hmiGroup&&this.parentWidget.hasGridLayout()&&(a=this.parentWidget.getLayoutSize());return this.l[a]};hmiWidget.prototype.getOffsetTop=function(){return 0};hmiWidget.prototype.getOffsetLeft=function(){return 0};
hmiWidget.prototype.haveLayout=function(){return void 0!=this.l};hmiWidget.prototype.getModule=function(){return this.module};hmiWidget.prototype.getGraphicModule=function(){var a=this.project.getCWidgetMgr();if(this.module){if(a.hasGfxInheritance(this.module.ctype))return this.module;if(this.parentWidget)return this.parentWidget.getGraphicModule()}return null};hmiWidget.prototype.isModuleInstance=function(){return!1};
hmiWidget.prototype.resolveId=function(a){return null!=this.module?a.replace("*",this.module.studioId):a};hmiWidget.prototype.getJMType=function(){return this.constructor.jmType};hmiWidget.prototype.updateDataLink=function(a){};hmiWidget.prototype.constructor=hmiWidget;$hmi.addWidgetDefinition("hmiWidget",hmiWidget);var __alarmsMgr=null;
function hmiAlarmsMgr(a,b,c,d,e){this.alarmsBuffer={};this._nInitilizedAlarm=0;this._isAlarmsInitialized=!1;this.alarmNumber=c.alarmNumber;this.alarmCache={alDate:Array(this.alarmNumber),alDateTime:Array(this.alarmNumber),alDescription:Array(this.alarmNumber),alEnable:Array(this.alarmNumber),alName:Array(this.alarmNumber),alSelect:Array(this.alarmNumber),alSeverity:Array(this.alarmNumber),alState:Array(this.alarmNumber),alTime:Array(this.alarmNumber),alValue:Array(this.alarmNumber),alUserAction:Array(this.alarmNumber),
comment:Array(this.alarmNumber),BGColor:Array(this.alarmNumber),FGColor:Array(this.alarmNumber),blink:Array(this.alarmNumber),alGroups:Array(this.alarmNumber),alarmCount:0};this.rowChanged=null;this.dataLinks={};this.mapDataLinkToVar={};this.mapAlarmId={};this.enableTags={};this.rmEnableAl=[];hmiWidget.call(this,a.wgtId,b,c,d,e);this.currLang=this.parentPage.getWidget("_MultiLangMgr",!0).curLangId;this.srv=__project.getCommunticationObj();this.initPromiseReady();var f=this;$hmi.isTestModeActive()?
this.resolveWgtReady(!0):__tagMgr.isReady()?this._initAlarmConfiguration():__tagMgr.subscribeWgt(this,function(a,b){f.trigger(a,b)});this.ml=!0;__alarmsMgr=this}hmiAlarmsMgr.prototype=Object.create(hmiWidget.prototype);hmiAlarmsMgr.prototype.constructor=hmiAlarmsMgr;hmiAlarmsMgr.prototype.alarmCount=0;hmiAlarmsMgr.prototype.nDisabled=0;hmiAlarmsMgr.prototype.nRemoteEn=0;hmiAlarmsMgr.prototype.alarmsConf={defaultColors:{},alarms:{},mlTexts:{}};
hmiAlarmsMgr.prototype.enEventsType={AL_EVENT_TRIGGERED:1,AL_EVENT_NOT_TRIGGERED:2,AL_EVENT_ACKED:4,AL_EVENT_RESET:8,AL_EVENT_ENABLED:16,AL_EVENT_DISABLED:32,AL_FLAG_TRIGGER_CONDITION_CHANGED:64};hmiAlarmsMgr.jmType="AlarmsMgrWgt";hmiAlarmsMgr.prototype.trigger=function(a){"tagmgrready"==a&&this._initAlarmConfiguration()};
hmiAlarmsMgr.prototype._initAlarmConfiguration=function(){var a=this;this.srv.getConf().done(function(b){b=b["alarms.json"];a.alarmsConf=b;a.initAlarmBuffer(b);if(__tagMgr.getGroupInfo("AlarmEnableTags@$AlarmMgrWgt@$0")){__tagMgr.subscribeGroup("AlarmEnableTags@$AlarmMgrWgt@$0",a.parentPage);for(var c in a.enableTags)$hmi.hmiAttach(a,__tagMgr.wgtId,{tag:c,srcType:"Tag",rw:"r",attr:"__rmen__"+c,tagType:""})}a.srv.subscribeAlarms("*",function(b){a.onDataReady(b)});setTimeout(function(){a._isAlarmsInitialized=
!0;a.resolveWgtReady(!0)},1E3)}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading alarms configuration. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)})};hmiAlarmsMgr.prototype.isDataReady=function(){return this._isAlarmsInitialized};hmiAlarmsMgr.prototype.updateTables=function(){var a=this.getAllSubscriptions();if(a)for(var b in a)a[b].getWidget().updateData()};
hmiAlarmsMgr.prototype.updateAlarmCache=function(a){var b=a.cacheIndex;this.alarmCache.alEnable[b]=a.al.alEnable;this.alarmCache.alState[b]=a.al.stateToString();this.alarmCache.alValue[b]=a.al.alValue;this.alarmCache.alDateTime[b]=a.al.alDateTime;this.alarmCache.alDate[b]=a.al.alDate;this.alarmCache.alTime[b]=a.al.alTime;var c=a.al.alName;a=a.al.alState;this.alarmCache.BGColor[b]=this.getBGColor(c,a);this.alarmCache.FGColor[b]=this.getFGColor(c,a);this.alarmCache.blink[b]=a==Alarm.prototype.stateType.STATE_TRIGGERED_NOT_ACKED||
a==Alarm.prototype.stateType.STATE_NOT_TRIGGERED_NOT_ACKED?this.alarmsConf.alarms[c].blinkTxt?!0:!1:!1};hmiAlarmsMgr.prototype.getFGColor=function(a,b){var c=this.alarmsConf.defaultColors,d=this.alarmsConf.alarms[a];switch(b){case 2:return d.tTC?d.tTC:c.tTC;case 3:return d.tNATC?d.tNATC:c.tNATC;case 5:return d.nTNATC?d.nTNATC:c.nTNATC;case 4:return d.nTATC?d.nTATC:c.nTATC;case 6:return d.tATC?d.tATC:c.tATC;case 0:return d.nTTC?d.nTTC:c.nTTC;case 1:return d.dTC?d.dTC:c.dTC}return"#0000"};
hmiAlarmsMgr.prototype.getBGColor=function(a,b){var c=this.alarmsConf.defaultColors,d=this.alarmsConf.alarms[a];switch(b){case 2:return d.tBG?d.tBG:c.tBG;case 3:return d.tNABC?d.tNABC:c.tNABC;case 5:return d.nTNABG?d.nTNABG:c.nTNABG;case 4:return d.nTABC?d.nTABC:c.nTABC;case 6:return d.tABG?d.tABG:c.tABG;case 0:return d.nTBC?d.nTBC:c.nTBC;case 1:return d.dBG?d.dBG:c.dBG}return"#ffff"};hmiAlarmsMgr.prototype.columnToUpdate=!1;
hmiAlarmsMgr.prototype.subscribeDataLink=function(a){hmiWidget.prototype.subscribeDataLink.call(this,a);this.mapDataLinkToVar[a.tag]?this.mapDataLinkToVar[a.tag].splice(0,1,a):(this.mapDataLinkToVar[a.tag]=[],this.mapDataLinkToVar[a.tag].push(a))};hmiAlarmsMgr.prototype.getAlarmName=function(a){return this.alarmCache.alName[a]};hmiAlarmsMgr.prototype.getDataValues=function(a){return this.alarmCache[a]};
hmiAlarmsMgr.prototype.getDataValuesQuality=function(a){if("alEnable"==a){a={};for(var b=0,c=this.rmEnableAl.length;b<c;b++){var d=this.alarmsBuffer[this.rmEnableAl[b]],e=d.al.alRemoteEnable,f=$hmi.getTagFromCache(e);void 0===f?(f=new State,this.parentWidget.getTag(e,f,-1,!0),a[d.cacheIndex]=f.quality):a[d.cacheIndex]=f.getQuality()}return a}return null};
hmiAlarmsMgr.prototype.onDataReady=function(a){for(var b=[],c=!1,d=0,e=a.length;d<e;d++){var f=a[d].alName,g=this.alarmsBuffer[f],h=g.al.update(a[d]);this._isAlarmsInitialized||this.alarmsBuffer[f].isInitialized||this._nInitilizedAlarm++;h&&(this.updateAlarmCache(g),b.push(f),!c&&h&&(c=!0))}this._isAlarmsInitialized&&c&&this.sendUpdate(b);this._nInitilizedAlarm>=this.alarmCount-this.nDisabled-this.nRemoteEn&&(this._isAlarmsInitialized=!0,this.resolveWgtReady(!0))};
hmiAlarmsMgr.prototype.getDefaultColors=function(){return this.alarmsConf.defaultColors};
hmiAlarmsMgr.prototype.createAlarm=function(a,b){var c=new Alarm(a),d=this.alarmCache.alarmCount;this.alarmsBuffer[a]={al:c,isInitialized:!1,cacheIndex:d};var e=this.alarmsConf.alarms[a];c.alDescription=this.getAlarmProperty(a,"d");c.xmlOrder=parseFloat(e.xO);c.notTriggeredBgColor=void 0!=e.nTBC?e.nTBC:this.alarmsConf.defaultColors.nTBC;c.notTriggeredTxtColor=void 0!=e.nTTC?e.nTTC:this.alarmsConf.defaultColors.nTTC;c.alSeverity=this.getAlarmServerity(a);c.alarmId=e.id;c.liveData=e.lD;c.usrAct=e.usrAct;
this.mapAlarmId[c.alarmId]=c.alName;this.alarmCache.alName[d]=a;this.alarmCache.alSeverity[d]=c.alSeverity;this.alarmCache.alValue[d]=this.getAlarmProperty(a,"sourcevalue");this.alarmCache.BGColor[d]=this.getAlarmProperty(a,"nTBC");this.alarmCache.FGColor[d]=this.getAlarmProperty(a,"nTTC");this.alarmCache.comment[d]=this.getAlarmProperty(a,"comment");this.alarmCache.blink[d]=this.getAlarmProperty(a,"blinkTxt");this.alarmCache.alGroups[d]=this.getAlarmProperty(a,"groups");this.alarmCache.alUserAction[d]=
this.getAlarmProperty(a,"usrAct");this.alarmCache.alSelect[d]=!1;this.alarmCache.alDateTime[d]="1970/01/01 00:00:00";this.alarmCache.alDate[d]="1970/01/01";this.alarmCache.alTime[d]="00:00:00";this.alarmCache.alState[d]="Disabled";var f=!1,e=e.eT;if(null!=e){this.rmEnableAl.push(a);c.alRemoteEnable=e;this.enableTags[e]?this.enableTags[e].al.push(a):this.enableTags[e]={al:[a],status:new Quality(192)};this.nRemoteEn++;var g=$hmi.getTagFromCache(e);void 0==g&&__tagMgr.subscribeForTagsNotification([e]);
g&&g.isQualityGood()&&(f=g.getValue()?!0:!1)}(this.alarmCache.alEnable[d]=f)||this.nDisabled++;"undefined"!=typeof this.alarmsConf.mlTexts[c.alDescription]&&(this.alarmCache.alDescription[d]=this.alarmsConf.mlTexts[c.alDescription][this.currLang]);if(c.usrAct){var d=[],h;for(h in c.usrAct)c.usrAct[h].t&&1==c.usrAct[h].t&&(c.usrAct[h].alAction=!0,d.push(c.usrAct[h]));this._registerJSAction(d)}this.alarmCount=++this.alarmCache.alarmCount};
hmiAlarmsMgr.prototype.getAlarmServerity=function(a){a=this.alarmsConf.alarms[a];var b="";switch(a.sv){case 0:b="-not important";break;case 1:b="-low";break;case 2:b="-below normal";break;case 3:b="-normal";break;case 4:b="-above normal";break;case 5:b="-high";break;case 6:b="-critical";break;default:b=""}return a.sv+b};hmiAlarmsMgr.prototype.getAlarmProperty=function(a,b){var c=this.alarmsConf.alarms[a];return void 0!=c[b]?c[b]:this.alarmsConf.defaultColors[b]};
hmiAlarmsMgr.prototype.initAlarmBuffer=function(){for(var a in this.alarmsConf.alarms)this.createAlarm(a,{})};hmiAlarmsMgr.prototype.sendUpdate=function(a,b,c){var d=null,d=!0,e;for(e in this.dataLinks){var f=this.dataLinks[e],g=f.tag,h=this.alarmCache[g];if($.isArray(h)){for(var k=0;k<a.length;k++)if(b||"alSelect"!=g){var l=this.alarmsBuffer[a[k]].cacheIndex,d=f;"alEnable"==g?d.setWgtValue(h[l],l,c):d.setWgtValue(h[l],l);d=!0}f.initialized=!1}}d&&this.updateTables()};
hmiAlarmsMgr.prototype.setValue=function(a,b,c,d,e,f){var g;d=!1;"undefined"!=typeof f&&(g=this.alarmsBuffer[f].al,d=g.updateProperty(a,b));if("alSelect"==a)g.alSelect=b;else if("alEnable"==a)g.alEnable=b,g.setDirty(!0);else if(-1!=a.indexOf("__rmen__")){var h=a.split("__rmen__")[1];this.checkEnableTagQuality(h,c)}d&&(this.alarmCache[a][this.alarmsBuffer[f].cacheIndex]=b,this.sendUpdate([g.alName],e))};
hmiAlarmsMgr.prototype.getValue=function(a){return this._isAlarmsInitialized&&void 0!==this.alarmCache[a]?this.alarmCache[a]:hmiWidget.prototype.getValue.call(this,a)};
hmiAlarmsMgr.prototype.checkEnableTagQuality=function(a,b){var c=this.enableTags[a],d=!1;if(c&&b){for(var e=b.isQualityGood(),f=0,g=c.al.length;f<g;f++){var h=this.alarmsBuffer[c.al[f]],k=h.al,h=h.cacheIndex;if(e){c.status||(d=!0);var l=$hmi.getTagFromCache(a).getValue();if(this.alarmCache.alEnable[h]!=l){d=this.getAlarmProperty(k.alName,"notifyMask");if(d&this.enEventsType.AL_EVENT_ENABLED||d&this.enEventsType.AL_EVENT_DISABLED)k.alEnable=l,this.alarmCache.alEnable[h]=l;d=!0}}else d=!0}c.status=
b.isQualityGood();d&&this.sendUpdate(c.al,!0,b)}};hmiAlarmsMgr.prototype.updateAlarmByIndex=function(a,b,c){var d=this.alarmCache.alName[a];return d&&(d=this.alarmsBuffer[d].al,void 0!==d[b])?(d[b]=c,this.alarmCache[b][a]=c,!0):!1};hmiAlarmsMgr.prototype.setSelectAlarm=function(a,b){this.setValue("alSelect",b,null,0,!0,a)};hmiAlarmsMgr.prototype.setEnableAlarm=function(a,b){this.setValue("alEnable",b,null,0,!0,a)};
hmiAlarmsMgr.prototype.selectAllAlarms=function(a){for(var b=!1,c=0;c<this.alarmCount;c++)this.alarmCache.alSelect[c]=a;for(var d in this.alarmsBuffer)this.alarmsBuffer[d].al.alSelect=a;if(a=this.mapDataLinkToVar.alSelect)for(c=0;c<a.length;c++)a[c].setWgtValue(this.alarmCache.alSelect,-1),b=!0;this.columnToUpdate=!0;b&&this.updateTables()};
hmiAlarmsMgr.prototype.doSelectAlarms=function(a,b){var c=!1;if(void 0!==b)for(var d=0,e=b.length;d<e;d++){var f=this.alarmsBuffer[b[d]];f.al.alSelect=a;this.alarmCache.alSelect[f.cacheIndex]=a}else for(d in this.alarmsBuffer)f=this.alarmsBuffer[d],f.al.alSelect=a,this.alarmCache.alSelect[f.cacheIndex]=a;if(f=this.mapDataLinkToVar.alSelect)for(d=0;d<f.length;d++)f[d].setWgtValue(this.alarmCache.alSelect,-1),c=!0;this.columnToUpdate=!0;c&&this.updateTables()};
hmiAlarmsMgr.prototype.getSelectAlarmsByFilter=function(a,b,c,d){var e=[],f;for(f in this.alarmsBuffer){var g=this.alarmsBuffer[f].al,h="alState"==a?g.stateToString():g[a],k="alState"==c?g.stateToString():g[c];h&&k&&b&&d?b.test(h)&&d.test(k)&&e.push(g.alName):h&&b?b.test(h)&&e.push(g.alName):k&&d?d.test(k)&&e.push(g.alName):e.push(g.alName)}return e};hmiAlarmsMgr.prototype.getAlarmById=function(a){a=this.mapAlarmId[a];return void 0!==a?this.alarmsBuffer[a].al:null};
hmiAlarmsMgr.prototype.getAlarmByName=function(a){return this.alarmsBuffer[a].al};hmiAlarmsMgr.prototype.getAlarmByIndex=function(a){return this.alarmsBuffer[this.alarmCache.alName[a]].al};hmiAlarmsMgr.prototype.getAlarmNameByIndex=function(a){return this.alarmCache.alName[a]};hmiAlarmsMgr.prototype.getUnorderedPosition=function(a){return this.getAlarmByIndex(a).xmlOrder};hmiAlarmsMgr.prototype.isAlarmSelected=function(a){return this.alarmsBuffer[a].al.alSelect};
hmiAlarmsMgr.prototype.getSelectedToogleStatus=function(){for(var a=this.alarmCache.alSelect,b=!0,c=0,d=a.length;c<d&&b;c++)a[c]&&(b=!1);return b};hmiAlarmsMgr.prototype.getSelectedAlarms=function(){for(var a=[],b=0;b<this.alarmCache.alSelect.length;b++)this.alarmCache.alSelect[b]&&a.push(this.alarmCache.alName[b]);return a};
hmiAlarmsMgr.prototype._getAlarmsEnableStatus=function(){for(var a={enabled:[],disabled:[]},b={},c=0,d=this.alarmCache.alEnable.length;c<d;c++){var e=this.alarmCache.alName[c],f=this.alarmsBuffer[e].al;if(f.isDirty()){var g=this.alarmCache.alEnable[c];null!=f.alRemoteEnable?b[f.alRemoteEnable]?(b[f.alRemoteEnable].list.push(e),b[f.alRemoteEnable].status&&!g&&(b[f.alRemoteEnable].status=!1)):b[f.alRemoteEnable]={list:[e],status:g}:g?a.enabled.push(e):a.disabled.push(e);f.setDirty(!1)}}for(var h in b)c=
b[h],c.status?a.enabled=a.enabled.concat(c.list):a.disabled=a.disabled.concat(c.list);return a};hmiAlarmsMgr.prototype.ackSelectedAlarms=function(){var a=this.getSelectedAlarms();0<a.length&&this.srv.acknowledgeAlarms(a,!1)};hmiAlarmsMgr.prototype.enableAlarms=function(){var a=this._getAlarmsEnableStatus();0<a.enabled.length&&this.srv.enableAlarms(a.enabled,!0,!1);0<a.disabled.length&&this.srv.enableAlarms(a.disabled,!1,!1)};hmiAlarmsMgr.prototype.saveConfiguration=function(){this.srv.saveConfiguration(!1)};
hmiAlarmsMgr.prototype.updateLanguage=function(){var a=this.getPageMLTextMgr().getCurrentLanguage();if(a!=this.currLang){var b=[],c;for(c in this.alarmsBuffer){var d=this.alarmsBuffer[c];this.alarmCache.alDescription[d.cacheIndex]=this.alarmsConf.mlTexts[d.al.alDescription][a];b.push(c)}this.sendUpdate(b);this.currLang=a}};$hmi.fn.hmiAlarmsMgr=function(a,b,c,d){return new hmiAlarmsMgr(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiAlarmsMgr",hmiAlarmsMgr);
function AlarmEvent(a,b,c,d,e,f){this.returnTS=!0;this.eventType=a;this.subType=b;this.startTime=c;this.endTime=d;this.deltaTime=this.nEvents=0;this.bounds="false";this.strBuffId=e;this.bufferName=f}AlarmEvent.prototype.getId=function(){return this.eventType+this.subType+this.startTime+this.endTime};AlarmEvent.prototype.getBufferId=function(){return this.strBuffId};
AlarmEvent.prototype.toURL=function(){return"eventType="+this.eventType+"&subType="+this.subType+"&returnTS="+this.returnTS+"&startTime="+this.startTime+"&endTime="+this.endTime+"&nEvents="+this.nEvents+"&deltaTime="+this.deltaTime+"&bounds="+this.bounds+"&archiveName="+this.bufferName};
function hmiEventBufferWgt(a,b,c,d,e){this.vars={alAlarmID:[],alDateTime:[],alDescription:[],alEventType:[],alName:[],alState:[],alStateCode:[],alValue:[],evTimestamp:[],evDate:[],evTime:[],min:hmiEventBufferWgt.prototype.min,max:hmiEventBufferWgt.prototype.max,eventCount:0,PageDuration:1};this.dataLinks={};hmiWidget.call(this,a.wgtId,b,c,d,e);a=$hmi.cache.getWgtProp(this.wgtId,"PageDuration");null!=a?this.PageDuration=a:void 0!==this.defDur&&0<=this.defDur&&(this.PageDuration=this.getPageDurantion(this.defDur));
this.vars.PageDuration=this.PageDuration;if(""!==this.evType&&""!==this.subType){a=$hmi.activeProject.getWidget("_SysPropMgr",!0).getValue("System Time");this.max=Math.ceil(a/1E3);this.min=this.max-this.getTimeFrame();this.evType=0;this.alarmEvent=new AlarmEvent(this.evType,this.subType,this.min,this.max,this.wgtId,this.buffName);this.srv=__project.getCommunticationObj();this.alMgr=$hmi.getWidget("_AlarmsMgr",!0);this.currLang=$hmi.getWidget("_MultiLangMgr",!0).curLangId;var f=this;if(f.srv.getConnectionStatus())this.currEvtId=
f.srv.subscribeEvent(this.alarmEvent,function(a){f.onDataReady(a)});else f.srv.onConnectionReady(function(){f.currEvtId=f.srv.subscribeEvent(this.alarmEvent,function(a){f.onDataReady(a)})});this.ml=!0}}hmiEventBufferWgt.prototype=Object.create(hmiWidget.prototype);hmiEventBufferWgt.prototype.constructor=hmiEventBufferWgt;hmiEventBufferWgt.prototype.max=Math.round((new Date).getTime()/1E3);hmiEventBufferWgt.prototype.min=Math.round(((new Date).getTime()-6E4)/1E3);
hmiEventBufferWgt.prototype.eventCount=0;hmiEventBufferWgt.prototype.PageDuration=2;hmiEventBufferWgt.prototype.evType=14;hmiEventBufferWgt.prototype.subType=1;hmiEventBufferWgt.prototype.currEvtId=null;hmiEventBufferWgt.jmType="EventBufferWgt";hmiEventBufferWgt.prototype.parseDateTime=function(a){};
hmiEventBufferWgt.prototype.onDataReady=function(a){var b=this.eventCount=a.length,c,d=0;this.setPrevVars();this.emptyVars();for(var e=0;e<b;e++){c=this.vars;var f=a[e];if(14==f.type&&(1==f.evtType||4==f.evtType)){var f=f.data,g=this.alMgr.getAlarmById(f.id);if(null!=g){c.alAlarmID.push(f.id);var h=f.ts;c.alDateTime.push(h);c.evTimestamp.push(h);var k=(new DateFormat(new Date(h),"DD/MM/YYYY hh:mm:ss")).formatDateTimeValue().split(" ");c.evDate.push(k[0]);c.evTime.push(k[1]);k=g.alDescription;"undefined"!=
typeof this.alMgr.alarmsConf.mlTexts[k]&&(k=this.alMgr.alarmsConf.mlTexts[k][this.currLang]);if(g.liveData)var l=g.liveData,n=this.parentPage.getPageMLTextMgr().getCurrentLanguage(),k=this._replaceHistLiveTags(k,"string"==typeof l[n]?l[l[n]]:l[n],f.d);c.alDescription.push(k);c.alEventType.push(this._getEventType(f.t));c.alName.push(g.alName);c.alState.push(this._getAlarmState(f.st));c.alStateCode.push(f.st);c.alValue.push(f.v);0==e&&(d=h)}}}0==b?this.clearTables():this.updateDataTables();0==this.PageDuration&&
this.setValue("min",d/1E3)};hmiEventBufferWgt.prototype._replaceHistLiveTags=function(a,b,c){if(!b||!c)return a;var d=c.length,e=0;for(b=b.length;e<b;e++){var f=new RegExp("\\[\\$"+e+"\\]","g"),g="";e<d&&(g=c[e]);a=a.replace(f,g)}return a};hmiEventBufferWgt.prototype.isDataReady=function(){return!0};hmiEventBufferWgt.prototype.getDataValues=function(a){return this.vars[a]};hmiEventBufferWgt.prototype.getAlarmNameByIndex=function(a){a=this.vars.alName[a];return null!=a?a:"nodata"};
hmiEventBufferWgt.prototype.getAlarmStateCodeByIndex=function(a){return this.vars.alStateCode[a]};hmiEventBufferWgt.prototype._getEventType=function(a){switch(a){case 1:return"Triggered";case 2:return"Not Triggered";case 4:return"Acked";case 8:return"Reset";case 16:return"Enabled";case 32:return"Disabled";case 64:return"Flag Trigger Condition Changed";default:return""}};
hmiEventBufferWgt.prototype._getAlarmState=function(a){switch(a){case 0:return"Not Triggered";case 1:return"Disabled";case 2:return"Triggered";case 3:return"Triggered Not Acked";case 4:return"Not Triggered Acked";case 5:return"Not Triggered Not Acked";case 6:return"Triggered Acked";default:return""}};hmiEventBufferWgt.prototype.getUnorderedPosition=function(a){return null};
hmiEventBufferWgt.prototype.updateDataTables=function(){var a=!1,b;for(b in this.dataLinks){var c=this.dataLinks[b].tag;if(this.vars[c]instanceof Array){if(this.eventCount){$.isEmptyObject(this.prevVars)||this.eventCount==this.prevVars.alAlarmID.length||(this.prevVars={},a=!0);for(var d=0;d<this.eventCount&&!a;d++){var e=$.isEmptyObject(this.prevVars),f=e||this.vars[c][d]!=this.prevVars[c][d]&&!moment.isMoment(this.vars[c][d])&&!moment.isMoment(this.prevVars[c][d]),e=e||moment.isMoment(this.vars[c][d])&&
moment.isMoment(this.prevVars[c][d])&&!this.vars[c][d].isSame(this.prevVars[c][d]);if(f||e)a=!0}}else"PageDuration"==c&&this.prevVars[c]!=this.vars[c]&&(a=!0);if(a)break}}if(a){for(var g in this.dataLinks)a=this.dataLinks[g],this.vars[a.tag]instanceof Array&&a.setWgtValue(this.vars[a.tag],-1);this.clearTables();this.updateTables()}};
hmiEventBufferWgt.prototype.getValue=function(a){return"PageDuration"==a?this.PageDuration:"min"==a?this.min:"max"==a?this.max:"PageDuration"==a?this.PageDuration:void 0!==this.vars[a]?this.vars[a]:hmiWidget.prototype.getValue.call(this,a)};
hmiEventBufferWgt.prototype.setValue=function(a,b,c,d){var e=this;d=!1;c=Tag.prototype.QUALITY_GOOD;if(-1<a.indexOf("PageDuration")){a="All"==b?0:parseInt(b,10);if(a==this.PageDuration)return;this.PageDuration=a;this.vars.PageDuration=this.PageDuration;$hmi.cache.setWgtProp(this.wgtId,"PageDuration",this.PageDuration);this.min=this.max-this.getTimeFrame();d=!0;this.sendUpdate("min",new Date(1E3*this.min),c,-1);this.sendUpdate("PageDuration",this.PageDuration,c,-1)}else"min"==a?(this.min=b,this.sendUpdate("min",
new Date(1E3*this.min),c,-1)):"max"==a&&(this.max=b,this.min=this.max-this.getTimeFrame(),d=!0,this.sendUpdate("max",new Date(1E3*this.max),c,-1),this.sendUpdate("min",new Date(1E3*this.min),c,-1));d&&(this.srv.unsubscribeEvent(this.alarmEvent),this.alarmEvent.startTime=this.min,this.alarmEvent.endTime=this.max,this.currEvtId=this.srv.subscribeEvent(this.alarmEvent,function(a){e.onDataReady(a)}))};
hmiEventBufferWgt.prototype.sendUpdate=function(a,b,c,d){var e;if(this.dataLinks)for(var f in this.dataLinks)e=this.dataLinks[f],e.tag===a&&e.tgtWgt!==this&&e.setWgtValue(b,d,c,c)};hmiEventBufferWgt.prototype.readEvents=function(){var a=this,b=[];this.srv.readEvent(this.alarmEvent,b,!1).always(function(c){a.onDataReady(b,!0)})};hmiEventBufferWgt.prototype.setPrevVars=function(){this.prevVars={};for(var a in this.vars)0<this.vars[a].length&&(this.prevVars[a]=this.vars[a].slice())};
hmiEventBufferWgt.prototype.emptyVars=function(){this.vars={alAlarmID:[],alDateTime:[],alDescription:[],alEventType:[],alName:[],alState:[],alStateCode:[],alTime:[],alValue:[],evDate:[],evTime:[],evTimestamp:[],min:this.vars.min,max:this.vars.max,eventCount:0,PageDuration:this.PageDuration}};
hmiEventBufferWgt.prototype.updateLanguage=function(){var a=this.getPageMLTextMgr().getCurrentLanguage();if(a!=this.currLang){for(var b=$hmi.getWidget("_AlarmsMgr",!0),c=0,d=this.vars.alName.length;c<d;c++){var e=b.getAlarmByName(this.vars.alName[c]);this.vars.alDescription[c]=b.alarmsConf.mlTexts[e.alDescription][a]}this.currLang=a;this.updateDataTables()}};
hmiEventBufferWgt.prototype.timeFrame={0:0,1:60,2:300,3:600,4:1800,5:3600,6:7200,7:14400,8:28800,9:43200,10:86400,11:172800,12:432E3,13:604800,14:1209600,15:2419200};hmiEventBufferWgt.prototype.getTimeFrame=function(){var a=this.timeFrame[this.PageDuration];return 0==a?this.max-1:void 0!==a?a:0};hmiEventBufferWgt.prototype.getPageDurantion=function(a){for(var b in this.timeFrame)if(a==this.timeFrame[b])return parseInt(b);return 1};
hmiEventBufferWgt.prototype.updateTables=function(){var a=this.getAllSubscriptions();if(a)for(var b in a){var c=a[b].getWidget();c instanceof hmiTable&&c.updateData()}};hmiEventBufferWgt.prototype.clearTables=function(){var a=this.getAllSubscriptions();if(a)for(var b in a){var c=a[b].getWidget();c instanceof hmiTable&&c.clear()}};hmiEventBufferWgt.prototype._isInt=function(a){return 0===a%1};
hmiEventBufferWgt.prototype.destroy=function(){if(this.destroyed)return!1;this.srv.unsubscribeEvent(this.alarmEvent);this.vars=null;this.setPrevVars();return this.destroyed=!0};$hmi.fn.hmiEventBufferWgt=function(a,b,c,d){return new hmiEventBufferWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiEventBufferWgt",hmiEventBufferWgt);
function hmiColumn(a,b,c,d,e){this.value=[];this.quality={};this.alarmMgr=$hmi.activeProject.getWidget("_AlarmsMgr",!0);this.tableWgt=e;this.tableIdx=this.tableWgt.addColumnWgt(this);hmiWidget.call(this,a.wgtId,b,c,d,e)}hmiColumn.prototype=Object.create(hmiWidget.prototype);hmiColumn.prototype.constructor=hmiColumn;hmiColumn.prototype.type=0;hmiColumn.prototype.hasChanged=!0;hmiColumn.prototype.dataLinkTag=null;hmiColumn.prototype.dataLinkSrc=null;hmiColumn.prototype.visibility=!0;
hmiColumn.prototype.length=0;hmiColumn.prototype.hasQuality=!1;hmiColumn.prototype.numberFormat="DD/MM/YYYY hh:mm:ss";hmiColumn.jmType="ColumnWgt";hmiColumn.prototype.render=function(){this._baseRenderMask&this._baseRenderFlags.VISIBLE&&(this.visible?this.elem.style.display="":(this.elem.style.display="none",this.tableWgt.hideColumn(this.tableIdx)));this._baseRenderMask&=~this._baseRenderFlags.VISIBLE;hmiWidget.prototype.render.call(this)};
hmiColumn.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.getAttribute())};hmiColumn.prototype.initDataLinkSideEffects=function(a,b){"value"==b&&(this.dataLinkTag=a.getTag(),this.dataLinkSrc=a.getDataSrc(),this.getDataFromSource(a.getTag()))};
hmiColumn.prototype.getDataFromSource=function(a){var b=this;if(this.dataLinkSrc.constructor==hmiAlarmsMgr)if(this.dataLinkSrc.isDataReady()){var c=this.dataLinkSrc.getDataValues(a);"undefined"!=typeof c&&(this.setValue("value",c,Tag.prototype.QUALITY_GOOD,-1),"alEnable"!=a||this.hasQuality||(this.quality=this.dataLinkSrc.getDataValuesQuality(a),this.hasQuality=!0));this.tableWgt.columnReady(this.wgtId)}else setTimeout(function(){b.getDataFromSource(a)},200);else this.tableWgt.columnReady(this.wgtId)};
hmiColumn.prototype.getDataReference=function(a){return this.dataLinkSrc.getAlarmNameByIndex(a)};hmiColumn.prototype.getTagLinkedToValue=function(){return this.dataLinkTag};hmiColumn.prototype.getSrcLinkedToValue=function(){return this.dataLinkSrc};
hmiColumn.prototype.getValue=function(a,b){var c;return"value"==a?(-1==b?c=this.value:this.value instanceof Array?(c=this.value[b],this.dataLinkSrc&&this.dataLinkSrc.constructor==hmiAlarmsMgr&&(c=this._replaceLiveData(c,b))):c=this.value,c):"width"==a?this.width:hmiWidget.prototype.getValue.call(this,a)};
hmiColumn.prototype._replaceLiveData=function(a,b){if("string"==typeof a&&"alDescription"==this.dataLinkTag){var c=this.alarmMgr.getAlarmByIndex(b),d=c.liveData,c=c.liveTags,e=this.parentPage.getPageMLTextMgr().getCurrentLanguage(),f;f="string"==typeof d[e]?d[d[e]]:d[e];if(null==f)return a;d=null==c?0:c.length;e=0;for(f=f.length;e<f;e++){var g=new RegExp("\\[\\$"+e+"\\]","g"),h="nan";e<d&&(h=""==c[e]?"nan":c[e]);a=a.replace(g,h)}}return a};hmiColumn.prototype.isEmpty=function(){return 0==this.length};
hmiColumn.prototype.setValue=function(a,b,c,d){if("value"==a)void 0!==d&&(-1==d||b instanceof Array?b instanceof Array?this.value=b:(this.value=b,this.tableWgt.refreshRequest()):this.value&&(this.value[d]=b,"undefined"!=typeof b&&"undefined"!=typeof c&&"number"==typeof d&&(this.quality[d]=c,this.hasQuality=!0)),this.value&&(this.length=this.value.length)),this.hasChanged=!0;else return hmiWidget.prototype.setValue().call(this,a,b,c,d)};
hmiColumn.prototype.getQuality=function(a){var b=this.dataLinkSrc.getAlarmNameByIndex(a);return null!=this.dataLinkSrc.getAlarmByName(b).alRemoteEnable&&this.hasQuality?this.quality[a]:Tag.prototype.QUALITY_GOOD};hmiColumn.prototype.destroy=function(){if(this.destroyed)return!1;this.value=this.dataLinkSrc=this.dataLinkTag=this.tableWgt=null;return hmiWidget.prototype.destroy.call(this)};$hmi.fn.hmiColumn=function(a,b,c,d){return new hmiColumn(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiColumn",hmiColumn);
function hmiComboBox(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.itemData=0;this.select=this.elem.childNodes[1];this.count=this.select.childNodes.length;this.authCode=this.getAuthorizations();this.isNotNative=this._isNativeSelectCompatible();this.index||(this.index=0);if(0>this.index||this.index>this.count-1)this.index=-1;this.index!=this.select.selectedIndex&&(this.index=this.select.selectedIndex);this.keyValue=this.listData.split(",")[this.index];this.list instanceof Array||(this.list=
this.list.split(","));this.textValue=this.list[this.index];this._hasEmptyElem=!1;this.ml=!0;this.authCode==this.umgr.wgtAuth.RDONLY&&(this.enable=!1,this._renderMask|=this._renderFlags.DIS);this._renderMask|=this._renderFlags.INITWRAP;$hmi.addToRender(this)}hmiComboBox.prototype=Object.create(hmiWidget.prototype);hmiComboBox.prototype.constructor=hmiComboBox;hmiComboBox.prototype.select=null;hmiComboBox.prototype.isML=!0;hmiComboBox.prototype.enable=!0;hmiComboBox.prototype.lData=null;
hmiComboBox.prototype.keyValue=null;hmiComboBox.prototype.textValue=null;hmiComboBox.prototype._renderMask=0;hmiComboBox.prototype._renderFlags={CHANGE:1,DIS:2,DATA:4,EMPTY:8,UPDATE:16,FILL:32,INITWRAP:64,NATIVECOMBOBOUNDS:128};hmiComboBox.jmType="ComboBoxWgt";hmiComboBox.prototype._initSelectEvents=function(){var a=this;$(this.select).change(function(){a.onChange()})};
hmiComboBox.prototype._initSelectricWrapper=function(){this.combowrap=new ComboWrapper(this);this.updateWrapper();this.getAuthorizations()!=this.umgr.wgtAuth.RDONLY&&this.combowrap.bindEvents()};
hmiComboBox.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.INITWRAP&&($hmi.modernBrowser&&($(this.elem).hasClass("hacklayer")||$(this.elem).addClass("hacklayer")),this.isNotNative?this._initSelectricWrapper():this._initSelectEvents());this._renderMask&this._renderFlags.NATIVECOMBOBOUNDS&&(this.select.style.width=this.width+"px",this.select.style.height=this.height+"px");this._renderMask&this._renderFlags.UPDATE&&this.updateValue();this._renderMask&
this._renderFlags.CHANGE&&(this._hasEmptyElem&&($("option[value='empty']",this.select).remove(),this._hasEmptyElem=!1),this.select.selectedIndex=this.index);if(this._renderMask&this._renderFlags.EMPTY){if(!this._hasEmptyElem){var a=document.createElement("option");a.setAttribute("value","empty");a.setAttribute("selected","selected");a.setAttribute("style","display:none");$(this.select).prepend(a)}this.index=-1;this._hasEmptyElem=!0;this.select.selectedIndex=this.index}this._renderMask&this._renderFlags.DIS&&
(this.enable?($(this.select).removeAttr("disabled"),this.combowrap&&this.combowrap.bindEvents()):(this.combowrap&&this.combowrap.unbindEvents(),$(this.select).attr("disabled","")));this._renderMask&this._renderFlags.DATA&&this.setListData();if(this._renderMask&this._renderFlags.FILL){$(this.select).children().remove();a=document.createElement("option");a.setAttribute("value","empty");a.setAttribute("selected","selected");a.setAttribute("style","display:none");if(this.list){var b=this.list,c=document.createDocumentFragment(),
d;if(0>this.index||this.index>this.count-1)$(c).append(a),this._hasEmptyElem=!0,this.index=-1;for(var e=0,f=this.count;e<f;e++)d=document.createElement("option"),a=document.createTextNode(b[e]),$(d).append(a),$(c).append(d);$(this.select).prepend(c)}else $(this.select).prepend(a);this.select.selectedIndex=this.index}this.combowrap&&this.updateWrapper();this._renderMask=0};hmiComboBox.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};
hmiComboBox.prototype.initDataLinkSideEffects=function(a,b){if("index"==b&&"r"==a.rw||this.authCode==this.umgr.wgtAuth.RDONLY)this.enable=!1,this._renderMask|=this._renderFlags.DIS,$hmi.addToRender(this);"list"==b&&this.hasPropInDatalinks("List")};
hmiComboBox.prototype.setValue=function(a,b,c,d){var e=!1;this.isBadValue(b,!1,c)||("index"==a&&void 0!==b?(this.index=Math.round(b),e=!0,this._renderMask=0>this.index||this.index>this.count-1?this._renderMask|this._renderFlags.EMPTY:this._renderMask|this._renderFlags.CHANGE,(a=this.select.options[this.index])?(b=this.listData.split(","),this.keyValue=void 0!==b[this.index]?b[this.index]:"",this.textValue=a.textContent):this.textValue=this.keyValue="",this.sendUpdate("data",this.keyValue,c),this.doWriteValue("data",
this.keyValue),this.sendUpdate("text",this.textValue,c)):"disabled"==a&&void 0!==b?this.enable!=!b&&(this.enable=!b,e=!0,this._renderMask|=this._renderFlags.DIS,this.sendUpdate(a,this.enable,c)):"data"==a?this.lData!=b&&(this.lData=b,e=!0,this._renderMask|=this._renderFlags.DATA,this.doWriteValue(a,this.lData),this.sendUpdate(a,this.lData,c)):"list"==a?this.list!=b&&(this.list=void 0!=b?b instanceof Array?b:b.split(","):"",this.count=this.list.length,e=!0,this._renderMask|=this._renderFlags.FILL,
this.sendUpdate(a,this.list instanceof Array?this.list.join(","):this.list,c)):hmiWidget.prototype.setValue.call(this,a,b,c,d),e&&$hmi.addToRender(this))};hmiComboBox.prototype.setListData=function(){var a,b,c;a=this.select.childNodes;b=a.length;for(var d=this.listData.split(","),e=0;e<b;e++){var f=a[e].getAttribute("value");if(d[f]==this.lData){c=e;break}}void 0!=c&&(this.index=this.select.selectedIndex=c,this.doWriteValue("index",c))};
hmiComboBox.prototype.getValue=function(a){switch(a){case "itemData":case "data":return this.keyValue;case "index":return this.index;case "list":return this.list instanceof Array?this.list.join(","):this.list;case "text":return this.textValue;default:return hmiWidget.prototype.getValue.call(this,a)}};
hmiComboBox.prototype.updateValue=function(){this.index=this.select.selectedIndex;this._hasEmptyElem&&0<this.index&&--this.index;this.doWriteValue("index",this.index);this.sendUpdate("index",this.index);this.keyValue=this.listData.split(",")[this.index];this.doWriteValue("data",this.keyValue);this.sendUpdate("data",this.keyValue);this.doWriteValue("itemData",this.keyValue);this.sendUpdate("itemData",this.keyValue);this.textValue=this.list[this.index];this.doWriteValue("text",this.textValue);this.sendUpdate("text",
this.textValue)};
hmiComboBox.prototype.updateLanguage=function(){if(!this.hasListPropInDatalinks&&this.isML){var a=this.getPageMLTextMgr(),b=a.getCurrentFont(),c=$(".text",this.elem);b&&(this.combowrap?this.combowrap.updateFont(b):this.elem.style.fontFamily="'"+b+"'");if((b=a.getText(0,this,"list"))&&b instanceof Array)this.setValue("list",b,Tag.prototype.QUALITY_GOOD);else for(var b=0,d=c.length;b<d;b++){var e=c[b].getAttribute("data-textid"),e=a.getText(e);null!=e&&("undefined"==typeof c[b].childNodes[0]?c[b].appendChild(document.createTextNode(e)):
c[b].childNodes[0].textContent=e)}this.combowrap&&this.updateWrapper()}};hmiComboBox.prototype.onChange=function(a){this.isNotNative&&(this.index=this.select.selectedIndex=a);this._renderMask|=this._renderFlags.UPDATE;$hmi.addToRender(this)};hmiComboBox.prototype.onClose=function(){this.isNotNative&&this.combowrap&&this.combowrap.detachClone()};hmiComboBox.prototype.updateWrapper=function(){this.combowrap&&this.combowrap.update(this.index)};
hmiComboBox.prototype.setParentBounds=function(a,b,c,d,e){hmiWidget.prototype.setParentBounds.call(this,a,b,c,d,e);this.combowrap?(this.removeComboWrapper(),this._renderMask|=this._renderFlags.INITWRAP):this._renderMask|=this._renderFlags.NATIVECOMBOBOUNDS;$hmi.addToRender(this)};hmiComboBox.prototype.destroy=function(){if(this.destroyed)return!1;hmiWidget.prototype.destroy.call(this);this.removeComboWrapper()};
hmiComboBox.prototype.removeComboWrapper=function(){this.combowrap?(this.combowrap.removeObjects(),delete this.combowrap,$(this.elem).append(this.select)):$(this.select).off()};$hmi.fn.hmiComboBox=function(a,b,c,d){return new hmiComboBox(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiComboBox",hmiComboBox);
function hmiGridWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.trnWndId&&(this.trnWnd=this.parentWidget.getWidgetByClass(hmiTrendWindowWgt),this.trnWnd.subscribeWgt(this,function(){}));$hmi.cache.hasWgtProps(this.elem.id)&&(a=$hmi.cache.getWgtProp(this.elem.id,"crsVisible"),this.yCursorPos=$hmi.cache.getWgtProp(this.elem.id,"yCursorPos"),this.xCursorShow=a);this._initXCursor=!1;this._initObjects();this._renderMask=this._renderFlags.GRID;$hmi.addToRender(this)}hmiGridWgt.prototype=Object.create(hmiWidget.prototype);
hmiGridWgt.prototype.constructor=hmiGridWgt;hmiGridWgt.prototype.showGrid=!0;hmiGridWgt.prototype.cursorWidth=4;hmiGridWgt.prototype.type=0;hmiGridWgt.prototype.xanchor=0;hmiGridWgt.prototype.yanchor=0;hmiGridWgt.prototype.xspacing=0;hmiGridWgt.prototype.yspacing=0;hmiGridWgt.prototype.cursorColor="rgb( 255, 0, 0 )";hmiGridWgt.prototype._renderMask=0;hmiGridWgt.prototype._renderFlags={GRID:2,CURSOR:4,UPDATEGRIDCANVAS:8,UPDATECRSCANVAS:16};hmiGridWgt.jmType="GridWgt";
hmiGridWgt.prototype._initObjects=function(){this.gridGraph=new Grid(this.elem.querySelector(".trend_grid"),{width:this.width,height:this.height,minX:this.min||0,maxX:this.max||1E3,minY:this.y0||0,maxY:this.y1||100,xanchor:this.xanchor,yanchor:this.yanchor,xspacing:this.xspacing,yspacing:this.yspacing,gridX:this.gridX,gridY:this.gridY,colorX:this.colorX,colorY:this.colorY});var a={width:this.width,height:this.height,xCursorShow:this.xCursorShow,yCursorShow:this.yCursorShow,yCursorPos:this.yCursorPos,
cursorWidth:this.cursorWidth,cursorColor:this.cursorColor};this.trnWnd.isScatter()?this.cursorGraph=new CursorXY(this.elem.querySelector(".trend_cursor"),a):this.cursorGraph=new Cursor(this.elem.querySelector(".trend_cursor"),a)};
hmiGridWgt.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.GRID&&(this.gridGraph.setGridX(this.gridX),this.gridGraph.setGridY(this.gridY),this.gridGraph.setColorX(this.colorX),this.gridGraph.setColorY(this.colorY),this.showGrid&&this.gridGraph.drawBGGrid());if(this._renderMask&this._renderFlags.CURSOR){if(!this._initXCursor){var a=this.max-this.getTrendDuration()/2,b=null==this.yCursorPos?0:this.yCursorPos;this.cursorGraph.setXCursorPos(a);this.cursorGraph.setYCursorPos(b);
this._initXCursor=!0}this.cursorGraph.drawCursor(!1)}this._renderMask&this._renderFlags.UPDATEGRIDCANVAS&&(this.gridGraph.updateSize(this.width,this.height),this.gridGraph.clearCanvasContext(),this.gridGraph.drawBGGrid());this._renderMask&this._renderFlags.UPDATECRSCANVAS&&(this.cursorGraph.updateSize(this.width,this.height),this.cursorGraph.clearCanvasContext(),this.cursorGraph.drawCursor(!1));this._renderMask=0};
hmiGridWgt.prototype.setValue=function(a,b,c,d){d=!1;if(this.isBadValue(b,!1,c))return!1;switch(a){case "showGrid":this.showGrid!=b&&(this.showGrid=b,this._renderMask|=this._renderFlags.GRID,d=!0,this.sendUpdate(a,this.showGrid,c));break;case "cursor_pos":this.xCursorPos!=b&&(this.xCursorPos=b,this.cursorGraph.setXCursorPos(this.xCursorPos),this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.xCursorPos,c));break;case "ycursor_pos":this.yCursorPos!=b&&(this.yCursorPos=b,this.cursorGraph.setYCursorPos(this.yCursorPos),
this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.yCursorPos,c));break;case "min":this.min!=b&&(this.min=b,this.cursorGraph.setXMin(this.min),this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.min,c));break;case "max":this.max!=b&&(this.max=b,this.cursorGraph.setXMax(this.max),this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.max,c));break;case "y0":this.y0!=b&&(this.y0=b,this.cursorGraph.setYMin(this.y0),this._renderMask|=this._renderFlags.CURSOR,
d=!0,this.sendUpdate(a,this.y0,c));break;case "y1":this.y1!=b&&(this.y1=b,this.cursorGraph.setYMax(this.y1),this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.y1,c));break;case "xanchor":this.xanchor!=b&&(this.xanchor=b,this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.xanchor,c));break;case "yanchor":this.yanchor!=b&&(this.yanchor=b,this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.yanchor,c));break;case "xspacing":this.xspacing!=b&&(this.xspacing=
b,this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.xspacing,c));break;case "yspacing":this.yspacing!=b&&(this.yspacing=b,this._renderMask|=this._renderFlags.CURSOR,d=!0,this.sendUpdate(a,this.yspacing,c));break;case "gridX":this.gridX!=b&&(this.gridX=b,this._renderMask|=this._renderFlags.GRID,d=!0,this.sendUpdate(a,this.gridX,c));break;case "gridY":this.gridY!=b&&(this.gridY=b,this._renderMask|=this._renderFlags.GRID,d=!0,this.sendUpdate(a,this.gridY,c));break;case "colorX":this.colorX!=
b&&(this.colorX=b,this._renderMask|=this._renderFlags.GRID,d=!0,this.sendUpdate(a,this.colorX,c));break;case "colorY":this.colorY!=b&&(this.colorY=b,this._renderMask|=this._renderFlags.GRID,d=!0,this.sendUpdate(a,this.colorY,c));break;default:hmiWidget.prototype.setValue.call(this,a,b,c)}d&&$hmi.addToRender(this)};
hmiGridWgt.prototype.getValue=function(a){switch(a){case "cursor_pos":return this.cursorGraph.getXPosition();case "ycursor_pos":return this.cursorGraph.getYPosition();case "cursor-show":return this.cursorGraph.isCursorVisible()}return hmiWidget.prototype.getValue.call(this,a)};
hmiGridWgt.prototype.scrollTrendCursor=function(a,b,c){if(this.trnWnd.isScatter())this.cursorGraph.isVisible&&(a=this.cursorGraph.stepXY(a,c),this.xCursorPos=a.xvalue,this._renderMask|=this._renderFlags.CURSOR,$hmi.addToRender(this),this.updateXYCursorValue(a.xvalue,a.yoccurence));else{var d=this.getTrendDuration();b=0==b?d*c/100:1E3*c;a=this.getXCursor()+(1==a?-b:b);a<this.min&&(a=this.min);a>this.max&&(a=this.max);this.setValue("cursor_pos",a,null)}};
hmiGridWgt.prototype.setCursorVisibility=function(a){this.cursorGraph.setCursorVisibility(a);if(this.trnWnd.isInitialized()){var b=this.max-this.getTrendDuration()/2;a&&this.xCursorPos!=b?this.setValue("cursor_pos",b,null):(this._renderMask|=this._renderFlags.CURSOR,$hmi.addToRender(this))}this.trnWnd.isScatter()&&a&&(this.cursorGraph.resetXYCursor(),this.updateXYCursorValue(this.cursorGraph.getValueXY(),this.cursorGraph.getOccurenceXY()))};hmiGridWgt.prototype.getXCursor=function(){return this.cursorGraph.getXPosition()};
hmiGridWgt.prototype.getYCursor=function(){return this.cursorGraph.getYPosition()};hmiGridWgt.prototype.getTrendDuration=function(){return this.trnWnd.xPageSize};
hmiGridWgt.prototype.updateCursorGrid=function(){var a=this.parentWidget,b=[],c;for(c in a.wgts){var d=a.wgts[c];d.constructor==hmiXYCurveWgt&&d.visible&&b.push(d)}this.cursorGraph.updateXYGrid(b);this.cursorGraph.isCursorVisible()&&(a=this.cursorGraph.getValueXY(),b=this.cursorGraph.getOccurenceXY(),void 0!==a&&void 0!==b&&this.updateXYCursorValue(a,b))};hmiGridWgt.prototype.isCursorVisible=function(){return null!=this.cursorGraph?this.cursorGraph.isCursorVisible():!1};
hmiGridWgt.prototype.updateXYCursorValue=function(a,b){var c=this.parentWidget,d;for(d in c.wgts){var e=c.wgts[d];e.constructor==hmiXYCurveWgt&&e.visible&&e.setXYCursorValue(a,b)}};hmiGridWgt.prototype.setParentBounds=function(a,b,c,d,e){hmiWidget.prototype.setParentBounds.call(this,a,b,c,d,e);this._renderMask=this._renderFlags.UPDATECRSCANVAS|this._renderFlags.UPDATEGRIDCANVAS;$hmi.addToRender(this)};
hmiGridWgt.prototype.destroy=function(){if(this.destroyed)return!1;$hmi.cache.setWgtProp(this.elem.id,"crsVisible",this.cursorGraph.isCursorVisible());$hmi.cache.setWgtProp(this.elem.id,"yCursorPos",this.xCursorPos);this.cursorGraph.clearCanvasContext();this.gridGraph.clearCanvasContext();this.cursorGraph=this.cursorGraph=null;return hmiWidget.prototype.destroy.call(this)};$hmi.fn.hmiGridWgt=function(a,b,c,d){return new hmiGridWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiGridWgt",hmiGridWgt);
function hmiIndicator(a,b,c,d,e){this.curState=0;hmiWidget.call(this,a.wgtId,b,c,d,e);this.setValue("value",this.curState,null)}hmiIndicator.prototype=Object.create(hmiWidget.prototype);hmiIndicator.prototype.constructor=hmiIndicator;hmiIndicator.prototype.backgroundClass="bgColor00";hmiIndicator.prototype.colors=["green","red"];hmiIndicator.prototype.strokeColor="#FFF";hmiIndicator.prototype.numStates=2;hmiIndicator.prototype.disabled=!1;hmiIndicator.prototype._renderMask=0;
hmiIndicator.prototype._renderFlags={VALUE:1,STROKE:2};hmiIndicator.jmType="IndicatorWgt";
hmiIndicator.prototype.render=function(){hmiWidget.prototype.render.call(this);if(this._renderMask&this._renderFlags.VALUE){var a=Math.abs(parseInt(this.value)%this.numStates),a=this.colors[a],b=this.elem.getElementsByClassName(this.backgroundClass);0<b.length?b[0].style.fill?b[0].style.fill=a:b[0].setAttribute("fill",a):(b=this.elem.getElementsByTagName("svg"),0<b.length&&(b[0].style.fill=a));this.elem&&this.elem.setAttribute("data-c",a)}this._renderMask&this._renderFlags.STROKE&&(this.elem.getElementsByTagName("path").style.stroke=
this.strokeColor);this._renderMask=0};hmiIndicator.prototype.setValue=function(a,b,c,d){if("value"==a||"frame"==a){if(this.isBadValue(b,!1,c))return!1;this.value!=b&&(this.value=b,this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this),this.sendUpdate(a,this.value,c))}else hmiWidget.prototype.setValue.call(this,a,b,c,d)};hmiIndicator.prototype.getValue=function(a){return"value"==a?this.curState:hmiWidget.prototype.getValue.call(this,a)};
$hmi.fn.hmiIndicator=function(a,b,c,d){return new hmiIndicator(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiIndicator",hmiIndicator);
function hmiIPCamera(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.currip=this.timer=null;if(a=$hmi.getEventMgr()){var f=this;this.activateHandler=function(){f.imageElem=f.elem.firstElementChild;f.initEventHandlers();var a=navigator.userAgent;-1==a.indexOf("Trident")&&-1==a.indexOf("Edge")&&-1==a.indexOf("MSIE")||!f.isMjpeg?f.start():f.showIEMjpeg()};this.deactivateHandler=function(){f.stop()};a.on(this.parentPage.elem,"loadWgt",this.activateHandler);a.on(this.parentPage.elem,"unloadWgt",this.deactivateHandler)}}
hmiIPCamera.prototype=Object.create(hmiWidget.prototype);hmiIPCamera.prototype.rate=5E3;hmiIPCamera.prototype.mjpgrate=5E3;hmiIPCamera.prototype.user="";hmiIPCamera.prototype.pwd="";hmiIPCamera.prototype.mjpegip="";hmiIPCamera.prototype.isMjpeg=!1;hmiIPCamera.prototype.constructor=hmiIPCamera;hmiIPCamera.prototype._renderMask=0;hmiIPCamera.prototype._renderFlags={JPGREFRESH:1,MJPGREFRESH:2,ADDNOSIGNAL:4,RMNOSIGNAL:8};hmiIPCamera.jmType="IPCameraWgt";
hmiIPCamera.prototype.initEventHandlers=function(){var a=this;this.imageElem.onerror=function(){null==document.getElementById(a.wgtId+".nosignal")&&(a._renderMask|=a._renderFlags.ADDNOSIGNAL,$hmi.addToRender(a))};this.imageElem.onload=function(){null!=document.getElementById(a.wgtId+".nosignal")&&(a._renderMask|=a._renderFlags.RMNOSIGNAL,$hmi.addToRender(a))}};
hmiIPCamera.prototype.createNoSignalHTMLElement=function(){var a=document.createElement("div"),b=document.createElement("h1");a.setAttribute("id",this.wgtId+".nosignal");a.style.width="100%";a.style.height="100%";a.style.backgroundColor="black";a.style.textAlign="center";a.style.position="absolute";a.style.left="0px";a.style.top="0px";b.style.color="blue";b.style.position="relative";b.style.top="50%";b.appendChild(document.createTextNode("NO SIGNAL"));a.appendChild(b);return a};
hmiIPCamera.prototype.appendNoSignalElement=function(){this.elem.getElementsByTagName("img")[0].style.display="none";this.elem.appendChild(this.createNoSignalHTMLElement())};hmiIPCamera.prototype.removeNoSignalElement=function(){this.elem.getElementsByTagName("img")[0].style.display="block";this.elem.removeChild(document.getElementById(this.wgtId+".nosignal"))};
hmiIPCamera.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.JPGREFRESH&&this.refreshJPEG();this._renderMask&this._renderFlags.MJPGREFRESH&&this.refreshMJPEG();this._renderMask&this._renderFlags.ADDNOSIGNAL&&this.appendNoSignalElement();this._renderMask&this._renderFlags.RMNOSIGNAL&&this.removeNoSignalElement();this._renderMask=0};
hmiIPCamera.prototype.showIEMjpeg=function(){var a=$(this.elem).children(),b;b='<object id="Player" standby="Loading Axis Media Control components..." border="0" codeBase="/activex/AMC.cab#version=6,0,6,7" classid="CLSID:DE625294-70E6-45ED-B895-CFFA13AEB044" style="width:100%;height:100%;"><param name="StretchToFit" value="-1">'+('<param name="MediaURL" value="'+this.mjpegip+'">');b+='<param name="AutoStart" value="-1"></object>';a.replaceWith(b)};
hmiIPCamera.prototype.setOptions=function(a){null!=a&&(void 0!=a.user&&(this.user=a.user),void 0!=a.pwd&&(this.pwd=a.pwd),void 0!=a.rate&&(this.rate=a.rate),void 0!=a.mjpegip&&(this.mjpegip=a.mjpegip),void 0!=a.ip&&(this.ip=a.ip))};hmiIPCamera.prototype.refreshMJPEG=function(){this.imageElem&&(this.imageElem.src=this.currip)};hmiIPCamera.prototype.refreshJPEG=function(){this.imageElem&&(this.imageElem.src=this.currip+"?v="+(new Date).getTime())};
hmiIPCamera.prototype.start=function(){if(!this.bAltIPAddr){var a=this,b,c;this.timer&&clearInterval(this.timer);this.currip=this.ip?this.ip:this.mjpegip;b=this.currip.substring(0,this.currip.indexOf("//")+2);c=this.currip.substring(this.currip.indexOf("//")+2);this.user&&this.pwd&&(this.currip=b+this.user+":"+this.pwd+"@"+c);this.mjpegip?(this._renderMask|=this._renderFlags.MJPGREFRESH,$hmi.addToRender(this),this.timer=setInterval(function(){a._renderMask|=a._renderFlags.MJPGREFRESH;$hmi.addToRender(a)},
this.mjpgrate)):(this._renderMask|=this._renderFlags.JPGREFRESH,$hmi.addToRender(this),this.timer=setInterval(function(){a._renderMask|=a._renderFlags.JPGREFRESH;$hmi.addToRender(a)},a.rate))}};hmiIPCamera.prototype.stop=function(){this.timer&&clearInterval(this.timer);this.imageElem&&(this.imageElem.src="",this.imageElem.onerror=null,this.imageElem=this.imageElem.onload=null)};hmiIPCamera.prototype.destroy=function(){return this.destroyed?!1:hmiWidget.prototype.destroy.call(this)};
$hmi.fn.hmiIPCamera=function(a,b,c,d){return new hmiIPCamera(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiIPCamera",hmiIPCamera);function hmiLabel(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.textCnt=this.elem.getElementsByClassName("text")[0];this.color=this.textCnt.style.color;this.ml=!0}hmiLabel.prototype=Object.create(hmiWidget.prototype);hmiLabel.prototype.constructor=hmiLabel;hmiLabel.prototype.invokablePropsList=["fill","fontColor"];hmiLabel.prototype.text=null;
hmiLabel.prototype.color=null;hmiLabel.prototype.fontFamily=null;hmiLabel.prototype.masked=null;hmiLabel.prototype._renderMask=0;hmiLabel.prototype._renderFlags={VALUE:2,FNCOLOR:4,FNFAMILY:8};hmiLabel.jmType="LabelWgt";
hmiLabel.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.VALUE&&(this.masked?this.writeMaskedText(this.text):this.writeText(this.text));this._renderMask&this._renderFlags.FNCOLOR&&(this.textCnt.style.color=this.color);this._renderMask&this._renderFlags.FNFAMILY&&(this.textCnt.style.fontFamily="'"+this.fontFamily+"'");this._renderMask=0};
hmiLabel.prototype.writeText=function(a){if(-1==a.indexOf("\n"))this.textCnt&&(this.textCnt.innerHTML="<p>"+a+"</p>");else{a=a.split("\n");for(var b="",c=0,d=a.length;c<d;c++)b+="<p>"+a[c]+"</p>";this.textCnt.innerHTML=b}};hmiLabel.prototype.writeMaskedText=function(){for(var a=this.text.toString().length,b="",c=0;c<a;c++)b+=this.maskChar;this.writeText(b)};
hmiLabel.prototype.setValue=function(a,b,c,d){var e=!1;if("value"==a||"text"==a){if(this.isBadValue(b,1,c))return!1;b=null!=b?b.toString():"";if(this.text===b)return!1;this.text!=b&&(this.text=b,e=!0,this._renderMask|=this._renderFlags.VALUE,this.sendUpdate(a,b,c))}"fill"===a||"fontColor"===a?this.color!=b&&(d="#000",this.isBadValue(b,!0,c)||(/^rgb\(\s*\d+,\s*\d+\s*,\s*\d+\s*\)$/.test(b)?d=b:"string"==typeof b&&0==b.indexOf("#")&&1<b.length&&8>=b.length&&(d=b)),this.color!=d&&(this.color=d,this._renderMask|=
this._renderFlags.FNCOLOR,e=!0,this.sendUpdate(a,d,c))):"font-family"==a?this.isBadValue(b,!1,c)||this.fontFamily==b||(this.fontFamily=b,this._renderMask|=this._renderFlags.FNFAMILY,e=!0,this.sendUpdate(a,b,c)):"masked"==a?this.masked!=b&&void 0!=b&&(this.masked=b,this._renderMask|=this._renderFlags.VALUE,e=!0,this.sendUpdate(a,this.masked,c)):hmiWidget.prototype.setValue.call(this,a,b,c,d);e&&$hmi.addToRender(this)};
hmiLabel.prototype.getValue=function(a){return"value"==a?this.text:"fill"==a||"fontColor"==a?this.color?this.color:this.elem.style.color:hmiWidget.prototype.getValue.call(this,a)};
hmiLabel.prototype.updateLanguage=function(){if(!this.hasTextPropInDatalinks&&!this.hasValuePropInDatalinks){var a=this.getPageMLTextMgr(),b=this.textCnt.getAttribute("data-textid"),b=a.getText(b,this,"text"),a=a.getCurrentFont();a!=this.fontFamily&&this.setValue("font-family",a,null);null!=b&&this.text!=b&&(this.text=b,this.writeText(b))}};hmiLabel.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};
hmiLabel.prototype.initDataLinkSideEffects=function(a,b){"value"!=b&&"text"!=b||this.hasPropInDatalinks("Text")};hmiLabel.prototype.destroy=function(){this.textCnt=null;return hmiWidget.prototype.destroy.call(this)};$hmi.fn.hmiLabel=function(a,b,c,d){return new hmiLabel(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiLabel",hmiLabel);
function hmiLabels(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);void 0===this.width&&(this.width=parseFloat(this.elem.style.width.split("px")[0]));void 0===this.height&&(this.height=parseFloat(this.elem.style.height.split("px")[0]));void 0===this.cx&&(this.cx=this.width/2);void 0===this.cy&&(this.cy=this.height/2);void 0===this.radiusX&&(this.radiusX=this.cx);void 0===this.radiusY&&(this.radiusY=this.cy);this.labelNames&&(this.labelNames=this.labelNames.split(","));this._initLabelSize(this.dataType,
this.form);this._renderMask=this._renderFlags.MIN|this._renderFlags.MAX|this._renderFlags.LBSFREQ|this._renderFlags.FNSIZE;$hmi.addToRender(this);this._initialized=!0}hmiLabels.prototype=Object.create(hmiWidget.prototype);hmiLabels.prototype.constructor=hmiLabels;hmiLabels.prototype.reverse=0;hmiLabels.prototype.min=0;hmiLabels.prototype.max=500;hmiLabels.prototype.labels=10;hmiLabels.prototype.startAngle=0*Math.PI/180;hmiLabels.prototype.stopAngle=90*Math.PI/180;hmiLabels.prototype.cx=0;
hmiLabels.prototype.cy=0;hmiLabels.prototype.range=500;hmiLabels.prototype.fontSize="10px";hmiLabels.prototype.fontFamily="Thaoma";hmiLabels.prototype.fontColor="rgb( 0,0,0 )";hmiLabels.prototype.dataFormat="Numeric";hmiLabels.prototype.dataType="Number";hmiLabels.prototype.invokablePropsList=["fill","fontColor"];hmiLabels.prototype._valueWithMaxSymbols=hmiLabels.prototype.max;hmiLabels.prototype._renderMask=0;
hmiLabels.prototype._renderFlags={MIN:2,MAX:4,LBSFREQ:8,FNCOLOR:16,FNSIZE:32,REVERSE:64,UPLBLSIZE:128,REDRAW:256};hmiLabels.prototype.enNumericType={INT:0,FLOAT:1,HEXL:2,HEXU:3,EXP:4,EXPD:5,THOUSAND:6};hmiLabels.jmType="LabelsWgt";
hmiLabels.prototype._initLabelSize=function(a,b){if("Time"==a)if(this.isCached())this.maxTextSize=this.getCachedSize();else{var c=-1!=this.dataFormat.indexOf("A")?this.dataFormat+"A":this.dataFormat;this.maxTextSize=getMeasureText(c,this.fontFamily,parseFloat(this.fontSize));this.setCachedSize()}else Math.abs(this.min)>Math.abs(this.max)?this._valueWithMaxSymbols=this.getValueByFormat(this.min):this._valueWithMaxSymbols=this.getValueByFormat(this.max);"vert"==this.form&&"Number"!=this.dataType&&(this.maxTextSize=
{width:this.width,height:parseInt(this.fontSize)});if(("round"==this.form||"horiz"==this.form)&&"Text"==a){var d=c=0;if(this.labelNames)for(var e=0;e<this.labelNames.length;e++)this.labelNames[e].length>d&&(d=this.labelNames[e].length,c=e);this.isCached()?this.maxTextSize=this.getCachedSize():(this.maxTextSize=getMeasureText(this.labelNames[c],this.fontFamily,parseFloat(this.fontSize)),this.setCachedSize())}};
hmiLabels.prototype.render=function(){hmiWidget.prototype.render.call(this);if(this._renderMask&(this._renderFlags.MIN|this._renderFlags.MAX|this._renderFlags.LBSFREQ|this._renderFlags.FNSIZE|this._renderFlags.REVERSE|this._renderFlags.REDRAW))switch(this.form){case "horiz":this.drawLinear(!1);break;case "vert":this.drawLinear(!0);break;case "round":this.drawRadial()}this._renderMask&this._renderFlags.FNCOLOR&&(this.elem.style.color=this.fill);this._renderMask=0};
hmiLabels.prototype.removeChildren=function(){for(;this.elem.hasChildNodes();)this.elem.removeChild(this.elem.firstChild)};
hmiLabels.prototype.drawRadial=function(){if(!this.isCached()||this._initialized){var a=this.cx,b=this.cy,c=this.radiusX,d=this.radiusY,e=this.startAngle,f,g,h;this.min>this.max&&(this.max=this.min);this.elem.setAttribute("data-cx",this.radiusX);this.elem.setAttribute("data-cy",this.radiusY);this.removeChildren();var k=(this.stopAngle-this.startAngle)/(this.labels-1),l=(this.max-this.min)/(this.labels-1),n=this.min;this.reverse&&(l=-l,n=this.max);this.maxTextSize||(this.maxTextSize=getMeasureText(" "+
this.getValueByFormat(this._valueWithMaxSymbols),this.fontFamily,parseFloat(this.fontSize)));for(var m,p=document.createDocumentFragment(),q=0;q<this.labels;q++)f=Math.cos(Math.PI*e/180),g=Math.sin(Math.PI*e/180),f=a-(c-this.maxTextSize.width/2-3)*f,g=b-(d-this.maxTextSize.height/2-3)*g,f-=this.maxTextSize.width/2,g-=this.maxTextSize.height/2,this.labelNames[q]?h=this.labelNames[q]:(n=Math.round(n*Math.pow(10,6))/Math.pow(10,6),h=this.getValueByFormat(n)),m=document.createElement("div"),h=document.createTextNode(h),
m.style.fontSize=this.fontSize,m.style.fontFamily=this.fontFamily,m.style.position="absolute",m.style.width=this.maxTextSize.width+"px",m.style.height=this.maxTextSize.height+"px",m.style.top=g.toFixed(2)+"px",m.style.left=f.toFixed(2)+"px",m.style.textAlign="center",m.appendChild(h),n+=l,e+=k,p.appendChild(m);this.elem.appendChild(p)}};
hmiLabels.prototype.drawLinear=function(a){if(!this.isCached()||this._initialized){this.min>this.max&&(this.max=this.min);this.removeChildren();var b=(this.max-this.min)/(this.labels-1),c=this.min;this.reverse&&(b=-b,c=this.max);if(this.labelNames)for(var d=0;d<this.labelNames.length;d++);var e=this._renderMask&this._renderFlags.UPLBLSIZE;this.maxTextSize&&0==e||(this.maxTextSize=getMeasureText(" "+this.getValueByFormat(this._valueWithMaxSymbols),this.fontFamily,parseFloat(this.fontSize)));var f=
e=d=0;if(a)switch(d=(this.height-this.maxTextSize.height)/(this.labels-1),this.align){case 0:e=0;break;case 1:e=this.width-this.maxTextSize.width;break;case 2:e=this.width/2-this.maxTextSize.width/2}else switch(d=(this.width-this.maxTextSize.width)/(this.labels-1),this.align){case 0:f=0;break;case 1:f=this.height-this.maxTextSize.height;break;case 2:f=this.height/2-this.maxTextSize.height/2}for(var g=this.maxTextSize.height/2,h=this.maxTextSize.width/2,k=d,l,n,m=document.createDocumentFragment(),
d=0;d<this.labels;d++){this.labelNames[d]?l=this.labelNames[d]:(c=Math.round(c*Math.pow(10,6))/Math.pow(10,6),l=this.getValueByFormat(c));n=document.createElement("div");l=document.createTextNode(l);n.style.fontSize=this.fontSize;n.style.fontFamily=this.fontFamily;n.style.position="absolute";n.style.width=this.maxTextSize.width+"px";n.style.height=this.maxTextSize.height+"px";$hmi.modernBrowser&&n.setAttribute("class","hacklayer willcnt");if(a){switch(this.align){case 0:n.style.textAlign="left";break;
case 1:n.style.textAlign="right";break;default:n.style.textAlign="center"}n.style.top=g-this.maxTextSize.height/2+"px";n.style.left=e+"px"}else n.style.top=f+"px",n.style.left=h-this.maxTextSize.width/2+"px",n.style.textAlign="center";n.appendChild(l);a?g+=k:h+=k;c+=b;m.appendChild(n)}this.elem.appendChild(m)}};
hmiLabels.prototype.getValueByFormat=function(a){var b;switch(this.dataType){case "Number":return b=this.dataFormat.split("."),1<b.length?(b=b[1].length,a=Math.round(a*Math.pow(10,b))/Math.pow(10,b),0==a&&(a=Math.abs(a)),a=a.toFixed(b)):a=0<a?Math.ceil(a).toString():Math.floor(a).toString(),a;case "Text":return a;case "Time":return b=this.dataFormat,(new DateFormat(new Date(a),b)).formatDateTimeValue()}};hmiLabels.prototype.isCached=function(){return Boolean(this.elem.getAttribute("cache"))};
hmiLabels.prototype.setCachedSize=function(){this.elem.setAttribute("cache","true");this.elem.setAttribute("maxLabelWidth",this.maxTextSize.width);this.elem.setAttribute("maxLabelHeight",this.maxTextSize.height)};hmiLabels.prototype.getCachedSize=function(){return{width:this.elem.getAttribute("maxLabelWidth"),height:this.elem.getAttribute("maxLabelHeight")}};
hmiLabels.prototype.setValue=function(a,b,c,d){var e=!1;if("min"==a){if(this.isBadValue(b,!1,c))return!1;parseFloat(b)!=this.min&&(this.min=parseFloat(b),"Number"==this.dataType&&(e=this.getValueByFormat(this.min),b=e.length,d=this._valueWithMaxSymbols.length,b>d||b==d&&"-"==this._valueWithMaxSymbols.charAt(0))&&(this._valueWithMaxSymbols=e,this._renderMask|=this._renderFlags.UPLBLSIZE),this._renderMask|=this._renderFlags.MIN,e=!0,this.sendUpdate(a,this.min,c))}else if("max"==a){if(this.isBadValue(b,
!1,c))return!1;parseFloat(b)!=this.max&&(this.max=parseFloat(b),"Number"==this.dataType&&(e=this.getValueByFormat(this.max),b=e.length,d=this._valueWithMaxSymbols.length,b>d||b==d&&"-"==this._valueWithMaxSymbols.charAt(0))&&(this._valueWithMaxSymbols=e,this._renderMask|=this._renderFlags.UPLBLSIZE),this._renderMask|=this._renderFlags.MAX,e=!0,this.sendUpdate(a,this.max,c))}else if("labelFreq"==a){if(this.isBadValue(b,!1,c))return!1;b=parseFloat(b);0>b&&(b=0);this.labels!=b&&(this.labels=b,this._renderMask|=
this._renderFlags.LBSFREQ,e=!0,this.sendUpdate(a,this.labels,c))}else if("numStates"==a){if(this.isBadValue(b,!1,c))return!1;b=parseFloat(b);b=0<b?b:0;this.labels!=b&&(this.labels=b,this.max=this.min+this.labels-1,this._renderMask|=this._renderFlags.LBSFREQ,e=!0,this.sendUpdate(a,this.labels,c))}else if("fill"==a||"fontColor"==a)d="#000",this.isBadValue(b,!0,c)||this.fill==b?this.fill!=d&&(/^rgb\(\s*\d+,\s*\d+\s*,\s*\d+\s*\)$/.test(b)?d=b:"string"==typeof b&&0==b.indexOf("#")&&1<b.length&&8>=b.length&&
(d=b),this.fill=d,e=!0,this.sendUpdate(a,d,c)):e=!0,e&&(this._renderMask|=this._renderFlags.FNCOLOR);else if("font-size"==a){if(this.isBadValue(b,!1,c))return!1;a=parseFloat(b);10>a&&(a=10);this.fontSize!=a&&(this.fontSize=a,e=!0,this._renderMask|=this._renderFlags.FNSIZE)}else if("reverseScale"==a){if(this.isBadValue(b,!1,c))return!1;b=parseInt(b);this.reverse!=b&&(this.reverse=b,e=!0,this._renderMask|=this._renderFlags.REVERSE,this.sendUpdate(a,this.reverse,c))}else"visibility2"==a?hmiWidget.prototype.setValue.call(this,
"visibility",b,c,d):hmiWidget.prototype.setValue.call(this,a,b,c,d);e&&$hmi.addToRender(this)};hmiLabels.prototype.getValue=function(a){return"fill"==a||"fontColor"==a?this.fill?this.fill:this.elem.style.color:"undefined"!=typeof this[a]?this[a]:hmiWidget.prototype.getValue.call(this,a)};
hmiLabels.prototype.setParentBounds=function(a,b,c,d,e){var f=this.width,g=this.height;hmiWidget.prototype.setParentBounds.call(this,a,b,c,d,e);this.radiusX*=this.width/f;this.radiusY*=this.height/g;this._renderMask|=this._renderFlags.REDRAW;$hmi.addToRender(this)};$hmi.fn.hmiLabels=function(a,b,c,d){return new hmiLabels(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiLabels",hmiLabels);
function hmiMultiStateImage(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this._svgUse=this.elem.getElementsByTagName("use")[0];this._imgRef=(a=parseInt(this.elem.getAttribute("data-frame")))?this.images[this.value%this.numStates]:this.images[0];a!=this.value&&(this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this))}hmiMultiStateImage.prototype=Object.create(hmiWidget.prototype);hmiMultiStateImage.prototype.constructor=hmiMultiStateImage;hmiMultiStateImage.prototype.value=null;
hmiMultiStateImage.prototype.numStates=null;hmiMultiStateImage.prototype.images=null;hmiMultiStateImage.prototype._imgRef=null;hmiMultiStateImage.prototype._svgUse=null;hmiMultiStateImage.prototype.animate=!1;hmiMultiStateImage.prototype.updateRate=1E3;hmiMultiStateImage.prototype.animTimer=null;hmiMultiStateImage.prototype.animValue=-1;hmiMultiStateImage.prototype.enFrameType={BMP:1,SVG:0,CORRUPT:-1};hmiMultiStateImage.prototype._renderMask=0;hmiMultiStateImage.prototype._renderFlags={VALUE:1,ANIMATE:2};
hmiMultiStateImage.jmType="MultiStateImageWgt";hmiMultiStateImage.prototype.render=function(){hmiWidget.prototype.render.call(this);var a;this._renderMask&this._renderFlags.VALUE&&(a=this._changeImage(this.value),this.elem.setAttribute("data-frame",a));this._renderMask&this._renderFlags.ANIMATE&&(a=this._changeImage(this.animValue),this.elem.setAttribute("data-frame",a));this._renderMask=0};
hmiMultiStateImage.prototype.setOptions=function(a){null!=a&&(hmiWidget.prototype.setOptions.call(this,a),void 0!=a.value&&this.setValue("value",a.value,null),void 0!=a.updateRate&&(this.animInterval=parseInt(a.updateRate)),void 0!=a.animate&&(this.animate=a.animate)&&this.startAnimation())};hmiMultiStateImage.prototype.animateImages=function(){var a=this.animValue+1;this.animValue=a=a>=this.numStates?0:a;this._renderMask|=this._renderFlags.ANIMATE;$hmi.addToRender(this);this.animate&&this.startAnimation()};
hmiMultiStateImage.prototype.startAnimation=function(){var a=this;this.animTimer=setTimeout(function(){a.animateImages()},this.updateRate)};hmiMultiStateImage.prototype.stopAnimation=function(){clearTimeout(this.animTimer)};
hmiMultiStateImage.prototype.setValue=function(a,b,c,d){if(this.isBadValue(b,!1,c))return!1;if("value"==a||"frame"==a){b=parseFloat(b);if(isNaN(b))return!1;this.value!=b&&(this.value=b,this.animate&&(this.animValue=b),this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this))}else if("animate"==a){b=parseFloat(b);if(isNaN(b))return!1;this.animate!=b&&(0==b?(this.animate=!1,this.stopAnimation()):(this.animate=!0,0<this.updateRate&&this.startAnimation()),this.sendUpdate(a,b))}else if("updateRate"==
a){b=parseFloat(b);if(isNaN(b))return!1;0>b&&(b=0);this.updateRate!=b&&(this.updateRate=b,this.stopAnimation(),this.animate&&0!=b&&this.startAnimation(),this.sendUpdate(a,b))}else hmiWidget.prototype.setValue.call(this,a,b,c,d);return!0};hmiMultiStateImage.prototype.getValue=function(a){return"value"==a||"frame"===a?this.value:hmiWidget.prototype.getValue.call(this,a)};
hmiMultiStateImage.prototype._changeImage=function(a){a=0>a?0:parseInt(a)%this.numStates;var b=this.images[a],c=this._imgRef[this.enFrameType.BMP],d=this._imgRef[this.enFrameType.SVG],e=this.elem.className.split(" ");c?(e.splice(e.indexOf(c),1),b[this.enFrameType.CORRUPT]&&(this.elem.className=e.join(" "))):d&&(this._svgUse.style.opacity=0);b[this.enFrameType.BMP]?this.elem.className=e.join(" ")+" "+b[1]:b[this.enFrameType.SVG]&&(c&&(this.elem.className=e.join(" ")),this._svgUse.setAttributeNS("http://www.w3.org/1999/xlink",
"xlink:href",this.isTemplateWgt?"#"+this.parentPage.prefix+b[this.enFrameType.SVG]:"#"+b[this.enFrameType.SVG]),this._svgUse.style.opacity=1);this._imgRef=b;return a};hmiMultiStateImage.prototype.destroy=function(){if(this.destroyed)return!1;this._imgRef=this._svgUse=this.images=null;this.animate&&this.stopAnimation();return hmiWidget.prototype.destroy.call(this)};$hmi.fn.hmiMultiStateImage=function(a,b,c,d){return new hmiMultiStateImage(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiMultiStateImage",hmiMultiStateImage);
function hmiNeedle(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.image=$("[data-widget='ImageWgt']",this.elem);this.draggingTimeOut=null;this.writeTagDelay=180;1==this.wrMode&&(this.ndlToolTip=document.getElementById(this.parentPage.wgtId+"_ndltooltip"));this._currMouseAction=-1;this.authCode=this.getAuthorizations();this.image[0]&&(this.imageW=parseFloat(this.image[0].style.width),this.imageH=parseFloat(this.image[0].style.height),this.imageX=parseFloat(this.image[0].style.left),this.imageY=
parseFloat(this.image[0].style.top));this.imageRot=0;this.image.attr("rot")&&(this.imageRot=parseFloat(this.image.attr("rot")));this.range=this.max-this.min;this.type="vertical"==this.form?1:"horizontal"==this.form?2:0;"vertical"==this.form?(this.offset=Math.floor(this.imageH/2),this.length=this.height-2*this.offset):"horizontal"==this.form?(this.offset=Math.floor(this.imageW/2),this.length=this.width-2*this.offset):this.type=0;this.value>this.max?this.value=this.max:this.value<this.min&&(this.value=
this.min);c.acceptClick&&(this.disabled=!1);c.disabled&&(this.disabled=c.disabled);this.handleEvent();this._renderMask|=this._renderFlags.VALUE;$hmi.addToRender(this)}hmiNeedle.prototype=Object.create(hmiWidget.prototype);hmiNeedle.prototype.constructor=hmiNeedle;hmiNeedle.prototype.backgroundClass="bgColor00";hmiNeedle.prototype.form="round";hmiNeedle.prototype.type=0;hmiNeedle.prototype.reverse=!1;hmiNeedle.prototype.min=0;hmiNeedle.prototype.max=100;hmiNeedle.prototype.startAngle=0;
hmiNeedle.prototype.stopAngle=90;hmiNeedle.prototype.initAngle=180;hmiNeedle.prototype.value=0;hmiNeedle.prototype._clickOffset=null;hmiNeedle.prototype.dragging=0;hmiNeedle.prototype.discrete=0;hmiNeedle.prototype.opacity=1;hmiNeedle.prototype.fill=null;hmiNeedle.prototype.stroke=null;hmiNeedle.prototype.disabled=!0;hmiNeedle.prototype.permission="rw";hmiNeedle.prototype.xformScaling=!0;hmiNeedle.prototype._renderMask=0;hmiNeedle.prototype._renderFlags={VALUE:1,FILL:2,STROKE:4,OPACITY:8,TOOLTIP:16};
hmiNeedle.prototype._mouseActionType={MOUSEDOWN:0,MOUSEMOVE:1,MOUSEUP:2};hmiNeedle.jmType="NeedleWgt";
hmiNeedle.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.VALUE&&this.updateNeedle();this._renderMask&this._renderFlags.TOOLTIP&&this.updateToolTip();this._renderMask&this._renderFlags.FILL&&$("."+this.backgroundClass,this.elem).css("fill",this.fill);this._renderMask&this._renderFlags.STROKE&&$("path",this.elem).attr("stroke",this.stroke);this._renderMask&this._renderFlags.OPACITY&&$("svg",this.elem).css("opacity",this.opacity);this._renderMask=
0};hmiNeedle.prototype.handleEvent=function(){this.events={mousedown:!0,touchstart:!0}};hmiNeedle.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);a.tgtWgt==this&&this.initDataLinkSideEffects(a,a.attr)};hmiNeedle.prototype.initDataLinkSideEffects=function(a,b){"value"==b&&(this.permission="rw"==a.rw||"w"==a.rw?"rw":"r")};
hmiNeedle.prototype.updateNeedle=function(){this.value=this.value>this.max?this.max:this.value;this.value=this.value<this.min?this.min:this.value;var a=this.max-this.min;if(0==this.type){var b=this.initAngle-this.startAngle,a=0!=a?(this.stopAngle-this.startAngle)*(this.value-this.min)/a:0,a=-b+a;this.image.css("transform","rotate("+a+"deg)");this.elem&&(this.elem.setAttribute("data-v",this.value),this.elem.setAttribute("data-a",a))}else 2==this.type?(b=this.width-this.imageW,a=0!=a?b*(this.value-
this.min)/a:0,this.reverse&&(a=this.width-a-this.imageW),this.image.css("left",a+"px"),this.elem&&(this.elem.setAttribute("data-v",this.value),this.elem.setAttribute("data-p",a))):1==this.type&&(b=this.height-this.imageH,a=0!=a?b*(this.value-this.min)/a:0,this.reverse&&(a=this.height-a-this.imageH),this.image.css("top",a+"px"),this.elem&&(this.elem.setAttribute("data-v",this.value),this.elem.setAttribute("data-p",a)))};
hmiNeedle.prototype.updateToolTip=function(){var a=null,b=!1;if(1==this.wrMode){if(this._currMouseAction==this._mouseActionType.MOUSEDOWN||this._currMouseAction==this._mouseActionType.MOUSEMOVE)b=!0,a={x:0,y:0},this.ndlToolTip.style.display="block";this._currMouseAction==this._mouseActionType.MOUSEUP&&(this.ndlToolTip.style.display="none")}switch(this.type){case 0:b&&(a.x=this.width/2,a.y=this.height/2);break;case 1:b&&(a.x=this.width,a.y=parseInt(this.image[0].style.top));break;case 2:b&&(a.x=parseInt(this.image[0].style.left),
a.y=-1)}b&&this.drawToolTipItem(a)};hmiNeedle.prototype.drawToolTipItem=function(a){a=this.calculatePointsInPageCoordinates(a);a="translateX("+Math.round(a.x)+"px) translateY("+Math.round(a.y)+"px)";$(this.ndlToolTip).css({"-ms-transform":a,"-webkit-transform":a,transform:a});this.ndlToolTip.childNodes[0].textContent=this.value};
hmiNeedle.prototype.calculatePointsInPageCoordinates=function(a){var b=!1,c=!1;2==this.type&&2>this.parentWidget.top-15&&(a.y+=this.height,b=!0);1==this.type&&this.parentWidget.left>this.parentPage.width/2&&(a.x-=this.width,c=!0);a=multiply(this.mtxChain,[[a.x],[a.y],[1]]);2!=this.type||b||(a[1][0]-=15);1==this.type&&c&&(a[0][0]-=15);return{x:this.offsets.left+a[0][0],y:this.offsets.top+a[1][0]}};
hmiNeedle.prototype.getParentsOffsets=function(){var a,b,c=this,d={top:0,left:0},e=!0;do if(a=isNaN(c.left)?0:c.left,b=isNaN(c.top)?0:c.top,isIdentityMatrix(c.mtx)&&(a*=this.mtxChain[0][0],b*=this.mtxChain[1][1]),d.top+=b,d.left+=a,c=c.parentWidget,c.constructor==hmiPage||c.constructor==hmiDialog)e=!1;while(e);return d};
hmiNeedle.prototype.setValue=function(a,b,c){var d=!1,e="#000";if("value"==a){if(this.isBadValue(b,!1,c))return!1;b=parseFloat(b,!1,c);if(isNaN(b))return!1;b>this.max?b=this.max:b<this.min&&(b=this.min);this.value!=b?(this.value=b,this._renderMask|=this._renderFlags.VALUE,d=!0,this.sendUpdate(a,this.value,c)):1==this.wrMode&&this._currMouseAction==this._mouseActionType.MOUSEUP&&(this._renderMask|=this._renderFlags.TOOLTIP,d=!0,this.sendUpdate(a,this.value,c))}else if("fill"==a)isNaN(b)?this.isBadValue(b,
!0,c)?(this.fill=e,d=!0):this.fill!=b&&(0==b.indexOf("#")&&1<b.length&&8>=b.length&&(e=b),this.fill=e,d=!0,this.sendUpdate(a,this.fill,c)):(d=!0,this.fill=e),d&&(this._renderMask|=this._renderFlags.FILL);else if("stroke"==a)isNaN(b)&&(this.isBadValue(b,!0,c)?(this.stroke=e,d=!0):this.stroke!=b&&(0==b.indexOf("#")&&1<b.length&&8>=b.length&&(e=b),this.stroke=e,d=!0,this.sendUpdate(a,this.stroke,c)),d&&(this._renderMask|=this._renderFlags.STROKE));else if("fill-opacity"==a){if(this.isBadValue(b,!1,c))return!1;
b=parseFloat(b);0>b?b=0:1<b&&(b=1);this.opacity!=b&&(this.opacity=b,d=!0,this._renderMask|=this._renderFlags.OPACITY,this.sendUpdate(a,this.opacity,c))}else if("min"==a)b=parseFloat(b),this.min!=b&&(this.min=b,this.range=this.max-this.min,d=!0,this._renderMask|=this._renderFlags.VALUE,this.sendUpdate(a,this.min,c));else if("max"==a)b=parseFloat(b),this.max!=b&&(this.max=b,this.range=this.max-this.min,d=!0,this._renderMask|=this._renderFlags.VALUE,this.sendUpdate(a,this.max,c));else if("numStates"==
a){if(this.isBadValue(b,!1,c))return!1;e=parseInt(b);this.max!=this.min+e-1&&(this.max=b,this.range=this.max-this.min,d=!0,this._renderMask|=this._renderFlags.VALUE,this.sendUpdate(a,e,c))}else if("reverseScale"==a){if(this.isBadValue(b,!1,c))return!1;b=parseInt(b);this.reverse!=b&&(this.reverse=b,d=!0,this._renderMask|=this._renderFlags.VALUE,this.sendUpdate(a,this.reverse,c))}else hmiWidget.prototype.setValue.call(this,a,b,c);d&&$hmi.addToRender(this)};
hmiNeedle.prototype.getValue=function(a){return"value"==a?this.value:this[a]?this[a]:hmiWidget.prototype.getValue.call(this,a)};hmiNeedle.prototype.updateThumbPosition=function(a,b){if(this.isBadValue(a,!1,b))return!1;a=parseFloat(a,!1,b);if(isNaN(a))return!1;a>this.max?a=this.max:a<this.min&&(a=this.min);this.value!=a?(this.value=a,this._renderMask=this._renderFlags.VALUE|this._renderFlags.TOOLTIP):this._renderMask|=this._renderFlags.TOOLTIP;$hmi.addToRender(this)};
hmiNeedle.prototype.doMouseDown=function(a,b){if(this.disabled||"r"==this.permission||this.authCode==this.umgr.wgtAuth.RDONLY)return!1;this._currMouseAction=this._mouseActionType.MOUSEDOWN;this._currTargetId=a.wgt.wgtId;this.dragging=1;var c;1==this.wrMode&&(this.mtxChain=GetParentTransform(this.elem),this.offsets=this.getParentsOffsets());1==this.type||2==this.type?(this._clickOffset={x:this.imageW/2,y:this.imageH/2},c={x:a.x-this._clickOffset.x,y:a.y-this._clickOffset.y},c=this._normValueFromMouseHV(c)):
c=this._normValueFromMouseRound({x:a.x,y:a.y});1==this.wrMode?this.updateThumbPosition(c,null):(this.setValue("value",c,null),this.doWriteValue("value",c))};hmiNeedle.prototype.doMouseUp=function(a,b){if(this.disabled||"r"==this.permission||this.authCode==this.umgr.wgtAuth.RDONLY)return!1;this._currMouseAction=this._mouseActionType.MOUSEUP;this._currTargetId=null;this.dragging=0;1==this.wrMode&&(this.setValue("value",this.value,null),this.doWriteValue("value",this.value));this._clickOffset=null};
hmiNeedle.prototype.doMouseMove=function(a,b){if(this.disabled||"r"==this.permission||this.authCode==this.umgr.wgtAuth.RDONLY)return!1;this._currMouseAction=this._mouseActionType.MOUSEMOVE;this.dragging=1;var c;1==this.type||2==this.type?(c={x:a.x-this._clickOffset.x,y:a.y-this._clickOffset.y},c=this._normValueFromMouseHV(c)):c=this._normValueFromMouseRound({x:a.x,y:a.y});1==this.wrMode?this.updateThumbPosition(c,null):(this.setValue("value",c,null),this._writeDraggingValues())};
hmiNeedle.prototype._writeDraggingValues=function(){var a=this;null==this.draggingTimeOut&&(this.doWriteValue("value",a.value),this.draggingTimeOut=setTimeout(function(){a.doWriteValue("value",a.value);a.draggingTimeOut=null},a.writeTagDelay))};hmiNeedle.prototype._normValueFromMouseHV=function(a){a=(1==this.type?a.y:a.x)/this.length;1<a?a=1:0>a&&(a=0);this.reverse&&(a=1-a);a=this.min+a*this.range;return 1==this.discrete?a.toFixed():a};
hmiNeedle.prototype._normValueFromMouseRound=function(a){a=180*Math.atan2(this.cy-a.y,a.x-this.cx)/Math.PI;var b=0>this.startAngle?-180-this.startAngle:null;a=((b?-180<a&&a<b?-180-a:180-a:180-a)-this.startAngle)*this.range/(this.stopAngle-this.startAngle)+this.min;if(a<this.min-.5||a>this.max+.5)a=this.value;this.discrete&&(a=Math.round(a));return a};hmiNeedle.prototype.destroy=function(){this.ndlToolTip=null;return hmiWidget.prototype.destroy.call(this)};
$hmi.fn.hmiNeedle=function(a,b,c,d){return new hmiNeedle(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiNeedle",hmiNeedle);
function hmiNumeric(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);a=this.elem.getElementsByTagName("span");this.border=this.stroke+"px solid "+this.strokeColor;this.fontSize=a[0].style.fontSize;this.fontColor=a[0].style.color;this.kpdType=c.keypad;this.parseFormat();this.defineFormat();var f=this;if(c=$hmi.getEventMgr())f=this,this.activateHandler=function(){f.events={mousedown:!0,touchstart:!0}},c.on(this.parentPage.elem,"loadWgt",this.activateHandler)}hmiNumeric.prototype=Object.create(hmiWidget.prototype);
hmiNumeric.prototype.constructor=hmiNumeric;hmiNumeric.prototype.rw="rw";hmiNumeric.prototype.format="#";hmiNumeric.prototype.decimalDigits=null;hmiNumeric.prototype.leadingDigits=null;hmiNumeric.prototype.decimalPlaces=null;hmiNumeric.prototype.value=null;hmiNumeric.prototype.min=null;hmiNumeric.prototype.max=null;hmiNumeric.prototype.frame=0;hmiNumeric.prototype.stroke=1;hmiNumeric.prototype.strokeColor="#000";hmiNumeric.prototype.backgroundColor=null;hmiNumeric.prototype.maskChar="*";
hmiNumeric.prototype.keypad=0;hmiNumeric.prototype.timeSpec=null;hmiNumeric.prototype.formatType=null;hmiNumeric.prototype.numericFormat=null;hmiNumeric.prototype.enFormatType={TEXT:0,NUMBER:1,DATETIME:2};hmiNumeric.prototype.enNumericType={INT:0,FLOAT:1,HEXL:2,HEXU:3,EXP:4,EXPD:5,THOUSAND:6};hmiNumeric.prototype._renderMask=0;hmiNumeric.prototype._keypadMask=0;hmiNumeric.prototype._renderFlags={VALUE:2,FRAME:4,FILL:8,FNSIZE:16,FRCOLOR:32,FRSIZE:64,FRFILL:128,KEYPAD:256,FOCUS:512};
hmiNumeric.prototype._renderKeypad={KEYPAD_DATE:2,KEYPAD_TIME:4,KEYPAD_NUM:8,KEYPAD_TXT:16,KEYPAD_HIDE:32};hmiNumeric.prototype.isPadding=!1;hmiNumeric.prototype.invokablePropsList=["value","min","max","fill","fontColor"];hmiNumeric.jmType="NumericWgt";hmiNumeric.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};
hmiNumeric.prototype.initDataLinkSideEffects=function(a,b){"value"==b&&(this.rw=a.rw,"w"==this.rw||"rw"==this.rw?this.timeSpec&&!Modernizr.inputtypes.date&&(0==$("#hmi-dtpop").children().length&&this.enableDateBox(),this.attachDTAttributes()):this.events={})};hmiNumeric.prototype.attachEvent=function(){this.timeSpec?Modernizr.inputtypes.date&&this.attachKeypadEvents():this.attachKeypadEvents()};
hmiNumeric.prototype.attachDTAttributes=function(){0<this.dateField.length&&this.dateField[0].setAttribute("data-field","date");0<this.timeField.length&&(this.timeField[0].setAttribute("data-field","time"),-1!=this.timeFormat.indexOf("A")?this.timeField[0].setAttribute("data-format",this.timeFormat+"A"):this.timeField[0].setAttribute("data-format",this.timeFormat))};hmiNumeric.prototype.enableDateBox=function(){$("#hmi-dtpop").DateTimePicker(this.addDTParameters())};
hmiNumeric.prototype.addDTParameters=function(){var a=this;return{buttonsToDisplay:["SetButton","HeaderCloseButton"],titleContentDate:"Set new date",titleContentTime:"Set new time",animationDuration:0,parseDateTimeString:function(a,c,d){d=d.parents()[1];var e=d.getAttribute("id"),e=$hmi.getWidget(e);this.wgtRef={mode:c,currElem:d,currWgt:e,orDateFormat:e.dateFormat,orTimeFormat:e.timeFormat,is12H:!1};this.wgtRef.orTimeFormat&&-1!=this.wgtRef.orTimeFormat.indexOf("hh")&&(this.wgtRef.is12H=!0);return moment(a,
"date"==c?this.wgtRef.orDateFormat:this.wgtRef.orTimeFormat).toDate()},formatDateTimeString:function(a){var c=this.wgtRef;if("date"==c.mode)return a=moment(a.dd+"-"+a.MM+"-"+a.yyyy,"DD-MM-YYYY"),a=a.format(c.orDateFormat);if("time"==c.mode)return a=c.is12H?moment(a.hh+":"+a.mm+":"+a.ss+" "+a.ME,"hh:mm:ss A"):moment(a.hour+":"+a.mm+":"+a.ss,"HH:mm:ss"),a=a.format(c.orTimeFormat)},settingValueOfElement:function(){a.updateValues(this)}}};
hmiNumeric.prototype.updateValues=function(a){var b=$(".hmi-date",a.wgtRef.currElem).text(),c=$(".hmi-time",a.wgtRef.currElem).text(),d,e;a=a.wgtRef;a.orDateFormat&&a.orTimeFormat?(d=a.orDateFormat,e=a.orTimeFormat):(a.orDateFormat||(d="",e=a.orTimeFormat),a.orTimeFormat||(e="",d=a.orDateFormat));b=moment(b+" "+c,d+" "+e).toDate();a.currWgt.setValue("value",b,null,0,!0);a.currWgt.doWriteValue("value",Math.round(a.currWgt.getTimeForSever()/1E3))};
hmiNumeric.prototype.doMouseUp=function(a,b){if($hmi.isTestModeActive()||this.getAuthorizations()!=this.umgr.wgtAuth.RDONLY)if("w"===this.rw||"rw"===this.rw)this.timeSpec?(b.target.classList.contains("hmi-date")&&null!=this.dateField&&Modernizr.inputtypes.date&&this.dataLinks&&0<this.countDataLinks()&&(this._renderMask|=this._renderFlags.KEYPAD,this._keypadMask|=this._renderKeypad.KEYPAD_DATE,$hmi.addToRender(this)),b.target.classList.contains("hmi-time")&&null!=this.timeField&&Modernizr.inputtypes.date&&
this.dataLinks&&0<this.countDataLinks()&&(this._renderMask|=this._renderFlags.KEYPAD,this._keypadMask|=this._renderKeypad.KEYPAD_TIME,$hmi.addToRender(this))):(this._renderMask|=this._renderFlags.KEYPAD,1==this.keypad?(this._keypadMask|=this._renderKeypad.KEYPAD_NUM,$hmi.addToRender(this)):2==this.keypad&&(this._keypadMask|=this._renderKeypad.KEYPAD_TXT,$hmi.addToRender(this)),this.elem.addEventListener("click",this.showKTime))};
hmiNumeric.prototype.destroy=function(){$hmi.getEventMgr().off(this.parentPage.elem,"loadWgt",this.activateHandler);return hmiWidget.prototype.destroy.call(this)};
hmiNumeric.prototype.showKeyPad=function(a,b){if(this.disabled)return!1;var c=this;if(document.getElementById("kpd"))return!1;this.constructor==hmiEditBoxWgt&&2==this.ebt&&(b="password");var d="<input type='"+b+"' name='nField' id='nField' autocapitalize='off' autofocus><br>",e=document.createElement("div");e.setAttribute("id","kpd");e.setAttribute("data-wgtid",this.wgtId);$hmi.modernBrowser&&e.setAttribute("class","hacklayer");e.innerHTML=d+"<button type='button' class='positive' name='save' id='save'><div class='img saveimg'></div>Save</button><button type='button' class='negative' name='discard' id='discard'><div class='img cancelimg'></div>Cancel</button>";
e.style.left=this.elem.style.left||0;e.style.top=this.elem.style.top||0;if(d=$(e.childNodes[0])){var f=0,g=parseFloat(this.elem.style.fontSize),h=parseFloat(this.elem.style.height),k=this.getVerticalAlignment();"middle"==k?f=h/2-g/2:"bottom"==k&&(f=h-g);$(e).css("margin-top",f+"px");d.css({width:this.elem.style.width,color:"#383838",backgroundColor:"#dfdfde",font:this.elem.style.font,fontSize:this.elem.style.fontSize,textAlign:this.elem.style.textAlign});d.attr("value",this._getCurrentKeyValue(a));
this._renderMask|=this._renderFlags.FOCUS}this.parentWidget.constructor==hmiGroup?(d=this.parentWidget,h=isNaN(d.left)?0:d.left,f=isNaN(d.top)?0:d.top,g=k=0,null!=d.scrollbar&&(k=d.scrollbar.offset.x,g=d.scrollbar.offset.y),h=h+parseFloat(e.style.left)-k,0>h&&(h=0),f=f+parseFloat(e.style.top)-g,0>f&&(f=0),e.style.left=h+"px",e.style.top=f+"px",e.appendAfter(d.elem),d.addActiveElement(e)):e.appendAfter(this.elem);$("#kpd #save").click(function(){var a=$("#nField"),b=a.attr("type"),d=a.val(),e=!0;"number"==
b&&(d=parseFloat(a.val()),d<c.min||d>c.max)&&(e=!1);e&&(d=c._formatInputValue(b,$.trim(d)),c.setValue("value",d,null,0,-1),a=c.value,c.formatType==c.enFormatType.DATETIME&&(a=Math.round(c.getTimeForSever()/1E3)),c.doWriteValue("value",a));c._renderMask|=c._renderFlags.KEYPAD;c._keypadMask|=c._renderKeypad.KEYPAD_HIDE;$hmi.addToRender(c)});$("#kpd #discard").click(function(){c._renderMask|=c._renderFlags.KEYPAD;c._keypadMask|=c._renderKeypad.KEYPAD_HIDE;$hmi.addToRender(c)});$("#kpd #nField").keyup(function(a){13===
a.keyCode?$("#save").click():27===a.keyCode&&$("#discard").click()});return!0};hmiNumeric.prototype.getVerticalAlignment=function(){var a=this.elem.childNodes[1].getAttribute("class");if(-1!=a.indexOf("align-top"))return"top";if(-1!=a.indexOf("align-middle"))return"middle";if(-1!=a.indexOf("align-bottom"))return"bottom"};
hmiNumeric.prototype._formatInputValue=function(a,b){if("date"==a||"time"==a){var c,d,e,f;"date"==a&&(e=moment(b,"YYYY-MM-DD").format(this.dateFormat),f=$(".hmi-time",this.elem).text());"time"==a&&(e=$(".hmi-date",this.elem).text(),f=b);this.dateFormat&&this.timeFormat?(c=this.dateFormat,d=this.timeFormat):(this.dateFormat||(c="",d=this.timeFormat),this.timeFormat||(d="",c=this.dateFormat));b=moment(e+" "+f,c+" "+d).toDate()}else 0<=this.format.search(/^0{0,1}#{1,3}h$/i)&&(b=parseInt("0x"+b)),null!==
this.min&&null!==this.max&&"none"!=this.format&&($.isNumeric(b)&&(b=parseFloat(b)),b=b<this.min||b>this.max||!$.isNumeric(b)?this.value:b);return b};hmiNumeric.prototype._getCurrentKeyValue=function(a){if(a.hasClass("hmi-date"))return moment(a.text(),this.dateFormat).format("YYYY-MM-DD");if(a.hasClass("hmi-time")){if(this.timeFormat&&-1!=this.timeFormat.indexOf("A")){var b;b=this.timeFormat.indexOf("A");return a.text().substring(0,b-1)}return moment(a.text(),this.timeFormat).format(this.timeFormat)}return a.text().trim()};
hmiNumeric.prototype.hideKeyPad=function(){$("#kpd").remove()};hmiNumeric.prototype.maskedValue=function(a){var b="";a=this.formatType==this.enFormatType.TEXT?a.length:this.formatText(a).toString().length;for(var c=0;c<a;c++)b+=this.maskChar;return b};hmiNumeric.prototype.writeText=function(a){null==a&&(a="");void 0!==this.elem.childNodes[1]&&(this.elem.childNodes[1].textContent=a)};
hmiNumeric.prototype.render=function(){hmiWidget.prototype.render.call(this);$hmi.modernBrowser&&(this.$elem.hasClass("hacklayer")||this.$elem.addClass("hacklayer"));if(this._renderMask&this._renderFlags.VALUE)if(this.formatType==this.enFormatType.TEXT)this.writeText(this.value);else if(this.formatType==this.enFormatType.NUMBER)this.masked?this.writeText(this.maskedValue(this.formatText(this.value))):this.writeText(this.formatText(this.value));else if(this.formatType==this.enFormatType.DATETIME){var a=
"",b="",c=moment(this.value);switch(this.timeSpec){case "local":c.utcOffset(moment().utcOffset());break;case "global":c.utcOffset(0);break;default:var d=__hmiSystemVars.getServerOffset();720<d&&(d-=65536);c.utcOffset(d)}this.dateFormat&&(a=c.format(this.dateFormat));this.timeFormat&&(b=c.format(this.timeFormat));c=this.elem.querySelector(".hmi-date");null!=c&&(c.textContent=a);a=this.elem.querySelector(".hmi-time");null!=a&&(a.textContent=b)}this._renderMask&this._renderFlags.FRAME&&(this.frame?(this.elem.style.border=
this.border,this.elem.style["background-color"]=this.backgroundColor):(this.elem.style.border="",this.elem.style["background-color"]=""));this._renderMask&this._renderFlags.FILL&&(this.elem.querySelector(".text").style.color=this.fontColor);this._renderMask&this._renderFlags.FNSIZE&&(this.elem.querySelector(".text").style.fontSize=this.fontSize);this._renderMask&this._renderFlags.FRCOLOR&&this.updateBorder();this._renderMask&this._renderFlags.FRSIZE&&this.updateBorder();this._renderMask&this._renderFlags.FRFILL&&
(this.elem.style.backgroundColor=this.backgroundColor);if(this._renderMask&this._renderFlags.KEYPAD){switch(this._keypadMask){case this._renderKeypad.KEYPAD_DATE:this.showKeyPad(this.dateField,"date");break;case this._renderKeypad.KEYPAD_TIME:this.showKeyPad(this.timeField,"time");break;case this._renderKeypad.KEYPAD_TXT:this.showKeyPad(this.$elem,"text");break;case this._renderKeypad.KEYPAD_NUM:this.showKeyPad(this.$elem,"number");break;case this._renderKeypad.KEYPAD_HIDE:this.hideKeyPad()}this._keypadMask=
0}this._renderMask&this._renderFlags.FOCUS&&(b=document.getElementById("nField"),b.focus(),b.select());this._renderMask=0};hmiNumeric.prototype.updateBorder=function(){this.border=this.stroke+"px solid "+this.strokeColor;this.$elem.css("border",this.border)};
hmiNumeric.prototype.setDateTimeValue=function(a,b,c){if(void 0==a)return!1;if(void 0==c||0==c||"string"==typeof c)c=-1;b=$.type(a);if("date"!=b)if("number"==b){if(a=new Date(1E3*a),"date"!=$.type(a))return!1}else a=a.toDate();this.value!==a&&(this.value=a,-1!=c&&__hmiSystemVars.setValue("System Time",Math.round(this.getTimeForSever()/1E3)),this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this));return!0};
hmiNumeric.prototype.setUnformatValue=function(a,b){return this.isBadValue(a,1,b)?!1:!0};hmiNumeric.prototype.setFormatValue=function(a,b){if(this.isBadValue(a,!1,b))return!1;this.value!==a&&(this.value=a,"boolean"==typeof a&&(this.value=1==a?1:0),this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this));return!0};hmiNumeric.prototype.validateColor=function(a){return void 0==a?!1:0==a.indexOf("#")&&1<a.length&&8>=a.length||"r"===a.charAt(0)&&"g"===a.charAt(1)&&"b"===a.charAt(2)?!0:!1};
hmiNumeric.prototype.addDecimalDigitsToFormat=function(a,b){a+=".";for(var c=0;c<b;c++)a+="#";return a};hmiNumeric.prototype.addLeadingDigitsToFormat=function(a,b){for(var c=1;c<b;c++)a="0"+a;return a};
hmiNumeric.prototype.getDynamicFormat=function(){var a=this.format,a=0<=a.indexOf("h")?"#h":0<=a.indexOf("H")?"#H":"#";""!==this.decimalDigits&&void 0!==this.decimalDigits&&"#"===a&&0<this.decimalDigits&&(a=this.addDecimalDigitsToFormat(a,parseInt(this.decimalDigits)));""!==this.leadingDigits&&void 0!==this.leadingDigits&&0<this.leadingDigits&&(a=this.addLeadingDigitsToFormat(a,parseInt(this.leadingDigits)));return a};
hmiNumeric.prototype.setValue=function(a,b,c,d,e){var f=!1,g="#000";if(null!=this.elem){if("value"==a){var h=this.value,g=!1;this.timeSpec?g=this.setDateTimeValue(b,c,e):(b instanceof Array&&(b=0>d||d>b.length?"":b[d]),g=this.setFormatValue(b,c));if(g)this.value!=h&&(b=this.value,this.value instanceof Date&&(b=this.value.getTime()/1E3),this.sendUpdate(a,b,c));else return!1}else if("usingFormat"==a)b!=this.format&&void 0!==b&&(this.format=b,this.parseFormat(),this.defineFormat(),this.sendUpdate(a,
this.format,c));else if("decimalDigits"==a)b!=this.decimalDigits&&void 0!==b&&(this.decimalDigits=b=10<b||0>b?this.decimalDigits:b,this.format=this.getDynamicFormat(),this.parseFormat(),this.defineFormat(),this.sendUpdate(a,this.decimalDigits,c));else if("leadingDigits"==a)b!=this.leadingDigits&&void 0!==b&&(this.leadingDigits=b=10<b||0>b?this.leadingDigits:b,this.format=this.getDynamicFormat(),this.parseFormat(),this.defineFormat(),this.sendUpdate(a,this.leadingDigits,c));else if("frame"==a){if(this.isBadValue(b,
!1,c))return!1;b=parseFloat(b);this.frame!=b&&(this.frame=b,this._renderMask|=this._renderFlags.FRAME,f=!0,this.sendUpdate(a,this.frame,c))}else if("min"==a){if(this.isBadValue(b,!1,c))return!1;parseFloat(b)!=this.min&&(this.min=parseFloat(b),this.sendUpdate(a,this.min,c))}else if("max"==a){if(this.isBadValue(b,!1,c))return!1;parseFloat(b)!=this.max&&(this.max=parseFloat(b),this.sendUpdate(a,this.max,c))}else if("fill"==a||"fontColor"==a)isNaN(b)&&(this.isBadValue(b,!0,c)?(this.fontColor=g,f=!0):
this.fontColor!=b&&(this.fontColor=this.validateColor(b)?b:g,f=!0,this.sendUpdate(a,this.fontColor,c))),f&&(this._renderMask|=this._renderFlags.FILL);else if("font-size"==a){if(this.isBadValue(b,!1,c))return!1;h=parseFloat(b);this.fontSize!=h&&(this.fontSize=parseFloat(b),this._renderMask|=this._renderFlags.FNSIZE,f=!0,this.sendUpdate(a,this.fontSize,c))}else if("frameColor"==a)isNaN(b)?this.isBadValue(b,!0,c)?(this.strokeColor=g,f=!0):this.strokeColor!=b&&(this.strokeColor=this.validateColor(b)?
b:g,f=!0,this.sendUpdate(a,this.strokeColor,c)):(this.strokeColor=g,f=!0),f&&(this._renderMask|=this._renderFlags.FRCOLOR);else if("frameSize"==a){if(this.isBadValue(b,!1,c))return!1;b=parseFloat(b);1>b&&(b=1);b!=this.stroke&&(this.stroke=b,this._renderMask|=this._renderFlags.FRSIZE,f=!0,this.sendUpdate(a,this.stroke,c))}else if("frameFill"==a)g="trasparent",isNaN(b)&&void 0!=b?this.isBadValue(b,!0,c)?(this.backgroundColor=g,f=!0):this.backgroundColor!=b&&(this.backgroundColor=this.validateColor(b)?
b:g,f=!0,this.sendUpdate(a,this.backgroundColor,c)):(this.backgroundColor=g,f=!0),f&&(this._renderMask|=this._renderFlags.FRFILL);else if("Index"==a)for(h in e=this.index=parseInt(b),this.dataLinks)b=this.dataLinks[h],d=b.dataSrc.getValue(b.tag),d instanceof Array&&!isNaN(e)&&b.attr!=a&&(e>d.length-1||0>e?this.setValue("value",d[e],new Quality(0),0,-1):this.setValue("value",d[e],c,0,-1));else"masked"==a?this.masked!=b&&(this.masked=b,this._renderMask|=this._renderFlags.VALUE,f=!0,this.sendUpdate(a,
this.masked,c)):hmiWidget.prototype.setValue.call(this,a,b,c,d);f&&$hmi.addToRender(this)}};hmiNumeric.prototype.getValue=function(a){return"value"==a?this.value instanceof Date?this.value.getTime()/1E3:this.value:"format"==a?this.format:"decimalDigits"==a?this.decimalDigits:"leadingDigits"==a?this.leadingDigits:"fill"==a||"fontColor"==a?this.fontColor?this.fontColor:this.elem.style.color:hmiWidget.prototype.getValue.call(this,a)};
hmiNumeric.prototype.getTimeForSever=function(){var a=this.value.getTime();switch(this.timeSpec){case "local":return a;case "global":return a-6E4*(new Date).getTimezoneOffset();case "server":return a-=6E4*__hmiSystemVars.getServerOffset(),a-6E4*(new Date).getTimezoneOffset()}};
hmiNumeric.prototype.defineFormat=function(){this.timeSpec?(this.dateField=$(".hmi-date",this.elem),this.timeField=$(".hmi-time",this.elem),Modernizr.inputtypes.date&&($("#"+this.wgtId+"_date").parent().css("display","none"),$("#"+this.wgtId+"_time").parent().css("display","none")),this.setValue("value",moment(),new Quality(0),0,-1)):"undefined"!=typeof this.value&&this.formatType!=this.enFormatType.TEXT&&(this._renderMask|=this._renderFlags.VALUE,$hmi.addToRender(this))};
hmiNumeric.prototype.formatText=function(a){switch(this.numericFormat){case this.enNumericType.INT:a=this.formatINTValue(a);break;case this.enNumericType.FLOAT:a=this.formatFLOATValue(a);break;case this.enNumericType.HEXL:a=this.formatHexadecimalValue(a);break;case this.enNumericType.HEXU:a=this.formatHexadecimalValue(a);break;case this.enNumericType.EXP:a=this.applyPadding(this.formatExponentialValue(a));break;case this.enNumericType.EXPD:a=this.formatEXPDvalue(a);break;case this.enNumericType.THOUSAND:a=
this.formatThousandSeparatorValue(a);break;default:a=this.applyPadding(a+"")}return a};hmiNumeric.prototype.applyPadding=function(a){if(!this.isPadding)return a;var b=this.format,c=a.indexOf("."),d=this.format.indexOf("h");0>d&&(d=this.format.indexOf("H"));var e="";0<=c?(e=a.slice(c,a.length),a=a.slice(0,c),b=this.format.slice(0,this.format.indexOf("."))):0<=d&&(b=this.format.slice(0,d));b=b.length;0<=this.format.indexOf("e")&&b--;for(c=0;c<b;c++)a.length<b&&(a="0"+a);return a+e};
hmiNumeric.prototype.formatINTValue=function(a){if(null!=a)return""===a||"string"==typeof a||"object"==typeof a?a:Math.round(a)+""};hmiNumeric.prototype.formatFLOATValue=function(a){if(null!=a)return"number"!=typeof a&&(a=parseFloat(a)),this.applyPadding(a.toFixed(this.decimalPlaces)+"")};
hmiNumeric.prototype.formatHexadecimalValue=function(a){var b=this.numericFormat==this.enNumericType.HEXL;a=parseInt(a);var c=0>a?!0:!1;a=0>a?0xfffffffffffff+a+1:a;a=b?a.toString(16):a.toString(16).toUpperCase();if(c&&16>a.length)for(var c=16-a.length,d=0;d<c;d++)a=b?"f"+a:"F"+a;return this.applyPadding(a)};
hmiNumeric.prototype.formatThousandSeparatorValue=function(a){a+="";var b="";0<=a.indexOf(".")&&(a=a.slice(0,a.indexOf(".")),b=a.slice(a.indexOf("."),a.length));for(var c="",d=0,e=a.length-1;0<=e;e--)2==d&&0<e?(c=","+a[e]+c,d=0):(c=a[e]+c,d++);return this.applyPadding(c+b)};hmiNumeric.prototype.formatExponentialValue=function(a){a=a.toExponential(this.decimalPlaces)+"";0<this.format.indexOf("E")&&(a=a.replace("e","E"));return a};
hmiNumeric.prototype.formatEXPDvalue=function(a){a=this.formatExponentialValue(a);var b=a.slice(a.indexOf("+")+1,a.length);10>b&&(a=a.slice(0,a.indexOf("+")+1)+"0"+b);return this.applyPadding(a)};
hmiNumeric.prototype.parseFormat=function(){if(this.timeSpec){this.formatType=this.enFormatType.DATETIME;this.sep=null;-1!=this.format.indexOf(" - ")?this.sep="-":-1!=this.format.indexOf("~")&&(this.sep="~");var a;a=this.sep?this.format.split(this.sep):[this.format];-1!=a[0].indexOf("Y")||-1!=a[0].indexOf("D")||-1!=a[0].indexOf("M")?(this.dateFormat=a[0].trim(),1<a.length&&(this.timeFormat=a[1].trim())):(this.timeFormat=a[0].trim(),1<a.length&&(this.dateFormat=a[1].trim()));this.timeFormat&&(-1!=
this.timeFormat.indexOf("AP")?(this.timeFormat=this.timeFormat.replace("AP","A"),this.timeFormat=this.timeFormat.replace("HH","hh")):this.timeFormat=this.timeFormat.replace("hh","HH"));this.dateFormat&&(this.dateFormat=this.dateFormat.toUpperCase())}else{if(""==this.format||"none"==this.format)this.formatType=this.enFormatType.TEXT;else if(this.formatType=this.enFormatType.NUMBER,"#"==this.format)this.numericFormat=this.enNumericType.INT;else{var b;b=0<this.format.indexOf("E");var c=0<this.format.indexOf("e");
b||c?(b?a=this.format.slice(1,this.format.indexOf("E")):c&&(a=this.format.slice(1,this.format.indexOf("e"))),c=this.format.slice(this.format.indexOf("+")+1,this.format.length),b=a.lastIndexOf("."),this.numericFormat=1<c.length?this.enNumericType.EXPD:this.enNumericType.EXP,this.decimalPlaces=this.format.substring(b,a.length).length-1):(b=this.format.lastIndexOf("."),a=0<=this.format.lastIndexOf(","),0<=b&&!a?(this.numericFormat=this.enNumericType.FLOAT,this.decimalPlaces=this.format.substring(b+1,
this.format.length).length):(0<this.format.indexOf("h")?this.numericFormat=this.enNumericType.HEXL:0<this.format.indexOf("H")&&(this.numericFormat=this.enNumericType.HEXU),a&&(this.numericFormat=this.enNumericType.THOUSAND)))}this.isPadding="0"==this.format.charAt(0)&&0<=this.format.lastIndexOf("#")}};$hmi.fn.hmiNumeric=function(a,b,c,d){return new hmiNumeric(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiNumeric",hmiNumeric);
function hmiPage(a,b,c){this.callbacks={};this.visible=!1;this.bgColor=this.fitCssTransform="";hmiWidget.call(this,a.wgtId,b,c,null,null);this.constructor==hmiPage&&($hmi.isProjectReady=!0,$hmi.currentPage=this,$hmi.setActivePage(this),pageMgr&&!pageMgr.isCurrentPageDefined()&&pageMgr.setCurrentPageFromName(this.wgtId));this.project=$hmi.activeProject;$hmi.addWidget(a.wgtId,this);this.elem&&null!=this.project&&(this.backgroundColor=a=this.elem.style.backgroundColor,2==this.project.getValue("bgColorOption")&&
this.project.setValue("color",a));this.templateWebId&&(this.templatePagePrefix=this.templateWebId.split("_")[0]);this.cntMtx=[[1,0,0],[0,1,0],[0,0,1]];this.top=this.left=0;this.constructor==hmiPage&&this.executeOnDemandFitToScreenSizeModality();this.elem&&this.loadFontsFace();$hmi.activeProject&&(this.sysVars=$hmi.activeProject.getWidget("_SysPropMgr",!0));this.ml=!0;this.linksList=[];$hmi.setFocusPage(this);$hmi.mouseMgr.loseFocus()}hmiPage.prototype=Object.create(hmiWidget.prototype);
hmiPage.prototype.constructor=hmiPage;hmiPage.prototype.callbacks=null;hmiPage.prototype.userValue=null;hmiPage.prototype.invokablePropsList=["id","Id"];hmiPage.prototype.dialog=0;hmiPage.prototype.sFactor=0;hmiPage.prototype.xPageOffset=0;hmiPage.prototype.yPageOffset=0;hmiPage.prototype.resizeTimer=null;hmiPage.prototype.resizeDialogTimer=null;hmiWidget.prototype.templateWebId=null;hmiPage.prototype.backgroundColor=null;hmiPage.prototype.mlPage=null;hmiPage.prototype._renderMask=0;
hmiPage.prototype._renderFlags={VISIBLE:1,REDRAW:2,BGCOLOR:4,REDRAWDLG:8,UPDATEPOS:16,APPLYMASK:32,APPLYDLGPARAMS:64,APPLYDLGHDR:128,APPLYFITTOSCREENSIZE:256};hmiPage.prototype._fitSelector={NONE:0,FITSIZE:1,FITPAGETOSCREENSIZE:2};hmiPage.prototype.isCached=!1;hmiPage.jmType="PageWgt";Object.defineProperty(hmiPage.prototype,"backgroundColor",{get:function(){return this.elem.style.backgroundColor},set:function(a){this.bgColor=a;this._renderMask|=this._renderFlags.BGCOLOR;$hmi.addToRender(this)}});
hmiPage.prototype.pageactivate=function(){this.onActivateActions();if(this.constructor==hmiPage&&(this.isCached&&$hmi.activeProject.getWidget("_TagMgr",!0).subscribePageGroups($hmi.activePage.wgtId),this.isCached&&this.constructor==hmiPage&&this.executeOnDemandFitToScreenSizeModality(),"changepassword"==this.studioId)){var a=$hmi.activeProject.getWidget("_UserGroupMgr",!0);a.clearAll();a.checkMessages()}if(this.isCached)for(var a=0,b=this.linksList.length;a<b;a++)this.linksList[a].update(),this.linksList[a].mount();
this.constructor==hmiPage&&$hmi.activeProject.activateDialogs()};hmiPage.prototype.registerLink=function(a){this.isCached||this.linksList.push(a)};
hmiPage.prototype.pagedeactivate=function(){var a=$hmi.activeProject.getWidget("_IndexedTagSetMgr",!0);$hmi.activeProject.getWidget("_TagMgr",!0).unsubscribePageGroups(this.wgtId);null!=a&&a.unsubscribePageGroups(this.wgtId);$hmi.activeProject.off("resize.page");for(var a=0,b=this.linksList.length;a<b;a++)this.linksList[a].unmount();this.visible=!1;this.tOnDeActivateActions();this.onDeActivateActions();this.executeActions()};
hmiPage.prototype.destroy=function(){hmiWidget.prototype.destroy.call(this);clearTimeout(this.resizeTimer);var a=this.xforms;if(a)for(var b in a)a[b].destroy();this.mlPage=this.mlTemplate=null;$hmi.wgts[this.wgtId]=null;this.project.removeGroupedButton(this.wgtId);this.linksList=null};
hmiPage.prototype.render=function(){hmiWidget.prototype.render.call(this);if(this._renderMask&this._renderFlags.VISIBLE){var a=document.getElementById("_"+this.wgtId);this.visible?(setVendorCSS(a,"Transform",this.fitCssTransform),setVendorCSS(a,"TransformOrigin","0px 0px")):setVendorCSS(a,"Transform","translateZ(0)scale(0)")}if(this._renderMask&this._renderFlags.REDRAW){switch(this.fitsize){case this._fitSelector.FITPAGETOSCREENSIZE:this.executeFitPageToScreenSize();break;case this._fitSelector.FITSIZE:case this._fitSelector.NONE:this.executeFitToSize()}this.forceRedraw=
!1}this._renderMask&this._renderFlags.BGCOLOR&&(this.elem.style.backgroundColor=this.bgColor);this._renderMask=0};
hmiPage.prototype.executeOnDemandFitToScreenSizeModality=function(){this.fitsize==this._fitSelector.FITSIZE&&(this.bgColor=this.elem.style.backgroundColor,this._renderMask|=this._renderFlags.BGCOLOR);this.fitsize==this._fitSelector.FITSIZE||this.fitsize==this._fitSelector.FITPAGETOSCREENSIZE?this.adaptToBrowserViewport($hmi.browserWindow.width,$hmi.browserWindow.height):(this.sFactor=1,this._renderMask|=this._renderFlags.REDRAW,$hmi.addToRender(this));this.bindResizeEvent();$hmi.activeProject.fitToScreenTransition&&
setTransition(this.elem,"none")};
hmiPage.prototype.executeFitToSize=function(){var a=document.getElementById("_"+this.wgtId),b=($hmi.browserWindow.width-this.width*this.sFactor)/2,c=($hmi.browserWindow.height-this.height*this.sFactor)/2;.1>b&&(b=0);.1>c&&(c=0);this.xPageOffset=b;this.yPageOffset=c;this.fitCssTransform="translateY( "+c+"px ) translateX( "+b+"px ) scale( "+this.sFactor+" )";this.cntMtx[0][0]=this.cntMtx[1][1]=this.sFactor;this.cntMtx[0][2]=b;this.cntMtx[1][2]=c;this.visible&&(setTransformOrigin(a,"left top"),setTransform(a,
this.fitCssTransform));a.style.position="absolute";a.style.left="0px";a.style.top="0px";this.executeGroupGridLayout()};
hmiPage.prototype.executeFitPageToScreenSize=function(){var a=document.getElementById("_"+this.wgtId);a.style.width=this.elem.style.width=this.width+"px";a.style.height=this.elem.style.height=this.height+"px";for(var b in this.wgts)if(a=this.wgts[b],a.elem&&a.parentWidget==this){var c=a.getParentBounds(this);a.setParentBounds(c.x*this.xScale,c.y*this.yScale,c.width*this.xScale,c.height*this.yScale,this)}};
hmiPage.prototype.executeGroupGridLayout=function(){for(var a in this.wgts){var b=this.wgts[a];b.elem&&b.parentWidget==this&&b.constructor==hmiGroup&&b.hasGridLayout()&&b.executeGridLayout()}};
hmiPage.prototype.bindResizeEvent=function(){var a=this;this.forceRedraw=!1;this.invalidateMtxChain();$hmi.activeProject.on("resize.page",function(b){clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(b,d){$hmi.activeProject.fitToScreenTransition?setTransition(a.elem,"0.3s"):setTransition(a.elem,"none");a.adaptToBrowserViewport(b,d);a.invalidateMtxChain()},100,b.width,b.height)})};
hmiPage.prototype.adaptToBrowserViewport=function(a,b){var c=this.getRatio(a,b);this.fitsize==this._fitSelector.FITSIZE?this.sFactor=Math.min(c.x,c.y):this.fitsize==this._fitSelector.FITPAGETOSCREENSIZE&&(this.width=a,this.height=b,this.xScale=c.x,this.yScale=c.y);this.forceRedraw=!0;this._renderMask|=this._renderFlags.REDRAW;$hmi.addToRender(this)};hmiPage.prototype.getRatio=function(a,b){return{x:0==this.width?0==a?1:a/1E-6:a/this.width,y:0==this.height?0==b?1:b/1E-6:b/this.height}};
hmiPage.prototype.getScaleFactors=function(){var a={x:1,y:1};this.sFactor&&(a.x=a.y=this.sFactor);this.xScale&&this.yScale&&(a.x=this.xScale,a.y=this.yScale);return a};hmiPage.prototype.isFitToSizeEnable=function(){return this.fitsize==this._fitSelector.FITSIZE?!0:!1};hmiPage.prototype.isFitPageToScreenSizeEnable=function(){return this.fitsize==this._fitSelector.FITPAGETOSCREENSIZE?!0:!1};
hmiPage.prototype.loadFontsFace=function(){void 0!=this.fonts&&0<this.fonts.length&&WebFont.load({custom:{families:this.fonts,urls:["/web/css/fonts.css"]}})};hmiPage.prototype.onActivateActions=function(){if(this.onActivate)for(var a=this.onActivate,b=0;b<a.length;b++)$hmi.doAction(this.wgtId,a[b])};hmiPage.prototype.tOnActivateActions=function(){if(this.tonActivate)for(var a=this.tonActivate,b=0;b<a.length;b++)$hmi.doAction(this.wgtId,a[b])};hmiPage.prototype.executeActions=function(){$hmi.actionMgr.doActions()};
hmiPage.prototype.onDeActivateActions=function(){if(this.onDeactivate)for(var a=this.onDeactivate,b=0;b<a.length;b++)$hmi.doAction(this.wgtId,a[b])};hmiPage.prototype.tOnDeActivateActions=function(){if(this.tonDeactivate)for(var a=this.tonDeactivate,b=0;b<a.length;b++)$hmi.doAction(this.wgtId,a[b])};hmiPage.prototype.setDialogElem=function(){this.dialog=(this.elem=document.getElementById(this.wgtId+"Dialog"))?1:0};
hmiPage.prototype.getEventWidgets=function(){var a=[],b;for(b in this.wgts)this.wgts[b].constructor==hmiEventBufferWgt&&a.push(this.wgts[b]);return a};hmiPage.prototype.initialUpdate=function(){for(var a in this.wgts){var b=this.wgts[a].dataLinks;if(b)for(var c in b){var d=b[c],e=d.dataSrc.getValue(d.tag);"object"!=typeof e&&0<=d.rw.indexOf("r")&&d.tgtWgt.setValue(d.attr,e)}}};
hmiPage.prototype.bindCWCallbacks=function(){for(var a in this.callbacks){var b=this.callbacks[a],c=b.callbackString.indexOf(".");-1!=c&&"this"==b.callbackString.substring(0,c)&&(b.fn=b.wgt.findJSFunction(b.callbackString.substring(c+1)))}};
hmiPage.prototype.bindJSCallback=function(a){for(var b in this.callbacks){var c=this.callbacks[b];if(c.wgt.constructor==hmiPage||a==c.wgt.isTemplateWgt){var d=c.callbackString.indexOf(".");if(-1!=d)if("this"==c.callbackString.substring(0,d))c.fn=c.wgt.findJSFunction(c.callbackString.substring(d+1));else try{c.fn=this.__eval__(c.callbackString)}catch(e){c.fn=null}else try{c.fn=this.__eval__(c.callbackString)}catch(f){c.fn=null}}}};
hmiPage.prototype.registerPageCallback=function(a,b){var c=a;b&&0==a.indexOf("this.")?c=":"+b.wgtId+":"+a:b.isTemplateWgt&&(c=this.templatePagePrefix+c);this.callbacks[c]||(this.callbacks[c]={callbackString:a,fn:null,wgt:b});return c};hmiPage.prototype.bindCWJSClass=function(){var a=$hmi.getActiveProject().getCWidgetMgr();a&&a.bindCWLogicClass(this)};
hmiPage.prototype.setValue=function(a,b,c,d){d=!1;if(null!=this.elem)switch(a){case "color":a="rgb(0,0,0)";isNaN(b)&&!this.isBadValue(b,!0,c)&&this.backgroundColor!=b&&(/^rgb\(\s*\d+,\s*\d+\s*,\s*\d+\s*\)$/.test(b)?a=b:b&&0==b.indexOf("#")&&1<b.length&&8>=b.length&&(a=b));this.backgroundColor!=a&&(this.backgroundColor=a,2==this.project.getValue("bgColorOption")&&this.project.setValue("color",a));break;case "visibility":case "visible":this.visible!=b&&(this._renderMask|=this._renderFlags.VISIBLE,this.forceRedraw&&
(this._renderMask|=this._renderFlags.REDRAW),this.visible=b,d=!0);default:hmiWidget.prototype.setValue.call(this,a,b,c)}d&&$hmi.addToRender(this)};hmiPage.prototype.getValue=function(a){return"backgroundColor"==a?this.backgroundColor:"id"==a||"Id"==a?this.studioId:hmiWidget.prototype.getValue.call(this,a)};hmiPage.prototype.addWidget=function(a,b){hmiWidget.prototype.addWidget.call(this,a,b);b.constructor==hmiPageMLTextMgr&&(b.isTemplateWgt?this.mlTemplate=b:this.mlPage=b)};
hmiPage.prototype.getPageMLTextMgr=function(){return this.mlPage};hmiPage.prototype.getTemplateMLTextMgr=function(){return this.mlTemplate};hmiPage.prototype.execTemplateJS=function(){if("undefined"!=typeof pagesJS){var a=this.templateWebId;if(a&&(a=pagesJS[a]))try{a()}catch(b){$hmi.showErrorMessage("Generated by template javascript:",b.message)}}};
hmiPage.prototype.execJS=function(){if(__project.isProjectReady()){if("undefined"!=typeof pagesJS){var a=pagesJS[this.wgtId];if(a)try{a()}catch(b){$hmi.showErrorMessage("Generated by page javascript:",b.message)}}}else{var c=this;setTimeout(function(){c.execJS()},100)}};hmiPage.prototype.show=function(){this.setValue("visibility",1,null)};hmiPage.prototype.addXForm=function(a,b){this.xforms||(this.xforms={});this.xforms[a]=b};hmiPage.prototype.getXForm=function(a){if(void 0!==this.xforms)return this.xforms[a]};
hmiPage.prototype.setCached=function(a){this.isCached=a};hmiPage.prototype.getProject=function(){return this.project};hmiPage.prototype.getTransformMatrix=function(){return this.cntMtx};hmiPage.prototype.hidePageContainer=function(){var a=this;requestAnimationFrame(function(){setVendorCSS(document.getElementById("_"+a.wgtId),"Transform","translateZ(0)scale(0)");a.visible=!1})};$hmi.fn.hmiPage=function(a,b,c){return new hmiPage(this,a,b,c)};$hmi.addWidgetDefinition("hmiPage",hmiPage);
function DialogHeader(a,b,c,d,e){if(null==e||""==e)e=b;var f=document.createElement("div"),g=document.createElement("div");f.setAttribute("data-role","dialog-header");f.setAttribute("id",a+"_header");g.setAttribute("id",a+"_title");g.className+=" hdr-title";g.appendChild(document.createTextNode(e));f.appendChild(g);e=document.createElement("div");var g=document.createElement("div"),h=document.createElement("a");e.id=a+"_close";e.className+=" round-button";g.className+=" round-button-circle";h.appendChild(document.createTextNode("X"));
g.appendChild(h);e.appendChild(g);f.style.position="absolute";f.style.width=c+"px";f.style.height=d+"px";f.style.backgroundColor="rgb( 223, 223, 223)";e.style.position="absolute";e.style.width="30px";e.style.left="7px";e.style.top="7px";f.appendChild(e);$(e).on("click",function(){$hmi.getAction("hmiActionCloseDialog").execute(a,{pg:b.toLowerCase()})});return f}
function hmiDialog(a,b,c){hmiPage.call(this,a,b,c);this.fitsize=$hmi.activePage.fitsize;this.dlgCont=document.getElementById(this.wgtId+"_content");this.dlgMain=document.getElementById("_"+this.wgtId);this.parentPage||(this.parentPage=$hmi.activePage);this._renderMask=this._renderFlags.APPLYMASK|this._renderFlags.APPLYDLGPARAMS;this.cntMtx=[[1,0,0],[0,1,0],[0,0,1]];this.fitsize==this._fitSelector.FITSIZE?(this.bindResizeDialogEvent(),this.adaptDialogToBrowserViewport()):(this.drawHeader(),this.updatePosition(),
this.checkGridLayoutGroups());this.inflateActiveDialogsArray()}hmiDialog.prototype=Object.create(hmiPage.prototype);hmiDialog.prototype.constructor=hmiDialog;hmiDialog.prototype.visible=!0;hmiDialog.prototype.hdrHeight=47;hmiDialog.jmType="DialogWgt";hmiDialog.prototype.inflateActiveDialogsArray=function(){$hmi.activeProject.addActiveDialogs(this)};
hmiDialog.prototype.render=function(){this._renderMask&this._renderFlags.UPDATEPOS&&this.runtimePosition();this._renderMask&this._renderFlags.APPLYMASK&&this.attachPointerEventMask(this.getLastActiveDialog());this._renderMask&this._renderFlags.APPLYDLGPARAMS&&this.setDialogParameters();this._renderMask&this._renderFlags.APPLYDLGHDR&&this.addHeader();this._renderMask&this._renderFlags.REDRAWDLG&&this.applyTransform();this._renderMask&this._renderFlags.APPLYFITTOSCREENSIZE&&hmiPage.prototype.executeGroupGridLayout.call(this);
hmiPage.prototype.render.call(this)};hmiDialog.prototype.applyTransform=function(){this.fitCssTransform="scale( "+$hmi.activePage.sFactor+" )";this.cntMtx[0][0]=this.cntMtx[1][1]=$hmi.activePage.sFactor;setTransformOrigin(this.dlgMain,"left top");setTransform(this.dlgMain,this.fitCssTransform)};
hmiDialog.prototype.bindResizeDialogEvent=function(){var a=this;$hmi.activeProject.on("resize."+this.wgtId,function(){clearTimeout(a.resizeDialogTimer);a.resizeDialogTimer=setTimeout(function(){a.adaptDialogToBrowserViewport();a.invalidateMtxChain()},100)})};hmiDialog.prototype.drawHeader=function(){this.titlebar&&void 0==this.headerElem&&(this._renderMask|=this._renderFlags.APPLYDLGHDR,$hmi.addToRender(this))};
hmiDialog.prototype.updatePosition=function(){this._renderMask|=this._renderFlags.UPDATEPOS;$hmi.addToRender(this)};hmiDialog.prototype.checkGridLayoutGroups=function(){this._renderMask|=this._renderFlags.APPLYFITTOSCREENSIZE;$hmi.addToRender(this)};hmiDialog.prototype.adaptDialogToBrowserViewport=function(){this.dlgMain&&(this.drawHeader(),this.updatePosition(),this.checkGridLayoutGroups(),this.fitsize==this._fitSelector.FITSIZE&&(this._renderMask|=this._renderFlags.REDRAWDLG,$hmi.addToRender(this)))};
hmiDialog.prototype.runtimePosition=function(){if(this.dynPos)this.xPosition=parseFloat(this.elem.getAttribute("px")),this.yPosition=parseFloat(this.elem.getAttribute("py"));else{var a=this.width,b=this.height;this.fitsize==this._fitSelector.FITSIZE&&(a*=$hmi.activePage.sFactor,b*=$hmi.activePage.sFactor);this.xPosition=$hmi.browserWindow.width/2-a/2;this.yPosition=$hmi.browserWindow.height/2-(b+this.hdrHeight)/2}b=a=0;this.dynPos&&(this.fitsize==this._fitSelector.NONE&&(a=($hmi.browserWindow.width-
this.parentPage.width)/2,b=0),this.fitsize==this._fitSelector.FITSIZE&&(a=this.parentPage.xPageOffset,b=this.parentPage.yPageOffset),0>a&&(a=0),0>b&&(b=0));this.left=a+this.xPosition;this.top=b+this.yPosition;this.dlgMain.style.left=this.left+"px";this.dlgMain.style.top=this.top+"px"};
hmiDialog.prototype.attachPointerEventMask=function(a){this.maskDiv||(this.maskDiv=document.createElement("div"),this.maskDiv.id="hmi-p-event-mask",this.maskDiv.style.position="absolute",this.maskDiv.style.width="100%",this.maskDiv.style.height="100%");this.removePointerEventMask();this.maskDiv.appendBefore(a)};
hmiDialog.prototype.setDialogParameters=function(){this.dlgMain.style.position="absolute";this.dlgMain.style.width=this.width+"px";this.dlgMain.style.height="auto";if(this.titlebar||"transparent"!=this.backgroundColor)this.titlebar&&(this.dlgCont.style.marginTop="46px",this.elem.style.position="relative"),this.dlgMain["box-shadow"]="1px 1px 20px #000000",this.dlgMain["-mozbox-shadow"]="1px 1px 20px #000000",this.dlgMain["-webkitbox-shadow"]="1px 1px 20px #000000"};
hmiDialog.prototype.enableDrag=function(){var a=this;$(this.dlgMain).draggable({handle:$("#"+this.headerElem.id),cursor:"move",drag:function(){var b=$(this)[0];a.left=parseFloat(b.style.left.split("px")[0]);a.top=parseFloat(b.style.top.split("px")[0]);a.xPosition=(a.left-a.pageXOff)/a.scaleFactor;a.yPosition=(a.top-a.pageYOff)/a.scaleFactor;a.invalidateMtxChain()}})};
hmiDialog.prototype.addHeader=function(){this.headerElem=new DialogHeader(this.wgtId,this.studioId,this.width,this.hdrHeight,this.elem.getAttribute("titlename"));this.headerElem.appendBefore(this.dlgCont);this.enableDrag()};hmiDialog.prototype._enablePagePointer=function(){var a=$hmi.activeProject.activeDialogs;0<a.length?(this.attachPointerEventMask(this.getLastActiveDialog()),this.changeFocusPage(a[a.length-1])):this.removePointerEventMask()};
hmiDialog.prototype.changeFocusPage=function(a){$hmi.focusPage=$hmi.getWidget(a)};hmiDialog.prototype.getLastActiveDialog=function(){var a=$hmi.activeProject.activeDialogs;if(0<a.length)return document.getElementById("_"+a[a.length-1])};hmiDialog.prototype.removePointerEventMask=function(){$("#hmi-p-event-mask").remove()};
hmiDialog.prototype.pagedeactivate=function(){var a=$hmi.activeProject.getWidget("_TagMgr",!0);$hmi.getEventMgr().trigger(this.elem,"unloadWgt");a.unsubscribePageGroups(this.wgtId);this.destroy()};hmiDialog.prototype.enablePointer=function(){this._enablePagePointer()};hmiDialog.prototype.closeDialog=function(){this.pagedeactivate()};
hmiDialog.prototype.destroy=function(){this.resizeDialogTimer=null;$hmi.activeProject.off("resize."+this.wgtId);$(this.dlgMain).remove();$("link[href='../css/pages/_"+this.wgtId+".css']").remove();hmiWidget.prototype.destroy.call(this)};hmiDialog.prototype.getOffsetTop=function(){return this.titlebar?this.fitsize==this._fitSelector.FITSIZE?this.hdrHeight*$hmi.activePage.sFactor:this.hdrHeight:0};hmiDialog.prototype.getOffsetLeft=function(){return 0};hmiDialog.prototype.getTransformMatrix=function(){return this.cntMtx};
hmiDialog.prototype.pageactivate=function(){$hmi.activeProject.getWidget("_TagMgr",!0).subscribePageGroups(this.wgtId);this.fitsize==this._fitSelector.FITSIZE&&this.bindResizeDialogEvent()};hmiDialog.prototype.stopLogic=function(){$hmi.activeProject.getWidget("_TagMgr",!0).unsubscribePageGroups(this.wgtId);$hmi.activeProject.off("resize."+this.wgtId)};hmiDialog.prototype.getDialogContainerElem=function(){return this.dlgMain?this.dlgMain:null};
$hmi.fn.hmiDialog=function(a,b,c){return new hmiDialog(this,a,b,c)};$hmi.addWidgetDefinition("hmiDialog",hmiDialog);var __hmiSystemVars=null;
function hmiSystemVars(a,b,c,d,e){this.srv=__project.getCommunticationObj();this.sysProp={};this.sysProp[this.PROPS.XSCREEN]=$hmi.browserWindow.width;this.sysProp[this.PROPS.YSCREEN]=$hmi.browserWindow.height;this.sysProp[this.PROPS.TIME]=new Date;this._systemTimeDelayTimer=this._pollTimer=null;this._timeoutSytemTime=3E5;hmiWidget.call(this,a.wgtId,b,c,d,e);__hmiSystemVars=this;var f=this;$hmi.isTestModeActive()||(this._requestTimeSettings().then(function(){f.startQuerying(f.PROPS.TIME)}),this.sysProp[this.PROPS.CONN_ST]=
$hmi.activeProject.getConnectionStatus());if(a=$hmi.activeProject.getWidget("_UserGroupMgr",!0))a.waitWgtReady().then(function(){f.trigger("um_login")}),a.subscribeWgt(this,function(a,b){f.trigger(a,b)});$hmi.activeProject.subscribeWgt(this,function(a,b){f.trigger(a,b)})}hmiSystemVars.prototype=Object.create(hmiWidget.prototype);hmiSystemVars.prototype.constructor=hmiSystemVars;hmiSystemVars.prototype.enabledVars={"System Time":!1,"X Screen resolution":!1,"Y Screen resolution":!1};
hmiSystemVars.prototype.PROPS={TIME:"System Time",XSCREEN:"X Screen resolution",YSCREEN:"Y Screen resolution",GROUP:"This Client Group-Name",USRNAME:"This Client User-Name",CONN_ST:"Connection status"};hmiSystemVars.prototype._pollingTime=1E3;hmiSystemVars.prototype.DLSSetting={};hmiSystemVars.jmType="SysPropMgrWgt";
hmiSystemVars.prototype.subscribeDataLink=function(a){hmiWidget.prototype.subscribeDataLink.call(this,a);var b=a.tag;this.enabledVars[b]?a.tgtWgt.setValue(a.attr,this.sysProp[b],null):this.startQuerying(b)};hmiSystemVars.prototype._requestTimeSettings=function(){var a=this;return this.srv.getDLSSettings().then(function(b){a.DLSSetting=b})};hmiSystemVars.prototype.getServerOffset=function(){if(0==this.DLSSetting.mode)return this.DLSSetting.stdoff;if(1==this.DLSSetting.mode)return this.DLSSetting.dlsoff};
hmiSystemVars.prototype.startXScreenWatch=function(){var a=this;$hmi.activeProject.on("resize.sysvar",function(){a.updateScreenSize("X")})};hmiSystemVars.prototype.startYScreenWatch=function(){var a=this;$hmi.activeProject.on("resize.sysvar",function(){a.updateScreenSize("Y")})};
hmiSystemVars.prototype.updateScreenSize=function(a){var b=0;"X"==a?(b=$hmi.browserWindow.width=this.sysProp[this.PROPS.XSCREEN]=window.innerWidth,this.sendUpdate(this.PROPS.XSCREEN,b)):"Y"==a&&(b=$hmi.browserWindow.height=this.sysProp[this.PROPS.YSCREEN]=window.innerHeight,this.sendUpdate(this.PROPS.YSCREEN,b))};
hmiSystemVars.prototype.setValue=function(a,b,c,d){"System Time"==a?("date"==$.type(b)?this.srv.setTime(Math.round(b.getTime()/1E3),!1):this.srv.setTime(b,!1),clearTimeout(this._systemTimeDelayTimer),this._systemTimeDelayTimer=null):a==this.PROPS.CONN_ST&&this.sendUpdate(prop,this.sysProp[this.PROPS.CONN_ST],c)};
hmiSystemVars.prototype.getValue=function(a){if(a!=this.PROPS.TIME||this.enabledVars[a]){if(a==this.PROPS.CONN_ST)return this.sysProp[this.PROPS.CONN_ST];switch(a){case this.PROPS.XSCREEN:return this.enabledVars[this.PROPS.XSCREEN]?this.sysProp[a]:$hmi.browserWindow.width;case this.PROPS.YSCREEN:return this.enabledVars[this.PROPS.YSCREEN]?this.sysProp[a]:$hmi.browserWindow.height;default:return this.sysProp[a]}}else return moment()};
hmiSystemVars.prototype.trigger=function(a){switch(a){case "c_status":a=$hmi.activeProject.getConnectionStatus();this.sysProp[this.PROPS.CONN_ST]!=a&&(this.sysProp[this.PROPS.CONN_ST]=a,this.sendUpdate(this.PROPS.CONN_ST,a,Tag.prototype.QUALITY_GOOD));break;case "um_login":a=$hmi.activeProject.getWidget("_UserGroupMgr",!0).getValue("username");var b=$hmi.activeProject.getWidget("_UserGroupMgr",!0).getValue("group");this.sysProp[this.PROPS.USRNAME]!=a&&(this.sysProp[this.PROPS.USRNAME]=a,this.sendUpdate(this.PROPS.USRNAME,
a,Tag.prototype.QUALITY_GOOD));this.sysProp[this.PROPS.GROUP]!=b&&(this.sysProp[this.PROPS.GROUP]=b,this.sendUpdate(this.PROPS.GROUP,b,Tag.prototype.QUALITY_GOOD))}};hmiSystemVars.prototype.isSystemVarsEnable=function(a){return this.enabledVars[a]};hmiSystemVars.prototype.setProps=function(a){};
hmiSystemVars.prototype.startDateTimePolling=function(){var a=this;null==this._systemTimeDelayTimer?this.srv.getTime(!1).then(function(b){"#S_OK"==b.status&&(b=new Date(b.time),a.sysProp["System Time"]=moment(b),a.sendUpdate("System Time",b));a._pollTimer=setTimeout(function(){a.startDateTimePolling()},a._pollingTime);a._systemTimeDelayTimer=setTimeout(function(){clearTimeout(a._systemTimeDelayTimer);a._systemTimeDelayTimer=null},a._timeoutSytemTime)}):(a.sysProp["System Time"]=a.sysProp["System Time"].add(1,
"seconds"),a.sendUpdate("System Time",a.sysProp["System Time"].clone().toDate()),a._pollTimer=setTimeout(function(){a.startDateTimePolling()},a._pollingTime))};
hmiSystemVars.prototype.startQuerying=function(a){var b=this;switch(a){case this.PROPS.TIME:this.startDateTimePolling();this.enabledVars[this.PROPS.TIME]=!0;break;case this.PROPS.XSCREEN:this.updateScreenSize("X");this.startXScreenWatch();this.enabledVars[this.PROPS.XSCREEN]=!0;var c=$hmi.getEventMgr();if(c){b=this;this.deactivateXHandler=function(){$hmi.activeProject.off("resize.sysvar");b.enabledVars[b.PROPS.XSCREEN]=!1;c.off(d,"unloadWgt",b.deactivateXHandler)};var d=$hmi.getActivePage().elem;
c.on(d,"unloadWgt",this.deactivateXHandler)}break;case this.PROPS.YSCREEN:this.updateScreenSize("Y"),this.startYScreenWatch(),this.enabledVars[this.PROPS.YSCREEN]=!0,c&&(b=this,this.deactivateYHandler=function(){$hmi.activeProject.off("resize.sysvar");b.enabledVars[b.PROPS.YSCREEN]=!1;c.off(d,"unloadWgt",b.deactivateYHandler)},d=$hmi.getActivePage().elem,c.on(d,"unloadWgt",this.deactivateYHandler))}};$hmi.fn.hmiSystemVars=function(a,b,c,d){return new hmiSystemVars(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiSystemVars",hmiSystemVars);
function hmiTable(a,b,c,d,e){this.columnsWgt=[];this._rowsToDisplay=[];this._previousRowsToDisplay=[];this.dataSrcs=[];this.alarmMgr=$hmi.activeProject.getWidget("_AlarmsMgr",!0);void 0!==c.filterString&&c.filterString!=this._defaultFilter&&(c.filterString=new RegExp(c.filterString,"i"));void 0!==c.filterString1&&(c.filterString1=new RegExp(c.filterString1,"i"));hmiWidget.call(this,a.wgtId,b,c,d,e);this.authCode=this.getAuthorizations();this.isTemplateWgt&&this.setIdForTemplate();this._headerColumns=
this.elem.getElementsByTagName("th");this.colsWidth=[];var f=this;this.firstRefresh=this.pageStart=!1;this.tbBGColor=this.elem.querySelector(".bodytable").style.backgroundColor;this.initializeTable();if(a=$hmi.getEventMgr())this.activateHandler=function(){f.load()},this.deactivateHandler=function(){f.unload()},a.on(this.parentPage.elem,"loadWgt",this.activateHandler),a.on(this.parentPage.elem,"unloadWgt",this.deactivateHandler);this.ml=!0}hmiTable.prototype=Object.create(hmiWidget.prototype);
hmiTable.prototype.constructor=hmiTable;hmiTable.prototype._defaultFilter="^((Not Triggered Acked|Not Triggered Not Acked|Triggered).*$)";hmiTable.prototype.filterString=/^((Not Triggered Acked|Not Triggered Not Acked|Triggered).*$)/i;hmiTable.prototype.filterString1=RegExp("");hmiTable.prototype.filterCol=0;hmiTable.prototype.filterCol1=null;hmiTable.prototype.defaultSortCol=0;hmiTable.prototype.enableSort=!1;hmiTable.prototype.sortOrder=1;hmiTable.prototype.filterChanged=!0;
hmiTable.prototype.timer=null;hmiTable.prototype.isActiveAlarm=null;hmiTable.prototype.autoRefresh=!1;hmiTable.prototype.nColumnEnable=0;hmiTable.prototype.colsWidth=null;hmiTable.prototype.clusterize=null;hmiTable.prototype.tbBGColor="#ffffff";hmiTable.prototype.bgColor="#fff";hmiTable.prototype.fgColor="#000";hmiTable.prototype.subscribed=!1;hmiTable.prototype._getBGColorFromAlCache=!1;hmiTable.prototype._getFGColorFromAlCache=!1;hmiTable.prototype._queuedRefreshReq=!1;
hmiTable.prototype.typeContainer={HISTORICAL:"historical",ACTIVE:"active"};hmiTable.prototype.invokablePropsList=["tableBGColor"];hmiTable.prototype._webkitCustomScrollV="WebKit/534.34";hmiTable.prototype._renderMask=0;hmiTable.prototype._renderFlags={REFRESH:1,BGCOLOR:2};hmiTable.jmType="TableWgt";
hmiTable.prototype.load=function(){this.nColumnEnable!=this.columnsWgt.length||this.firstRefresh||(this.refresh(this.autoRefresh),this.firstRefresh=!0);this.pageStart=!0;var a=this;this.headerClickHandler=function(b){a.orderRows(b.target)};for(var b=0,c=this._headerColumns.length;b<c;b++)this._headerColumns[b].setAttribute("data-colN",b),this.authCode!=this.umgr.wgtAuth.RDONLY&&this._headerColumns[b].addEventListener("click",this.headerClickHandler)};
hmiTable.prototype.orderRows=function(a){this._headerColumns[this.defaultSortCol].style.textDecoration="";this.defaultSortCol=parseFloat(a.getAttribute("data-colN"));this.sortOrder=this.sortOrder?0:1;this._headerColumns[this.defaultSortCol].style.textDecoration="underline";this.refresh(!1)};
hmiTable.prototype.unload=function(){for(var a=0,b=this._headerColumns.length;a<b;a++)this._headerColumns[a].removeEventListener("click",this.headerClickHandler);$(".hmi-msg",this.elem).off("click");this.stopRefresh();$("input:checkbox",this.elem).off("click");this.firstRefresh=!1;a=this.nColumnEnable=0;for(b=this.dataSrcs.length;a<b;a++)this.dataSrcs[a].unsubscribeWgt(this);this.subscribed=!1};
hmiTable.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.REFRESH&&this.refreshOnSourceChange();this._renderMask&this._renderFlags.BGCOLOR&&(this.elem.querySelector(".bodytable").style.backgroundColor=this.tbBGColor);this._renderMask=0};
hmiTable.prototype.columnReady=function(a){for(var b=this.columnsWgt.length,c=0;c<b;c++)if(this.columnsWgt[c].wgtId==a){this.nColumnEnable++;this.nColumnEnable==b&&this.pageStart&&!this.firstRefresh&&(this.firstRefresh=!0,this.refresh(this.autoRefresh));break}};
hmiTable.prototype.getValue=function(a){return"filterString"==a?this.filterString:"filterAttr"==a?(a=this.columnsWgt[this.filterCol])?a.getTagLinkedToValue():"":"filterString1"==a?this.filterString1:"filterAttr1"==a?(a=this.columnsWgt[this.filterCol1])?a.getTagLinkedToValue():"":hmiWidget.prototype.getValue.call(this,a)};hmiTable.prototype.addColumnWgt=function(a){this.colsWidth.push(a.getValue("width"));return this.columnsWgt.push(a)-1};
hmiTable.prototype.updateData=function(){$hmi.activePage.wgtId!=this.parentPage.wgtId&&this.parentPage.wgtId!=$hmi.focusPage.wgtId||this.refresh(this.autoRefresh)};hmiTable.prototype.updateSelectColumn=function(){this._updateCheckboxes()};hmiTable.prototype.setIdForTemplate=function(){var a=this.elem.children[0].firstChild,b=a.nextSibling,c=b.firstChild;$(a).attr("id","hdr_"+this.wgtId);$(b).attr("id","container_"+this.wgtId);$(c).attr("id","tbl"+this.wgtId)};
hmiTable.prototype.initializeTable=function(){var a=this.elem.children[0].firstChild,b=$(this.elem.firstElementChild),c=$hmi.browserScrollbarWidth,d=parseFloat(a.getAttribute("hdr-w")),e=0,f=40,g=$(a).next();-1!=navigator.userAgent.indexOf(this._webkitCustomScrollV)?($(this.elem.childNodes[1]).addClass("webkitbar"),g.addClass("webkitbar")):f=c;e="none"!=a.childNodes[0].style.display?this.height-28:this.height;b.scrollLeft(0);d>=this.width?g.css({height:e-c+"px",width:d+"px","padding-right":f+"px"}):
(g.css("width","100%"),g.css("height",e));this.authCode==this.umgr.wgtAuth.RDONLY&&(a=this.elem.getElementsByClassName("clusterize"),b=this.elem.getElementsByClassName("clusterize-scroll"),a[0].className+=" lockscrollx",b[0].className+=" lockscrolly")};
hmiTable.prototype.setValue=function(a,b,c,d){null!=this.elem&&(-1<a.indexOf("filterString")?void 0!==b&&(this[a]=new RegExp(b,"i"),this.filterChanged=!0,this.refresh(!1)):"tableBGColor"==a?this.isBadValue(b,!0,c)||this.tbBGColor==b||(this.tbBGColor="number"==typeof b?"#000":b,this._renderMask|=this._renderFlags.BGCOLOR,$hmi.addToRender(this)):"bgColor"==a?this._getBGColorFromAlCache||this.isBadValue(b,!0,c)||this.bgColor==b||(this.bgColor="number"==typeof b?"#000":b,this._renderMask|=this._renderFlags.REFRESH,
$hmi.addToRender(this)):"fgColor"!=a||this._getFGColorFromAlCache||this.isBadValue(b,!0,c)||this.fgColor==b||(this.fgColor="number"==typeof b?"#000":b,this._renderMask|=this._renderFlags.REFRESH,$hmi.addToRender(this)))};hmiTable.prototype.refreshRequest=function(){var a=this;0==this._queuedRefreshReq&&(this._queuedRefreshReq=!0,setTimeout(function(){a.refresh(!1);a._queuedRefreshReq=!1},0))};
hmiTable.prototype.hideColumn=function(a){var b=this.elem.querySelector(".bodytable").getElementsByTagName("th");null!=b&&null!=b[a]&&"none"!=b[a].style.display&&(b[a].style.display="none")};
hmiTable.prototype.refresh=function(a){var b=this;if(this.elem){this.tableContent=[];this.isSourceChanged=!1;0<this.columnsWgt.length&&(this._previousRowsToDisplay=this._rowsToDisplay.slice(),this._filterColumn(),this._sortColumn());0==this._rowsToDisplay.length&&0<this._previousRowsToDisplay.length&&(this.isSourceChanged=!0);this.rowStyle=Array(this._rowsToDisplay.length);for(var c=this._rowsToDisplay.length,d=this.columnsWgt.length,e=0;e<d;e++){this.tableContent[e]=[];for(var f=0;f<c;f++){var g=
this.columnsWgt[e];"alSelect"==g.dataLinkTag&&(this.checkboxColumnWgt=g);if(g.hasChanged||this.filterChanged||this._rowsToDisplay[f]!=this._previousRowsToDisplay[f])this.isSourceChanged=!0;var h=this._rowsToDisplay[f],k=g.getValue("value",h),l="text-overflow:ellipsis;";0==g.visible&&(l+="display:none;");switch(g.type){case 2:l+="text-align:center;word-break:break-all;";g.getQuality(h).isQualityGood()?(k="<input type='checkbox' data-datalink='"+g.getTagLinkedToValue()+"' data-tableid=\""+this.elem.id+
'" data-dataref="'+g.getDataReference(h)+'" '+(k?"checked=true":""),this.authCode==this.umgr.wgtAuth.RDONLY&&(k+=" disabled "),k+=" />"):k="<div class='bad align-center' style='position:relative'></div>";this.tableContent[e][f]='<td style="'+l+'">'+k+"</td>";break;case 4:this.tableContent[e][f]=l?'<td style="'+l+'">':"<td>";var n,l=typeof k;"string"==l||"number"==l?n=new Date(k):"undefined"!=typeof k&&(n=new Date(k.format()));n=this.isActiveAlarm?this.getLocalDate(n):new Date(k);k=(new DateFormat(n,
g.numberFormat)).formatDateTimeValue();this.tableContent[e][f]+=k;this.tableContent[e][f]+="</td>";break;case 5:this.tableContent[e][f]=l?'<td style="'+l+'">':"<td>";k&&"object"==typeof k&&(k=document.createElement("div"),$(k).css({width:"15px",height:"15px",margin:"0 auto",display:"block","background-size":"contain",opacity:"0.7"}),k.setAttribute("class",g.imgPath+" hmi-img"),k.setAttribute("data-dataref",g.getDataReference(h)),this.tableContent[e][f]+=k.outerHTML);this.tableContent[e][f]+="</td>";
break;default:this.tableContent[e][f]=l?'<td style="'+l+'">':"<td>",this.tableContent[e][f]=k instanceof Date?this.tableContent[e][f]+k.getTime():this.tableContent[e][f]+(void 0===k?"":k),this.tableContent[e][f]+="</td>"}"alState"!=g.getTagLinkedToValue()||this.rowStyle[f]||(this.rowStyle[f]=[2],this.isActiveAlarm?(this.rowStyle[f][0]=[this.alarmMgr.alarmCache.BGColor[h],this.alarmMgr.alarmCache.FGColor[h]],this.rowStyle[f][1]=this.alarmMgr.alarmCache.blink[h]):(k=g.dataLinkSrc.getAlarmNameByIndex(h),
h=g.dataLinkSrc.getAlarmStateCodeByIndex(h),this.rowStyle[f][0]=[this.alarmMgr.getBGColor(k,h),this.alarmMgr.getFGColor(k,h)],this.rowStyle[f][1]=!1));g.hasChanged=!1}}this._renderMask|=this._renderFlags.REFRESH;$hmi.addToRender(this);a&&(this.timer=setTimeout(function(){b.refresh()},3E3))}};
hmiTable.prototype.refreshOnSourceChange=function(){if(this.isSourceChanged){var a=[],b,c,d,e=this._rowsToDisplay.length,f=this.typeContainer.HISTORICAL;for(c=0;c<e;c++){b="<tr";d=this.bgColor;this._getBGColorFromAlCache&&(d=this.rowStyle[c][0][0]);var g=this.fgColor;this._getFGColorFromAlCache&&(g=this.rowStyle[c][0][1]);b+=' style="background-color:'+d+";color:"+g+';"';this.rowStyle[c][1]&&(b+=' class="blink"');this.isActiveAlarm&&(f=this.typeContainer.ACTIVE);b+=">";for(d=0;d<this.columnsWgt.length;d++)b+=
this.tableContent[d][c];b+="</tr>";a.push(b)}b=this.elem.querySelector(".bodytable").id;var h=this;null==this.clusterize?this.clusterize=new Clusterize({rows:a,scrollId:b,contentId:f+"_"+h.elem.id,rows_in_block:20,blocks_in_cluster:3,show_no_data_row:!1,callbacks:{clusterChanged:function(){h.isActiveAlarm&&(h._updateCheckboxes(),h._updateUserActions())},clusterWillChange:function(){h.isActiveAlarm&&(h._unbindCheckboxes(),h._unbindUserActions())}}}):this.clusterize.update(a);if(this.authCode!=this.umgr.wgtAuth.RDONLY)$(":checkbox",
this.elem).on("click",this._updateManager())}this.filterChanged=!1};hmiTable.prototype._setUserAction=function(a,b){var c=__alarmsMgr.getAlarmByName(a).usrAct,d;for(d in c)if(c[d].t==$hmi.actionMgr.enActionType.JS)$hmi.doAction(b,c[d]);else{var e=$hmi.getAction("hmiAction"+c[d].c);e.setParameters(c[d]);$hmi.doAction(b,e)}};
hmiTable.prototype._updateUserActions=function(){var a=this;if(this.authCode!=this.umgr.wgtAuth.RDONLY)$(".hmi-img",this.elem).on("click",function(){a._setUserAction($(this).data("dataref"),a.elem.id)})};hmiTable.prototype._unbindUserActions=function(){$(".hmi-img",this.elem).off()};hmiTable.prototype.clear=function(){null!=this.clusterize&&this.clusterize.update([])};
hmiTable.prototype._updateCheckboxes=function(){var a,b,c,d=$("input:checkbox[data-datalink]");this.checkboxColumnWgt&&(this.checkboxColumnWgt.hasChanged=!0);if(this.authCode!=this.umgr.wgtAuth.RDONLY)$(":checkbox",this.elem).on("click",this._updateManager());if(null!=this.clusterize){a=d.length;for(var e=0;e<a;e++)b=d[e].getAttribute("data-dataref"),c=d[e].getAttribute("data-datalink"),__alarmsMgr.getAlarmByName(b)[c]?d[e].setAttribute("checked",!0):d[e].removeAttribute("checked")}};
hmiTable.prototype._unbindCheckboxes=function(){$(":checkbox",this.elem).off()};hmiTable.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.getAttribute())};
hmiTable.prototype.initDataLinkSideEffects=function(a,b){this.dataSrcs.push(a.dataSrc);if(0==this.subscribed){this.isActiveAlarm=a.dataSrc.constructor==hmiAlarmsMgr;var c=$("tbody",this.elem);this.isActiveAlarm?c.attr("id",this.typeContainer.ACTIVE+"_"+this.elem.id):c.attr("id",this.typeContainer.HISTORICAL+"_"+this.elem.id);a.dataSrc.subscribeWgt(this,function(){});this.subscribed=!0}var c=a.getDataSrc().constructor,d=a.getTag();if("BGColor"==d&&"bgColor"==b&&c==hmiAlarmsMgr||"alBGColor"==d&&"bgColor"==
b&&c==hmiEventBufferWgt)this._getBGColorFromAlCache=!0;if("FGColor"==d&&"fgColor"==b&&c==hmiAlarmsMgr||"alFGColor"==d&&"fgColor"==b&&c==hmiEventBufferWgt)this._getFGColorFromAlCache=!0};hmiTable.prototype.addBlink=function(a){var b,c;if("activeTable"==this.typeTable){for(var d=0;d<this._rowsToDisplay.length;d++)this._rowsToDisplay[d]==a&&(c=d+1);a=$(this.elem).find("tr").eq(c).children();b=a.not("td:nth-child(1)").not("td:nth-child(8)");$(b).fadeToggle(700,function(){$(b).fadeToggle(800)})}};
hmiTable.prototype.stopRefresh=function(){"number"==typeof this.timer&&(clearTimeout(this.timer),delete this.timer)};
hmiTable.prototype._filterColumn=function(){this._rowsToDisplay=[];if(this.columnsWgt[0].isEmpty())return!1;for(var a=0;a<this.columnsWgt[0].value.length;a++){var b=!1;if(""==this.filterString||this.filterString.test(this.columnsWgt[this.filterCol].value[a]))null==this.filterCol1?b=!0:this.filterString1.test(this.columnsWgt[this.filterCol1].value[a])&&(b=!0);b?this._rowsToDisplay.push(a):(b=this.getDatalink("selectionAttr"))&&b.dataSrc.constructor==hmiAlarmsMgr&&b.dataSrc.updateAlarmByIndex(a,b.tag,
!1)}return!0};
hmiTable.prototype._sortColumn=function(){for(var a=[],b={},c=0,d=!0,c=0;c<this._rowsToDisplay.length;c++){if(this.enableSort)b=this.columnsWgt[this.defaultSortCol].value[this._rowsToDisplay[c]];else if(b=this.columnsWgt[this.defaultSortCol].getSrcLinkedToValue().getUnorderedPosition(this._rowsToDisplay[c]),null==b){d=!1;break}b={index:this._rowsToDisplay[c],value:b};a.push(b)}if(d){var e=this.sortOrder,f=this.enableSort;a.sort(function(a,b){if(f&&1==e){var c=b;b=a;a=c}return"string"==typeof a.value?
a.value.localeCompare(b.value):a.value-b.value});for(c=0;c<this._rowsToDisplay.length;c++)this._rowsToDisplay[c]=a[c].index}};hmiTable.prototype.deleteTable=function(a){if(0==a)$("table tbody",this.elem).children().remove();else for(var b=$("table tr",this.elem).length-1,c=a;c<b;c++)$("table tbody tr:eq("+a+")",this.elem).remove()};
hmiTable.prototype._updateManager=function(){return function(){var a=$(this);a.prop("checked",this.checked);var b=a.data("dataref"),a=a.data("datalink");"alSelect"==a?__alarmsMgr.setSelectAlarm(b,this.checked):"alEnable"==a&&__alarmsMgr.setEnableAlarm(b,this.checked)}};hmiTable.prototype._tableRowToAlarmIndex=function(a){return this._rowsToDisplay[a]};hmiTable.prototype.getLocalDate=function(a){if(void 0===a)return new Date(0);var b=moment().utcOffset();return new Date(a.getTime()+6E4*b)};
hmiTable.prototype.updateLanguage=function(){var a=this.getPageMLTextMgr(),b=a.getCurrentFont(),c=$(".text",this.elem);b&&$("#container_"+this.wgtId).css("font-family",b);for(var b=0,d=c.length;b<d;b++){var e=c[b].getAttribute("data-textid"),e=a.getText(e);null!=e&&(c[b].childNodes[0].textContent=e)}};
hmiTable.prototype.destroy=function(){if(this.destroyed)return!1;this._headerColumns=null;this.clusterize&&(this.clusterize.destroy(!0),this.clusterize=null);this.isActiveAlarm&&(this._unbindCheckboxes(),this._unbindUserActions());var a=$hmi.getEventMgr();a.off(this.parentPage.elem,"loadWgt",this.activateHandler);a.off(this.parentPage.elem,"unloadWgt",this.deactivateHandler);this.alarmMgr=this._rowsToDisplay=this._previousRowsToDisplay=this.tableContent=this.rowStyle=this.dataSrcs=null;return hmiWidget.prototype.destroy.call(this)};
$hmi.fn.hmiTable=function(a,b,c,d){return new hmiTable(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTable",hmiTable);var __project=null,project=null;
function hmiProject(a,b,c){"undefined"!=typeof c.modernBrowser&&($hmi.modernBrowser=c.modernBrowser);this.status=0;$hmi.init();this.bindToWindowEvent();$hmi.cache.clear();this.pageMgr=this.trendMgr=this.tagMgr=null;this.projectName=c.projectName;this.maxBandwidth=c.maxBandwidth;this.connectionMode=c.connectionMode;this.iconStatusDelay=c.webSysIconDelay;$hmi.isTestModeActive()||(this.initServerInterface(),this.srv.requestConf());hmiPage.call(this,a,b,c);$hmi.setActivePage(this);1==this.bgColorOption&&
(this._renderMask|=this._renderFlags.BGCOLOR,$hmi.addToRender(this));a=this.getScrollbarSize();$hmi.browserScrollbarWidth=a.width;$hmi.browserScrollbarHeight=a.height;50>this.pollRate?this.pollRate=50:1E4<this.pollRate&&(this.pollRate=1E4);if(0>this.timeout||864E5<this.timeout)this.timeout=0;$hmi.startInActivityTimer(this.timeout,function(){$hmi.getAction("hmiActionLogOut").execute()});$hmi.activeProject=__project=this;project=new hmiIProject(this);if(!$hmi.isTestModeActive()){var d=this;this.srv.getConf("propsMap.json").then(function(a){d.props=
a["propsMap.json"]})}this.activeDialogs=[];this._dlgInfo={};this.projectReady=!1;void 0!==CWidgetMgr&&(this.cWidgetMgr=new CWidgetMgr(this));this.cpAnimation=!1;this.cpAnimationOnCache=!0;this.pagesCacheSize=$hmi.limitPages;this.fitToScreenTransition=!0;this.defs=$hmi.defs;this.actMgr=$hmi.actionMgr}hmiProject.prototype=Object.create(hmiPage.prototype);hmiProject.prototype.props=null;hmiProject.prototype.pollRate=3E3;hmiProject.prototype.timeout=6E5;hmiProject.prototype.connstatus=1;
hmiProject.prototype.connectionMode=0;hmiProject.prototype.timeout=6E5;hmiProject.prototype._callbacks={};hmiProject.prototype._webPageSync=null;hmiProject.prototype.curURL=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1);hmiProject.prototype.color="none";hmiProject.prototype._renderMask=0;hmiProject.prototype._renderFlags={BGCOLOR:1};hmiProject.jmType="ProjectWgt";hmiProject.prototype.constructor=hmiProject;
hmiProject.prototype.initServerInterface=function(){if(!$hmi.isTestModeActive()){this.curURL=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1);var a=(new ServerInterface).getServerConf();a.projectName=this.projectName;a.maxBandwidth=this.maxBandwidth;a.connectionMode=this.connectionMode;this.ttl=a.ttl;$hmi.initServerInterface(a);this.srv=$hmi.serverInterface;var b=this;setInterval(function(){var a=b.srv.isSessionAlive();2==a.status&&$hmi.loadLoginPage();1==a.status&&0==b.connstatus&&
(b._hideStatusBar(),b.connstatus=1,b.sendNotification("c_status"));0==a.status&&1==b.connstatus&&(b._showStatusBar(),b.connstatus=0,b.sendNotification("c_status"));1==a.status&&b.projectName.toLowerCase()!=a.projectName.toLowerCase()&&-1==a.projectName.indexOf("_SIMULATOR_")&&$hmi.loadLoginPage()},this.ttl)}};hmiProject.prototype.getConnectionStatus=function(){return this.connstatus};
hmiProject.prototype._showStatusBar=function(){var a="#_"+$hmi.activePage.wgtId,b=$(".connstatus",a),c={display:"block","z-index":1},d=$hmi.activePage;d&&(d.isFitToSizeEnable()?($(".title",a).css("width","100%"),$("div[ data-role='header' ]",a).css({position:"absolute",width:"150px",height:"22px","border-width":"thin",left:$hmi.activePage.width/2-75+"px"}),b.css({position:"absolute",transform:"scale(0.6)",margin:"0px 65px"})):(c.left=d.elem.style.left,c["margin-left"]=d.elem.style.marginLeft));b.removeClass("active").addClass("broken").parent().css(c)};
hmiProject.prototype._hideStatusBar=function(){$(".connstatus","#_"+$hmi.activePage.wgtId).removeClass("broken").addClass("active").parent().css({display:"none","z-index":0})};hmiProject.prototype.hideLoadingPage=function(){var a=document.getElementById("_loading_");a&&$(a).remove()};
hmiProject.prototype.getScrollbarSize=function(){var a=document.body,b=document.createElement("div"),c=document.createElement("div");b.setAttribute("style","width:50px;height:50px;position:absolute;overflow:scroll;");b.appendChild(c);c.setAttribute("style","width:100px;height:100px;");a.appendChild(b);var c=b.offsetWidth-b.clientWidth,d=b.offsetHeight-b.clientHeight;a.removeChild(b);return{width:c,height:d}};
hmiProject.prototype.addActiveDialogs=function(a){this._dlgInfo[a.wgtId]?this._dlgInfo[a.wgtId].enable=!0:(this.activeDialogs.push(a.wgtId),this._dlgInfo[a.wgtId]={wgt:a,enable:!0})};hmiProject.prototype.removeActiveDialogs=function(a){var b=this.activeDialogs.indexOf(a);-1!=b&&(this.activeDialogs.splice(b,1),delete this._dlgInfo[a])};hmiProject.prototype.getActiveDialogsLength=function(){return this.activeDialogs.length};hmiProject.prototype.getActiveDialogs=function(){return this._dlgInfo};
hmiProject.prototype.hasActiveDialogs=function(){return 0<this.activeDialogs.length};hmiProject.prototype.isActiveDialog=function(a){return-1!=this.activeDialogs.indexOf(a)};hmiProject.prototype.closeAllDialogs=function(){for(var a=this.activeDialogs.length-1;0<=a;a--)this.closeDialog(this.activeDialogs[a]);this.activeDialogs=[];this._dlgInfo={};$(window).off("load.dialog orientationchange.dialog resize.dialog")};
hmiProject.prototype.activateDialogs=function(){for(var a=0;a<this.activeDialogs.length;a++){var b=this.activeDialogs[a],c=$hmi.getWidget(b),d=c.getDialogContainerElem();document.getElementById("container").appendChild(d);this._dlgInfo[b].enable||($hmi.setFocusPage(c),this._dlgInfo[b].enable=!0,$hmi.getEventMgr().trigger($hmi.getFocusPage().getHTMLElement(),"loadWgt"),c.show(),c.execJS(),c.pageactivate())}};
hmiProject.prototype.closeDialog=function(a){var b=this.activeDialogs.indexOf(a);-1!=b&&(b=this._dlgInfo[this.activeDialogs[b]].wgt,b.closeDialog(),this.removeActiveDialogs(a),this.cWidgetMgr.freeCWInstances("_"+a),b.enablePointer(),0<this.activeDialogs.length?(a=$hmi.getWidget(this.activeDialogs[this.activeDialogs.length-1]),$hmi.focusPage=a):$hmi.focusPage=$hmi.activePage)};
hmiProject.prototype.stopDialogsLogic=function(){for(var a=0,b=this.activeDialogs.length;a<b;a++){var c=this.activeDialogs[a];this._dlgInfo[c].wgt.stopLogic();this._dlgInfo[c].enable=!1}};hmiProject.prototype.getProject=function(){return this};hmiProject.prototype.getTag=function(a,b,c,d,e){return"function"!=typeof d?this._getTagSync(a,b,c,d):this._getTagAsync(a,b,c,d,e)};hmiProject.prototype.getTagMgr=function(){null==this.tagMgr&&(this.tagMgr=this.getWidget("_TagMgr",!0));return this.tagMgr};
hmiProject.prototype.getTrendMgr=function(){null==this.trendMgr&&(this.trendMgr=this.getWidget("_TrendMgr",!0));return this.trendMgr};hmiProject.prototype.getPageMgr=function(){null==this.pageMgr&&(this.pageMgr=this.getWidget("_PageMgr",!0));return this.pageMgr};
hmiProject.prototype._getTagSync=function(a,b,c,d){var e=null;d||"undefined"==typeof $hmi.getTagFromCache(a)?this.srv.readTag(new Tag(a,c),!0).always(function(a){(a instanceof State||a instanceof Tag)&&a.getMessageStatus()!=MessageStatus.prototype.status.E_TIMEOUT&&(e=a.getValue(),b instanceof State&&b.setState(a.quality,e,a.type,"S_OK",a.timestamp))}):(a=$hmi.getTagFromCache(a),e=a.getValue(c),b&&b.setState(a.quality,e,a.type,"S_OK",a.ts));return e};
hmiProject.prototype._getTagAsync=function(a,b,c,d,e){if(e||"undefined"==typeof $hmi.getTagFromCache(a))return this.srv.readTag(new Tag(a,c),!1).then(function(c){if((c instanceof State||c instanceof Tag)&&c.getMessageStatus()!=MessageStatus.prototype.status.E_TIMEOUT){var e;e=b instanceof State?b:new State;e.setState(c.quality,c.value,c.type,"S_OK",c.timestamp);return d(a,e)}});e=$hmi.getTagFromCache(a);b.setState(e.quality,e.getValue(c),e.type,"S_OK",e.ts);return d(a,b)};
hmiProject.prototype.setTag=function(a,b,c,d){var e=new State,f=this.getWidget("_TagMgr",!0);"undefined"==typeof c&&(c=0);if(d)return f.setTagValue(a,b,c,e,!0),f.setValue(a,b,c,!1),e.isQualityGood();f.setTagValue(a,b,c,e,!1);f.setValue(a,b,c,!1)};hmiProject.prototype.getCommunticationObj=function(){return this.srv};
hmiProject.prototype.getGroup=function(a,b,c){var d=0,e=this,f=new Group;this.srv.activateGroup(a,f,!0).then(function(g){g.getMessageStatus().getValue()==MessageStatus.prototype.status.S_OK&&(e.srv.readGroup(a,b,!0).then(function(e){b.getMessageStatus().getValue()==MessageStatus.prototype.status.S_OK&&("function"==typeof c&&c(a,b),d=1)}),e.srv.deactivateGroup(a,f,!1))});return d};hmiProject.prototype.getPollRate=function(){return this.pollRate};
hmiProject.prototype.setValue=function(a,b,c,d){switch(a){case "WebPageSynch":a=this.getWidget("_PageMgr",!0);if(isNaN(b)||!a)break;b=parseInt(b)-1;if(0>b||b>a.length()){this._webPageSync=b;break}if(parseInt(b)!=this._webPageSync){var e,f;"web"==a.userAgent?e=0:"tablet"==a.userAgent?e=1:"mobi"==a.userAgent&&(e=2);c=a.length();for(var g=d=0;g<c;g++){var h=a.pages[g];if(parseInt(h[1].charAt(e))){if(b==d){f=h[0];break}d++}}this._webPageSync=b;(new hmiActionLoadPage).execute(this.wgtId,{pg:f})}break;
case "changePageAnimation":this.changePageAnimation(b);break;case "changePageAnimationOnCache":this.cpAnimationOnCache=1==b;break;case "enableFitToScreenTransition":this.fitToScreenTransition=b;break;case "pagesCacheSize":this.pagesCacheSize!=b&&(1>b?b=1:10<b&&(b=10),$hmi.setPagesCacheSize(b),this.pagesCacheSize=$hmi.limitPages);break;case "color":this.color!=b&&(this.color=this.validateColor(b)?b:"#000",this._renderMask|=this._renderFlags.BGCOLOR,$hmi.addToRender(this))}};
hmiProject.prototype.render=function(){this._renderMask&this._renderFlags.BGCOLOR&&(1==this.bgColorOption||2==this.bgColorOption)&&(document.body.style.background=this.color);this._renderMask=0};hmiProject.prototype.validateColor=function(a){return void 0===a||null===a?!1:0==a.indexOf("#")&&1<a.length&&8>=a.length||"r"===a.charAt(0)&&"g"===a.charAt(1)&&"b"===a.charAt(2)?!0:!1};
hmiProject.prototype.getValue=function(a){switch(a){case "WebPageSynch":return this._webPageSync;case "changePageAnimation":return this.cpAnimation;case "changePageAnimationOnCache":return this.cpAnimationOnCache;case "pagesCacheSize":return this.pagesCacheSize;default:return this[a]}};hmiProject.prototype.isProjectReady=function(){return this.projectReady};
hmiProject.prototype.hideLoading=function(){var a=this;$hmi.isCoreWidgetsReady().then(function(){if(a.srv.getConnectionStatus())a.hideLoadingPage();else a.srv.onConnectionReady(function(){a.hideLoadingPage()})})};hmiProject.prototype.execJS=function(){var a=this;$hmi.isCoreWidgetsReady().then(function(){if("undefined"!=typeof pagesJS){var b=pagesJS[a.wgtId];if(b)try{b()}catch(c){$hmi.showErrorMessage("Generated by page javascript:",c.message)}}a.projectReady=!0;a.status=1})};
hmiProject.prototype.onPageChange=function(){var a=this.getWidget("_RecipeMgr",!0);if(a)a.onPageChange();this.stopDialogsLogic()};hmiProject.prototype.getURLForNextNormalPage=function(a,b){if(1<a.length){var c=a.length;if("umtemplates"==a[c-2])return a[c-2]="pages",this.curURL=a.join("/");if("pages"==a[c-2])return this.curURL}return this.curURL+"pages/"};
hmiProject.prototype.getURLForNextUMPage=function(a,b){if(1<a.length){var c=a.length;if("pages"==a[c-2])return a[c-2]="umtemplates",this.curURL=a.join("/")}-1==this.curURL.indexOf("umtemplates")&&(this.curURL+="umtemplates/");return this.curURL};hmiProject.prototype._getPagesUrl=function(a){return this.getWidget("_UserGroupMgr",!0).isUMTemplate(a)?this.getURLForNextUMPage(this.curURL.split("/"),a):this.getURLForNextNormalPage(this.curURL.split("/"),a)};
hmiProject.prototype.changePage=function(a,b){this.status=2;$hmi.pageNavigationOptions.pageToLeave=a;$hmi.pageNavigationOptions.pageToLoad=b;var c=$hmi.activeProject.getWidget("_PageMgr",!0);this.triggerEvent("shouldChangePage",{src:c.getPageStudioId(a),dst:c.getPageStudioId(b),height:$hmi.browserWindow.height,width:$hmi.browserWindow.width});this.onPageChange();var d=this;$hmi.pageNavigationOptions.pageToLeave!=$hmi.pageNavigationOptions.pageToLoad&&(!this.cpAnimationOnCache&&$hmi.isPageInCache($hmi.pageNavigationOptions.pageToLoad)||
$hmi.activeProject.showSpinner(!0));d=this;setTimeout(function(){var a=d._getPagesUrl($hmi.pageNavigationOptions.pageToLoad);$hmi.changePage(a+($hmi.pageNavigationOptions.pageToLoad+".html"),{src:$hmi.pageNavigationOptions.pageToLeave,dst:$hmi.pageNavigationOptions.pageToLoad,beautify:function(a){d.cWidgetMgr.injectCWTemplates(a,a.getAttribute("id"))}})},0);this.status=1};hmiProject.prototype.getClientType=function(){return"web"};hmiProject.prototype.status=0;
hmiProject.prototype._browserListener=["resize"];hmiProject.prototype.bindToWindowEvent=function(){var a=this;window.addEventListener("resize",function(){var b=$hmi.browserWindow.width=window.innerWidth,c=$hmi.browserWindow.height=window.innerHeight;a.triggerEvent("resize",{width:b,height:c})})};hmiProject.prototype.on=function(a,b){var c=null;-1!=a.indexOf(".")&&(c=a.split("."),a=c[0],c=c[1]);null==this._callbacks[a]?this._callbacks[a]=[{n:c,cb:b}]:this._callbacks[a].push({n:c,cb:b})};
hmiProject.prototype.off=function(a){var b=null;-1!=a.indexOf(".")&&(b=a.split("."),a=b[0],b=b[1]);if(null!=this._callbacks[a])if(null==b)delete this._callbacks[a];else{for(var c=this._callbacks[a],d=[],e=0,f=c.length;e<f;e++)c[e].n!=b&&d.push(c[e]);this._callbacks[a]=d}};
hmiProject.prototype.triggerEvent=function(a,b){var c=$hmi.activeProject,d=c._callbacks[a];if(null==d)return!0;for(var e=0,f=d.length;e<f;e++){var g=d[e].cb(b);if("shouldChangePage"==a&&null!=g){var h=c.getWidget("_PageMgr",!0).getWebPage(g.toLowerCase());null!=h&&($hmi.pageNavigationOptions.pageToLoad=h)}if(!1===g)return!1}return!0};
hmiProject.prototype._getStartPage=function(a){var b,c=this.getWidget("_UserGroupMgr",!0),d=this.getWidget("_PageMgr",!0);if(c.isUMTemplate(a))return a;c.useLastGroupPage()&&(b=c.loadLastPageUsed());!b&&c.getHomePage()&&(b=c.getHomePage());return b?d.getWebPage(b.toLowerCase()):a.toLowerCase()};
hmiProject.prototype.loadStartPage=function(a){var b=this;$hmi.activeProject.getWidget("_UserGroupMgr",!0);$hmi.enablePjctWidgetServerReq?$hmi.isTestModeActive()||$hmi.isCoreWidgetsReady().then(function(){b.executeLoadPage(a)}):this.executeLoadPage(a)};hmiProject.prototype.executeLoadPage=function(a){a=this._getStartPage(a);this.changePage(null,a)};hmiProject.prototype.addModule=function(a,b,c){this.cWidgetMgr.addModule(a,b,c)};hmiProject.prototype.getCWidgetMgr=function(){return this.cWidgetMgr};
hmiProject.prototype.subscribeDynamicTags=function(){this.getWidget("_TagMgr",!0).subscribeDynamicTags()};hmiProject.prototype.unsubscribeDynamicTags=function(){this.getWidget("_TagMgr",!0).unsubscribeDynamicTags()};hmiProject.prototype.changePageAnimation=function(a){this.cpAnimation=1==a};hmiProject.prototype.showSpinner=function(a){if(this.cpAnimation){var b=document.getElementById("spinnerbox");a?setCSSTransform(b,"translate(0px,0px)"):setCSSTransform(b,"translate(-10000px,-10000px)")}};
hmiProject.prototype.getWidgetDefinitions=function(){return this.defs};hmiProject.prototype.getActionMgr=function(){return this.actMgr};hmiProject.prototype.getFocusPage=function(){return $hmi.focusPage};hmiProject.prototype.groupedButtons={};hmiProject.prototype.groupButtonIn=function(a,b){var c=a.parentPage.getId();void 0===this.groupedButtons[c]&&(this.groupedButtons[c]={});void 0===this.groupedButtons[c][b]&&(this.groupedButtons[c][b]={});this.groupedButtons[c][b][a.getId()]=a};
hmiProject.prototype.updateButtonGroupedByID=function(a,b){var c=a.parentPage.getId();if(this.groupedButtons[c]&&this.groupedButtons[c][b]){var c=this.groupedButtons[c][b],d=a.getId(),e;for(e in c)e!=d&&1==c[e].getValue("value")&&c[e].doMouseDown()}};hmiProject.prototype.removeGroupedButton=function(a){this.groupedButtons[a]&&delete this.groupedButtons[a]};$hmi.fn.hmiProject=function(a,b,c,d){return new hmiProject(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiProject",hmiProject);var pageMgr=null;
function hmiPageMgr(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);pageMgr=this;this.userAgent=this.getDevice()}hmiPageMgr.prototype=Object.create(hmiWidget.prototype);hmiPageMgr.prototype.constructor=hmiPageMgr;hmiPage.prototype.currentPage=null;hmiPageMgr.prototype.pages=[];hmiPageMgr.prototype.homePages={};hmiPageMgr.prototype.invokableFunList=["getCurrentPageName","hasPage"];hmiPageMgr.jmType="PageMgrWgt";
hmiPageMgr.prototype.getDevice=function(){return/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?"mobi":/iPad|RIM Tablet OS/i.test(navigator.userAgent)?"tablet":"web"};hmiPageMgr.prototype.length=function(){return this.pages.length};hmiPageMgr.prototype.getHomePageIndex=function(){var a;switch(this.userAgent){case "web":a=this.homePages.web;break;case "table":a=this.homePages.tablet;break;case "mobi":a=this.homePages.mobile;break;default:a=this.homePages.web}return this.setCurrentPage(a)};
hmiPageMgr.prototype.getHomePageId=function(){var a;switch(this.userAgent){case "web":a=this.homePages.web;break;case "table":a=this.homePages.tablet;break;case "mobi":a=this.homePages.mobile;break;default:a=this.homePages.web}return a};hmiPageMgr.prototype.setCurrentPageFromName=function(a){for(var b,c=this.pages.length,d=0;d<c;d++)if(this.pages[d][0]==a){b=d;break}this.currentPage=b};hmiPageMgr.prototype.isCurrentPageDefined=function(){return null!=this.currentPage};
hmiPageMgr.prototype.setCurrentPage=function(a){this.currentPage=a};hmiPageMgr.prototype.getCurrentPageName=function(){return $hmi.activePage.studioId};hmiPageMgr.prototype.hasPage=function(a){return a.toLowerCase()in this.map};hmiPageMgr.prototype.getWebPage=function(a){return this.map[a]};hmiPageMgr.prototype.getPageStudioId=function(a){for(var b in this.map)if(this.map[b]==a)return b;return null};$hmi.fn.hmiPageMgr=function(a,b,c,d){return new hmiPageMgr(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiPageMgr",hmiPageMgr);var __tagMgr=null;
function hmiTagMgr(a,b,c,d,e){this.dataLinks={};this.activeCgiGroups={};this.dataTime={};this.dynamicSubscribedTags=[];hmiWidget.call(this,a.wgtId,b,c,d,e);this.srv=this.parentWidget.getCommunticationObj();this.initPromiseReady();__tagMgr=this;if($hmi.enablePjctWidgetServerReq)if($hmi.isTestModeActive())this.status=2,this.resolveWgtReady(!0),this.sendNotification("tagmgrready");else{var f=this;this.srv.getConf().done(function(a){f.groupsInfo=a["groups.json"];f.status=1;f.srv.getConf("tags.json").done(function(a){f.tagsInfo=
a["tags.json"];f.status=2;f.resolveWgtReady(!0);f.srv.subscribeNotification("tags",function(a){f.onDataReady(a)});a=0;for(var b=f.sbsQueue.length;a<b;a++)f._cerateSubscription(f.sbsQueue[a].sbsWgtId,f.sbsQueue[a].pageObj);f.sbsQueue=[];f.sendNotification("tagmgrready")}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading tags configuration file. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)})}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,
{msg:"Error loading groups configuration file. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)})}}hmiTagMgr.prototype=Object.create(hmiWidget.prototype);hmiTagMgr.prototype.activeCgiGroups=null;hmiTagMgr.prototype.groupsInfo=null;hmiTagMgr.prototype.tagsInfo=null;hmiTagMgr.prototype.status=0;hmiTagMgr.prototype.sbsQueue=[];hmiTagMgr.jmType="TagMgrWgt";hmiTagMgr.prototype.getGroupInfo=function(a){return this.groupsInfo[a]};
hmiTagMgr.prototype.getTagInfo=function(a){return this.tagsInfo[a]};hmiTagMgr.prototype.isReady=function(){return 2==this.status};hmiTagMgr.prototype.subscribeForTagsNotification=function(a){this.srv.subscribeTags(a,null)};hmiTagMgr.prototype.subscribeGroup=function(a,b){2==this.status?this._cerateSubscription(a,b):this.sbsQueue.push({sbsWgtId:a,pageObj:b})};
hmiTagMgr.prototype._cerateSubscription=function(a,b){if(this.groupsInfo[a]){var c=new hmiGroupSubscribeWgt({wgtId:a},a,{groupName:a,pollRate:this.pollRate,tagMgr:this,tags:this.groupsInfo[a].tgs},b,b),d=this.activeCgiGroups[a],e=b.wgtId;if(null==d)this.activeCgiGroups[a]={group:c,status:!0,pages:[e],groupId:a};else{d.group=c;var f=d.pages;-1==f.indexOf(e)&&f.push(e);d.status=!0}d=$hmi.serverInterface.subscribeGroups([a],null);c.setCallbackId(d)}};
hmiTagMgr.prototype.onDataReady=function(a){for(var b,c=[],d=0,e=a.length;d<e;d++)b=a[d],$hmi.updateTagsCache(b.n,b)&&c.push(b);a=c;this.sendNotification("indexedtagsetready",a);d=0;for(c=a.length;d<c;d++){b=$hmi.cache.getTag(a[d].n);var e=b.getValue(),f=this.dataLinks[b.name];if(f)for(var g=0,h=f.length;g<h;g++)if(b.isQualityGood()){var k=0;0!=f[g].tagIndex?k=f[g].tagIndex:f[g].tgtWgt.index&&(k=f[g].tgtWgt.index);Array.isArray(e)?"Index"==f[g].attr?f[g].setWgtValue(e,k,b.getQuality(),null,b.ts):
-1==k?f[g].setWgtValue(e,k,b.getQuality()):void 0==e[k]?f[g].setWgtValue(e[k],k,new Quality(0),null,b.ts):f[g].setWgtValue(e[k],k,b.getQuality(),null,b.ts):f[g].setWgtValue(e,-1,b.getQuality(),null,b.ts)}else f[g].setWgtValue(null,-1,b.getQuality(),null,b.ts)}};hmiTagMgr.prototype.isTagSubscribeInActiveGroup=function(a){for(var b in this.activeCgiGroups){var c=this.activeCgiGroups[b],d=c.group;if(c.status&&null!==d&&d.containsTag(a))return!0}return!1};
hmiTagMgr.prototype.addDataLink=function(a){var b=a.tag;this.isTagSubscribeInActiveGroup(b)||-1!=this.dynamicSubscribedTags.indexOf(b)||this.dynamicSubscribedTags.push(b);this.dataLinks[b]||(this.dataLinks[b]=[]);this.dataLinks[b].push(a)};
hmiTagMgr.prototype.removeDataLink=function(a){var b=this.dataLinks[a.tag],c=null;if(null!=b){for(var d=0,e=b.length;d<e;d++)if(b[d].getId()==a.getId()){c=d;break}null!=c&&(b.splice(c,1),0==b.length&&delete this.dataLinks[a.tag])}a=this.dynamicSubscribedTags.indexOf(a.tag);-1!==a&&this.dynamicSubscribedTags.splice(a,1)};hmiTagMgr.prototype.subscribeDataLink=function(a){this.addDataLink(a)};hmiTagMgr.prototype.unsubscribeDataLink=function(a){this.removeDataLink(a)};
hmiTagMgr.prototype.updateDataLink=function(a){var b=$hmi.cache.getTag(a.tag),c=a.tagIndex;void 0==c&&(c=-1);b?this.sendUpdate(a.tag,b.getValue(c),b.getQuality(),c):this.sendUpdate(a.tag,"",Tag.prototype.QUALITY_GOOD,c)};hmiTagMgr.prototype.subscribeDynamicTags=function(){0<this.dynamicSubscribedTags.length&&this.srv.subscribeTags(this.dynamicSubscribedTags)};
hmiTagMgr.prototype.unsubscribeDynamicTags=function(){if(0<this.dynamicSubscribedTags.length){var a=this,b=this.dynamicSubscribedTags.filter(function(b){return!a.isTagSubscribeInActiveGroup(b)});0<b.length&&this.srv.unsubscribeTags(b)}};
hmiTagMgr.prototype.subscribePageGroups=function(a){for(var b in this.activeCgiGroups){var c=this.activeCgiGroups[b];if(c&&-1!=c.pages.indexOf(a)&&0==c.status){var d=$hmi.focusPage;c.group=new hmiGroupSubscribeWgt({wgtId:c.groupId},c.groupId,{groupName:c.groupId,pollRate:this.pollRate,tagMgr:this,tags:this.groupsInfo[c.groupId].tgs},d,d);d=$hmi.serverInterface.subscribeGroups([c.groupId],null);c.group.setCallbackId(d);c.status=!0}}};
hmiTagMgr.prototype.unsubscribePageGroups=function(a){for(var b in this.activeCgiGroups)if(-1!=this.activeCgiGroups[b].pages.indexOf(a)){var c=this.activeCgiGroups[b].group.getCallbackId();this.srv.unsubscribeGroups(c);this.activeCgiGroups[b].status=!1;this.activeCgiGroups[b].group=null}};
hmiTagMgr.prototype.setValue=function(a,b,c,d){if(d){var e=new State;this.setTagValue(a,b,c,e,!1)}var f,g=$hmi.cache.getTag(a);g&&this.dataLinks[a]&&(e=g.getQuality(),g.value instanceof Array?(f=$hmi.cache.getTag(a).clone(!1),0<=c&&c<f.value.length&&(f.value[c]=parseFloat(b)),f=f.value):f=b,f=new Tag(a,c,f,"S_OK"),f.setQuality(e),$hmi.cache.updateTag(a,f)&&this.sendUpdate(a,b,e,c,d));return f};
hmiTagMgr.prototype.setTagValue=function(a,b,c,d,e){if(this.tagsInfo[a]){var f=Tag.prototype.getTypeRange(this.tagsInfo[a].t);null!=f&&(b<f.min?b=f.max-Math.abs(f.min-b):b>f.max&&(b=f.min+Math.abs(b-(f.max+1))));this.tagsInfo[a].t==Tag.prototype.enumType.TIME&&("string"==typeof b&&(b=parseInt(b)),b=(new Date(1E3*b)).toISOString())}var g=this;return this.srv.writeTag(new Tag(a,c),b,d,e).then(function(a){if(null!=a&&null!=a.tgs[0]){var b=a.tgs[0];g.onDataReady([{n:b.name,v:{q:b.quality,v:b.value,ts:(new Date).toISOString(),
idx:b.idx}}])}return a})};hmiTagMgr.prototype.sendUpdate=function(a,b,c,d){if(d=this.dataLinks[a])for(var e=0,f=d.length;e<f;e++){var g=0;-1!=d[e].tagIndex?g=d[e].tagIndex:d[e].tgtWgt.index&&(g=d[e].tgtWgt.index);if(d[e].tag==a)if(d[e].dataSrc.getValue(d[e].tag)instanceof Array){var h=d[e].dataSrc.getValue(d[e].tag).length;0>g||g>h-1?d[e].setWgtValue(b,g,new Quality(0)):d[e].setWgtValue(b,g,c)}else d[e].setWgtValue(b,g,c)}};
hmiTagMgr.prototype.getTagValue=function(a,b){var c=this;if("undefined"!=typeof $hmi.getTagFromCache(a)){var d=$hmi.getTagFromCache(a),e=d.getValue();e.constructor==Array&&-1!=b&&(d=new State,d.setValue(e[b]));return $.Deferred().resolve(d)}return this.srv.readTag(new Tag(a,b),!1).then(function(d){return d?d:c.getTagValue(a,b)})};
hmiTagMgr.prototype.getValue=function(a,b){var c=this,d=$hmi.cache.getTag(a);return d?(void 0==b&&(b=-1),d.getValue(b)):this.srv.readTag(new Tag(a,0),!1).then(function(b){return b&&b.getMessageStatus()!=MessageStatus.prototype.status.E_TIMEOUT?b.getValue():c.getValue(a)})};hmiTagMgr.prototype.constructor=hmiTagMgr;$hmi.fn.hmiTagMgr=function(a,b,c,d){return new hmiTagMgr(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTagMgr",hmiTagMgr);
function hmiTrendBufferWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.trnWndId&&(this.trnWnd=this.parentWidget.getWidgetByClass(hmiTrendWindowWgt),this.trnWnd.subscribeWgt(this,function(){}));this.srv=__project.getCommunticationObj();this.bufferType==this.enType.REALTIME?this.samplingTime*=1E3:this.bufferType==this.enType.HISTORY&&(this.refreshHistory=3E3,this.isDirty=!0);var f=this;if(a=$hmi.getEventMgr())f=this,this.activateHandler=function(){f.load()},this.deactivateHandler=function(){f.unload()},
a.on(this.parentPage.elem,"loadWgt",this.activateHandler),a.on(this.parentPage.elem,"unloadWgt",this.deactivateHandler)}hmiTrendBufferWgt.prototype=Object.create(hmiWidget.prototype);hmiTrendBufferWgt.prototype.constructor=hmiTrendBufferWgt;hmiTrendBufferWgt.prototype.bufferSize=1E3;hmiTrendBufferWgt.prototype.bufferType=1;hmiTrendBufferWgt.prototype.nPoints=0;hmiTrendBufferWgt.prototype.nextInsert=0;hmiTrendBufferWgt.prototype.isCyclic=!1;hmiTrendBufferWgt.prototype.startTimeIdx=0;
hmiTrendBufferWgt.prototype.stopTimeIdx=0;hmiTrendBufferWgt.prototype.value=null;hmiTrendBufferWgt.prototype.timerRealTime=null;hmiTrendBufferWgt.prototype.currValueTs=null;hmiTrendBufferWgt.prototype.lastReadTagTs=null;hmiTrendBufferWgt.prototype.outOfSyncGap=0;hmiTrendBufferWgt.prototype.rIdal=null;hmiTrendBufferWgt.prototype.hTrendName=null;hmiTrendBufferWgt.prototype.hTrendPrefix=null;hmiTrendBufferWgt.prototype.hStartTime=null;hmiTrendBufferWgt.prototype.hEndTime=null;
hmiTrendBufferWgt.prototype.hMaxNSamples=0;hmiTrendBufferWgt.prototype.enType={HISTORY:0,REALTIME:1};hmiTrendBufferWgt.jmType="TrendBufferWgt";hmiTrendBufferWgt.prototype.load=function(){this.buffer=Array(this.bufferSize);this.auxBuff=[];this.nextInsert=0;this.bufferType==this.enType.REALTIME&&(this.isCyclic=!0,this.startRealTimeSampling())};hmiTrendBufferWgt.prototype.unload=function(){this.timerRealTime&&clearInterval(this.timerRealTime);this.auxBuff=this.buffer=null};
hmiTrendBufferWgt.prototype.startRealTimeSampling=function(){var a=this;this.timerRealTime=setInterval(function(){var b,c=Date.now();a.currValueTs!=a.lastReadTagTs?(b=(new Date(a.currValueTs)).getTime(),a.outOfSyncGap=c-b,a.lastReadTagTs=a.currValueTs):b=c-a.outOfSyncGap;a.addPoint(b,a.value,a.currValueQuality);b=a._orderByTime();a.sendUpdate("web-value",b,null)},this.samplingTime)};
hmiTrendBufferWgt.prototype.addPoint=function(a,b,c){this.nextInsert<this.bufferSize&&(this.buffer[this.nextInsert]=new Sample(a,b,c),this.stopTimeIdx=this.nextInsert);this.nextInsert++;this.nPoints++;this.nPoints>=this.bufferSize&&(this.nPoints=this.bufferSize,this.isCyclic&&this.nextInsert>=this.bufferSize&&(this.nextInsert=0),this.isCyclic&&(this.startTimeIdx=this.nextInsert))};
hmiTrendBufferWgt.prototype.setValue=function(a,b,c,d,e){if("Value"==a){this.currValueQuality=c;if(this.isBadValue(b,!1,c))return this.value=void 0,!1;switch(this.bufferType){case this.enType.REALTIME:if(this.value!=b||this.currValueTs!=e)this.value=b,this.currValueTs=e,this.sendUpdate(a,this.value,c);break;case this.enType.HISTORY:if(this.buffer=b)this.generateGhostBufferSamples(),this.sendUpdate("web-value",this.auxBuff,null)}}return!0};
hmiTrendBufferWgt.prototype.generateGhostBufferSamples=function(){var a=!1,b=this.buffer.length;this._prevQuality=this._prevValue=this._prevTimeStamp=null;this.auxBuff=[];for(--b;0<=b&&(0==b&&(a=!0),this.addBufferPoint(this.buffer[b],a));b--);};
hmiTrendBufferWgt.prototype.addBufferPoint=function(a,b){var c=!1;if(!this.buffer)return c;var d=1E3*a.rts,e=a.v,f=a.q,g=0,g=this.deltaTime,h=this.getTrendST(),k;1E3>h&&(h=1E3);g=Math.max(h,g);if(!this._prevTimeStamp)return c=this.inflateAndAddPoint(d,e,f),this._prevTimeStamp=d,this._prevValue=e,this._prevQuality=f,c;var h=this.hEndTime,l=(new Date).getTime();b?(k=d-this._prevTimeStamp,k>g&&(k=this._prevTimeStamp+k/g*g,k=d-k<=g/2?k-g:k,k<this._prevTimeStamp&&(k+=g),k>=this._prevTimeStamp&&k<=d&&(c=
this.inflateAndAddPoint(k,this._prevValue,this._prevQuality))),e!=this._prevValue?c=this.inflateAndAddPoint(d,e,f):h<l-g&&(c=this.inflateAndAddPoint(d,e,f))):(k=d-this._prevTimeStamp,k>g&&(k=this._prevTimeStamp+k/g*g,k=d-k<=g/2?k-g:k,k<this._prevTimeStamp&&(k+=g),k>=this._prevTimeStamp&&k<=d&&this.inflateAndAddPoint(k,this._prevValue,this._prevQuality)),c=this.inflateAndAddPoint(d,e,f),this._prevTimeStamp=d,this._prevValue=e,this._prevQuality=f);return c};
hmiTrendBufferWgt.prototype.inflateAndAddPoint=function(a,b,c,d){b=new Sample(a,b,c,d);c=this.hEndTime-this.hStartTime;if(a<this.hStartTime-c)0==this.auxBuff.length?this.auxBuff.push(b):this.auxBuff[0]=b;else{if(a>this.hEndTime+c)return this.auxBuff.push(b),!1;this.auxBuff.push(b)}return!0};hmiTrendBufferWgt.prototype.getTrendST=function(){if(this.hTrendName)return $hmi.activeProject.getWidget("_TrendMgr",!0).conf[this.hTrendPrefix].st};
hmiTrendBufferWgt.prototype.getValue=function(a){return"Value"==a?this.bufferType==this.enType.REALTIME?this.value:this.buffer:hmiWidget.prototype.getValue.call(this,a)};hmiTrendBufferWgt.prototype._orderByTime=function(){return 0==this.startTimeIdx?this.buffer.slice(0,this.stopTimeIdx+1):this.buffer.slice(this.startTimeIdx,this.bufferSize).concat(this.buffer.slice(0,this.stopTimeIdx+1))};
hmiTrendBufferWgt.prototype.subscribeDataLink=function(a){hmiWidget.prototype.subscribeDataLink.call(this,a);if(this.bufferType==this.enType.HISTORY){var b=a.dataSrc;b&&b.constructor==hmiIdalTrendWgt&&"Value"==a.attr&&(this.rIdal=b,this.hTrendName=a.tag,this.hTrendPrefix=this.hTrendName.split(".")[0])}this.bufferType!=this.enType.REALTIME&&this.bufferType!=this.enType.HISTORY||a.tgtWgt.constructor!=hmiTrendCurveWgt||"web-value"==a.attr||$hmi.createDataLink(a.tgtWgt,this,{rw:a.rw,attr:"web-value",
tag:"web-value",srcType:a.srcType,tagIndex:-1,xforms:a.xforms}).mount()};hmiTrendBufferWgt.prototype.setHistoricParams=function(a,b,c){null==this.hStartTime&&(this.startThr=a);null==this.hEndTime&&(this.endThr=b);var d=this.hEndTime-this.hStartTime;this.hStartTime=a;this.hEndTime=b;this.hMaxNSamples=c;this.rIdal&&(this.hStartTime<this.startThr-d/2||this.hEndTime>this.endThr+d/2||this.endThr-this.startThr!=b-a)&&(this.rIdal.updateBufferTimeDuration(this),this.startThr=a,this.endThr=b)};
hmiTrendBufferWgt.prototype.setDeltaTime=function(a){this.deltaTime=a};hmiTrendBufferWgt.prototype.getDeltaTime=function(){return this.deltaTime};hmiTrendBufferWgt.prototype.isHistoric=function(){return this.bufferType==this.enType.HISTORY};hmiTrendBufferWgt.destroy=function(){if(this.destroyed)return!1;this.unload();$hmi.getEventMgr().off(this.parentPage.elem,"loadWgt",this.activateHandler);return this.destroyed=!0};
$hmi.fn.hmiTrendBufferWgt=function(a,b,c,d){return new hmiTrendBufferWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTrendBufferWgt",hmiTrendBufferWgt);
function hmiTrendCurveWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.trnWndId&&(this.trnWnd=this.parentWidget.getWidgetByClass(hmiTrendWindowWgt),this.trnWnd.subscribeWgt(this,function(){}),this.cursorTs=this.trnWnd.getValue("cursor-timestamp"),this.curveType=this.trnWnd.getTrendType(),this.width=this.trnWnd.width,this.height=this.trnWnd.height);this.currPageDuration=this.trnWnd.xPageSize;this.getLineChartObj(this.parentWidget.elem.querySelector(".trend_crv"));this.trnWnd&&this.trnWnd.isScatter()&&
(this.graph.isScatter=!0);if(a=$hmi.getEventMgr()){var f=this;this.deactivateHandler=function(){f.unload()};a.on(this.parentPage.elem,"unloadWgt",this.deactivateHandler)}}hmiTrendCurveWgt.prototype=Object.create(hmiWidget.prototype);hmiTrendCurveWgt.prototype.constructor=hmiTrendCurveWgt;hmiTrendCurveWgt.prototype.visible=!0;hmiTrendCurveWgt.prototype.pBuffer=null;hmiTrendCurveWgt.prototype.min=0;hmiTrendCurveWgt.prototype.max=1E3;hmiTrendCurveWgt.prototype.y0=0;hmiTrendCurveWgt.prototype.y1=100;
hmiTrendCurveWgt.prototype.y1=100;hmiTrendCurveWgt.prototype.trendCurveType=100;hmiTrendCurveWgt.prototype._renderMask=0;hmiTrendCurveWgt.prototype._renderFlags={UPDATECURVECANVAS:2};hmiTrendCurveWgt.jmType="TrendCurveWgt";hmiTrendCurveWgt.prototype.unload=function(){this.value=null;this.graph.clearData();this.clearCanvas()};
hmiTrendCurveWgt.prototype.getLineChartObj=function(a){this.graph=new LineChart(a,{width:this.width,height:this.height,minX:this.min||0,maxX:this.max||1E3,minY:this.y0||0,maxY:this.y1||100,line:this.drawType,stroke:this.stroke,strokeWidth:this.strokeWidth},this)};hmiTrendCurveWgt.prototype.createCurveCanvas=function(a){var b=document.createElement("canvas");b.setAttribute("id",a);b.setAttribute("width",this.width);b.setAttribute("height",this.height);this.elem.appendChild(b)};
hmiTrendCurveWgt.prototype.updateCurveCanvasSize=function(){this.graph.updateSize(this.width,this.height)};hmiTrendCurveWgt.prototype.updateCurveCanvasContainerSize=function(){this.graph.updateCanvasContainerSize(this.getParentBounds(this.parentWidget))};hmiTrendCurveWgt.prototype.clearCanvas=function(){this.graph.clearCanvasContext()};hmiTrendCurveWgt.prototype.renderCurve=function(){this.graph.drawCurve()};
hmiTrendCurveWgt.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.UPDATECURVECANVAS&&(this.clearCanvas(),this.updateCurveCanvasContainerSize(),this.updateCurveCanvasSize());this._renderMask=0};
hmiTrendCurveWgt.prototype.updateHistoricGraph=function(){var a=this.trnWnd.startTime,b=this.trnWnd.endTime,c=this.trnWnd.width,d;if(null==this.pBuffer.getDeltaTime()||this.currPageDuration!=this.trnWnd.xPageSize)this.currPageDuration=this.trnWnd.xPageSize,0<c&&(d=parseInt(this.trnWnd.xPageSize/c),this.pBuffer.setDeltaTime(d));this.pBuffer.setHistoricParams(a,b,c)};
hmiTrendCurveWgt.prototype.setValue=function(a,b,c,d){if(this.isBadValue(b,!1,c))return 0;switch(a){case "web-value":this.value==b||this.trnWnd.isOnPause()||(this.value=b,void 0!=this.value&&null!=this.value[this.value.length-1]&&this.elem.setAttribute("data-cv",this.value[this.value.length-1].y));break;case "Value":this.val!=b&&(this.val=b,this.sendUpdate(a,this.val,c));break;case "min":if(this.min!=b||this.trnWnd.forceUpdate())d=this.min,this.min=b,this.updateValues(),this.pBuffer&&d!=b&&this.updateHistoricGraph(),
this.sendUpdate(a,this.min,c);break;case "max":if(this.max!=b||this.trnWnd.forceUpdate())d=this.max,this.max=b,this.updateValues(),this.pBuffer&&d!=b&&this.updateHistoricGraph(),this.sendUpdate(a,this.max,c);break;case "y0":if(this.y0!=b||this.trnWnd.forceUpdate())this.y0=b,this.updateValues(),this.sendUpdate(a,this.y0,c);break;case "y1":if(this.y1!=b||this.trnWnd.forceUpdate())this.y1=b,this.updateValues(),this.sendUpdate(a,this.y1,c);break;case "drawType":this.drawType!=b&&(this.drawType=b,this.visible=
0>this.drawType||1<this.drawType?0:1,this.updateValues(),this.sendUpdate(a,this.drawType,c));break;case "visibility2":this.visible!=b&&(this.getAuthorizations()==this.umgr.wgtAuth.HIDE?this.visible=0:this.visible=0>b||1<b?1:b,this.updateValues(),this.sendUpdate(a,this.visible,c));break;case "cursor-value":this.cursorValue!=b&&(this.cursorValue=b,this.sendUpdate(a,this.cursorValue,c));default:hmiWidget.prototype.setValue.call(this,a,b,c)}};
hmiTrendCurveWgt.prototype.updateMinMax=function(a,b){var c=!1;this.min!=a&&(this.min=a,this.updateValues(),c=!0,this.sendUpdate("min",this.min,null));this.max!=b&&(this.max=b,c=!0,this.updateValues(),this.sendUpdate("max",this.max,null));c&&this.curveType==hmiTrendWindowWgt.prototype.TYPE.HISTORY&&this.updateHistoricGraph()};
hmiTrendCurveWgt.prototype.updateValues=function(){this.value&&0<this.value.length&&this.value[0]&&(this.graph.setXRange(this.min,this.max),this.graph.setYRange(this.y0,this.y1),this.graph.updateCurve(this.value,this.drawType,this.visible),this.trnWnd.isScatter()&&this.trnWnd.drawCurves(),this.cursorTs=this.trnWnd.getValue("cursor-timestamp"))};
hmiTrendCurveWgt.prototype.getValue=function(a){switch(a){case "web-value":a=this.pBuffer?this.getArrayPointsFromSamples():this.value;break;case "Value":a=this.val;break;case "min":a=this.min;break;case "max":a=this.max;break;case "y0":a=this.y0;break;case "y1":a=this.y1;break;case "visibility2":a=this.visible;break;case "cursor-value":a=this.cursorValue;break;case "cursor-ts":a=this.cursorTs;break;default:a=hmiWidget.prototype.getValue.call(this,a)}return a};
hmiTrendCurveWgt.prototype.getArrayPointsFromSamples=function(){var a=[];if(this.value)for(var b=0;b<this.value.length;b++)a.push([this.value[b].x,this.value[b].y]);return a};hmiTrendCurveWgt.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};hmiTrendCurveWgt.prototype.initDataLinkSideEffects=function(a,b){a.dataSrc.constructor==hmiTrendBufferWgt&&a.dataSrc.bufferType==a.dataSrc.enType.HISTORY&&(this.pBuffer=a.dataSrc)};
hmiTrendCurveWgt.prototype.getSamplingTime=function(){if(this.pBuffer)return this.pBuffer.getTrendST()};hmiTrendCurveWgt.prototype.getWindowMinMax=function(){return{wndStart:this.trnWnd.startTime,wndEnd:this.trnWnd.endTIme}};hmiTrendCurveWgt.prototype.refreshTrend=function(){this.trnWnd.isScatter()&&this.trnWnd.update();this.trnWnd.drawCurves()};
hmiTrendCurveWgt.prototype.setParentBounds=function(a,b,c,d,e){hmiWidget.prototype.setParentBounds.call(this,a,b,c,d,e);this._renderMask=this._renderFlags.UPDATECURVECANVAS;$hmi.addToRender(this)};hmiTrendCurveWgt.prototype.destroy=function(){if(this.destroyed)return!1;this.trnWnd.unsubscribeWgt(this);this.graph.destroy();this.value=null;$hmi.getEventMgr().off(this.parentPage.elem,"unloadWgt",this.deactivateHandler);return hmiWidget.prototype.destroy.call(this)};
$hmi.fn.hmiTrendCurveWgt=function(a,b,c,d){return new hmiTrendCurveWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTrendCurveWgt",hmiTrendCurveWgt);
function hmiTrendWindowWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.showBackground();this.ySize=this._initYZoom=this.y1-this.y0;if(this.trendType==this.TYPE.SCATTER)this.endTime=this.stopTime,this._initXZoom=this.endTime-this.startTime,void 0==this.y0&&(this.y0=0);else if(this.trendType==this.TYPE.REALTIME||this.trendType==this.TYPE.HISTORY)this._initXZoom=this.getPDIndex(this.pageDuration);this._dStartTime=this.startTime;this._dEndTime=this.endTime;this._dY0=this.y0;this._dY1=this.y1;
this._dYSize=this.ySize;this._dPageDuration=this.pageDuration;$hmi.cache.hasWgtProps(this.elem.id)&&this.loadCachedValues();this._initWindowView();this._forceBoundsUpdate=this._updateXDuration=this._initialized=this._isPaused=!1;this._prevYDiff=this._prevXDiff=-1;this.events={mousedown:!0,touchstart:!0};if(a=$hmi.getEventMgr()){var f=this;this.activateHandler=function(){f.load()};this.deactivateHandler=function(){f.unload()};a.on(this.parentPage.elem,"loadWgt",this.activateHandler);a.on(this.parentPage.elem,
"unloadWgt",this.deactivateHandler)}}hmiTrendWindowWgt.prototype=Object.create(hmiWidget.prototype);hmiTrendWindowWgt.prototype.constructor=hmiTrendWindowWgt;hmiTrendWindowWgt.prototype.pageDuration=3E5;hmiTrendWindowWgt.prototype.updateInterval=1E3;hmiTrendWindowWgt.prototype.startTime=0;hmiTrendWindowWgt.prototype.endTime=1E3;hmiTrendWindowWgt.prototype.ySize=100;hmiTrendWindowWgt.prototype.y0=0;hmiTrendWindowWgt.prototype.y1=100;hmiTrendWindowWgt.prototype.isPrt=!1;
hmiTrendWindowWgt.prototype.maxXZoom=20;hmiTrendWindowWgt.prototype._renderMask=0;hmiTrendWindowWgt.prototype._renderFlags={CLBANDS:2,BGCOLOR:4,STROKE:8,CURVES:16,MOVE:32,UPDATECBCANVAS:64};hmiTrendWindowWgt.prototype.TYPE={HISTORY:0,REALTIME:1,SCATTER:2};hmiTrendWindowWgt.prototype.xStart=null;hmiTrendWindowWgt.prototype.xEnd=null;hmiTrendWindowWgt.prototype.yStart=null;hmiTrendWindowWgt.prototype.yEnd=null;hmiTrendWindowWgt.prototype.moveX=!1;hmiTrendWindowWgt.prototype.moveY=!1;
hmiTrendWindowWgt.prototype.gridXTickDivider=null;hmiTrendWindowWgt.prototype.xDurationMap={1:60,2:300,3:600,4:1800,5:3600,6:7200,7:14400,8:28800,9:43200,10:86400,11:172800,12:432E3,13:604800,14:1209600,15:2419200,16:7776E3,17:15552E3,18:31536E3,19:63072E3,20:157766400};hmiTrendWindowWgt.prototype.showBackground=function(){if(this.isPrt||this.isScatter())this.elem.style.boxSizing="border-box",this.elem.style.backgroundColor=this.fill,this.elem.style.border="1px solid "+this.stroke};
hmiTrendWindowWgt.jmType="TrendWindowWgt";hmiTrendWindowWgt.prototype._initWindowView=function(){this.isScatter()?(this.endTime=this.stopTime,this.xPageSize=this.endTime-this.startTime):(this.endTime=(new Date).getTime(),this.startTime=this.endTime-this.pageDuration,this.xPageSize=this.pageDuration);this.bands&&!this.isScatter()&&(this.clBand=new ColorBand(this.wgtId+"_cb",{width:this.width,height:this.height,minX:this.startTime,maxX:this.endTime,minY:this.y0||0,maxY:this.y1||100,bands:this.bands}))};
hmiTrendWindowWgt.prototype.load=function(){$hmi.activeProject.getWidget("_TrendMgr",!0).subscribeWgt(this,function(){});var a=this,b=this.getAllSubscriptions();b&&!this.isScatter()&&(this.timer=setInterval(function(){a.update();a.drawCurves()},this.updateInterval));b&&this.isScatter()&&(this.update(),this.drawCurves())};hmiTrendWindowWgt.prototype.drawCurves=function(){this._renderMask|=this._renderFlags.CURVES;$hmi.addToRender(this)};
hmiTrendWindowWgt.prototype._draw=function(){var a=0,b=this.getAllSubscriptions(),c;for(c in b){var d=b[c].getWidget();if(d.constructor==hmiTrendCurveWgt||d.constructor==hmiXYCurveWgt)0==a&&d.clearCanvas(),d.renderCurve(),a++}};
hmiTrendWindowWgt.prototype.loadCachedValues=function(){var a=$hmi.cache.getWgtProp(this.elem.id,"xDuration"),b=$hmi.cache.getWgtProp(this.elem.id,"yDuration");this.isScatter()?(this.pageDuration=a,this.startTime=$hmi.cache.getWgtProp(this.elem.id,"min"),this.stopTime=$hmi.cache.getWgtProp(this.elem.id,"max")):(this.pageDuration=1E3*this.getPDFromIndex(a),this._zXIdx=$hmi.cache.getWgtProp(this.elem.id,"xZoom"));this.ySize=b;this.y0=$hmi.cache.getWgtProp(this.elem.id,"y0");this.isScatter()?this.y1=
$hmi.cache.getWgtProp(this.elem.id,"y1"):this.y1=this.y0+this.ySize};hmiTrendWindowWgt.prototype._initGraph=function(a){null==this.gridXTickDivider&&(this.gridXTickDivider=this.grid.getValue("gridX"));this.setValue("min",a.xStart,null);this.setValue("max",a.xEnd,null);this.setValue("y0",a.yStart,null);this.setValue("y1",a.yEnd,null)};
hmiTrendWindowWgt.prototype.updateXDuration=function(a,b){var c,d;this.trendType==this.TYPE.SCATTER?(c=a,d=a+this.xPageSize):(c=this.xPageSize/(this.gridXTickDivider-1),d=this._tCurrent<b-this.xPageSize?this._tCurrent+c:b,c=d-this.xPageSize);this.setValue("min",c,null);this.setValue("max",d,null);this._updateXDuration=!1};hmiTrendWindowWgt.prototype.updateYDuration=function(a,b){var c;c=a+this.ySize;this.setValue("y0",a,null);this.setValue("y1",c,null);this._updateYDuration=!1};
hmiTrendWindowWgt.prototype.update=function(){var a;a=this.isScatter()?this.enableSpaceWindow():this.enableTimeWindow();this._updateXDuration&&this.updateXDuration(this.startTime,this.endTime);this._updateYDuration&&this.updateYDuration(this.y0,this.y1);this._initialized||(this._initGraph(a),this._initialized=!0);this.grid&&(!this.isScatter()||this.isScatter()&&this.grid.isCursorVisible())&&this.setValue("cursor-timestamp",this.grid.getXCursor(),null);if(this._initialized){if(a.pEnd&&!this.isScatter()){var b=
0,b=a.xStart,c=a.xEnd;this.trendType==this.TYPE.HISTORY&&(b=this.xPageSize/(this.gridXTickDivider-1),c=a.xEnd+b,b=a.xStart+b);this._forceBoundsUpdate=!1}else b=this.startTime,c=this.endTime,a.yStart=this.y0,a.yEnd=this.y1,this._forceBoundsUpdate=!0;this.setValue("max",c,null);this.setValue("min",b,null);this.setValue("y0",a.yStart,null);this.setValue("y1",a.yEnd,null)}};
hmiTrendWindowWgt.prototype.enableSpaceWindow=function(){return{xStart:this.startTime,xEnd:this.startTime+this.xPageSize,yStart:this.y0,yEnd:this.y1}};
hmiTrendWindowWgt.prototype.enableTimeWindow=function(){var a,b,c;a=(new Date).getTime();var d=this.isTrendPageEnded();this._tCurrent=a;d.end||(0==this.startPoint&&(b=a,c=a+this.xPageSize),1==this.startPoint&&(b=a-this.xPageSize/2,c=a+this.xPageSize/2));if(d.end||2==this.startPoint)b=a-this.xPageSize,c=a;return{xStart:b,xEnd:c,yStart:this.y0,yEnd:this.y0+this.ySize,pEnd:d.end}};
hmiTrendWindowWgt.prototype.isTrendPageEnded=function(){var a=!1;if(this._tCurrent){var b=parseInt(this._tCurrent/1E3),c=parseInt(this.endTime/1E3);b==c&&(a=!0)}return{end:a}};hmiTrendWindowWgt.prototype.getGridWgt=function(){return this.grid};
hmiTrendWindowWgt.prototype.render=function(){hmiWidget.prototype.render.call(this);this._renderMask&this._renderFlags.CLBANDS&&this.bands&&!this.isScatter()&&this._initialized&&(this.clBand.setXRange(this.startTime,this.endTime),this.clBand.setYRange(this.y0,this.y1),this.clBand.drawBands());this._renderMask&this._renderFlags.BGCOLOR&&(this.elem.style.backgroundColor=this.fill);this._renderMask&this._renderFlags.STROKE&&(this.elem.style.boxSizing="border-box",this.elem.style.border="solid",this.elem.style.borderWidth=
"1px",this.elem.style.borderColor=this.stroke);this._renderMask&this._renderFlags.UPDATECBCANVAS&&this.clBand.updateSize(this.width,this.height);if(this._renderMask&this._renderFlags.MOVE||this._renderMask&this._renderFlags.CURVES)this.moveX&&(this._updateXRange(),this.moveX=!1),this.moveY&&(this._updateYRange(),this.moveY=!1),this._draw();this._renderMask=0};hmiTrendWindowWgt.prototype.refreshCurves=function(){this._renderMask|=this._renderFlags.CURVES;$hmi.addToRender(this)};
hmiTrendWindowWgt.prototype.setValue=function(a,b,c,d){d=!1;if(this.isBadValue(b,!1,c))return!1;switch(a){case "min":b="string"==typeof b?parseFloat(b):b;this.startTime!=b&&(this.startTime=b,this.clBand&&(this._renderMask|=this._renderFlags.CLBANDS,d=!0),this.trendType==this.TYPE.SCATTER&&(this.xPageSize=this.endTime-this.startTime,this._renderMask|=this._renderFlags.CURVES,d=!0),this.sendUpdate(a,this.startTime,c));this._forceBoundsUpdate&&this.sendUpdate(a,this.startTime,c);break;case "max":b="string"==
typeof b?parseFloat(b):b;this.endTime!=b&&(this.endTime=b,this.clBand&&(this._renderMask|=this._renderFlags.CLBANDS,d=!0),this.trendType==this.TYPE.SCATTER&&(this.xPageSize=this.endTime-this.startTime,this._renderMask|=this._renderFlags.CURVES,d=!0),this.sendUpdate(a,this.endTime,c));this._forceBoundsUpdate&&this.sendUpdate(a,this.endTime,c);break;case "y0":b="string"==typeof b?parseFloat(b):b;this.y0!=b&&(this.y0=b,this.clBand&&(this._renderMask|=this._renderFlags.CLBANDS,d=!0),this.trendType==this.TYPE.SCATTER&&
(this.ySize=this.y1-this.y0,this._renderMask|=this._renderFlags.CURVES,d=!0),this.sendUpdate(a,this.y0,c));this._forceBoundsUpdate&&this.sendUpdate(a,this.y0,c);break;case "y1":b="string"==typeof b?parseFloat(b):b;this.y1!=b&&(this.y1=b,this.clBand&&(this._renderMask|=this._renderFlags.CLBANDS,d=!0),this.trendType==this.TYPE.SCATTER&&(this.ySize=this.y1-this.y0,this._renderMask|=this._renderFlags.CURVES,d=!0),this.sendUpdate(a,this.y1,c));this._forceBoundsUpdate&&this.sendUpdate(a,this.y1,c);break;
case "fill":this.fill!=b&&(this.fill=b,this._renderMask|=this._renderFlags.BGCOLOR,d=!0,this.sendUpdate(a,this.fill,c));break;case "stroke":b="string"==typeof b?parseFloat(b):b;this.stroke!=b&&(this.stroke=b,this._renderMask|=this._renderFlags.STROKE,d=!0,this.sendUpdate(a,this.stroke,c));break;case "pageDuration":b="string"==typeof b?parseFloat(b):b;if(this.pageDuration!=b){var e;this.trendType==this.TYPE.REALTIME||this.trendType==this.TYPE.HISTORY?1>b||b>this.maxXZoom?(b=-1,e=0):(this._zXIdx=b,
e=1E3*this.getPDFromIndex(b)):this.trendType==this.TYPE.SCATTER&&(e=b);this.pageDuration=this.xPageSize=e;this._updateXDuration=!0;this.clBand&&(this._renderMask|=this._renderFlags.CLBANDS,d=!0);this.sendUpdate(a,b,c)}break;case "ySize":b="string"==typeof b?parseFloat(b):b;this.ySize!=b&&(this.ySize=b,this._updateYDuration=!0,this.sendUpdate(a,this.ySize,c));break;case "cursor-timestamp":this.cursorTimestamp!=b&&(this.cursorTimestamp=b,this.sendUpdate(a,this.trendType==this.TYPE.SCATTER?this.cursorTimestamp:
new Date(this.cursorTimestamp),c));break;default:hmiWidget.prototype.setValue.call(this,a,b,c)}d&&$hmi.addToRender(this);return!0};hmiTrendWindowWgt.prototype.sendUpdateExceptCurveWgt=function(a,b,c){var d;if(this.dataLinks)for(var e in this.dataLinks)d=this.dataLinks[e],d.tag===a&&d.tgtWgt!==this&&d.tgtWgt.constructor!=hmiTrendCurveWgt&&d.setWgtValue(b,void 0,c)};
hmiTrendWindowWgt.prototype.sendUpdateCurveWgt=function(a,b){var c;if(this.dataLinks)for(var d in this.dataLinks)c=this.dataLinks[d],"min"===c.tag&&c.tgtWgt!==this&&c.tgtWgt.constructor==hmiTrendCurveWgt&&c.tgtWgt.updateMinMax(a,b)};hmiTrendWindowWgt.prototype._updateXRange=function(){this.sendUpdateExceptCurveWgt("min",this.startTime,null);this.sendUpdateExceptCurveWgt("max",this.endTime,null);this.sendUpdateCurveWgt(this.startTime,this.endTime)};
hmiTrendWindowWgt.prototype._updateYRange=function(){this.sendUpdate("y0",this.y0,null);this.sendUpdate("y1",this.y1,null)};hmiTrendWindowWgt.prototype.getValue=function(a){if("min"==a)return this.startTime;if("max"==a)return this.endTime;if("pageDuration"==a){a=this.getPDIndex(this.pageDuration);if(1>a||a>this.maxXZoom)a=-1;return a}return"cursor-timestamp"==a?this.cursorTimestamp:this[a]?this[a]:hmiWidget.prototype.getValue.call(this,a)};hmiTrendWindowWgt.prototype.forceUpdate=function(){return this._forceBoundsUpdate};
hmiTrendWindowWgt.prototype.doMouseDown=function(a){this._mvPoint.endX=this.endTime;this._mvPoint.endY=this.y1};hmiTrendWindowWgt.prototype.doMouseUp=function(a){this._prevYDiff=this._prevXDiff=-1;this._mvPoint.endX=null;this._mvPoint.endY=null};hmiTrendWindowWgt.prototype._mvPoint={endX:null,endY:null};
hmiTrendWindowWgt.prototype.doMouseMove=function(a){var b=a.deltaX,c=a.deltaY;if(this._initialized)if(a.nxtPoints)this._handlePinchEvent(a);else if(0!=b&&(b=parseInt(this._mvPoint.endX-this.xPageSize*b/this.width),a=parseInt(b-this.xPageSize),this.startTime!=a&&(this.startTime=a),this.endTime!=b&&(this.endTime=b),this.moveX=!0),0!=c&&(a=this._mvPoint.endY+this.ySize*c/this.height,c=a-this.ySize,this.y0!=c&&(this.y0=c),this.y1!=a&&(this.y1=a),this.moveY=!0),this.moveX||this.moveY)this._renderMask|=
this._renderFlags.MOVE,$hmi.addToRender(this)};hmiTrendWindowWgt.prototype._handlePinchEvent=function(a){var b=Math.abs(a.nxtPoints.x-a.x);a=Math.abs(a.nxtPoints.y-a.y);var c=!1,d=!1;0<this._prevXDiff&&(c=!0);0<this._prevYDiff&&(d=!0);(c||d)&&this.zoomOnPinchAction(c,d,b-this._prevXDiff,a-this._prevYDiff);this._prevXDiff=b;this._prevYDiff=a};
hmiTrendWindowWgt.prototype.zoomOnPinchAction=function(a,b,c,d){null!=a&&(c=c/(this.width/(this.endTime-this.startTime))/2,a=this.startTime+c,c=this.endTime-c,this.setValue("min",a,null),this.setValue("max",c,null),this.xPageSize=this.endTime-this.startTime,this.ySize=this.y1-this.y0);null!=b&&(c=d/(this.height/(this.y1-this.y0))/2,b=this.y0+c,d=this.y1-c,this.setValue("y0",b,null),this.setValue("y1",d,null),this.ySize=this.y1-this.y0);this.drawCurves()};
hmiTrendWindowWgt.prototype.changePageDuration=function(a){this.isScatter()||this.setValue("pageDuration",a,null)};hmiTrendWindowWgt.prototype.resetXYCursorValues=function(){var a=this.getAllSubscriptions(),b;for(b in a){var c=a[b].getWidget();c.constructor==hmiXYCurveWgt&&c.resetCursorValue()}};
hmiTrendWindowWgt.prototype.moveTrendWindow=function(a,b){switch(a){case "left":this.setValue("min",this.startTime-b.x,null);this.setValue("max",this.endTime-b.x,null);break;case "right":this.setValue("min",this.startTime+b.x,null);this.setValue("max",this.endTime+b.x,null);break;case "up":this.setValue("y0",this.y0+b.y,null);this.setValue("y1",this.y1+b.y,null);break;case "down":this.setValue("y0",this.y0-b.y,null),this.setValue("y1",this.y1-b.y,null)}this.drawCurves()};
hmiTrendWindowWgt.prototype.scrollTrendToTime=function(a,b){var c,d;if(void 0!=b&&!this.isScatter()){b*=1E3;switch(a){case 0:c=b;d=b+this.xPageSize;break;case 1:c=b-this.xPageSize/2;d=b+this.xPageSize/2;break;case 2:c=b-this.xPageSize,d=b}this.setValue("min",c,null);this.setValue("max",d,null)}this.drawCurves()};
hmiTrendWindowWgt.prototype.zoomX=function(a){var b;if(this.trendType==this.TYPE.REALTIME||this.trendType===this.TYPE.HISTORY)this._zXIdx||(this._zXIdx=this._initXZoom),this._zXIdx=a?1<this._zXIdx?this._zXIdx-1:this._zXIdx:this._zXIdx<=this.maxXZoom?this._zXIdx+1:this._zXIdx,this.setValue("pageDuration",this._zXIdx,null),this.drawCurves();this.trendType==this.TYPE.SCATTER&&(this.endTime>=this.startTime&&(a?this.setValue("max",this.endTime-(this.endTime-this.startTime)/3):this.setValue("max",this.startTime+
3*(this.endTime-this.startTime)/2),b=this.endTime-this.startTime),this.setValue("pageDuration",b,null),this.drawCurves())};hmiTrendWindowWgt.prototype.zoomY=function(a){var b;this.y1>=this.y0&&(this.TYPE.SCATTER?(b=this.y1-this.y0,a?this.setValue("y1",this.y1-b/3):this.setValue("y1",this.y0+3*b/2),this.setValue("ySize",this.y1-this.y0,null),this.update(),this.drawCurves()):(b=a?this.ySize-this.ySize/3:this.ySize+this.ySize/2,this.setValue("ySize",b,null)))};
hmiTrendWindowWgt.prototype.resetZoom=function(a){if(a){if(this.trendType==this.TYPE.REALTIME||this.trendType==this.TYPE.HISTORY)this._zXIdx=this._initXZoom;this.setValue("pageDuration",this._initXZoom,null)}else this.setValue("ySize",this._initYZoom,null);this.update();this.drawCurves()};hmiTrendWindowWgt.prototype.getPDIndex=function(a){for(var b in this.xDurationMap)if(this.xDurationMap[b]==parseInt(a/1E3))return parseInt(b)};
hmiTrendWindowWgt.prototype.resumeTrendTimer=function(){this._tCurrent>this.endTime&&(this._initialized=!1);this._isPaused=!1;this.load()};hmiTrendWindowWgt.prototype.stopTrendTimer=function(){this._isPaused=!0;clearInterval(this.timer)};hmiTrendWindowWgt.prototype.getPDFromIndex=function(a){return this.xDurationMap[a]};hmiTrendWindowWgt.prototype.isRealtime=function(){return this.trendType==this.TYPE.REALTIME};hmiTrendWindowWgt.prototype.isScatter=function(){return this.trendType==this.TYPE.SCATTER};
hmiTrendWindowWgt.prototype.isHistorical=function(){return this.trendType==this.TYPE.HISTORY};hmiTrendWindowWgt.prototype.getTrendType=function(){return this.trendType};hmiTrendWindowWgt.prototype.isInitialized=function(){return this._initialized};hmiTrendWindowWgt.prototype.isOnPause=function(){return this._isPaused};
hmiTrendWindowWgt.prototype.restoreDefault=function(){if(this.trendType==this.TYPE.HISTORY||this.trendType==this.TYPE.REALTIME){var a=this.enableTimeWindow();this.setValue("min",a.xStart);this.setValue("max",a.xEnd)}else this.trendType==this.TYPE.SCATTER&&(this.setValue("min",this._dStartTime),this.setValue("max",this._dEndTime));this.setValue("y0",this._dY0);this.setValue("y1",this._dY1);this.update();this.trendType!=this.TYPE.HISTORY&&this.trendType!=this.TYPE.REALTIME||this.drawCurves()};
hmiTrendWindowWgt.prototype.setView=function(a,b,c,d){if(this.trendType==this.TYPE.HISTORY||this.trendType==this.TYPE.REALTIME)b*=1E3,a*=1E3;c===d&&0===c&&(c=this._dY0,d=this._dY1);a===b&&0===a&&(this.trendType==this.TYPE.HISTORY||this.trendType==this.TYPE.REALTIME?(this.pageDuration=this.xPageSize=this._dPageDuration,b=this.enableTimeWindow(),a=b.xStart,b=b.xEnd):this.trendType==this.TYPE.SCATTER&&(a=this._dStartTime,b=this._dEndTime));this.setValue("min",a);this.setValue("max",b);this.pageDuration=
this.xPageSize=b-a;this.setValue("y0",c);this.setValue("y1",d);this.ySize=d-c;this.update();this.trendType!=this.TYPE.HISTORY&&this.trendType!=this.TYPE.REALTIME||this.drawCurves()};
hmiTrendWindowWgt.prototype.unload=function(){clearInterval(this.timer);var a=this.elem.id;this.isScatter()?($hmi.cache.setWgtProp(a,"xDuration",this.xPageSize),$hmi.cache.setWgtProp(a,"min",this.startTime),$hmi.cache.setWgtProp(a,"max",this.endTime),$hmi.cache.setWgtProp(a,"y1",this.y1)):($hmi.cache.setWgtProp(a,"xDuration",this.getPDIndex(this.pageDuration)),$hmi.cache.setWgtProp(a,"xZoom",this._zXIdx));$hmi.cache.setWgtProp(a,"y0",this.y0);$hmi.cache.setWgtProp(a,"yDuration",this.ySize);this.clBand&&
this.clBand.clearCanvasContext();$hmi.activeProject.getWidget("_TrendMgr",!0).unsubscribeWgt(this)};hmiTrendWindowWgt.prototype.destroy=function(){if(this.destroyed)return!1;this.unload();var a=$hmi.getEventMgr();a.off(this.parentPage.elem,"loadWgt",this.activateHandler);a.off(this.parentPage.elem,"unloadWgt",this.deactivateHandler);return hmiWidget.prototype.destroy.call(this)};
hmiTrendWindowWgt.prototype.subscribeWgt=function(a,b){hmiWidget.prototype.subscribeWgt.call(this,a,b);a.constructor==hmiGridWgt&&(this.grid=a)};$hmi.fn.hmiTrendWindowWgt=function(a,b,c,d){return new hmiTrendWindowWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTrendWindowWgt",hmiTrendWindowWgt);
function hmiTrendMgr(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);var f=this;this.srv=__project.getCommunticationObj();$hmi.enablePjctWidgetServerReq&&($hmi.isTestModeActive()||this.srv.getConf().done(function(a){f.conf=a["trends.json"]}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading trends configuration. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)}))}hmiTrendMgr.prototype=Object.create(hmiWidget.prototype);
hmiTrendMgr.prototype.constructor=hmiTrendMgr;hmiTrendMgr.prototype.conf=null;hmiTrendMgr.jmType="TrendMgrWgt";hmiTrendMgr.prototype.moveTrendWindow=function(a,b,c){a=this.getWidgetSubscribed(a);var d={};"page"==c?(d.x=a.xPageSize,d.y=a.y1-a.y0):(d.x=a.xPageSize/10,d.y=(a.y1-a.y0)/10);a.moveTrendWindow(b,d)};
hmiTrendMgr.prototype.showTrendCursor=function(a,b){var c=this.getWidgetSubscribed(a);if(void 0!==c){var d=c.getGridWgt();null!=d&&(d.setCursorVisibility(b),c.isScatter()&&(b||c.resetXYCursorValues(),c.refreshCurves()))}};hmiTrendMgr.prototype.scrollTrendCursor=function(a,b,c,d){a=this.getWidgetSubscribed(a);if(void 0!==a){var e=a.getGridWgt();null!=e&&(e.scrollTrendCursor(b,c,d),a.isScatter()&&a.refreshCurves())}};
hmiTrendMgr.prototype.scrollTrendToTime=function(a,b,c){this.getWidgetSubscribed(a).scrollTrendToTime(b,c)};hmiTrendMgr.prototype.refreshTrend=function(a){a=this.getWidgetSubscribed(a);for(var b in a.getAllSubscriptions()){var c=a.getWidgetSubscribed(b);c.constructor!=hmiTrendCurveWgt&&c.constructor!=hmiXYCurveWgt||c.refreshTrend()}};hmiTrendMgr.prototype.zoomTrendWindow=function(a,b,c){a=this.getWidgetSubscribed(a);c?a.zoomX(b):a.zoomY(b)};hmiTrendMgr.prototype.resetZoom=function(a,b){this.getWidgetSubscribed(a).resetZoom(b)};
hmiTrendMgr.prototype.changePageDuration=function(a,b){this.getWidgetSubscribed(a).changePageDuration(b)};hmiTrendMgr.prototype.pauseTrend=function(a){this.getWidgetSubscribed(a).stopTrendTimer()};hmiTrendMgr.prototype.resumeTrend=function(a){this.getWidgetSubscribed(a).resumeTrendTimer()};hmiTrendMgr.prototype.getCommunticationObj=function(){return this.srv};
hmiTrendMgr.prototype.getSubscribedWgtId=function(a){var b=this.getAllSubscriptions();if(b)for(var c in b){var d=b[c].getWidget();if(d.studioId==a&&d.parentPage.wgtId==$hmi.focusPage.wgtId)return c}return null};hmiTrendMgr.prototype.restoreTrendDefault=function(a){(a=this.getWidgetSubscribed(a))&&a.restoreDefault()};hmiTrendMgr.prototype.setTrendView=function(a,b,c,d,e){(a=this.getWidgetSubscribed(a))&&a.setView(b,c,d,e)};$hmi.fn.hmiTrendMgr=function(a,b,c,d){return new hmiTrendMgr(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiTrendMgr",hmiTrendMgr);function hmiIdalTrendWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.srv=$hmi.activeProject.getWidget("_TrendMgr",!0).getCommunticationObj();var f=this;if(a=$hmi.getEventMgr())f=this,this.activateHandler=function(){f.load()},this.deactivateHandler=function(){f.unload()},a.on(this.parentPage.elem,"loadWgt",this.activateHandler),a.on(this.parentPage.elem,"unloadWgt",this.deactivateHandler)}hmiIdalTrendWgt.prototype=Object.create(hmiWidget.prototype);
hmiIdalTrendWgt.prototype.constructor=hmiIdalTrendWgt;hmiIdalTrendWgt.jmType="IdalTrendWgt";hmiIdalTrendWgt.prototype.load=function(){this.enabled=!0};hmiIdalTrendWgt.prototype.unload=function(){this.enabled=!1};hmiIdalTrendWgt.prototype.subscribeDataLink=function(a){var b=a.getTargetWidget();this.srv.subscribeTrend(b,function(b,d){a.setWgtValue(d)});hmiWidget.prototype.subscribeDataLink.call(this,a)};
hmiIdalTrendWgt.prototype.unsubscribeDataLink=function(a){var b=a.getTargetWidget();b instanceof hmiTrendBufferWgt&&this.srv.unsubscribeTrend(b);hmiWidget.prototype.unsubscribeDataLink.call(this,a)};hmiIdalTrendWgt.prototype.destroy=function(){if(this.destroyed)return!1;var a=$hmi.getEventMgr();a.off(this.parentPage.elem,"loadWgt",this.activateHandler);a.off(this.parentPage.elem,"unloadWgt",this.deactivateHandler);this.unload();return hmiWidget.prototype.destroy.call(this)};
hmiIdalTrendWgt.prototype.updateBufferTimeDuration=function(a){this.srv.updateTrendSubscription(a)};$hmi.fn.hmiIdalTrendWgt=function(a,b,c,d){return new hmiIdalTrendWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiIdalTrendWgt",hmiIdalTrendWgt);
function hmiXYCurveWgt(a,b,c,d,e){hmiTrendCurveWgt.call(this,a,b,c,d,e);a=[];a.push(this.xTag);a.push(this.yTag);this.value=Array(this.maxLimit);if(b=$hmi.getEventMgr()){var f=this;this.activateHandler=function(){f.load()};b.on(this.parentPage.elem,"loadWgt",this.activateHandler)}this.srv=$hmi.activeProject.getCommunticationObj();this.srv.subscribeTags(a,function(a){})}hmiXYCurveWgt.prototype=Object.create(hmiTrendCurveWgt.prototype);hmiXYCurveWgt.prototype.constructor=hmiXYCurveWgt;
hmiXYCurveWgt.jmType="XYCurveWgt";hmiXYCurveWgt.prototype.load=function(){null==this.value&&(this.value=Array(this.maxLimit))};hmiXYCurveWgt.prototype.unload=function(){this.xvalue=this.yvalue=this.value=null;this.graph.clearData();this.clearCanvas()};
hmiXYCurveWgt.prototype.setValue=function(a,b,c,d){if(this.isBadValue(b,!1,c))return 0;switch(a){case "xvalue":this.xvalue!=b&&(this.xvalue=b,this.updateXYValue(),this.updateValues(),this.sendUpdate(a,this.xvalue,c));break;case "yvalue":this.yvalue!=b&&(this.yvalue=b,this.updateXYValue(),this.updateValues(),this.sendUpdate(a,this.yvalue,c));break;case "min":if(this.min!=b||this.trnWnd.forceUpdate())this.min=b,this.updateValues(),this.sendUpdate(a,this.min,c);break;case "max":if(this.max!=b||this.trnWnd.forceUpdate())this.max=
b,this.updateValues(),this.sendUpdate(a,this.max,c);break;case "y0":if(this.y0!=b||this.trnWnd.forceUpdate())this.y0=b,this.updateValues(),this.sendUpdate(a,this.y0,c);break;case "y1":if(this.y1!=b||this.trnWnd.forceUpdate())this.y1=b,this.updateValues(),this.sendUpdate(a,this.y1,c);break;default:hmiWidget.prototype.setValue.call(this,a,b,c)}};
hmiXYCurveWgt.prototype.getValue=function(a){switch(a){case "xvalue":a=this.xvalue;break;case "yvalue":a=this.yvalue;break;case "min":a=this.min;break;case "max":a=this.max;break;case "y0":a=this.y0;break;case "y1":a=this.y1;break;case "cursor-value":a=this.cursorValue;break;case "cursor-ts":a=this.trnWnd.getGridWgt().getXCursor();break;default:a=hmiWidget.prototype.getValue.call(this,a)}return a};
hmiXYCurveWgt.prototype.updateXYValue=function(){var a=this.trnWnd.getGridWgt();if(this.xvalue&&this.yvalue){for(var b=Math.min(this.xvalue.length,this.maxLimit),c=0;c<b;c++)void 0!==this.yvalue[c]&&(void 0!==this.value[c]?(this.value[c].x=this.xvalue[c],this.value[c].y=this.yvalue[c]):this.value[c]=new Sample(this.xvalue[c],this.yvalue[c],192));a.updateCursorGrid()}};
hmiXYCurveWgt.prototype.setXYCursorValue=function(a,b){void 0!==this.value[this.idxSelectedSample]&&this.value[this.idxSelectedSample].select(!1);var c=this.xvalue.indexOf(a);if(-1!==c){var c=this._findIndex(a,c,b),d=this.yvalue[c];void 0==d&&(c=this.xvalue.lastIndexOf(a),d=this.yvalue[c]);this.idxSelectedSample=c;this.cursorValue=d;void 0!==this.value[this.idxSelectedSample]&&this.value[this.idxSelectedSample].select(!0)}else this.cursorValue="";this.trnWnd.setValue("cursor-timestamp",a,Tag.prototype.QUALITY_GOOD);
this.sendUpdate("cursor-value",this.cursorValue,Tag.prototype.QUALITY_GOOD)};hmiXYCurveWgt.prototype._findIndex=function(a,b,c){var d=this.xvalue,e=b;b+=1;for(var f=d.length;b<f&&0<c;b++)d[b]==a&&(c--,e=b);return e};
hmiXYCurveWgt.prototype.resetCursorValue=function(){void 0!==this.value[this.idxSelectedSample]&&(this.value[this.idxSelectedSample].select(!1),this.idxSelectedSample=void 0);this.cursorValue="";this.sendUpdate("cursor-value",this.cursorValue,Tag.prototype.QUALITY_GOOD);this.trnWnd.setValue("cursor-timestamp","",Tag.prototype.QUALITY_GOOD)};hmiXYCurveWgt.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a)};
hmiXYCurveWgt.prototype.destroy=function(){$hmi.getEventMgr().off(this.parentPage.elem,"loadWgt",this.activateHandler);return hmiTrendCurveWgt.prototype.destroy.call(this)};$hmi.fn.hmiXYCurveWgt=function(a,b,c,d){return new hmiXYCurveWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiXYCurveWgt",hmiXYCurveWgt);
function hmiRecipeMgr(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);var f=this;this.srv=__project.getCommunticationObj();$hmi.enablePjctWidgetServerReq&&($hmi.isTestModeActive()||this.srv.getRecipeList(!1).then(function(a){0!=a.length&&(f.recipeList=a.join(","),f.srv.getRecipeParams("curRecipe","all").then(function(a){f.curRecipe=a;f.srv.subscribeRecipe("curRecipe",function(a,b){f.onCurrRecipeUpdate(a,b)});f._usedInCurrPage?f.srv.setRecipeNotificationRate(f._ACTIVE_POLL):f.srv.setRecipeNotificationRate(f._IDLE_POLL);
f._firstUpdate()}))}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading recipes configuration. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)}))}hmiRecipeMgr.prototype=Object.create(hmiWidget.prototype);hmiRecipeMgr.prototype.constructor=hmiRecipeMgr;hmiRecipeMgr.prototype.recipeList=[];hmiRecipeMgr.prototype.curRecipeSetList=[];hmiRecipeMgr.prototype.curRecipeSet=null;
hmiRecipeMgr.prototype.curRecipe=null;hmiRecipeMgr.prototype.curSelRecipeSet=null;hmiRecipeMgr.prototype.enSub={};hmiRecipeMgr.prototype.LinkType={RECIPE:2,SET:3,ELEM:4};hmiRecipeMgr.prototype._IDLE_POLL=8E3;hmiRecipeMgr.prototype._ACTIVE_POLL=1500;hmiRecipeMgr.prototype._usedInCurrPage=!1;hmiRecipeMgr.prototype._isRemoteSrc=!1;hmiRecipeMgr.prototype._baseProps=["recipeList","curRecipeSetList","curRecipeSet","curRecipe"];hmiRecipeMgr.jmType="RecipeMgrWgt";
hmiRecipeMgr.prototype.getValue=function(a){if("curRecipe"==a)return this.curRecipe?this.curRecipe.id:void 0;if("recipeList"==a)return this.recipeList;if("curRecipeSetList"==a)return this.curRecipe?this.curRecipe.RecipeSetList:void 0;if("curRecipeSet"==a)return this.curRecipe?this.curRecipe.selSet:void 0;var b=a.split("."),c=b[b.length-1];if(this.enSub[a])return this.enSub[a].obj[c];if($hmi.initPageLogic)return null;a=b.length;var d,e;a==this.LinkType.RECIPE&&this.srv.getRecipeParam(b[0],c,!0).then(function(a){e=
a.err;d=a.v}).fail(function(){e="Failed Request."});a==this.LinkType.SET&&this.srv.getRecipeSetParam(b[0],b[1],c,!0).then(function(a){e=a.err;d=a.v}).fail(function(){e="Failed Request."});a==this.LinkType.ELEM&&this.srv.getRecipeElemParam(b[0],b[1],b[2],c,!0).then(function(a){e=a.err;d=a.v}).fail(function(){e="Failed Request."});e&&$hmi.notifyWarning("Recipe Manager","REST status:"+e);return d};
hmiRecipeMgr.prototype.setValue=function(a,b,c,d){c=!1;if("curRecipe"==a)this.curRecipe.id!=b&&(this.curRecipe.id=b,this._isRemoteSrc||this.srv.setCurrentRecipe(this.curRecipe.id,null,!1),c=!0);else if("curRecipeSetList"==a)this.curRecipe.RecipeSetList!=b&&(this.curRecipe.RecipeSetList=b,c=!0);else if("curRecipeSet"==a)this.curRecipe.selSet!=b&&(this.curRecipe.selSet=b,this._isRemoteSrc||this.srv.setCurrentRecipe(this.curRecipe.id,this.curRecipe.selSet,!1),c=!0);else if("recipeList"==a)this.recipeList!=
b&&(this.recipeList=b,c=!0);else{if(!a)return;d=a.split(".");var e=d.length,f=d[e-1];if(this.enSub[a]&&this.enSub[a].en){var g=this.enSub[a],e=g.type;b instanceof RecipeObj&&(b=b[f]);void 0!=b&&g.obj[f]!=b&&(g.obj[f]=b,c=!0)}else c=!0;!this._isRemoteSrc&&c&&(e==this.LinkType.RECIPE&&this.srv.setRecipeParam(d[0],b,!1),e==this.LinkType.SET&&(this.srv.setRecipeSetParam(d[0],d[1],f,b,!1),d[0]==this.curRecipe.id&&this.sendUpdate("curRecipeSet",b,Tag.prototype.QUALITY_GOOD)),e==this.LinkType.ELEM&&this.srv.setRecipeElemParam(d[0],
d[1],d[2],f,b,!1))}c&&this.sendUpdate(a,b,Tag.prototype.QUALITY_GOOD)};
hmiRecipeMgr.prototype.subscribeDataLink=function(a){hmiWidget.prototype.subscribeDataLink.call(this,a);var b=a.tag.split("."),c=b.length;a=a.tag;this._usedInCurrPage||(this._usedInCurrPage=!0,this.srv.setRecipeNotificationRate(this._ACTIVE_POLL));if(-1==this._baseProps.indexOf(a)){var d=this;this.enSub[a]&&this.enSub[a].en||(this.enSub[a]={en:!0,type:c},c==this.LinkType.RECIPE?("RecipeSetList"==b[1]?this.srv.subscribeRecipeSetList(b[0],function(a,b){d.onDataUpdate(a,b)}):this.srv.subscribeRecipe(b[0],
function(a,b){d.onDataUpdate(a,b)}),this.enSub[a].obj=new Recipe):c==this.LinkType.SET?(this.srv.subscribeRecipeSet(b[0],b[1],function(a,b){d.onDataUpdate(a,b)}),this.enSub[a].obj=new RecipeSet):c==this.LinkType.ELEM&&(this.srv.subscribeRecipeSetElem(b[0],b[1],b[2],function(a,b){d.onDataUpdate(a,b)}),this.enSub[a].obj=new RecipeSetElem))}};
hmiRecipeMgr.prototype.onCurrRecipeUpdate=function(a,b){this._isRemoteSrc=!0;this.setValue("curRecipe",b.id);void 0!=b.RecipeSetList&&this.setValue("curRecipeSetList",b.RecipeSetList);void 0!=b.selSet&&this.setValue("curRecipeSet",b.selSet);void 0!=b.rcList&&this.setValue("recipeList",b.rcList);this._isRemoteSrc=!1};hmiRecipeMgr.prototype.onDataUpdate=function(a,b){this._isRemoteSrc=!0;this.setValue(a,b);this._isRemoteSrc=!1};
hmiRecipeMgr.prototype._firstUpdate=function(){for(var a=this._baseProps,b=0,c=a.length;b<c;b++)this.sendUpdate(a[b],this.getValue(a[b]),Tag.prototype.QUALITY_GOOD)};
hmiRecipeMgr.prototype.onPageChange=function(){this.srv.setRecipeNotificationRate(this._IDLE_POLL);this._usedInCurrPage=!1;for(var a in this.enSub){var b=a.split("."),c=b.length;this.enSub[a]&&this.enSub[a].en&&(c==this.LinkType.RECIPE?"RecipeSetList"==b[1]?this.srv.unsubscribeRecipeSetList(b[0]):this.srv.unsubscribeRecipe(b[0]):c==this.LinkType.SET?this.srv.unsubscribeRecipeSet(b[0],b[1]):c==this.LinkType.ELEM&&this.srv.unsubscribeRecipeSetElem(b[0],b[1],b[2]),this.enSub[a].en=!1)}};
hmiRecipeMgr.prototype.getRecipeItem=function(a,b,c){var d=a+"."+b+"."+c+".Value";return this.enSub[d]&&this.enSub[d].en?this.getValue(d):this.srv.getRecipeElemParam(a,b,c)};hmiRecipeMgr.prototype.setRecipeItem=function(a,b,c){};$hmi.fn.hmiRecipeMgr=function(a,b,c,d){return new hmiRecipeMgr(this,a,b,c,d)};function hmiRecipeWgt(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e)}hmiRecipeWgt.prototype=Object.create(hmiWidget.prototype);hmiRecipeWgt.prototype.constructor=hmiRecipeWgt;
hmiRecipeWgt.jmType="RecipeWgt";$hmi.fn.hmiRecipeWgt=function(a,b,c,d){return new hmiRecipeWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiRecipeWgt",hmiRecipeWgt);
function hmiUserGroupMgr(a,b,c,d,e){hmiWidget.call(this,a.wgtId,b,c,d,e);this.initPromiseReady();var f=this;this.srv=$hmi.activeProject.getCommunticationObj();this._isChangePasswdAction=this._isDefaultUser=this._initialized=!1;this._logOffTimer={};$hmi.enablePjctWidgetServerReq&&(this.infologin={},this.commoninfo={},this.srv.getConf().done(function(a){a=f._deepFreeze(a["usermgmt.json"]);f._securityEnable=a.securityEnable;f._forceRemoteLogin=a.forceRemoteLogin;a.common&&(f.commoninfo.pwdd=a.common.pwdDuration);
if(f._securityEnable){f._loadGroupObject();var b=f._getUserInfos(a);if(null!=b){var c=b.grobj;f._initialized=!0;f._auth=c.authUI;f._homepage=c.homepage;f._useLastVisitedPage=c.useLastVisitedPage;a.defUsr==b.name&&a.defUsrGrp==b.grname&&(f._isDefaultUser=!0);f.currentUser.username=b.name;f.currentUser.group=b.grname;f.currentUser.idxot=b.idxot;f.currentUser.exception=b.exception;f.sendNotification("login");""!=$hmi.urlParameters.token&&(f.currentToken=$hmi.urlParameters.token);f._updateCurrentUser();
f.saveValue("_hmiusergroup");c.timers&&f.startTimer(null!=c.timers[b.idxot]?c.timers[b.idxot]:b.idxot,function(){$hmi.getAction("hmiActionLogOut").execute()})}else $hmi.getAction("hmiActionLogOut").execute()}else f._initialized=!0;f.resolveWgtReady(!0)}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading user management map. Reloading..."},3);setTimeout(function(){$hmi.getAction("hmiActionLogOut").execute()},1E3)}))}hmiUserGroupMgr.prototype=Object.create(hmiWidget.prototype);
hmiUserGroupMgr.prototype.constructor=hmiUserGroupMgr;hmiUserGroupMgr.prototype.templatesDir="../umtemplates/";hmiUserGroupMgr.prototype.wgtAuth={HIDE:0,RDONLY:1,FULL:2,DEFAULT:3};hmiUserGroupMgr.prototype.actAuth={NOTALLOWED:0,ALLOWED:1,DEFAULT:2};hmiUserGroupMgr.prototype.currentUser={username:"",group:"",idxot:""};
hmiUserGroupMgr.prototype.serverCodes={1:"#S_OK",2:"#S_OK_PWD_WILL_EXPIRE",3:"#S_OK_NEED_PASWD_CHANGE",50:"#E_FAIL",49:"#E_USER_DONT_EXIST",48:"#E_GROUP_DONT_EXIST",47:"#E_NO_GROUP_SPECIFIED",46:"#E_USER_ALREADY_EXIST",45:"#E_PASS_DONT_MATCH",44:"#E_UNAUTHORIZED_USER",43:"#E_NO_SESSION_EXIST",42:"#E_SESSION_EXPIRED",41:"#E_SESSION_ALREADY_EXIST",40:"#E_LOGIN_FAIL",39:"#E_RE_LOGIN_ATTEMPT",38:"#E_NEED_LOGIN",37:"#E_TOO_MANY_USERS",36:"#E_FTP_READ_FORBIDDEN",35:"#E_FTP_WRITE_FORBIDDEN",34:"#E_NOT_ALLOWED",
33:"#E_INVALIDARG",32:"#E_ILLEGAL_FORMAT",31:"#E_ACCES_DENIED",30:"#E_CHANGE_PASSWORD",29:"#E_MUST_CONTAIN_SPECIAL_CHAR",28:"#E_MUST_CONTAIN_NUMBERS",27:"#E_PASSWORD_TOO_SHORT",26:"#E_SIMILAR_PREV_PSWD",25:"#E_PASSWORD_EXPIRED"};hmiUserGroupMgr.prototype.changePswdServerCodeMap={"#S_OK":0,"#S_OK_PWD_WILL_EXPIRE":14,"#E_PASS_DONT_MATCH":6,"#E_NOT_ALLOWED":6,"#E_CHANGE_PASSWORD":13,"#E_MUST_CONTAIN_SPECIAL_CHAR":9,"#E_MUST_CONTAIN_NUMBERS":8,"#E_PASSWORD_TOO_SHORT":7,"#E_SIMILAR_PREV_PSWD":10,"#E_PASSWORD_EXPIRED":13};
hmiUserGroupMgr.prototype.backwardCompatibilityChangePwdMsg=";Error : You are not authorized. Please contact administrator;Error : Connection lost with the Runtime. Please verify the Runtime status;Error : The username or password you entered is incorrect;Error : The password entered is incorrect;Error : Action cannot be executed;Error : Passwords do not match;Error: Password length too short;Error: Password must contain numbers;Error: Password must contain special characters;Error: Password must be different than previous passwords;Error : User already exist;Error:Password cannot be empty;Error: Your password has expired;Warning: Your password will expire soon".split(";");
hmiUserGroupMgr.jmType="UserGroupMgrWgt";hmiUserGroupMgr.prototype.getValue=function(a){return"username"==a?this.currentUser.username:"group"==a?this.currentUser.group:null};
hmiUserGroupMgr.prototype._getUserInfos=function(a){var b;if(""!=$hmi.urlParameters.usr){var c=!1,d;for(d in a)if("object"==typeof a[d]&&a[d].users){var e=a[d].users.indexOf($hmi.urlParameters.usr);if(-1!=e){b={name:$hmi.urlParameters.usr,grname:d,grobj:a[d],idxot:e,exception:a[d].exceptions[e]};c=!0;break}}c||(b={name:$hmi.urlParameters.usr,grname:$hmi.urlParameters.g,grobj:a[$hmi.urlParameters.g],idxot:$hmi.urlParameters.ot,exception:!1})}else if(null!=this._hmiusergroup)b={},b.name=this._hmiusergroup.lastUser,
b.grname=this._hmiusergroup.lastGroup,b.grobj=a[this._hmiusergroup.lastGroup],b.idxot=this._hmiusergroup.lastOt,b.exception=this._hmiusergroup.lastException;else if(this.srv.isLogged())if(a.defUsr&&a.defUsrGrp)b={name:a.defUsr,grname:a.defUsrGrp,grobj:a[a.defUsrGrp],idxot:a[a.defUsrGrp].users.indexOf(a.defUsr),exception:a[a.defUsrGrp].exceptions.indexOf(a.defUsr)};else return null;else return null;return b};
hmiUserGroupMgr.prototype._deepFreeze=function(a){for(var b in a)"object"==typeof a[b]&&null!==a[b]&&this._deepFreeze(a[b]);return Object.freeze(a)};
hmiUserGroupMgr.prototype._updateCurrentUser=function(){null==this._hmiusergroup?this._hmiusergroup={lastUser:this.currentUser.username,lastGroup:this.currentUser.group,lastOt:this.currentUser.idxot,lastException:this.currentUser.exception,grps:[]}:(this._hmiusergroup.lastUser=this.currentUser.username,this._hmiusergroup.lastGroup=this.currentUser.group,this._hmiusergroup.lastOt=this.currentUser.idxot,this._hmiusergroup.lastException=this.currentUser.exception)};
hmiUserGroupMgr.prototype._storeGroup=function(a){for(var b=!0,c=0;c<this._hmiusergroup.grps.length;c++){var d=this._hmiusergroup.grps[c];if(d.name==a.name&&d.pjct==a.pjct){this._hmiusergroup.grps.splice(c,1,a);b=!1;break}}b&&this._hmiusergroup.grps.push(a);return this.saveValue("_hmiusergroup")};
hmiUserGroupMgr.prototype._storeObject=function(){this._hmiusergroup=this.loadValue("_hmiusergroup");this._updateCurrentUser();this._storeGroup({page:{id:$hmi.activePage.studioId,type:$hmi.activePage.constructor==hmiProject?0:1},pjct:$hmi.activeProject.studioId,name:this.currentUser.group})};
hmiUserGroupMgr.prototype.loadLastPageUsed=function(){var a=$hmi.activeProject.studioId,b=this.currentUser.group;if(null!=this._hmiusergroup)for(var c in this._hmiusergroup.grps){var d=this._hmiusergroup.grps[c];if(d.name==b&&d.pjct==a&&1==d.page.type)return d.page.id}return null};hmiUserGroupMgr.prototype.storeLastPageUsed=function(){this._storeObject()};hmiUserGroupMgr.prototype._loadGroupObject=function(){this._hmiusergroup=this.loadValue("_hmiusergroup")};
hmiUserGroupMgr.prototype.getWidgetTreeAuthorizations=function(a){var b=this._isWidgetInMap(a);return b==this.wgtAuth.DEFAULT&&a.parentWidget?this.getWidgetTreeAuthorizations(a.parentWidget):b};hmiUserGroupMgr.prototype.getActionTreeAuthorizations=function(a,b,c){return this._isActionInMap(a,b,c)==this.actAuth.DEFAULT&&a.parentWidget?this.getActionTreeAuthorizations(a.parentWidget,b,c):this._isActionInMap(a,b,c)};
hmiUserGroupMgr.prototype._isWidgetInMap=function(a){if(null!=this._auth.widgets){if(a.parentPage){var b=a.isTemplateWgt?a.parentPage.templateStudioId:a.parentPage.studioId;if(this._auth.widgets[b]&&null!=this._auth.widgets[b][a.studioId])return this._auth.widgets[b][a.studioId]}if(null!=this._auth.widgets[a.studioId]&&null!=this._auth.widgets[a.studioId][a.studioId])return this._auth.widgets[a.studioId][a.studioId];if(null!=this._auth.widgets[a.elem.dataset.widget])return this._auth.widgets[a.elem.dataset.widget];
if(a.ctype&&null!=this._auth.widgets[a.ctype])return this._auth.widgets[a.ctype]}return this.wgtAuth.DEFAULT};
hmiUserGroupMgr.prototype._isActionInMap=function(a,b,c){if(null!=this._auth.actions){if(a.parentPage){var d=a.isTemplateWgt?a.parentPage.templateStudioId:a.parentPage.studioId;if(this._auth.actions[d]){if(null!=this._auth.actions[d][c])return this._auth.actions[d][c][a.studioId];if(null!=this._auth.actions[d][d])return this._auth.actions[d][d]}}return null!=this._auth.actions[a.studioId]&&null!=this._auth.actions[a.studioId][c]?this._auth.actions[a.studioId][c][a.studioId]:null!=this._auth.actions[b]?
this._auth.actions[b]:this.actAuth.DEFAULT}};hmiUserGroupMgr.prototype.startTimer=function(a,b){0<a&&(this._logOffTimer.callback=b,this._logOffTimer.interval=6E4*a,this._logOffTimer.timer=setTimeout(this._logOffTimer.callback,this._logOffTimer.interval))};hmiUserGroupMgr.prototype.resetTimer=function(){this._logOffTimer.timer&&(clearTimeout(this._logOffTimer.timer),this._logOffTimer.timer=setTimeout(this._logOffTimer.callback,this._logOffTimer.interval))};
hmiUserGroupMgr.prototype.trigger=function(a){"almgrready"==a&&this._initAlarmConfiguration()};hmiUserGroupMgr.prototype.loadUMForm=function(a,b){this._isChangePasswdAction=!0;(new hmiActionLoadPage).execute(a,{pg:b})};
hmiUserGroupMgr.prototype.changePwdAction=function(){var a=this.currentUser.username;if("changepassword"==$hmi.activePage.studioId){var b=this.getFormFields(),c=null==b[0].getValue("value")?"":b[0].getValue("value"),d=null==b[1].getValue("value")?"":b[1].getValue("value"),e=null==b[2].getValue("value")?"":b[2].getValue("value");if(d!=e)this.printMessage(this.changePswdServerCodeMap["#E_PASS_DONT_MATCH"]),this.clearFormFields([b[1],b[2]]);else{var f=this;this.srv.changePwd(a,c,d,!1).then(function(a){null!=
f.changePswdServerCodeMap[a.code]&&("#S_OK"==a.code?$hmi.enablePjctWidgetServerReq?$hmi.getAction("hmiActionLogOut").execute():-1==$hmi.urlParameters.code?$hmi.getAction("hmiActionLogOut").execute():location.href=window.location.protocol+"//"+window.location.host+"/index.html":(f.printMessage(f.changePswdServerCodeMap[a.code]),f.clearFormFields([b[0],b[1],b[2]])))})}}};
hmiUserGroupMgr.prototype.getFormFields=function(){var a=[];if("changepassword"==$hmi.activePage.studioId){var b=null==$hmi.activePage.getWidget("oldpassword_edit",!0)?$hmi.activePage.getWidget("ChangePwdEditWgt1.oldpassword_edit",!0):$hmi.activePage.getWidget("oldpassword_edit",!0),c=null==$hmi.activePage.getWidget("newpassword_edit",!0)?$hmi.activePage.getWidget("ChangePwdEditWgt1.newpassword_edit",!0):$hmi.activePage.getWidget("newpassword_edit",!0),d=null==$hmi.activePage.getWidget("confirmpassword_edit",
!0)?$hmi.activePage.getWidget("ChangePwdEditWgt1.confirmpassword_edit",!0):$hmi.activePage.getWidget("confirmpassword_edit",!0);a.push(b);a.push(c);a.push(d);a.push($hmi.activePage.getWidget("error_msg",!0))}return a};hmiUserGroupMgr.prototype.isUMTemplate=function(a){a instanceof Array&&(a=a[0]);var b=a.split("/");1<b.length&&(a=b[b.length-1]);return-1!=$hmi.umTemplates.indexOf(a)?!0:!1};
hmiUserGroupMgr.prototype.getMappedErrorCode=function(a){switch($hmi.activePage.studioId){case "changepassword":return this.changePswdServerCodeMap[this.serverCodes[Math.abs(a)]];default:return-1}};hmiUserGroupMgr.prototype.printMessage=function(a){if(null!=a){var b=$hmi.activePage.getWidget("error_msg",!0);b.constructor==hmiMsgText?b.setValue("value",a,null,null):b.setValue("value",this.backwardCompatibilityChangePwdMsg[a],null,null)}};
hmiUserGroupMgr.prototype.checkMessages=function(){null==$hmi.urlParameters.code||this._isChangePasswdAction||this.isUMTemplate($hmi.activePage.studioId)&&this.printMessage(this.getMappedErrorCode($hmi.urlParameters.code))};hmiUserGroupMgr.prototype.clearFormFields=function(a){for(var b in a){var c=a[b];c.constructor==hmiMsgText?c.setValue("value",-1):c.setValue("value","")}};hmiUserGroupMgr.prototype.clearAll=function(){this.clearFormFields(this.getFormFields())};
hmiUserGroupMgr.prototype.isDataReady=function(){return this._initialized};hmiUserGroupMgr.prototype.getHomePage=function(){return this._homepage};hmiUserGroupMgr.prototype.useLastGroupPage=function(){return this._useLastVisitedPage};hmiUserGroupMgr.prototype.getAuthorizationMap=function(){return this._auth};hmiUserGroupMgr.prototype.isSecurityEnabled=function(){return this._securityEnable};hmiUserGroupMgr.prototype.isDefaultUser=function(){return this._isDefaultUser};
hmiUserGroupMgr.prototype.isForceRemoteLoginEnabled=function(){return this._forceRemoteLogin};hmiUserGroupMgr.prototype.setCurrentUser=function(a){this.currentUser.username=a};hmiUserGroupMgr.prototype.setPwdDuration=function(a){this.infologin.exDur=a};hmiUserGroupMgr.prototype.setDayRemainigs=function(a){this.infologin.exDays=a};$hmi.fn.hmiUserGroupMgr=function(a,b,c,d){return new hmiUserGroupMgr(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiUserGroupMgr",hmiUserGroupMgr);
var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),BARGRAPH_TYPE;
(function(a){a[a.SEGMENTS=0]="SEGMENTS";a[a.HRZ_STRETCH=1]="HRZ_STRETCH";a[a.VRT_STRETCH=2]="VRT_STRETCH";a[a.VRT=3]="VRT";a[a.HRZ=4]="HRZ"})(BARGRAPH_TYPE||(BARGRAPH_TYPE={}));
var hmiBarGraph=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.setDefaultState();b.type==BARGRAPH_TYPE.VRT_STRETCH||b.type==BARGRAPH_TYPE.HRZ_STRETCH?b.bar=b.elem.getElementsByTagName("svg")[0]:(b.background=b.elem.getElementsByClassName("bargraph-bk")[0],b.bar=b.elem.getElementsByClassName("bargraph-bar")[0]);return b}__extends(b,a);b.prototype.setDefaultState=function(){this.min=void 0===this.min?0:this.min;this.max=void 0===this.max?100:this.max;this.color=this.color?
this.color:"rgb(170,170,170)";this.backgroundColor=void 0==this.backgroundColor?"none":this.backgroundColor;this.nodes=void 0===this.nodes?0:this.nodes;this.reverse=void 0===this.reverse?!1:this.reverse;this.gpuEnabled=void 0===this.gpuEnabled?!0:this.gpuEnabled;this.type=void 0===this.type?BARGRAPH_TYPE.SEGMENTS:this.type;this._renderMask=0};b.prototype.setValue=function(c,d,e,f){var g="#000";if("value"===c){if(this.isBadValue(d,!1,e))return!1;d=parseFloat(d);if(isNaN(d))return!1;d!=this.value&&
(d>this.max?d=this.max:d<this.min&&(d=this.min),this.value=d,this.elem&&this.elem.setAttribute("data-v",this.value.toString()),this._renderMask|=b._renderFlags.VALUE,$hmi.addToRender(this),this.sendUpdate(c,this.value,e))}else if("fill"===c){if(this.isBadValue(d,!1,e))return!1;this.color!=d&&(this.color=d,this._renderMask|=b._renderFlags.FILL,$hmi.addToRender(this),this.sendUpdate(c,d,e))}else if("color"==c||"Color"==c)if(isNaN(d)){if(this.isBadValue(d,!0,e))return this.backgroundColor=g,this._renderMask|=
b._renderFlags.COLOR,$hmi.addToRender(this),!1;this.backgroundColor!=d&&(0==d.indexOf("#")&&1<d.length&&8>=d.length&&(g=d),this.backgroundColor=g,this._renderMask|=b._renderFlags.COLOR,$hmi.addToRender(this),this.sendUpdate(c,g,e))}else this._renderMask|=b._renderFlags.COLOR,$hmi.addToRender(this),this.backgroundColor=g;else if("min"==c){if(this.isBadValue(d,!1,e))return!1;d!=this.min&&(d>this.max&&(d=this.max),this.min=d,this._renderMask|=b._renderFlags.VALUE,$hmi.addToRender(this),this.sendUpdate(c,
this.min,e))}else if("max"==c){if(this.isBadValue(d,!1,e))return!1;d!=this.max&&(d<this.min&&(d=this.min),this.max=d,this._renderMask|=b._renderFlags.VALUE,$hmi.addToRender(this),this.sendUpdate(c,this.max,e))}else a.prototype.setValue.call(this,c,d,e,f);return!0};b.prototype.render=function(){a.prototype.render.call(this);if(this._renderMask&b._renderFlags.VALUE){var c=0;if(this.type==BARGRAPH_TYPE.SEGMENTS)this.colorSegments();else if(this.type==BARGRAPH_TYPE.HRZ_STRETCH)c=(this.value-this.min)/
(this.max-this.min),$hmi.modernBrowser?setTransform(this.bar,"translateZ(0) scaleX("+c+")"):setTransform(this.bar,"scaleX("+c+")");else if(this.type==BARGRAPH_TYPE.VRT_STRETCH)c=(this.value-this.min)/(this.max-this.min),$hmi.modernBrowser?setTransform(this.bar,"translateZ(0) scaleY("+c+")"):setTransform(this.bar,"scaleY("+c+")");else if($hmi.modernBrowser){var c=(this.value-this.min)/(this.max-this.min),d;if(this.type==BARGRAPH_TYPE.HRZ_STRETCH||this.type==BARGRAPH_TYPE.HRZ)d="translateZ(0) scaleX("+
c+")";else if(this.type==BARGRAPH_TYPE.VRT_STRETCH||this.type==BARGRAPH_TYPE.VRT)d="translateZ(0) scaleY("+c+")";setTransform(this.bar,d)}else d=this.bar.style,this.type==BARGRAPH_TYPE.VRT?(c=this.height*(this.value-this.min)/(this.max-this.min),this.reverse||(d.top=this.height-c+"px"),d.height=c+"px"):this.type==BARGRAPH_TYPE.HRZ&&(c=this.width*(this.value-this.min)/(this.max-this.min),this.reverse&&(d.left=this.width-c+"px"),d.width=c+"px")}if(this._renderMask&b._renderFlags.FILL)switch(this.type){case BARGRAPH_TYPE.SEGMENTS:this.colorSegments();
break;case BARGRAPH_TYPE.HRZ_STRETCH:case BARGRAPH_TYPE.VRT_STRETCH:this.bar.firstElementChild.setAttribute("fill",this.color);break;default:this.bar.style.backgroundColor=this.color}if(this._renderMask&b._renderFlags.COLOR)switch(this.type){case BARGRAPH_TYPE.SEGMENTS:this.colorSegments();break;default:this.background.style.backgroundColor=this.backgroundColor}if(this._renderMask&b._renderFlags.UPDATESVG&&this.elem.getElementsByTagName("svg")[0]){c=this.elem.getElementsByTagName("svg")[0];d=this.width/
parseFloat(c.getAttribute("width"));var e=this.height/parseFloat(c.getAttribute("height"));setTransformOrigin(c,"top left");setTransform(c,"scale("+d+","+e+")")}this._renderMask=0};b.prototype.colorSegments=function(){var a=Math.floor((this.value-this.min)/(this.max-this.min)*this.nodes);this.reverse&&(a=this.nodes-a);for(var b="",e=1;e<=this.nodes;e++){var f=this.elem.querySelector(".hmi-bar-seg-"+e),b=e<=a?this.color:this.backgroundColor;null!=f.style.fill&&(f.style.fill=b);f.setAttribute("fill",
b)}};b.prototype.getValue=function(b){return"value"==b?this.value:a.prototype.getValue.call(this,b)};b.prototype.setParentBounds=function(c,d,e,f,g){a.prototype.setParentBounds.call(this,c,d,e,f,g);this._renderMask|=b._renderFlags.UPDATESVG;$hmi.addToRender(this)};b.prototype.destroy=function(){this.bar=this.background=null;return a.prototype.destroy.call(this)};b._renderFlags={VALUE:2,FILL:4,COLOR:8,UPDATESVG:16};b.jmType="BargraphWgt";return b}(hmiWidget);
$hmi.fn.hmiBarGraph=function(a,b,c,d){return new hmiBarGraph(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiBarGraph",hmiBarGraph);function testTs1(a){return"TypeScript work:"+a}
var hmiGenericCanvasWgt=function(a){function b(b,d,e,f,g){var h=a.call(this,b.wgtId,d,e,f,g)||this;h.authCode=h.getAuthorizations();h.cnvId=h.wgtId+"_gcnv";h.cnvEl=document.getElementById(h.cnvId);h.context2d=h.cnvEl.getContext("2d");h.applyContextTransformations();h.events={mousedown:!0,touchstart:!0};if(b=$hmi.getEventMgr())h.activateHandler=function(){h.update()},b.on(h.parentPage.elem,"loadWgt",h.activateHandler);return h}__extends(b,a);b.prototype.render=function(){a.prototype.render.call(this);
if(this._renderMask&b._renderFlags.DRAW&&this.onDraw)for(var c=this.onDraw,d=0;d<c.length;d++)$hmi.doAction(this.wgtId,c[d]);this._renderMask&b._renderFlags.RESIZE&&(this.cnvEl.width=this.width,this.cnvEl.height=this.height);this._renderMask=0};b.prototype.applyContextTransformations=function(){var a=this.width/this.cnvW,b=this.height/this.cnvH;switch(this.rdrHint){case 1:this.context2d.scale(Math.min(a,b),Math.min(a,b));break;case 2:this.context2d.scale(a,b)}};b.prototype.setValue=function(b,d,e,
f,g){a.prototype.setValue.call(this,b,d,e,f,g);this.update()};b.prototype.update=function(){this.autoClear&&this.clearCanvasContext();this._renderMask|=b._renderFlags.DRAW;$hmi.addToRender(this)};b.prototype.clearCanvasContext=function(){this.context2d.clearRect(0,0,this.width,this.height)};b.prototype.doMouseDown=function(){if(this.authCode==this.umgr.wgtAuth.RDONLY)return!1};b.prototype.doMouseUp=function(){if(this.authCode==this.umgr.wgtAuth.RDONLY)return!1};b.prototype.doMouseMove=function(){if(this.authCode==
this.umgr.wgtAuth.RDONLY)return!1};b.prototype.destroy=function(){if(this.destroyed)return!1;this.clearCanvasContext();return a.prototype.destroy.call(this)};b.prototype.setParentBounds=function(c,d,e,f,g){a.prototype.setParentBounds.call(this,c,d,e,f,g);this._renderMask|=b._renderFlags.RESIZE;$hmi.addToRender(this)};b.jmType="GenericCanvasWgt";b._renderFlags={DRAW:2,RESIZE:4};return b}(hmiWidget);$hmi.fn.hmiGenericCanvasWgt=function(a,b,c,d){return new hmiGenericCanvasWgt(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiGenericCanvasWgt",hmiGenericCanvasWgt);
var hmiJSFunctBlock=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.values={value1:null,value2:null,value3:null,value4:null,value5:null,value6:null,value7:null,value8:null,value9:null,value10:null,value11:null,value12:null,value13:null,value14:null,value15:null,value16:null};return b}__extends(b,a);b.prototype.setValue=function(a,b,e){this.values[a]!=b&&void 0!=b&&(this.values[a]=b,this.sendUpdate(a,b,e))};b.prototype.getValue=function(a){return this.values[a]};b.prototype.setParentBounds=
function(a,b,e,f,g){};b.prototype.getParentBounds=function(a){return{x:0,y:0,width:0,height:0}};b.prototype.destroy=function(){this.values=null;return this.destroyed?!1:a.prototype.destroy.call(this)};b.jmType="JSFunctBlockWgt";return b}(hmiWidget);
Object.defineProperties(hmiJSFunctBlock.prototype,{value1:{get:function(){return this.getValue("value1")},set:function(a){this.setValue("value1",a,null)}},value2:{get:function(){return this.getValue("value2")},set:function(a){this.setValue("value2",a,null)}},value3:{get:function(){return this.getValue("value3")},set:function(a){this.setValue("value3",a,null)}},value4:{get:function(){return this.getValue("value4")},set:function(a){this.setValue("value4",a,null)}},value5:{get:function(){return this.getValue("value5")},
set:function(a){this.setValue("value5",a,null)}},value6:{get:function(){return this.getValue("value6")},set:function(a){this.setValue("value6",a,null)}},value7:{get:function(){return this.getValue("value7")},set:function(a){this.setValue("value7",a,null)}},value8:{get:function(){return this.getValue("value8")},set:function(a){this.setValue("value8",a,null)}},value9:{get:function(){return this.getValue("value9")},set:function(a){this.setValue("value9",a,null)}},value10:{get:function(){return this.getValue("value10")},
set:function(a){this.setValue("value11",a,null)}},value11:{get:function(){return this.getValue("value11")},set:function(a){this.setValue("value11",a,null)}},value12:{get:function(){return this.getValue("value12")},set:function(a){this.setValue("value12",a,null)}},value13:{get:function(){return this.getValue("value13")},set:function(a){this.setValue("value13",a,null)}},value14:{get:function(){return this.getValue("value14")},set:function(a){this.setValue("value14",a,null)}},value15:{get:function(){return this.getValue("value15")},
set:function(a){this.setValue("value15",a,null)}},value16:{get:function(){return this.getValue("value16")},set:function(a){this.setValue("value16",a,null)}}});$hmi.fn.hmiJSFunctBlock=function(a,b,c,d){return new hmiJSFunctBlock(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiJSFunctBlock",hmiJSFunctBlock);
var hmiGroupSubscribeWgt=function(a){function b(b,d,e,f,g){d=a.call(this,b.wgtId,d,e,f,g)||this;d.groupName=b.wgtId;d.srv=$hmi.activeProject.getCommunticationObj();d.tagMgr=void 0!==d.tagMgr?d.tagMgr:null;d.tags=void 0!==d.tags?d.tags:null;d._cbId=void 0!==d._cbId?d._cbId:null;return d}__extends(b,a);b.prototype.stop=function(){__tagMgr.unsubscribeGroup(this.wgtId)};b.prototype.getCallbackId=function(){return this._cbId};b.prototype.setCallbackId=function(a){this._cbId=a};b.prototype.destroy=function(){this.tagMgr=
this.tags=null;hmiWidget.prototype.destroy.call(this)};b.prototype.containsTag=function(a){return 1===this.tags[a]};b.prototype.removeDataLink=function(a){};b.jmType="GroupSubscribeWgt";return b}(hmiWidget);$hmi.fn.hmiGroupSubscribeWgt=function(a,b,c,d){return new hmiGroupSubscribeWgt(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiGroupSubscribeWgt",hmiGroupSubscribeWgt);
var hmiIndexedTagSetMgr=function(a){function b(b,d,e,f,g){var h=a.call(this,b.wgtId,d,e,f,g)||this;h.tagSetsData={};h.activeCgiGroups={};h.dataLinks={};h.mapIdxToName={};h.idxsInPage={};h.srv=h.parentWidget.getCommunticationObj();h.initPromiseReady();h.initialized=!1;h.tagsToUnsubscr=[];h.tagMgr=$hmi.activeProject.getWidget("_TagMgr",!0);h.tagMgr.subscribeWgt(h,function(a,b){h.trigger(a,b)});if(!$hmi.enablePjctWidgetServerReq)return h;h.srv.getConf().done(function(a){h.tagSetsData=a["indexedtagset.json"];
h.generateMapIdxToName();h.resolveWgtReady();h.initialized=!0}).fail(function(){$hmi.getAction("hmiActionShowMessage").execute(null,{msg:"Error loading indexed tag configuration file. Reloading..."},3);setTimeout(function(){location.href=window.location.protocol+"//"+location.host+"/index.html"},2E3)});return h}__extends(b,a);b.prototype.generateMapIdxToName=function(){for(var a in this.tagSetsData)null==this.mapIdxToName[this.tagSetsData[a].idx]&&(this.mapIdxToName[this.tagSetsData[a].idx]=[]),this.mapIdxToName[this.tagSetsData[a].idx].push(a)};
b.prototype.removeUnusedIndexes=function(){var a=this.project.getPageMgr();if(Object.keys(this.idxsInPage).length>$hmi.limitPages)for(var b in this.idxsInPage)-1==$hmi.loadedPages.indexOf(a.getWebPage(b.toLowerCase()))&&delete this.idxsInPage[b]};b.prototype.trigger=function(a,b){if("indexedtagsetready"==a&&this.initialized){var e=$hmi.focusPage.studioId,f=[],g=[],h=[],k=0,l=0;this.removeUnusedIndexes();if(0<b.length)for(k=0;k<b.length;k++)l=$hmi.cache.getTag(b[k].n),null!=this.mapIdxToName[b[k].n]?
(h.push(l),f.push(b[k].n),null==this.idxsInPage[e]&&(this.idxsInPage[e]=[]),-1==this.idxsInPage[e].indexOf(b[k].n)&&this.idxsInPage[e].push(b[k].n)):g.push(b[k]);for(var n in this.mapIdxToName)$hmi.cache.getTag(n)&&this.idxsInPage[e]&&-1!=this.idxsInPage[e].indexOf(n)&&(l=$hmi.cache.getTag(n))&&-1==f.indexOf(l.name)&&(h.push(l),f.push(l.name));e=[];f=[];n=[];if(0<h.length){for(k=0;k<h.length;k++){var m=this.mapIdxToName[h[k].name];if(0<m.length)for(l=0;l<m.length;l++){var p,q=m[l],r=h[k].getValue().toString();
p=this.isIndexedTagGroup(q);if(!p||!this.isGroupAlreadyActive(q,r))if(r=this.getIndexIgnoringCase(q,r),p&&null!=r)p=!1,e.push(q),f.push({ts:q,i:r}),n.push({ts:q,i:r,bi:p});else if(p){p=!0;var r=null,t;for(t in this.activeCgiGroups)if(null!=this.activeCgiGroups[t]&&this.activeCgiGroups[t].tagName==q){r=this.activeCgiGroups[t];break}null!=r&&(r=r.group.groupName.split("@")[2],n.push({ts:q,i:r,bi:p}))}}}0<e.length&&this.unsubscribeGroups(e);0<f.length&&this.subscribeGroups(f);0<n.length&&this.updateGroupTag(n)}0<
g.length&&this.update(g)}};b.prototype.getGroupName=function(a,b){return $hmi.focusPage.studioId+"@"+a+"@"+b};b.prototype.isGroupAlreadyActive=function(a,b){var e=this.getGroupName(a,b),f;for(f in this.activeCgiGroups)if(f==e)return!0;return!1};b.prototype.isIndexedTagGroup=function(a){var b=$hmi.focusPage;return null==this.tagSetsData[a]||null==this.tagSetsData[a].pgs||-1==this.tagSetsData[a].pgs.indexOf(b.studioId)&&-1==this.tagSetsData[a].pgs.indexOf(b.templateStudioId)?!1:!0};b.prototype.getIndexIgnoringCase=
function(a,b){var e=$hmi.focusPage;if(null!=this.tagSetsData[a]&&null!=this.tagSetsData[a].pgs&&(-1!=this.tagSetsData[a].pgs.indexOf(e.studioId)||-1!=this.tagSetsData[a].pgs.indexOf(e.templateStudioId)))for(var e=Object.keys(this.tagSetsData[a].inst),f=0,g=e.length;f<g;f++)if(e[f].toLowerCase()==b.toLowerCase())return e[f];return null};b.prototype.unsubscribeGroups=function(a){var b=[],e;for(e in this.activeCgiGroups)this.activeCgiGroups[e].pageWebId==$hmi.focusPage.wgtId&&-1!=a.indexOf(this.activeCgiGroups[e].tagName)&&
(b.push(e),delete this.activeCgiGroups[e]);this.srv.unsubscribeGroups(b)};b.prototype.unsubscribePageGroups=function(a){var b=[],e;for(e in this.activeCgiGroups)this.activeCgiGroups[e].pageWebId==a&&b.push(e);this.activeCgiGroups={};this.srv.unsubscribeGroups(b);this.srv.unsubscribeTags(this.tagsToUnsubscr,null);for(a=0;a<this.tagsToUnsubscr.length;a++)delete $hmi.cache.cache.tags[this.tagsToUnsubscr[a]];this.tagsToUnsubscr=[]};b.prototype.subscribeGroups=function(a){for(var b=$hmi.activeProject.getWidget("_TagMgr",
!0),e=$hmi.focusPage,f=[],g=0;g<a.length;g++){var h=a[g],k=this.getGroupName(h.ts,h.i),l=new hmiGroupSubscribeWgt({wgtId:k},k,{groupName:k,tagMgr:b,tags:this.tagSetsData[h.ts].inst[h.i].tgs},e,e);this.activeCgiGroups[k]={group:l,tagName:h.ts,pageWebId:e.wgtId};f.push(k)}this.srv.subscribeGroups(f,null)};b.prototype.updateGroupTag=function(a){var b=[],e;for(e in a){var f=a[e],g=this.getGroupName(f.ts,f.i),h=this.activeCgiGroups[g].group.tags;for(e in h){var k=e.split(".")[0],h=f.i;if(k=$hmi.cache.getTag(k))for(var l=
this.activeCgiGroups[g].group.tags[e],n=0;n<l.length;n++){var m=f.ts+"."+l[n];this.dataLinks[m]&&(f.bi?this.sendUpdate(m,void 0,k.getQuality(),h):this.sendUpdate(m,k.getValue(),k.getQuality(),h))}}f.bi&&b.push(f.ts)}0<b.length&&this.unsubscribeGroups(b)};b.prototype.update=function(a){for(var b=0;b<a.length;b++){var e=$hmi.cache.getTag(a[b].n),f=e.getValue(),g=e.name,h=[],k;for(k in this.activeCgiGroups)if(void 0!=this.activeCgiGroups[k].group.tags){var l=this.activeCgiGroups[k].group.tags,n=this.activeCgiGroups[k].tagName,
m=[],p;for(p in l){var q=p.split(".");if(q[0]==g)for(m=l[p],1<q.length&&(q=parseInt(q[1].substr(1,q[1].length-1)),f instanceof Array&&-1!=q&&(f=f[q])),q=0;q<m.length;q++)if(h=n+"."+m[q],void 0!=this.dataLinks[h])for(var h=this.dataLinks[h],r=0;r<h.length;r++)if(e.isQualityGood()){var t=0;0!=h[r].tagIndex?t=h[r].tagIndex:h[r].tgtWgt.index&&(t=h[r].tgtWgt.index);f instanceof Array?"Index"==h[r].attr?h[r].setWgtValue(f,t,e.getQuality(),null,e.ts):-1==t?h[r].setWgtValue(f,t,e.getQuality()):void 0==f[t]?
h[r].setWgtValue(f[t],t,new Quality(0),null,e.ts):h[r].setWgtValue(f[t],t,e.getQuality(),null,e.ts):h[r].setWgtValue(f,-1,e.getQuality(),null,e.ts)}else h[r].setWgtValue(null,-1,e.getQuality(),null,e.ts)}}}};b.prototype.sendUpdate=function(a,b,e,f){for(var g=this.dataLinks[a],h=0;h<g.length;h++){var k=0;-1!=g[h].tagIndex?k=g[h].tagIndex:g[h].tgtWgt.index&&(k=g[h].tgtWgt.index);if(g[h].tag==a)if(g[h].dataSrc.getValue(g[h].tag)instanceof Array){var l=g[h].dataSrc.getValue(g[h].tag).length;0>k||k>l-
1?g[h].setWgtValue(b,k,new Quality(0)):g[h].setWgtValue(b,k,e)}else k=f,g[h].setWgtValue(b,k,e)}};b.prototype.getNameByTagAlias=function(a){a=a.split(".");var b=a[0],e=a[1],f;a=-1;var g=$hmi.cache.getTag(this.tagSetsData[b].idx);if(g&&(g=g.getValue().toString(),g=this.getIndexIgnoringCase(b,g),null!=this.tagSetsData[b].inst[g])){var b=this.tagSetsData[b].inst[g].tgs,h;for(h in b)if(-1!=b[h].indexOf(e)){f=h;break}}if(void 0!=f)return h=f.split("."),1<h.length&&(f=h[0],a=parseInt(h[1].substr(1,h[1].length-
1))),{tag:f,idx:a}};b.prototype.getValue=function(a,b){var e;if(this.initialized){var f=this.getNameByTagAlias(a),g;f&&(e=f.tag,g=f.idx,e=$hmi.cache.getTag(e))}return e?(void 0==b&&(b=g),e.getValue(b)):null};b.prototype.setValue=function(a,b,e,f){var g=this.getNameByTagAlias(a),h;if(g){h=g.tag;g=g.idx;-1!=g&&(e=g);if(f){a=new State;var k=$hmi.activeProject.getWidget("_TagMgr",!0);k.tagsInfo[h]&&(k=Tag.prototype.getTypeRange(k.tagsInfo[h].t),null!=k&&(b<k.min?b=k.max-Math.abs(k.min-b):b>k.max&&(b=
k.min+Math.abs(b-(k.max+1)))));return this.srv.writeTag(new Tag(h,e,null,null,null,null),b,a,!1)}(g=$hmi.cache.getTag(h))&&this.dataLinks[a]&&(f=g.getQuality(),g.value instanceof Array?(k=$hmi.cache.getTag(h).clone(!1),0<=e&&e<k.value.length&&(k.value[e]=parseFloat(b)),k=k.value):k=b,k=new Tag(h,e,k,"S_OK",f),$hmi.cache.updateTag(h,k)&&this.sendUpdate(a,b,f,e));return k}return new Tag(h,e,null,null,null,null)};b.prototype.subscribeDataLink=function(a){var b=a.tag;this.dataLinks[b]||(this.dataLinks[b]=
[]);this.dataLinks[b].push(a);a=a.tag.split(".")[0];a=this.tagSetsData[a].idx;var b=$hmi.focusPage.wgts[$hmi.focusPage.studioId+"@$GroupSubscrWgt@$0"],e=null;$hmi.focusPage.templateStudioId&&(e=$hmi.focusPage.wgts[$hmi.focusPage.templateStudioId+"@$GroupSubscrWgt@$0"]);var f=b?b.tags:null,g=e?e.tags:null;f&&!f[a]&&(this.tagsToUnsubscr.push(a),this.tagMgr.subscribeForTagsNotification([a]));g&&!g[a]&&(this.tagsToUnsubscr.push(a),this.tagMgr.subscribeForTagsNotification([a]));b||e||(this.tagsToUnsubscr.push(a),
this.tagMgr.subscribeForTagsNotification([a]))};b.prototype.unsubscribeDataLink=function(a){this.removeDataLink(a)};b.prototype.removeDataLink=function(a){for(var b=this.dataLinks[a.tag],e=null,f=0,g=b.length;f<g;f++)if(b[f].getId()==a.getId()){e=f;break}null!=e&&(b.splice(e,1),0==b.length&&delete this.dataLinks[a.tag])};b.jmType="IndexedTagSetMgrWgt";return b}(hmiWidget);$hmi.fn.hmiIndexedTagSetMgr=function(a,b,c,d){return new hmiIndexedTagSetMgr(this,a,b,c,d)};
(function(a){a[a.INIT_PRM=0]="INIT_PRM"})(WAITABLE_ERROR_MSG||(WAITABLE_ERROR_MSG={}));
Waitable=function(){function a(){this._prmWgtReady=null}a.prototype.resolveWgtReady=function(a){throw WAITABLE_ERROR_MSG.INIT_PRM;};a.prototype.rejectWgtReady=function(a){throw WAITABLE_ERROR_MSG.INIT_PRM;};a.prototype.initPromiseReady=function(){var a=this;this._prmWgtReady=new Promise(function(c,d){a.resolveWgtReady=c;a.rejectWgtReady=c})};a.prototype.waitWgtReady=function(){if(this._prmWgtReady)return this._prmWgtReady;throw WAITABLE_ERROR_MSG.INIT_PRM;};return a}();
(function(a){a[a.NORMAL=0]="NORMAL";a[a.TEMPLATE=1]="TEMPLATE"})(PageType||(PageType={}));
var CWidgetMgr=function(a){function b(b){var d=a.call(this)||this;d.project=b;d.cwgts={};d.instancesMap={};d.HTMLTemplatePolyfillEnabled=HTMLTemplateElement.bootstrap instanceof Function;b=document.getElementById("hmi-templates");var e=!1;d.initPromiseReady();b&&(e=0!=b.childNodes.length);if($hmi.isTestModeActive())d.resolveWgtReady(!0);else if(e)d.resolveWgtReady(!0);else d.project.getCommunticationObj().getResource("templates.xml").then(function(a){document.getElementById("hmi-templates").innerHTML=a;
d.HTMLTemplatePolyfillEnabled&&HTMLTemplateElement.bootstrap(document);d.resolveWgtReady(!0)})["catch"](function(){d.resolveWgtReady(!1)});return d}__extends(b,a);b.prototype.setCWMap=function(a,b){null==this.instancesMap[a]&&(this.instancesMap[a]=b)};b.prototype.getCWMap=function(a){a=this.instancesMap[a];return void 0!=a?a:null};b.prototype.freeCWInstances=function(a){delete this.instancesMap[a]};b.prototype.getAttributeLink=function(a,b){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==
this.cwgts[a].props?this.cwgts[a].props.attr[b]:[]};b.prototype.hasAttribute=function(a,b){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==this.cwgts[a].props};b.prototype.getParameters=function(a){a=a.toLowerCase();return void 0!==this.cwgts[a]&&null!==this.cwgts[a].props?this.cwgts[a].props.par:[]};b.prototype.isRegisteredModule=function(a){a=a.toLowerCase();return void 0!==this.cwgts[a]};b.prototype.hasGfxInheritance=function(a){a=a.toLowerCase();a=this.cwgts[a];return null!=a&&null!=a.conf&&
null!=a.conf.w};b.prototype.findCustomWidget=function(a,b){var e=null,f=null;void 0!=b&&(f=this.getCWMap(b));for(var g=a.querySelectorAll("[data-ctype]"),h=0,k=g.length;h<k;h++){var l=g[h],n=l.getAttribute("data-ctype"),m="1"==l.getAttribute("data-tmpl");this.isRegisteredModule(n)&&(null===e&&(e={p:[],t:[]}),l={webId:l.getAttribute("id"),studioId:l.getAttribute("data-sid"),moduleName:n},m?(e.t.push(l),null!=f&&f.t.push(l)):(e.p.push(l),null!=f&&f.p.push(l)))}return e};b.prototype.addModule=function(a){this.cwgts[a.name]=
a};b.prototype.injectCWTemplates=function(a,b){var e=this.getCWMap(b),f=a.getAttribute("id")!=b;if(null==e||f){e=this.findCustomWidget(a,b);if(null==e)return;f||this.setCWMap(b,e)}this.injectCW(a,e.t,b,PageType.TEMPLATE);this.injectCW(a,e.p,b,PageType.NORMAL)};b.prototype.injectCW=function(a,b,e,f){if(void 0!==b)for(var g=0,h=b.length;g<h;g++){var k=b[g].webId,l=b[g].studioId,n=b[g].moduleName.toLowerCase(),m=this.cwgts[n];if(void 0!==m){null===m.template&&(m.template=document.getElementById(n));
m=m.template;n=a.querySelector("#"+CSS.escape(k));null!=m&&null!=n&&n.appendChild(m.content.cloneNode(!0));for(var m=n.querySelectorAll(".wgt, .wgt>div, .hmi-col"),p=0,q=m.length;p<q;p++){var r=m[p];if("*"===r.id.charAt(0)&&"."===r.id.charAt(1)){r.id=r.id.replace("*",k);var t=r.getAttribute("data-sid");null!=t&&r.setAttribute("data-sid",t.replace("*",l))}f==PageType.TEMPLATE&&r.setAttribute("data-tmpl","1")}this.injectCWTemplates(n,e)}}};b.prototype.instantiateCW=function(a,b){b=b.toLowerCase();var e=
this.cwgts[b],f=this.project.getWidgetDefinitions(),g=this.project.getActionMgr(),h=(k={},k[b]=a,k);if(null!=e&&null!=e.conf&&null!=e.conf.w){a.setModule();e.conf.grid&&a.setGridLayout(e.conf.grid);for(var k=e.conf.w,l=0,n=k.length;l<n;l++){var m=k[l],p=m.w.replace("*",a.wgtId),q=this.deepClonePlainObject(m.p),r=void 0,r=void 0!==m.s?m.s.replace("*",a.studioId):p,t=h[m.f.toLowerCase()];-1!=m.t.indexOf("hmiAction")?(q.module=a,r=g.getActionDefinition(m.t),h[m.w]=new r({wgtId:p},m.e,q,this.project.getFocusPage(),
t)):"hmiAttach"===m.t?$hmi.hmiAttach(h[m.w],m.s,q):(q.isTemplateWgt=a.isTemplateWgt,q.module=a,"hmiCWMLTextMgr"==m.t&&e.tr&&this.applyMLPatch(q.texts,e.tr),h[m.w]=new f[m.t]({wgtId:p},r,q,this.project.getFocusPage(),t))}this.subscribeAttributeLinks(e,a);g=f=void 0;isIdentityMatrix(a.mtx)?(f=a.width,g=a.height):(g=a._map(a.mtx,{x:a.width,y:a.height}),f=g.x,g=g.y);h=a.left;k=a.top;a.width=e.conf.br.width;a.height=e.conf.br.height;a.left=0;a.top=0;a.setParentBounds(h,k,f,g,a.parentWidget);this.bindJSClass(a)}var k};
b.prototype.subscribeAttributeLinks=function(a,b){if(null!==a.props&&null!==a.props.attr)for(var e in a.props.attr){var f=a.props.attr[e];if(0<f.length)for(var g=0,h=f.length;g<h;g++){var k=f[g].lastIndexOf("."),l=f[g].substring(0,k),k=b.getWidget(l,!0,b.isTemplateWgt);if(null==k){var n=l.replace(/[0-9]/g,""),l=parseInt(l.substring(n.length));isNaN(l)&&(l=1);var m=[];b.getWidgetsByJMClass(n,l,m);m.length==l&&(k=m[l-1])}null!=k&&k.subscribeWgt(b,function(a,b){return function(c,d){"mdup"==c&&a.sendUpdate(b,
d.v,d.q)}}(b,e))}}};b.prototype.applyMLPatch=function(a,b){for(var e in b){var f=a[e],g=b[e],h;for(h in g)f[h]=g[h]}};b.prototype.bindJSClass=function(a){var b=this.cwgts[a.ctype.toLowerCase()];void 0!==b&&null!=b.js&&b.js.call(a,a)};b.prototype.bindCWLogicClass=function(a){var b=this.getCWMap("_"+a.wgtId);if(null!==b){for(var e=b.t,f=0,g=e.length;f<g;f++){var h=e[f];this.hasGfxInheritance(h.moduleName)||(h=a.getWidget(h.webId),this.subscribeAttributeLinks(this.cwgts[h.ctype.toLowerCase()],h),this.bindJSClass(h))}e=
b.p;f=0;for(g=e.length;f<g;f++)h=e[f],this.hasGfxInheritance(h.moduleName)||(h=a.getWidget(h.webId),this.subscribeAttributeLinks(this.cwgts[h.ctype.toLowerCase()],h),this.bindJSClass(h));(0<b.t.length||0<b.p.length)&&a.bindCWCallbacks()}};b.prototype.deepCloneArray=function(a){for(var b=a.length,e=Array(b),f=0;f<b;f++){var g=a[f],h=typeof g;e[f]="number"==h||"boolean"==h?g:this.deepClonePlainObject(g)}return e};b.prototype.deepClonePlainObject=function(a){if(null===a)return null;switch(typeof a){case "string":return a.slice(0);
case "object":if(Array.isArray(a))return this.deepCloneArray(a);var b={},e;for(e in a){var f=a[e];if(Array.isArray(f))b[e]=this.deepCloneArray(f);else{var g=typeof f;b[e]="number"==g||"boolean"==g?f:this.deepClonePlainObject(f)}}return b;default:return a}};return b}(Waitable),hmiPageMLTextMgr=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;if(!$hmi.enablePjctWidgetServerReq)return b;b.curLangId=null;b.mlMgr=null;var h=b;b.firstLangLoad=!0;b.mlMgr=$hmi.activeProject.getWidget("_MultiLangMgr",
!0);b.mlMgr.subscribe(b.wgtId,function(a){h.isActive()&&h.changePageLanguage(a)});if(b.parentPage.elem){if(d=b.parentPage.elem.getAttribute("data-hmilang"))b.curLangId=d;if(d=$hmi.getEventMgr())h=b,b.activateHander=function(){h.load()},b.deactivateHander=function(){h.unload()},d.on(b.parentPage.elem,"loadWgt",b.activateHander),d.on(b.parentPage.elem,"unloadWgt",b.deactivateHander)}b.module&&b.module.setCWMLTextMgr(b);b.checkForLanguageUpdate();b.status=!0;return b}__extends(b,a);b.prototype.checkForLanguageUpdate=
function(){var a=this.mlMgr.curLangId;(this.curLangId!=a||this.firstLangLoad)&&this.changePageLanguage(a)};b.prototype.load=function(){this.status=!0;this.checkForLanguageUpdate()};b.prototype.unload=function(){this.status=!1};b.prototype.changePageLanguage=function(a){if(this.curLangId!=a||this.firstLangLoad){this.firstLangLoad=!1;this.curLangId=a;var b=this.parentPage.wgts,e;for(e in b){var f=b[e],g=!this.isTemplateWgt&&!f.isTemplateWgt,h=this.isTemplateWgt&&f.isTemplateWgt,k=void 0,k=f instanceof
hmiGroup?f.hasModule&&f.hasMLManager():null!=f.module&&f.module.hasMLManager();!g&&!h||k||f.updateLanguage()}this.parentPage.elem&&!this.isTemplateWgt&&this.parentPage.elem.setAttribute("data-hmilang",a)}};b.prototype.getMLTexts=function(a){return this.texts[a]};b.prototype.getText=function(a,b,e){return this.texts[a]?this.texts[a][this.curLangId]:null};b.prototype.getCurrentFont=function(){return this.mlMgr.getLanguageFont(this.curLangId)};b.prototype.getCurrentLanguage=function(){return this.mlMgr.curLangId};
b.prototype.getMultiLanguagesMgr=function(){return this.mlMgr};b.prototype.isActive=function(){return this.status};b.prototype.setValue=function(a,b){};b.prototype.getValue=function(a){};b.prototype.destroy=function(){this.mlMgr&&this.mlMgr.unsubscribe(this.wgtId);var a=$hmi.getEventMgr();a.off(this.parentPage.elem,"loadWgt",this.activateHander);a.off(this.parentPage.elem,"unloadWgt",this.deactivateHander);hmiWidget.prototype.destroy.call(this)};b.jmType="PageMLTextMgrWgt";return b}(hmiWidget);
$hmi.fn.hmiPageMLTextMgr=function(a,b,c,d){return new hmiPageMLTextMgr(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiPageMLTextMgr",hmiPageMLTextMgr);
var hmiCWMLTextMgr=function(a){function b(b,d,e,f,g){return a.call(this,b,d,e,f,g)||this}__extends(b,a);b.prototype.changePageLanguage=function(a){if(this.curLangId!=a||this.firstLangLoad){this.firstLangLoad=!1;this.curLangId=a;a=this.parentWidget.wgts;for(var b in a){var e=a[b];(!this.isTemplateWgt&&!e.isTemplateWgt||this.isTemplateWgt&&e.isTemplateWgt)&&e.updateLanguage()}b=this.parentWidget.getAttributeLinks();for(var f in b)a=b[f],a.t==ATTR_LINK_TYPE.MLPATCH&&(a=a.v[parseInt(this.curLangId.substr(1))],
this.parentWidget.setValue(f,a,Tag.prototype.QUALITY_GOOD))}};b.prototype.getMLTexts=function(a){return this.texts[a]};b.prototype.getText=function(a,b,e){return b&&e&&(b=b.getUserId().split("."),e="*."+b[b.length-1]+"."+e,(b=this.parentWidget.getAttributeLinks())&&(e=b[e])&&e.t==ATTR_LINK_TYPE.MLPATCH)?e.v[this.curLangId.substr(1)]:this.texts[a]?this.texts[a][this.curLangId]:null};b.jmType="CustomWgtMLTextMgrWgt";return b}(hmiPageMLTextMgr);$hmi.addWidgetDefinition("hmiCWMLTextMgr",hmiCWMLTextMgr);
var Linkable=function(){function a(){this.dataLinks=null}a.prototype.addDataLink=function(a){this.parentPage?this.parentPage.registerLink(a):this.registerLink&&this.registerLink(a);this.subscribeDataLink(a)};a.prototype.subscribeDataLink=function(a){void 0==this.dataLinks&&(this.dataLinks={});this.dataLinks[a.getId()]=a};a.prototype.removeDataLink=function(a){delete this.dataLinks[a.getId()]};a.prototype.registerLink=function(a){};a.prototype.getWidget=function(a,c,d){return null};a.prototype.setValue=
function(a,c,d,e,f){};a.prototype.getValue=function(a){return null};a.prototype.getId=function(){return""};a.prototype.destroy=function(){for(var a in this.dataLinks){var c=this.dataLinks[a];c.dataSrc.getId()!=this.getId()?c.dataSrc.removeDataLink(c):c.tgtWgt.getId()!=this.getId()&&c.tgtWgt.removeDataLink(c)}};a.prototype.unmountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].unmount()};a.prototype.mountLinks=function(){for(var a in this.dataLinks)this.dataLinks[a].mount(),this.dataLinks[a].update()};
return a}(),hmiDataLink=function(a){function b(b,d,e,f){var g=a.call(this)||this;g.dataSrc=null;g.tgtWgt=null;g.attr="";g.dataSrcId="";g.numXforms=0;g.rw="r";g.tag="";g.tagIndex=-1;g.tagType=null;g.tagRange=null;g.initialized=!0;g.id=b;g.tgtWgt=d;g.dataSrc=e;g.page=$hmi.getFocusPage();if(null!=f){g.dataSrc&&(g.dataSrcId=e.wgtId);for(var h in f)g[h]=f[h];g.loadXForms();g.loadStructuredTag();null!=g.tagType&&(g.tagRange=Tag.prototype.getTypeRange(g.tagType))}return g}__extends(b,a);b.prototype.loadXForms=
function(){if(this.xforms&&0<this.xforms.length){this.numXforms=this.xforms.length;for(var a=0,b=this.numXforms;a<b;a++){var e=this.xforms[a],f=this.tgtWgt.module;if(f){for(var g=!1;null!=f&&!g&&!(g=$hmi.getActiveProject().getCWidgetMgr().hasGfxInheritance(f.ctype));)f=f.module;g&&(f=f.getId(),e=this.xforms[a]=e.replace("*",f))}(e=$hmi.focusPage.getXForm(e))&&e.setDLink(this)}}};b.prototype.loadStructuredTag=function(){if(null!=this._tag&&""!=this._tag){for(var a=this._tag.match(/\${\w*}/g),b=this._tag,
e=0,f=a.length;e<f;e++)if(null!==a[e]&&3<a[e].length){var g=a[e],h=g.substring(2,g.length-1);if(null!==this.tgtWgt.module)if(this.tgtWgt.module.hasParameter(h))b=b.replace(g,this.tgtWgt.module.getValue(h)),this.tgtWgt.module.addParameterDataLink(h,this);else{var k=this.tgtWgt.module.getParentModuleWithParameter(h);k&&(b=b.replace(g,k.getValue(h)),k.addParameterDataLink(h,this))}}this.tag!=b&&this._tag!=b&&this.updateDataSourceAttribute(b);this.dataSrc.updateDataLink(this)}};b.prototype.mountInternalLinks=
function(){if(this.links&&0<this.links.length)for(var a=0,b=this.links.length;a<b;a++){var e=this.links[a].s,f=this.links[a].p,e=0==f.wT?this.page.getProject().getWidget(e,!0):this.page.getWidget(e,!0),f=$hmi.createDataLink(this,e,f);f.update();f.mount()}};b.prototype.unmountInternalLinks=function(){if(this.links&&0<this.links.length)for(var a in this.dataLinks)this.dataLinks[a].unmount()};b.prototype.mount=function(){this.tgtWgt.addDataLink(this);this.dataSrc&&this.dataSrc.subscribeDataLink(this);
this.mountInternalLinks()};b.prototype.unmount=function(){this.tgtWgt.removeDataLink(this);this.dataSrc&&this.dataSrc.unsubscribeDataLink(this);this.unmountInternalLinks()};b.prototype.update=function(){if("rw"===this.rw||"r"===this.rw){var a=$hmi.cache.getTag(this.tag),b=this.srcType;"Widget"==b||"Data"==b||"Recipe"==b||"Alias"==b?(a=this.dataSrc.getValue(this.tag),this.setWgtValue(a,-1,Tag.prototype.QUALITY_GOOD,!1,null)):"System"==b?(a=this.dataSrc.getValue(this.tag),this.tgtWgt.setValue(this.attr,
a,Tag.prototype.QUALITY_GOOD,this.tagIndex)):a?this.setWgtValue(a.getValue(this.tagIndex),-1,a.getQuality(),!1,a.ts):this.tgtWgt.setValue(this.attr,void 0,new Quality(64))}};b.prototype.updateDSParameter=function(){if(null!=this._tag){var a=this._tag.match(/\${\w*}/g);if(null!==a){for(var b=this._tag,e=0,f=a.length;e<f;e++)if(3<a[e].length)var g=a[e],h=g.substring(2,g.length-1),b=b.replace(g,this.tgtWgt.module.getValue(h));b!=this._tag&&this.tag!=b&&this.updateDataSourceAttribute(b);this.dataSrc.updateDataLink(this);
this.dataSrc instanceof hmiTagMgr&&this.dataSrc.subscribeDynamicTags()}}};b.prototype.updateDataSourceAttribute=function(a){this.dataSrc.unsubscribeDataLink(this);this.tag=a;this.dataSrc.subscribeDataLink(this)};b.prototype.setWgtValue=function(a,b,e,f,g){this.enableUpdate=null!=f?f:!0;if("w"!=this.rw){var h=this.tgtWgt.getValue(this.attr);0<this.numXforms&&(a=this.doXform(a,"r"));if("undefined"!=typeof this.tgtWgt.onDataUpdate&&this.enableUpdate&&h!=a)if($hmi.activeProject.isProjectReady())this.doOnDataUpdate(a,
h,this.attr,0,"R");else{var k=this;$hmi.isCoreWidgetsReady().then(function(){k.doOnDataUpdate(a,h,k.attr,0,"R")})}void 0===b&&(b=this.tagIndex);this.tgtWgt.setValue(this.attr,a,e,b,g)}};b.prototype.doOnDataUpdate=function(a,b,e,f,g){if(void 0!=this.tgtWgt&&void 0!=this.tgtWgt.onDataUpdate){a={attribute:this.attr,oldValue:b,newValue:a,attrName:e,mode:g,index:f};b=this.tgtWgt.onDataUpdate;for(e=0;e<b.length;e++)$hmi.doAction(this.tgtWgt.wgtId,b[e],a);$hmi.actionMgr.doActions()}};b.prototype.setTagValue=
function(a){if(null!=this.dataSrc){var b=a,e=0;if(0<this.numXforms){a=this.doXform(b,"w");a=this.scaleTagValues(a);var f=this.doXform(a,"r");b!=f&&this.tgtWgt.setValue(this.attr,f,Tag.prototype.QUALITY_GOOD)}else a=this.scaleTagValues(a);var g=this.dataSrc.getValue(this.tag,this.tagIndex);if("undefined"!=typeof this.tgtWgt.onDataUpdate&&g!=a){var h=this.tagIndex;if($hmi.activeProject.isProjectReady())this.doOnDataUpdate(a,g,this.attr,h,"W");else{var k=this;$hmi.isCoreWidgetsReady().then(function(){k.doOnDataUpdate(a,
g,k.attr,h,"W")})}}-1!=this.tagIndex?e=this.tagIndex:this.tgtWgt.index&&(e=this.tgtWgt.index);return this.dataSrc.constructor==hmiTagMgr||this.dataSrc.constructor==hmiIndexedTagSetMgr?this.dataSrc.setValue(this.tag,a,e,!0):this.dataSrc.setValue(this.tag,a,Tag.prototype.QUALITY_GOOD,!0)}return{}};b.prototype.isOutOfTagRange=function(a){return a<this.tagRange.min||a>this.tagRange.max};b.prototype.castWithSign=function(a){var b,e,f=Tag.prototype.enumType;switch(this.tagType){case f.BYTE:b=255;e=128;
break;case f.SHORT:b=65535,e=32768}return this.isOutOfTagRange(a)&&(a&=b,0!=(a&e))?-((~a&b)+1):a};b.prototype.scaleTagValues=function(a){var b=this.tagType,e=Tag.prototype.enumType,f=!isNaN(a),g=0!=a%1;switch(b){case e.BOOLEAN:return f?1==a?1:0:0;case e.BYTE:case e.SHORT:return f?g?Math.round(this.castWithSign(a)):this.castWithSign(a):0;case e.INT:return f?Math.round(a):0;case e.FLOAT:case e.DOUBLE:return f?a:0;case e.UNSIGNEDBYTE:return f?(a=Math.round(a)>>>0,g?Math.round(a)&255:a&255):0;case e.UNSIGNEDSHORT:return f?
(a=Math.round(a)>>>0,g?Math.round(a)&65535:a&65535):0;case e.UNSIGNEDINT:return f?(a=Math.round(a)>>>0,g?Math.round(a)&4294967295:a&4294967295):0;default:return a}};b.prototype.doXform=function(a,b){for(var e=0;e<this.numXforms;e++){var f=$hmi.getFocusPage().getXForm(this.xforms[e]);if(void 0==f){var g=$hmi.getActiveProject();g.hasActiveDialogs()&&(f=$hmi.getActivePage().getXForm(this.xforms[e]));void 0==f&&(f=g.getXForm(this.xforms[e]))}void 0!=f&&(g=f.getValue(),a=f.execute(this,a,b,g))}return a};
b.prototype.getId=function(){return this.id};b.prototype.getDataSrc=function(){return this.dataSrc};b.prototype.getAttribute=function(){return this.attr};b.prototype.getTag=function(){return this.tag};b.prototype.getTagType=function(){return this.tagType};b.prototype.getTagValue=function(){var a=this.dataSrc.getValue(this.tag);"object"==typeof a&&a.constructor==Array&&(a=-1==this.tagIndex?a[0]:a[this.tagIndex]);return a};b.prototype.setValue=function(a,b,e,f,g){if(!e.isQualityGood())return!1;switch(a){case "Index":b!=
this.tagIndex&&(this.tagIndex=b,this.update())}return!0};b.prototype.getValue=function(a){return null};b.prototype.getTargetWidget=function(){return this.tgtWgt};return b}(Linkable),GridLayoutClass=function(){function a(){this.colProperties=[];this.rowProperties=[];this.colXPos=[];this.rowYPos=[]}a.prototype.init=function(b){this.gridProperties=b.gr;for(var c in b.colsProps)this.colProperties.push(b.colsProps[c]);for(var d in b.rowsProps)this.rowProperties.push(b.rowsProps[d]);this.gridProperties.grGStkCollapsed==
a.enumStrokeCollaption.TRUE&&(this.computeRowStrokeCollapsed(),this.computeColStrokeCollapsed())};a.prototype.getGridColInferiorLimit=function(){for(var a=0,c=0;c<this.gridProperties.grCols;c++)a+=this.colProperties[c].minWidth;return a};a.prototype.getGridRowInferiorLimit=function(){for(var a=0,c=0;c<this.gridProperties.grRows;c++)a+=this.rowProperties[c].minHeight;return a};a.prototype.getGridColSuperiorLimit=function(){for(var a=0,c=0;c<this.gridProperties.grCols;c++)a+=this.colProperties[c].maxWidth;
return a};a.prototype.getGridRowSuperiorLimit=function(){for(var a=0,c=0;c<this.gridProperties.grRows;c++)a+=this.rowProperties[c].minHeight;return a};a.prototype.getRowProperties=function(){return this.rowProperties?this.rowProperties:null};a.prototype.getColProperties=function(){return this.colProperties?this.colProperties:null};a.prototype.computeRowStrokeCollapsed=function(){for(var b=this.getGridProperties().grGStkMode,c=this.getGridProperties().grGStkWidth,d=this.getGridProperties().grGStkColor,
e=this.getGridProperties().grRows,f=0;f<e;f++){var g=this.rowProperties[f].tStroke,h=this.rowProperties[f].bStroke;0==f&&(b==a.enumStrokeMode.AUTO&&(this.rowProperties[f].tStroke=Math.max(g,c)/2),c>=g&&(this.rowProperties[f].tStkColor=d));if(0<f){var k=this.rowProperties[f-1].bStroke,l=Math.max(g,k)/2;this.rowProperties[f].tStroke=Math.ceil(l);this.rowProperties[f-1].bStroke=Math.floor(l);k>g?this.rowProperties[f].tStkColor=this.rowProperties[f-1].bStkColor:this.rowProperties[f-1].bStkColor=this.rowProperties[f].tStkColor;
f==e-1&&(b==a.enumStrokeMode.AUTO&&(this.rowProperties[f].bStroke=Math.max(h,c)/2),c>=h&&(this.rowProperties[f].bStkColor=d))}}};a.prototype.computeColStrokeCollapsed=function(){for(var b=this.getGridProperties().grGStkMode,c=this.getGridProperties().grGStkWidth,d=this.getGridProperties().grGStkColor,e=this.getGridProperties().grCols,f=0;f<e;f++){var g=this.colProperties[f].lStroke,h=this.colProperties[f].rStroke;0==f&&(b==a.enumStrokeMode.AUTO&&(this.colProperties[f].lStroke=Math.max(g,c)/2),c>=
g&&(this.colProperties[f].lStkColor=d));if(0<f){var k=this.colProperties[f-1].rStroke,l=Math.max(g,k)/2;this.colProperties[f].lStroke=Math.ceil(l);this.colProperties[f-1].rStroke=Math.floor(l);k>g?this.colProperties[f].lStkColor=this.colProperties[f-1].rStkColor:this.colProperties[f-1].rStkColor=this.colProperties[f].rStkColor;f==e-1&&(b==a.enumStrokeMode.AUTO&&(this.colProperties[f].rStroke=Math.max(h,c)/2),c>=h&&(this.colProperties[f].rStkColor=d))}}};a.prototype.getGridProperties=function(){return this.gridProperties?
this.gridProperties:null};a.prototype.getWAspectRatio=function(a){return parseFloat(a.split(":")[0])};a.prototype.getHAspectRatio=function(a){return parseFloat(a.split(":")[1])};a.prototype.getTotalColMinWidth=function(){var a=0;if(0<this.colProperties.length)for(var c=0;c<this.gridProperties.grCols;c++)a+=this.colProperties[c].minWidth;return a};a.prototype.getTotalRowMinHeight=function(){var a=0;if(0<this.rowProperties.length)for(var c=0;c<this.gridProperties.grRows;c++)a+=this.rowProperties[c].minHeight;
return a};a.prototype.preserveAspectRatio=function(b){b.getParentBounds(b.parentWidget);b=b.getChildren();for(var c in b)if(b[c].haveLayout()){var d=b[c].getLayout(),e=b[c].getParentBounds(b[c].parentWidget);if(1==d.preserveAR){var f=e.width*(this.getHAspectRatio(d.aR)/this.getWAspectRatio(d.aR));if(f<=e.height){var g=e.height-f,h=e.y;switch(d.vItemUF){case a._wgtVerUnderflowMode.INHERITED:switch(this.gridProperties.grVUF){case a._groupVerUnderflowMode.MIDDLE:h+=g/2;break;case a._groupVerUnderflowMode.BOTTOM:h+=
g}break;case a._wgtVerUnderflowMode.MIDDLE:h+=g/2;break;case a._wgtVerUnderflowMode.BOTTOM:h+=g}b[c].setParentBounds(e.x,h,e.width,f,b[c].parentWidget)}else{f=e.height*this.getWAspectRatio(d.aR)/this.getHAspectRatio(d.aR);g=e.width-f;h=e.x;switch(d.hItemUF){case a._wgtHorUnderflowMode.INHERITED:switch(this.gridProperties.grHUF){case a._groupHorUnderflowMode.CENTER:h+=g/2;break;case a._groupHorUnderflowMode.RIGHT:h+=g}break;case a._wgtHorUnderflowMode.CENTER:h+=g/2;break;case a._wgtHorUnderflowMode.RIGHT:h+=
g}b[c].setParentBounds(h,e.y,f,e.height,b[c].parentWidget)}}}};a.prototype.applyAlgorithm=function(a){this.widthCalc(a);this.heightCalc(a);this.preserveAspectRatio(a)};a.prototype.widthCalc=function(b,c){var d=this.gridProperties.grHOF,e=this.gridProperties.grHUF,f=b.getParentBounds(b.parentWidget),g=b.getChildren(),h=f.width,k=0;this.gridProperties.grSclAutohide==a._scrollbarAutohide.ALWAYSVISIBLE&&this.getTotalColMinWidth()>f.width&&(k+=Math.max(0,this.gridProperties.grSclSize+this.gridProperties.grSclOffset));
h-=k;0>=h&&(h=.1);f=this.baseWidthCalc(h);if(f==a._grState.OK)this.wgtRepositioningX(g,0);else if(f==a._grState.OVERFLOW)switch(d){case a._groupHorOverflow.HIDDEN:this.wgtRepositioningX(g,0);break;case a._groupHorOverflow.SCROLL:c||this.heightCalc(b,!0),this.wgtRepositioningX(g,0)}else if(f==a._grState.UNDERFLOW)switch(e){case a._groupHorUnderflowMode.LEFT:this.wgtRepositioningX(g,0);break;case a._groupHorUnderflowMode.CENTER:case a._groupHorUnderflowMode.RIGHT:d=h-this.getGridColSuperiorLimit();
e==a._groupHorUnderflowMode.CENTER&&(d=Math.floor(d/2));for(e=0;e<=this.gridProperties.grCols;e++)this.colProperties[e].colPos+=d;this.wgtRepositioningX(g,0);break;default:this.wgtRepositioningX(g,0)}};a.prototype.heightCalc=function(b,c){var d=this.gridProperties.grVOF,e=this.gridProperties.grVUF,f=b.getParentBounds(b.parentWidget),g=b.getChildren(),h=f.height,k=0;this.gridProperties.grSclAutohide==a._scrollbarAutohide.ALWAYSVISIBLE&&this.getTotalRowMinHeight()>f.height&&(k+=Math.max(0,this.gridProperties.grSclSize+
this.gridProperties.grSclOffset));h-=k;0>=h&&(h=.1);f=this.baseHeightCalc(h);if(f==a._grState.OK)this.wgtRepositioningY(g,0);else if(f==a._grState.OVERFLOW)switch(d){case a._groupHorOverflow.HIDDEN:this.wgtRepositioningY(g,0);break;case a._groupHorOverflow.SCROLL:c||this.widthCalc(b,!0),this.wgtRepositioningY(g,0)}else if(f==a._grState.UNDERFLOW)switch(e){case a._groupVerUnderflowMode.TOP:this.wgtRepositioningY(g,0);break;case a._groupVerUnderflowMode.MIDDLE:case a._groupVerUnderflowMode.BOTTOM:d=
h-this.getGridRowSuperiorLimit();e==a._groupVerUnderflowMode.MIDDLE&&(d=Math.floor(d/2));for(e=0;e<=this.gridProperties.grRows;e++)this.rowProperties[e].rowPos+=d;this.wgtRepositioningY(g,0);break;default:this.wgtRepositioningY(g,0)}};a.prototype.fuzzyCompare=function(a,c){return 1E-5>=Math.abs(a-c)?!0:!1};a.prototype.wgtRepositioningX=function(b,c){for(var d=[],e=this.gridProperties.grCols,f=0;f<e;f++)d[f]=this.colProperties[f+1].colPos-this.colProperties[f].colPos;for(var g in b)if(b[g].haveLayout()){for(var e=
b[g].getParentBounds(b[g].parentWidget),f=b[g].getLayout(),h=f.cOcc,k=f.cSpan,l=h-1,n=l+k-1,m=0,p=l;p<=n;p++)m+=d[p];m-=f.maxWidth;n=p=0;0>=m&&(m=0);var q=this.gridProperties.grHUF;if(0!=m)switch(f.hItemUF){case a._wgtHorUnderflowMode.INHERITED:switch(q){case a._groupHorUnderflowMode.LEFT:n=m;break;case a._groupHorUnderflowMode.CENTER:p=m/2;n=m/2;break;case a._groupHorUnderflowMode.RIGHT:p=m}break;case a._wgtHorUnderflowMode.LEFT:n=m;break;case a._wgtHorUnderflowMode.CENTER:p=m/2;n=m/2;break;case a._wgtHorUnderflowMode.RIGHT:p=
m}m=l;p=Math.round(this.colProperties[m].colPos+this.colProperties[m].lMargin+this.colProperties[m].lStroke+p);m=l+k;k=Math.round(this.colProperties[m].colPos-p-this.colProperties[h+k-2].rMargin-this.colProperties[m-1].rStroke-n);0>=k&&(k=.1);p+=f.lMargin;k=k-f.lMargin-f.rMargin;0>=k&&(k=.1);0<h?b[g].setAsVisible(!0):b[g].setAsVisible(!1);b[g].setParentBounds(p,e.y,k,e.height,b[g].parentWidget)}};a.prototype.wgtRepositioningY=function(b,c){for(var d=[],e=this.gridProperties.grRows,f=0;f<e;f++)d[f]=
this.rowProperties[f+1].rowPos-this.rowProperties[f].rowPos;for(var g in b)if(b[g].haveLayout()){for(var e=b[g].getParentBounds(b[g].parentWidget),f=b[g].getLayout(),h=f.rOcc,k=f.rSpan,l=h-1,n=l+k-1,m=0,p=l;p<=n;p++)m+=d[p];m-=f.maxHeight;n=p=0;0>=m&&(m=0);var q=this.gridProperties.grVUF;if(0!=m)switch(f.vItemUF){case a._wgtVerUnderflowMode.INHERITED:switch(q){case a._groupVerUnderflowMode.TOP:n=m;break;case a._groupVerUnderflowMode.MIDDLE:p=m/2;n=m/2;break;case a._groupVerUnderflowMode.BOTTOM:p=
m}break;case a._wgtVerUnderflowMode.TOP:n=m;break;case a._wgtVerUnderflowMode.MIDDLE:p=m/2;n=m/2;break;case a._wgtVerUnderflowMode.BOTTOM:p=m}m=l;p=Math.round(this.rowProperties[m].rowPos+this.rowProperties[m].tMargin+this.rowProperties[m].tStroke+p);m=l+k;k=Math.round(this.rowProperties[m].rowPos-p-this.rowProperties[h+k-2].bMargin-this.rowProperties[m-1].bStroke-n);0>=k&&(k=.1);p+=f.tMargin;k=k-f.tMargin-f.bMargin;0>=k&&(k=.1);0<h?b[g].setAsVisible(!0):b[g].setAsVisible(!1);b[g].setParentBounds(e.x,
p,e.width,k,b[g].parentWidget)}};a.prototype.baseWidthCalc=function(b){var c,d=0,e=[],f=[],g=[],h=this.gridProperties.grCols;this.colProperties.length<=h&&(this.colProperties.push({}),this.colProperties[h].colPos=0,this.colProperties[h].maxWidth=0);b=Math.round(b);if(0>=b)return a._grState.ERROR;for(var k=0;k<h;k++)g.push(!0);for(var l=a._grState.ERROR,n=0;n<=h;n++){for(k=c=0;k<h;k++)e[k]=0,g[k]&&(c+=this.colProperties[k].stretch);for(var m=0,k=0;k<h;k++){if(g[k]){e[k]=this.colProperties[k].stretch/
c;null==f[k]&&(f[k]=0);f[k]+=e[k]*(b-d);var p=this.colProperties[k].minWidth,q=this.colProperties[k].maxWidth;f[k]>q-1E-5&&(f[k]=q);f[k]<p+1E-5&&(f[k]=p)}m+=f[k]}d=m;if(this.fuzzyCompare(b,d)){l=a._grState.OK;break}c=!0;if(d>b){for(k=0;k<h;k++)g[k]&&(p=this.colProperties[k].minWidth,f[k]<p+1E-5?g[k]=!1:c=!1);if(c){l=a._grState.OVERFLOW;break}}else{for(k=0;k<h;k++)g[k]&&(q=this.colProperties[k].maxWidth,f[k]>q-1E-5?g[k]=!1:c=!1);if(c){l=a._grState.UNDERFLOW;break}}}this.colProperties[0].colPos=0;for(k=
1;k<=h;k++)this.colProperties[k].colPos=this.colProperties[k-1].colPos+f[k-1];return l};a.prototype.baseHeightCalc=function(b){var c,d=0,e=[],f=[],g=[],h=this.gridProperties.grRows;this.rowProperties.length<=h&&(this.rowProperties.push({}),this.rowProperties[h].rowPos=0,this.rowProperties[h].maxHeight=0);b=Math.round(b);if(0>=b)return a._grState.ERROR;for(var k=0;k<h;k++)g.push(!0);for(var l=a._grState.ERROR,n=0;n<=h;n++){for(k=c=0;k<h;k++)e[k]=0,g[k]&&(c+=this.rowProperties[k].stretch);for(var m=
0,k=0;k<h;k++){if(g[k]){e[k]=this.rowProperties[k].stretch/c;null==f[k]&&(f[k]=0);f[k]+=e[k]*(b-d);var p=this.rowProperties[k].minHeight,q=this.rowProperties[k].maxHeight;f[k]>q-1E-5&&(f[k]=q);f[k]<p+1E-5&&(f[k]=p)}m+=f[k]}d=m;if(this.fuzzyCompare(b,d)){l=a._grState.OK;break}c=!0;if(d>b){for(k=0;k<h;k++)g[k]&&(p=this.rowProperties[k].minHeight,f[k]<p+1E-5?g[k]=!1:c=!1);if(c){l=a._grState.OVERFLOW;break}}else{for(k=0;k<h;k++)g[k]&&(q=this.rowProperties[k].maxHeight,f[k]>q-1E-5?g[k]=!1:c=!1);if(c){l=
a._grState.UNDERFLOW;break}}}this.rowProperties[0].rowPos=0;for(k=1;k<=h;k++)this.rowProperties[k].rowPos=this.rowProperties[k-1].rowPos+f[k-1];return l};a._grState={OK:0,OVERFLOW:1,UNDERFLOW:2,ERROR:3};a._wgtHorUnderflowMode={INHERITED:0,LEFT:1,CENTER:2,RIGHT:3};a._groupHorUnderflowMode={BLOCKED:0,LEFT:1,CENTER:2,RIGHT:3};a._wgtVerUnderflowMode={INHERITED:0,TOP:1,MIDDLE:2,BOTTOM:3};a._groupVerUnderflowMode={BLOCKED:0,TOP:1,MIDDLE:2,BOTTOM:3};a._groupHorOverflow={HIDDEN:0,VISIBLE:1,SCROLL:2};a._groupVerOverflow=
{HIDDEN:0,VSIBLE:1,SCROLL:2};a._scrollbarAutohide={AUTO:0,ALWAYSVISIBLE:1};a.enumStrokeMode={AUTO:0,FIXED:1};a.enumStrokeCollaption={FALSE:0,TRUE:1};return a}(),GraphicGrid=function(){function a(a){this.group=a}a.prototype.drawGrid=function(){for(var a=this.group.getGridProperties(),c=a.grRows,a=a.grCols,d=this.createTableElement(),e,f,g=0;g<c;g++){e=this.createRowElement();for(var h=0;h<a;h++)f=this.createCellElement(),this.applyStyles(e,f,g,h),e.appendChild(f);d.appendChild(e)}this.removeBackgroundStrokes(d);
this.appendTableElement(d)};a.prototype.appendTableElement=function(a){var c=this.group.getScrollbarContentElem();a.appendBefore(null!=c?c.firstElementChild:this.group.elem.firstElementChild)};a.prototype.createTableElement=function(){var a=document.createElement("div"),c=this.group.getParentBounds(this.group.parentWidget);a.id=this.group.wgtId+".table-grid";a.style.position="absolute";a.style.width=c.width+"px";a.style.height=c.height+"px";return a};a.prototype.createRowElement=function(){var a=
document.createElement("div");a.id=this.group.wgtId+".table-row";a.className+=" gr-row";return a};a.prototype.createCellElement=function(){var a=document.createElement("div");a.id=this.group.wgtId+".table-cell";a.className+=" gr-cell";return a};a.prototype.removeBackgroundStrokes=function(a){var c=this.group.getRowProperties(),d=this.group.getChildren(),e;for(e in d)if(d[e].haveLayout()){var f=d[e].getLayout(),g=f.rOcc-1,h=g+f.rSpan,k=f.cOcc-1,l=k+f.cSpan,n=f.lBgColor?f.lBgColor:c[g].bgColor;if(1==
f.rSpan&&1==f.cSpan)a.childNodes[g].childNodes[k].style.backgroundColor=n;else for(f=g;f<h;f++)for(var m=a.childNodes[f],p=k;p<l;p++)f+1<h&&(m.childNodes[p].style.borderBottom="none"),f-1>=g&&(m.childNodes[p].style.borderTop="none"),p+1<l&&(m.childNodes[p].style.borderRight="none"),p-1>=k&&(m.childNodes[p].style.borderLeft="none"),m.childNodes[p].style.backgroundColor=n}};a.prototype.applyStyles=function(a,c,d,e){var f=this.group.getRowProperties(),g=this.group.getColProperties();a.style.top=f[d].rowPos+
"px";c.style.left=g[e].colPos+"px";c.style.height=f[d+1].rowPos-f[d].rowPos+"px";c.style.width=g[e+1].colPos-g[e].colPos+"px";c.style.borderLeft=g[e].lStroke+"px solid "+g[e].lStkColor;c.style.borderRight=g[e].rStroke+"px solid "+g[e].rStkColor;c.style.borderTop=f[d].tStroke+"px solid "+f[d].tStkColor;c.style.borderBottom=f[d].bStroke+"px solid "+f[d].bStkColor;c.style.backgroundColor=f[d].bgColor};a.prototype["delete"]=function(){var a=this.group.getScrollbarContentElem(),a=null!=a?a:this.group.elem;
a.firstElementChild.id==this.group.wgtId+".table-grid"&&a.removeChild(a.firstElementChild)};return a}(),ATTR_LINK_TYPE;(function(a){a[a.VALUE=0]="VALUE";a[a.MLPATCH=1]="MLPATCH"})(ATTR_LINK_TYPE||(ATTR_LINK_TYPE={}));
var hmiGroup=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.clickWgtId=null;b.activeElements=[];b.invokablePropsList=b.initializeIvokablePropList();b.hasModule=!1;b.cwMLMgr=null;d=$hmi.activeProject.getCWidgetMgr();if(null!=d){d.instantiateCW(b,b.ctype);for(var h in b.links)(d=b.links[h],d.t==ATTR_LINK_TYPE.VALUE&&null!=d.v)?b.setValue(h,d.v,Tag.prototype.QUALITY_GOOD):d.t==ATTR_LINK_TYPE.MLPATCH&&(e=$hmi.activeProject.getWidget("_MultiLangMgr",!0))&&(d=d.v[e.getCurrentLangIndex()],
b.setValue(h,d,Tag.prototype.QUALITY_GOOD))}b.hasGridLayout()&&b.initGridLayout();return b}__extends(b,a);b.prototype.setGridLayout=function(a){this.grid=a;this.initGridLayout()};b.prototype.initGridLayout=function(){this.gridLayoutInstance=new GridLayoutClass;this.groupConfigurations=this.getConfigurationClones();this.graphicGrid=new GraphicGrid(this);this.configurationId=-1};b.prototype.initializeIvokablePropList=function(){var a=[];if($hmi.activeProject.props&&$hmi.activeProject.props[this.ctype]){var b=
$hmi.activeProject.props[this.ctype],e;for(e in b)a.push(e)}return a};b.prototype.findWgt=function(a,b){var e=b.replace("*",a.studioId),e=a.mapId[e];if(void 0!==e)return a.wgts[e];var f=b.split("."),g=f.length;if(!(1>=g)){for(var h=1;h<g;h++){e=a.mapId[a.studioId+"."+f[h]];if(void 0===e)return;a=a.wgts[e]}return a}};b.prototype.getWidget=function(b,d,e){if(!0===d&&"*"===b.charAt(0)&&"."===b.charAt(1)){var f=this.findWgt(this,b);if(void 0!==f)return e?f.isTemplateWgt?f:null:f;var f=this.wgts,g;for(g in f){var h=
f[g].getWidget(b,d,e);if(null!==h)if(e){if(h.isTemplateWgt)return h}else return h}return null}return a.prototype.getWidget.call(this,b,d,e)};b.prototype.getWidgetsByJMClass=function(a,d,e){for(var f in this.wgts){var g=this.wgts[f];if(g.constructor.jmType==a){if(e.push(g),e.length>=d)return!0}else if(g instanceof b&&g.getWidgetsByJMClass(a,d,e))return!0}return!1};b.prototype.addDataLink=function(b){a.prototype.addDataLink.call(this,b);var d=b.attr;if("*"===d[0]&&"."===d[1]){var e=d.lastIndexOf("."),
e=this.getWidget(d.substring(0,e),!0,this.isTemplateWgt);null!==e&&(d=d.split("."),e.initDataLinkSideEffects(b,d[d.length-1]))}};b.prototype.addParameterDataLink=function(a,b){void 0===this.params[a].links&&(this.params[a].links=[]);this.params[a].links.push(b)};b.prototype.hasParameter=function(a){return this.params&&this.params[a]?!0:!1};b.prototype.getParentModuleWithParameter=function(a){for(var b=this.module;b;){if(b.hasParameter(a))return b;b=this.parentWidget.module}return null};b.prototype.updateDataLinkParm=
function(a){if(a=this.params[a].links)for(var b=0,e=a.length;b<e;b++)a[b].updateDSParameter()};b.prototype.getDatalink=function(a){for(var b in this.dataLinks){var e=this.dataLinks[b];if(e.attr==a)return e}return null};b.prototype.setModule=function(){this.hasModule=!0};b.prototype.areAliases=function(a,b){return-1!=this.project.getCWidgetMgr().getAttributeLink(this.ctype,a).indexOf(b)};b.prototype.addWidget=function(b,d){a.prototype.addWidget.call(this,b,d);this.disabled&&d.setValue("disabled",1,
null,null)};b.prototype.setValue=function(c,d,e,f){var g=$hmi.activeProject.getCWidgetMgr(),h=this.invokablePropsList;if("*"===c[0]&&"."===c[1]){var g=c.lastIndexOf("."),k=this.getWidget(c.substring(0,g),!0,this.isTemplateWgt);null!==k&&(g=c.split("."),k.setValue(g[g.length-1],d,e,f),this.sendUpdate(c,d,e))}else if(-1!==g.getParameters(this.ctype).indexOf(c)||null!=this.params&&void 0!==this.params[c])e.isQualityGood()&&(this.params[c].v=d,this.updateDataLinkParm(c));else if(this[c]!=d||e&&!e.isQualityGood())if((g=
g.getAttributeLink(this.ctype,c))&&0<g.length){for(var h=0,l=g.length;h<l;h++){var n=g[h].lastIndexOf("."),k=g[h].substring(0,n),n=g[h].substr(n+1),k=this.getWidget(k,!0,this.isTemplateWgt);null==k&&(k={wgt:null,prop:null},this.resolveAliasAttribute(g[h],k),k=k.wgt);k&&k.setValue(n,d,e,f)}if(void 0===e||e.isQualityGood())this[c]=d;this.sendUpdate(c,d,e)}else if(h&&-1!=h.indexOf(c)){g=$hmi.activeProject.props[this.ctype][c];k={wgt:null,prop:null};for(h=0;h<g.length;h++)this.resolveAliasAttribute(g[h],
k),null!==k.wgt&&k.wgt.setValue(k.prop,d,e,f);e.isQualityGood()&&(this[c]=d)}else if("disabled"==c){if(this.disabled!=d)for(l in this.disabled=d="boolean"==typeof d?1==d?1:0:parseFloat(d),this.sendUpdate(c,this.disabled,e),this.wgts)this.wgts[l].setValue(c,this.disabled,e,f)}else"relHorScrollPos"==c?this.scrollbar&&this.xScrollbarPosition!=d&&(this.xScrollbarPosition=d,this._renderMask|=b._renderFlags.UPDATESCROLLBARX,$hmi.addToRender(this)):"relVerScrollPos"==c?this.scrollbar&&this.yScrollbarPosition!=
d&&(this.yScrollbarPosition=d,this._renderMask|=b._renderFlags.UPDATESCROLLBARY,$hmi.addToRender(this)):a.prototype.setValue.call(this,c,d,e,f)};b.prototype.getValue=function(a){if(void 0!==this.params&&void 0!==this.params[a])return this.params[a].v;if("*"==a[0]&&"."==a[1]){var b=a.lastIndexOf("."),b=this.getWidget(a.substring(0,b),!0,this.isTemplateWgt);if(null!==b)return a=a.split("."),b.getValue(a[a.length-1])}else return hmiWidget.prototype.getValue.call(this,a)};b.prototype.resolveAliasAttribute=
function(b,d){if("*"===b[0]&&"."===b[1]){var e=b.lastIndexOf("."),e=this.getWidget(b.substring(0,e),!0,this.isTemplateWgt);if(null!==e){var f=b.split(".");d.wgt=e;d.prop=f[f.length-1]}else d.wgt=null,d.prop=null}else a.prototype.resolveAliasAttribute.call(this,b,d)};b.prototype.render=function(){a.prototype.render.call(this);if(this._renderMask&b._renderFlags.DRWSCROLLBAR&&!this.scrollbar){var c=this.getOverflow();window.Scrollbar.use(DisableScrollPlugin);var d=this;this.scrollbar=window.Scrollbar.init(this.elem);
this.scrollbar.addListener(function(){if(0<d.activeElements.length)for(var a in d.activeElements)d.activeElements[a].remove()});c.hor!=GridLayoutClass._groupHorOverflow.SCROLL&&(this.scrollbar.track.xAxis.element.remove(),this.scrollbar.options.plugins.disableScroll.direction="x");c.ver!=GridLayoutClass._groupVerOverflow.SCROLL&&(this.scrollbar.track.yAxis.element.remove(),this.scrollbar.options.plugins.disableScroll.direction="y")}this._renderMask&b._renderFlags.UPDATESCROLLBARX&&(c=this.getOverflow(),
this.scrollbar&&c.hor==GridLayoutClass._groupHorOverflow.SCROLL&&this.scrollbar.setPosition(this.xScrollbarPosition,this.scrollbar.offset.y));this._renderMask&b._renderFlags.UPDATESCROLLBARY&&(c=this.getOverflow(),this.scrollbar&&c.ver==GridLayoutClass._groupVerOverflow.SCROLL&&this.scrollbar.setPosition(this.scrollbar.offset.x,this.yScrollbarPosition));this._renderMask&b._renderFlags.DRAWGRID&&(this.graphicGrid["delete"](),this.graphicGrid.drawGrid());this._renderMask=0};b.prototype.setParentBounds=
function(b,d,e,f,g){var h=this.width,k=this.height;a.prototype.setParentBounds.call(this,b,d,e,f,g);if(this.hasGridLayout())this.executeGridLayout();else if(!this.xformScaling){d=this.width;b=this.height;var h=0==h?0==d?1:d/1E-6:d/h,k=0==k?0==b?1:b/1E-6:b/k,l;for(l in this.wgts)b=this.wgts[l],d=b.getParentBounds(this),b.setParentBounds(d.x*h,d.y*k,d.width*h,d.height*k,this)}};b.prototype.executeGridLayout=function(){var a=this.checkGridConfiguration(this.groupConfigurations);a.id!==this.configurationId&&
(this.configurationId=a.id,this.gridLayoutInstance.init(a.cl));this.gridLayoutInstance.applyAlgorithm(this);this.drawGrid();this.drawScrollbar()};b.prototype.drawGrid=function(){this._renderMask|=b._renderFlags.DRAWGRID;$hmi.addToRender(this)};b.prototype.drawScrollbar=function(){var a=this.getOverflow();if(a.hor==GridLayoutClass._groupHorOverflow.SCROLL||a.ver==GridLayoutClass._groupVerOverflow.SCROLL)this._renderMask|=b._renderFlags.DRWSCROLLBAR;$hmi.addToRender(this)};b.prototype.updateLanguage=
function(){for(var a in this.wgts)this.wgts[a].updateLanguage()};b.prototype.setCWMLTextMgr=function(a){this.cwMLMgr=a};b.prototype.getCWMLTextMgr=function(){return this.cwMLMgr};b.prototype.getAttributeLinks=function(){return this.links};b.prototype.hasMLManager=function(){return null!=this.cwMLMgr};b.prototype.checkGridConfiguration=function(a){for(var b=a.length,e=0;e<b;e++){var f=a[e-1],g=a[e],h=g.gr.s?g.gr.s:this.width;if(this.width>(f?f.gr.s:0)&&this.width<=h||e==b-1)return{cl:g,id:e}}return{cl:a[b-
1],id:b-1}};b.prototype.cloneConf=function(a){var b={},e;for(e in a)b[e]="object"==typeof a[e]?this.cloneConf(a[e]):a[e];return b};b.prototype.getConfigurationClones=function(){for(var a=[],b=0;b<this.grid.length;b++)a.push(this.cloneConf(this.grid[b]));return a};b.prototype.getColProperties=function(){return this.gridLayoutInstance?this.gridLayoutInstance.getColProperties():null};b.prototype.getRowProperties=function(){return this.gridLayoutInstance?this.gridLayoutInstance.getRowProperties():null};
b.prototype.getGridProperties=function(){return this.gridLayoutInstance?this.gridLayoutInstance.getGridProperties():null};b.prototype.getOverflow=function(){var a=this.getGridProperties();return void 0!=a.grHOF&&void 0!=a.grVOF?{hor:a.grHOF,ver:a.grVOF}:null};b.prototype.getScrollbarContainerElem=function(){return this.scrollbar?this.scrollbar.containerEl:null};b.prototype.getScrollbarContentElem=function(){return this.scrollbar?this.scrollbar.contentEl:null};b.prototype.getScrollbarOffsets=function(){var a=
{top:0,left:0};this.scrollbar&&(a.top=$hmi.activePage.isFitToSizeEnable()?this.scrollbar.scrollTop*$hmi.activePage.sFactor:this.scrollbar.scrollTop,a.left=$hmi.activePage.isFitToSizeEnable()?this.scrollbar.scrollLeft*$hmi.activePage.sFactor:this.scrollbar.scrollLeft);return a};b.prototype.getChildren=function(){return this.wgts};b.prototype.hasGridLayout=function(){return this.grid?!0:!1};b.prototype.getLayoutSize=function(){var a;this.hasGridLayout()&&(a=this.gridLayoutInstance.getGridProperties().s);
return a};b.prototype.destroy=function(){a.prototype.destroy.call(this);this.scrollbar&&(this.scrollbar.removeListener(),this.scrollbar.destroy())};b.prototype.addAction=function(a,b){var e=$hmi.getActiveProject().getCWidgetMgr(),f;e&&(f=e.getAttributeLink(this.ctype,a));if(void 0===f||0==f.length)f=[a];for(var e=0,g=f.length;e<g;e++){var h=f[e];if("*"==h.charAt(0)&&"."==h.charAt(1)){var k=h.lastIndexOf("."),l=h.substr(k+1),h=this.getWidget(h.substring(0,k),!0,this.isTemplateWgt);null!=h&&h.addAction(l,
b)}}};b.prototype.addActiveElement=function(a){this.activeElements.push(a)};b.prototype.isModuleInstance=function(){return null!=this.ctype&&""!=this.ctype};b.jmType="GroupWgt";b._renderFlags={DRAWGRID:2,DRWSCROLLBAR:4,UPDATESCROLLBARX:8,UPDATESCROLLBARY:16};return b}(hmiWidget);$hmi.fn.hmiGroup=function(a,b,c,d){return new hmiGroup(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiGroup",hmiGroup);
var hmiEditBoxWgt=function(a){function b(b,d,e,f,g){b=a.call(this,b,d,e,f,g)||this;b.value=$hmi.cache.getWgtProp(b.wgtId,"value");return b}__extends(b,a);b.prototype.render=function(){if(this._renderMask&this._renderFlags.VALUE){if(this.formatType==this.enFormatType.TEXT&&null!=this.value)switch(this.ebt){case 0:this.writeText(this.value);break;case 1:this.writeText("");break;case 2:this.writeText(this.maskedValue(this.value))}this._renderMask=0<this._renderMask?this._renderMask-=this._renderFlags.VALUE:
0}a.prototype.render.call(this)};b.prototype.setValue=function(b,d,e,f){if(null!=this.elem){var g=!1;switch(b){case "editType":this.ebt!=d&&(this.ebt=d,this._renderMask|=this._renderFlags.VALUE,g=!0,this.sendUpdate(b,this.ebt,e));break;case "value":this.value!=d&&(this.value=d,this._renderMask|=this._renderFlags.VALUE,$hmi.cache.setWgtProp(this.wgtId,"value",this.value),g=!0,this.sendUpdate(b,this.value,e));break;case "Color":this.backgroundColor!=d&&(this.backgroundColor=d,this._renderMask|=this._renderFlags.FRFILL,
g=!0,this.sendUpdate(b,this.backgroundColor,e))}g&&$hmi.addToRender(this);"font-size"!=b&&"fill"!=b&&"fontColor"!=b||a.prototype.setValue.call(this,b,d,e,f)}};b.prototype.destroy=function(){return a.prototype.destroy.call(this)};b.jmType="EditBoxWgt";return b}(hmiNumeric);$hmi.fn.hmiEditBoxWgt=function(a,b,c,d){return new hmiEditBoxWgt(this,a,b,c,d)};
var hmiMultiLangMgr=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.mlWgts={};b.loadedFonts=[];(d=b.loadValue("curLangId"))&&d!=b.curLangId?b.changeLanguage(d):b.changeLanguage(b.curLangId);return b}__extends(b,a);b.prototype.subscribe=function(a,b){this.mlWgts[a]=b};b.prototype.unsubscribe=function(a){delete this.mlWgts[a]};b.prototype.changeLanguage=function(a){if(this.langs[a]){this.curLangId=a;this.saveValue("curLangId");var b=this.langs[a].defaultFont;-1==this.loadedFonts.indexOf(b)&&
(WebFont.load({custom:{families:[this.langs[a].defaultFont],urls:["/web/css/fonts.css"]}}),this.loadedFonts.push(b));for(var e in this.mlWgts)if(this.mlWgts[e])this.mlWgts[e](a)}};b.prototype.setValue=function(a,b){};b.prototype.getValue=function(a){};b.prototype.getLanguageFont=function(a){return(a=this.langs[a])?a.defaultFont:""};b.prototype.getCurrentLanguage=function(){return this.curLangId};b.prototype.getCurrentLangIndex=function(){return parseInt(this.curLangId.substr(1))};b.jmType="MultiLangMgrWgt";
return b}(hmiWidget);$hmi.fn.hmiMultiLangMgr=function(a,b,c,d){return new hmiMultiLangMgr(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiMultiLangMgr",hmiMultiLangMgr);
var hmiImage=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.clickWgtId=null;return b}__extends(b,a);b.prototype.render=function(){a.prototype.render.call(this);this._renderMask&b._renderFlags.FILL&&this.updateBackground();this._renderMask=0};b.prototype.updateBackground=function(){var a=$("."+b.backgroundClass,this.elem);a.length?a.css("fill",this.bgColor):$("svg",this.elem).css("fill",this.bgColor)};b.prototype.setValue=function(a,d,e,f){f=!1;null!=this.elem&&("fill"==a?
(isNaN(d)&&void 0!=d&&(this.isBadValue(d,!0,e)?f=!0:this.bgColor!=d&&(0==d.indexOf("#")&&1<d.length&&8>=d.length&&(this.bgColor=d),f=!0,this.sendUpdate(a,this.bgColor,null))),f&&(this._renderMask|=b._renderFlags.FILL,$hmi.addToRender(this))):hmiWidget.prototype.setValue.call(this,a,d,e))};b.backgroundClass="bgColor00";b._renderFlags={FILL:1,UPDATESVG:2,WIDTH:4,HEIGHT:8};b.jmType="ImageWgt";return b}(hmiWidget);$hmi.fn.hmiImage=function(a,b,c,d){return new hmiImage(this,a,b,c,d)};
$hmi.addWidgetDefinition("hmiImage",hmiImage);
var hmiShape=function(a){function b(c,d,e,f,g){c=a.call(this,c.wgtId,d,e,f,g)||this;c.bkElem=c.elem.querySelector("."+b.backgroundClass);c.backgroundColor=c.bkElem.getAttribute("fill");return c}__extends(b,a);b.prototype.applyStrokeColor=function(){this.elem.getElementsByTagName("svg")[0].firstElementChild.setAttribute("stroke",this.strokeColor)};b.prototype.applyStrokeWidth=function(){var a=this.elem.getElementsByTagName("svg")[0].firstElementChild,b=(this.width-this.strokeWidth)/this.width,e=(this.height-
this.strokeWidth)/this.height;setTransformOrigin(a,"center");setTransform(a,"scale( "+b+","+e+" )");a.setAttribute("stroke-width",""+this.strokeWidth)};b.prototype.render=function(){a.prototype.render.call(this);this._renderMask&b._renderFlags.FILL&&this.updateBackground();if(this._renderMask&b._renderFlags.UPDATESVG&&this.elem.getElementsByTagName("svg")[0]){var c=this.elem.getElementsByTagName("svg")[0],d=this.width/parseFloat(c.getAttribute("width")),e=this.height/parseFloat(c.getAttribute("height"));
setTransformOrigin(c,"top left");setTransform(c,"scale("+d+","+e+")")}this._renderMask&b._renderFlags.STRK&&this.applyStrokeColor();this._renderMask&b._renderFlags.STRKWIDTH&&this.applyStrokeWidth();this._renderMask=0};b.prototype.updateBackground=function(){null!=this.bkElem&&this.bkElem.setAttribute("fill",this.backgroundColor)};b.prototype.setValue=function(a,d,e,f){f=!1;var g="#000";if(null!=this.elem){switch(a){case "fill":this.isBadValue(d,!0,e)||this.strokeColor==d||(0==d.indexOf("#")&&1<d.length&&
8>=d.length?g=d:0===d.indexOf("rgb")&&(g=d),this.backgroundColor=g,f=!0,this.sendUpdate(a,this.backgroundColor,e));this._renderMask|=b._renderFlags.FILL;break;case "stroke":this.strokeColor!=d&&"string"==typeof d&&0==d.indexOf("#")&&1<d.length&&8>=d.length&&(this.strokeColor=d,this._renderMask|=b._renderFlags.STRK,f=!0);break;case "stroke-width":this.strokeWidth!=d&&(this.strokeWidth=d,this._renderMask|=b._renderFlags.STRKWIDTH,f=!0);break;default:hmiWidget.prototype.setValue.call(this,a,d,e)}f&&
$hmi.addToRender(this)}};b.prototype.getValue=function(b){return"fill"==b?this.backgroundColor:a.prototype.getValue.call(this,b)};b.prototype.setParentBounds=function(c,d,e,f,g){a.prototype.setParentBounds.call(this,c,d,e,f,g);this._renderMask|=b._renderFlags.UPDATESVG;$hmi.addToRender(this)};b.prototype.destroy=function(){this.backgroundColor=this.bkElem=null;return a.prototype.destroy.call(this)};b.backgroundClass="bgColor00";b._renderFlags={FILL:2,UPDATESVG:4,STRK:8,STRKWIDTH:16};b.jmType="ShapeWgt";
return b}(hmiWidget);$hmi.fn.hmiShape=function(a,b,c,d){return new hmiShape(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiShape",hmiShape);
var hmiTicks=function(a){function b(c,d,e,f,g){c=a.call(this,c.wgtId,d,e,f,g)||this;c.frame=0;c.form=null;c.color="rgb(0,0,0)";c.line=null;c.pathMajor=null;c.pathMinor=null;c.xScale=null;c.yScale=null;if(d=c.elem.getElementsByTagName("path"))1==c.frame&&c.form==b.enForm.RND?(c.line=d[0],c.pathMajor=d[1],c.pathMinor=d[2]):(c.pathMajor=d[0],c.pathMinor=d[1]);(c.form==b.enForm.HRZ||c.form==b.enForm.VRT)&&(d=c.elem.getElementsByTagName("line"))&&1<=d.length&&(c.line=d[0]);return c}__extends(b,a);b.prototype.render=
function(){a.prototype.render.call(this);this._renderMask&b._renderFlags.COLOR&&(this.form==b.enForm.VRT||this.form==b.enForm.HRZ?(this.pathMajor.setAttribute("fill",this.color),this.pathMinor.setAttribute("fill",this.color)):(this.pathMajor.setAttribute("stroke",this.color),this.pathMinor.setAttribute("stroke",this.color)),this.line&&this.line.setAttribute("stroke",this.color));if(this._renderMask&b._renderFlags.UPDATESVG&&this.elem.getElementsByTagName("svg")[0]){var c=this.elem.getElementsByTagName("svg")[0],
d=this.width/parseFloat(c.getAttribute("width")),e=this.height/parseFloat(c.getAttribute("height"));setTransformOrigin(c,"top left");setTransform(c,"scale("+d+","+e+")")}this._renderMask=0};b.prototype.setValue=function(c,d,e,f){f=!1;if("stroke"==c){var g="#000";this.isBadValue(d,!0,e)?(this.color=g,this._renderMask|=b._renderFlags.COLOR,f=!0):this.color!=d&&(isNaN(d)&&0==d.indexOf("#")&&1<d.length&&8>=d.length&&(g=d),this.color=g,this._renderMask|=b._renderFlags.COLOR,f=!0,this.sendUpdate(c,this.color,
e))}else"visibility2"==c?a.prototype.setValue.call(this,"visibility",d,e,null):a.prototype.setValue.call(this,c,d,e,null);f&&$hmi.addToRender(this)};b.prototype.setParentBounds=function(c,d,e,f,g){a.prototype.setParentBounds.call(this,c,d,e,f,g);this._renderMask|=b._renderFlags.UPDATESVG;$hmi.addToRender(this)};b.prototype.destroy=function(){this.pathMinor=this.pathMajor=this.line=null;return a.prototype.destroy.call(this)};b.enForm={VRT:0,HRZ:1,RND:2};b._renderFlags={COLOR:2,NTICKS:4,UPDATESVG:8};
b.jmType="TicksWgt";return b}(hmiWidget);$hmi.fn.hmiTicks=function(a,b,c,d){return new hmiTicks(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiTicks",hmiTicks);
var hmiButton=function(a){function b(c,d,e,f,g){c=a.call(this,c.wgtId,d,e,f,g)||this;c.setDefaultState();-1!=c.groupID&&c.parentPage.getProject().groupButtonIn(c,c.groupID);c.authCode=c.getAuthorizations();"standard"==c.type?c.classReleased&&c.classPressed?(c.isRaster=!0,c.curState=-1!=c.elem.className.indexOf(c.classPressed)?1:0):(c.divPressed=document.getElementById(c.elem.id+"_pressed"),c.divReleased=document.getElementById(c.elem.id+"_released"),c.curState=1==parseInt(c.divPressed.style.opacity)?
1:0):(c.dwnFill&&(c.curState=c.elem.style.backgroundColor==c.dwnFill?1:0),c.dwnStroke&&(c.curState=c.elem.style.borderColor==c.dwnStroke?1:0));c.events={mousedown:!0,touchstart:!0};c.wgtsOnTop=[];if(c.parentWidget&&c.parentWidget.constructor==hmiGroup)for(d=c.elem.nextSibling;d;)c.wgtsOnTop.push(d),d=d.nextSibling;c._animStatus=c.curState;0==c.toggle&&1==c.curState&&(c.curState=0,c._renderMask|=b._renderFlags.VALUE,c.render());return c}__extends(b,a);b.prototype.setDefaultState=function(){this.isRaster=
void 0===this.isRaster?!1:this.isRaster;this.classPressed=void 0===this.classPressed?null:this.classPressed;this.classReleased=void 0===this.classReleased?null:this.classReleased;this.curState=void 0===this.curState?0:this.curState;this.toggle=void 0===this.toggle?0:this.toggle;this.action=void 0===this.action?"write":this.action;this.numStates=void 0===this.numStates?2:this.numStates;this.type=void 0===this.type?"standard":this.type;this.strokeWidth=void 0===this.strokeWidth?1:this.strokeWidth;this.backgroundClass=
void 0===this.backgroundClass?"bgColor00":this.backgroundClass;this.backgroundColor=void 0===this.backgroundColor?"":this.backgroundColor;this.dx=void 0===this.dx?2:this.dx;this.dy=void 0===this.dy?2:this.dy;this.groupID=void 0===this.groupID?-1:this.groupID;this.invokablePropsList=["value"];this._renderMask=this._animStatus=0;this._lockEvent=!1};b.prototype.doMouseDown=function(a){if(this.disabled||this.authCode==this.umgr.wgtAuth.RDONLY)return!1;var b=this;if(this._lockEvent)return!1;this._lockEvent=
!0;setTimeout(function(){b._lockEvent=!1},100);this.toggle&&-1!=this.groupID&&this.parentPage.getProject().updateButtonGroupedByID(this,this.groupID);this.setValue("value",this.toggle?1===this.curState?0:1:1,null);this.doWriteValue("value",this.curState);return!0};b.prototype.doMouseUp=function(a){if(this.disabled||this.authCode==this.umgr.wgtAuth.RDONLY)return!1;this.toggle||(this.setValue("value",0,null),this.doWriteValue("value",this.curState));return!0};b.prototype.updateColor=function(){var a=
this;$("."+this.backgroundClass,this.elem).each(function(){var b=$(this);b.css("fill")?b.css("fill",a.fill):b.attr("fill",a.fill)})};b.prototype.offsetTopWgts=function(a){for(var b=0,e=this.wgtsOnTop.length;b<e;b++){var f=this.wgtsOnTop[b];if(3!=f.nodeType){var g=parseInt(f.style.top.split("px")[0]),h=parseInt(f.style.left.split("px")[0]);a?(f.style.top=g+this.dy+"px",f.style.left=h+this.dx+"px"):(f.style.top=g-this.dy+"px",f.style.left=h-this.dx+"px")}}};b.prototype.render=function(){if(!hmiWidget.prototype.render.call(this))return!1;
var a=this;if(this._renderMask&b._renderFlags.VALUE)if("standard"===this.type)if(this.isRaster){var d,e=this.elem.className.split(" ");this.curState?(d=e.indexOf(this.classReleased),-1!=d&&(this._animStatus=b._enStatus.IS_PRESSED,e.splice(d,1),this.elem.className=e.join(" ")+" "+this.classPressed,this.offsetTopWgts(1))):$hmi.modernBrowser?a.elem&&0==a.curState&&(d=e.indexOf(a.classPressed),-1!=d&&(a._animStatus=b._enStatus.IS_RELEASED,e.splice(d,1),a.elem.className=e.join(" ")+" "+a.classReleased,
a.offsetTopWgts(0))):setTimeout(function(){a.elem&&0==a.curState&&(d=e.indexOf(a.classPressed),-1!=d&&(a._animStatus=b._enStatus.IS_RELEASED,e.splice(d,1),a.elem.className=e.join(" ")+" "+a.classReleased,a.offsetTopWgts(0)))},50)}else this.curState?(this._animStatus=b._enStatus.IS_PRESSED,this.divPressed.style.opacity="1",this.divReleased.style.opacity="0",this.offsetTopWgts(1)):(a=this,$hmi.modernBrowser?(a._animStatus=b._enStatus.IS_RELEASED,a.divPressed.style.opacity="0",a.divReleased.style.opacity=
"1",a.offsetTopWgts(0)):setTimeout(function(){a.elem&&(a._animStatus=b._enStatus.IS_RELEASED,a.divPressed.style.opacity="0",a.divReleased.style.opacity="1",a.offsetTopWgts(0))},50));else if("rectangle"===this.type||"oval"===this.type)this.curState?(this._animStatus=b._enStatus.IS_PRESSED,this.dwnFill&&(this.elem.style.backgroundColor=this.dwnFill),this.dwnStroke&&(this.elem.style.borderColor=this.dwnStroke)):(a=this,$hmi.modernBrowser?(a._animStatus=b._enStatus.IS_RELEASED,a.upFill&&(a.elem.style.backgroundColor=
a.upFill),a.upStroke&&(a.elem.style.borderColor=a.upStroke)):setTimeout(function(){a.elem&&(a._animStatus=b._enStatus.IS_RELEASED,a.upFill&&(a.elem.style.backgroundColor=a.upFill),a.upStroke&&(a.elem.style.borderColor=a.upStroke))},50));this._renderMask&b._renderFlags.FILL&&this.updateColor();this._renderMask=0;return!0};b.prototype.setValue=function(a,d,e,f){if("value"==a){if(this.isBadValue(d,!1,e))return!1;d=parseFloat(d);if(isNaN(d))return!1;d=1<d||0>d?0:d;this.curState!=d&&(this.curState=d,this._renderMask|=
b._renderFlags.VALUE,this.render(),this.sendUpdate(a,this.curState,e))}else"fill"==a?(a=!1,isNaN(d)&&(this.isBadValue(d,!0,e)?a=!0:this.fill!=d&&(this.fill=this.validateColor(d)?d:"#000",a=!0)),a&&(this._renderMask|=b._renderFlags.FILL,$hmi.addToRender(this))):hmiWidget.prototype.setValue.call(this,a,d,e,f);return!0};b.prototype.validateColor=function(a){return 0==a.indexOf("#")&&1<a.length&&8>=a.length||"r"===a.charAt(0)&&"g"===a.charAt(1)&&"b"===a.charAt(2)?!0:!1};b.prototype.getValue=function(a){return"value"==
a?this.curState:hmiWidget.prototype.getValue.call(this,a)};b.prototype.destroy=function(){if(this.destroyed)return!1;if(!$hmi.modernBrowser&&0==this.curState&&this._animStatus==b._enStatus.IS_PRESSED)if("standard"===this.type)if(this.isRaster){var a=this.elem.className.split(" "),d=a.indexOf(this.classPressed);-1!=d&&(a.splice(d,1),this.elem.className=a.join(" ")+" "+this.classReleased,this.offsetTopWgts(0))}else this.divPressed.style.opacity="0",this.divReleased.style.opacity="1",this.offsetTopWgts(0);
else this.upFill&&(this.elem.style.backgroundColor=this.upFill),this.upStroke&&(this.elem.style.borderColor=this.upStroke);this.wgtsOnTop=[];this.divReleased=this.divPressed=null;return hmiWidget.prototype.destroy.call(this)};b.jmType="ButtonWgt";b._renderFlags={VALUE:2,FILL:4};b._enStatus={IS_RELEASED:0,IS_PRESSED:1};return b}(hmiWidget);$hmi.fn.hmiButton=function(a,b,c,d){return new hmiButton(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiButton",hmiButton);
var hmiLine=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.scaleX=1;b.scaleY=1;return b}__extends(b,a);b.prototype.applyStrokeColor=function(){this.elem.getElementsByTagName("svg")[0].firstElementChild.setAttribute("stroke",this.strokeColor)};b.prototype.updateSvgLineCode=function(a){var b=this.height+2*this.strokeWidth,e=-this.strokeWidth;a.setAttribute("width",""+(this.width+2*this.strokeWidth));a.setAttribute("height",""+b);a.style.marginLeft=e+"px";a.style.top=e+"px"};
b.prototype.updateLineAnchor=function(a){var b=parseFloat(a.getAttribute("width"));a=parseFloat(a.getAttribute("height"));var e,f,g,h,k=this.strokeWidth;switch(this.anchorIdx){case 0:e=0+k;g=0+k;f=b-k;h=a-k;break;case 1:e=0+k;g=a-k;f=b-k;h=0+k;break;case 2:e=b-k;g=0+k;f=0+k;h=a-k;break;case 3:e=b-k,g=a-k,f=0+k,h=0+k}return{x1:e,x2:f,y1:g,y2:h}};b.prototype.updateLineCode=function(a,b){a.setAttribute("x1",""+b.x1);a.setAttribute("y1",""+b.y1);a.setAttribute("x2",""+b.x2);a.setAttribute("y2",""+b.y2);
a.setAttribute("stroke-width",""+this.strokeWidth)};b.prototype.applyStrokeWidth=function(){var a=this.elem.getElementsByTagName("svg")[0],b=a.firstElementChild;this.updateSvgLineCode(a);this.updateLineCode(b,this.updateLineAnchor(a))};b.prototype.render=function(){a.prototype.render.call(this);if(this._renderMask&b._renderFlags.UPDATESVG&&this.elem.getElementsByTagName("svg")[0]){var c=this.elem.getElementsByTagName("svg")[0];setTransformOrigin(c,"top left");setTransform(c,"scale("+this.scaleX+","+
this.scaleY+")")}this._renderMask&b._renderFlags.STRK&&this.applyStrokeColor();this._renderMask&b._renderFlags.STRKWIDTH&&this.applyStrokeWidth();this._renderMask=0};b.prototype.setValue=function(a,d,e,f){f=!1;switch(a){case "stroke":this.strokeColor!=d&&"string"==typeof d&&0==d.indexOf("#")&&1<d.length&&8>=d.length&&(this.strokeColor=d,this._renderMask|=b._renderFlags.STRK,f=!0);break;case "stroke-width":this.strokeWidth!=d&&(this.strokeWidth=d,0==this.strokeWidth&&(this.strokeWidth=1),this._renderMask|=
b._renderFlags.STRKWIDTH,f=!0);break;default:hmiWidget.prototype.setValue.call(this,a,d,e)}f&&$hmi.addToRender(this)};b.prototype.setParentBounds=function(c,d,e,f,g){var h=this.width,k=this.height;a.prototype.setParentBounds.call(this,c,d,e,f,g);this.scaleX*=this.width/h;this.scaleY*=this.height/k;this._renderMask|=b._renderFlags.UPDATESVG;$hmi.addToRender(this)};b._renderFlags={UPDATESVG:1,STRK:2,STRKWIDTH:4};b.jmType="LineWgt";return b}(hmiWidget);
$hmi.fn.hmiLine=function(a,b,c,d){return new hmiLine(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiLine",hmiLine);var ScaleFormType;(function(a){a[a.VERTICAL=0]="VERTICAL";a[a.HORIZONTAL=1]="HORIZONTAL";a[a.ROUND=2]="ROUND"})(ScaleFormType||(ScaleFormType={}));var ScaleAlignType;(function(a){a[a.TOP_OR_LEFT=0]="TOP_OR_LEFT";a[a.BOTTOM_OR_RIGHT=1]="BOTTOM_OR_RIGHT";a[a.CENTER=2]="CENTER"})(ScaleAlignType||(ScaleAlignType={}));
var hmiScale=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.__renderMask=0;b.invokablePropsList=["alarmMin","alarmMax","stroke","strokeWidth"];b.initialized=!0;b.endAngle=b.endAngle||0;b.startAngle=b.startAngle||0;b.alarmMin=b.alarmMin||0;b.alarmMax=b.alarmMax||0;b.min=b.min||0;b.max=b.max||0;b.geometry=b.form==ScaleFormType.VERTICAL||b.form==ScaleFormType.HORIZONTAL?b.elem.querySelector("line"):b.elem.querySelector("path:nth-child(2)");return b}__extends(b,a);b.prototype.render=
function(){a.prototype.render.call(this);this._renderMask&b._renderFlags.REDRAW&&this.redraw();this._renderMask&b._renderFlags.STWIDTH&&this.redraw("strokeWidth");this._renderMask&b._renderFlags.STCOLOR&&this.geometry.setAttribute("stroke",this.stroke);if(this._renderMask&b._renderFlags.UPDATESVG&&this.elem.getElementsByTagName("svg")[0]){var c=this.elem.getElementsByTagName("svg")[0];c.style.width=this.width+"px";c.style.height=this.height+"px";this.redraw()}this._renderMask=0};b.prototype._checkLimit=
function(a){a>this.max&&(a=this.max);a<this.min&&(a=this.min);return a};b.prototype.redraw=function(a){var b=this.min,e=this.max,f=this.alarmMax;this.alarmMin>this.alarmMax&&(f=this.alarmMin);f>e&&(f=e);var g=this.alarmMin;this.alarmMin>this.alarmMax&&(g=this.alarmMax);g<b&&(g=b);this.form==ScaleFormType.ROUND?this.drawRndScale(b,e,g,f,a):this.form==ScaleFormType.HORIZONTAL?this.drawHrzScale(b,e,g,f,a):this.form==ScaleFormType.VERTICAL&&this.drawVrtScale(b,e,g,f,a)};b.prototype.drawRndScale=function(a,
b,e,f,g){var h=this.cx-this.strokeWidth/2,k=this.cy-this.strokeWidth/2,l=0,n=0;b-=a;0!=b&&(this.reverse?e<f&&(l=this.endAngle-(this.endAngle-this.startAngle)*(f-a)/b,n=this.endAngle-(this.endAngle-this.startAngle)*(e-a)/b):e<f&&(l=this.startAngle+(this.endAngle-this.startAngle)*(e-a)/b,n=this.startAngle+(this.endAngle-this.startAngle)*(f-a)/b));a=generateArcCode(this.cx,this.cy,h,k,l,n);this.geometry&&(this.geometry.setAttribute("d",a),"strokeWidth"==g&&this.geometry.setAttribute("stroke-width",this.strokeWidth.toString()))};
b.prototype.drawHrzScale=function(a,b,e,f,g){var h=0,k=0,l=0,n=0;b-=a;0!=b&&(0==this.reverse?(h=this.width*(e-a)/b,l=this.width*(f-a)/b):(h=this.width-this.width*(e-a)/b,l=this.width-this.width*(f-a)/b),this.align==ScaleAlignType.TOP_OR_LEFT?(k=this.strokeWidth/2,n=this.strokeWidth/2):this.align==ScaleAlignType.BOTTOM_OR_RIGHT&&(k=this.height-this.strokeWidth/2,n=this.height-this.strokeWidth/2));this.geometry&&(this.geometry.setAttribute("x1",h.toString()),this.geometry.setAttribute("y1",k.toString()),
this.geometry.setAttribute("x2",l.toString()),this.geometry.setAttribute("y2",n.toString()),"strokeWidth"==g&&this.geometry.setAttribute("stroke-width",this.strokeWidth.toString()))};b.prototype.drawVrtScale=function(a,b,e,f,g){var h=0,k=0,l=0,n=0;b-=a;0!=b&&(0==this.reverse?(k=this.height*(e-a)/b,n=this.height*(f-a)/b):(k=this.height-this.height*(e-a)/b,n=this.height-this.height*(f-a)/b),this.align==ScaleAlignType.TOP_OR_LEFT?(h=this.strokeWidth/2,l=this.strokeWidth/2):this.align==ScaleAlignType.BOTTOM_OR_RIGHT&&
(h=this.width-this.strokeWidth/2,l=this.width-this.strokeWidth/2));this.geometry&&(this.geometry.setAttribute("x1",h.toString()),this.geometry.setAttribute("y1",k.toString()),this.geometry.setAttribute("x2",l.toString()),this.geometry.setAttribute("y2",n.toString()),"strokeWidth"==g&&this.geometry.setAttribute("stroke-width",this.strokeWidth.toString()))};b.prototype.setValue=function(a,d,e,f){f=!1;if(this.isBadValue(d,!1,e))return!1;switch(a){case "min":this.min!=d&&(d>this.max&&(this.max=d),this.min=
d,this._renderMask|=b._renderFlags.REDRAW,f=!0,this.sendUpdate(a,this.min,e));break;case "max":this.max!=d&&(d<this.min&&(this.min=d),this.max=d,this._renderMask|=b._renderFlags.REDRAW,f=!0,this.sendUpdate(a,this.max,e));break;case "alarmMax":this.alarmMax!=d&&(this.alarmMax=parseFloat(d),this._renderMask|=b._renderFlags.REDRAW,f=!0,this.sendUpdate(a,this.alarmMax,e));break;case "alarmMin":this.alarmMin!=d&&(this.alarmMin=parseFloat(d),this._renderMask|=b._renderFlags.REDRAW,f=!0,this.sendUpdate(a,
this.alarmMin,e));break;case "stroke-width":0>=d&&(d=1);this.strokeWidth!=d&&(this.strokeWidth=parseFloat(d),this._renderMask|=b._renderFlags.STWIDTH,f=!0,this.sendUpdate(a,this.strokeWidth,e));break;case "startAngle":d>this.endAngle?d=this.endAngle:0>d&&(d=0);this.startAngle!=d&&(this.startAngle=parseFloat(d),this._renderMask|=b._renderFlags.REDRAW,f=!0);break;case "endAngle":d<this.startAngle?d=this.startAngle:360<d&&(d=360);this.endAngle!=d&&(this.endAngle=parseFloat(d),this._renderMask|=b._renderFlags.REDRAW,
f=!0);break;case "stroke":a="#000";this.stroke!=d&&(/^rgb\(\s*\d+,\s*\d+\s*,\s*\d+\s*\)$/.test(d)?a=d:"string"==typeof d&&0==d.indexOf("#")&&1<d.length&&8>=d.length&&(a=d),this.stroke=a,f=!0,this._renderMask|=b._renderFlags.STCOLOR);break;case "reverseScale":if(this.isBadValue(d,!1,e))return!1;d=parseInt(d);this.reverse!=d&&(this.reverse=d,f=!0,this._renderMask|=b._renderFlags.REDRAW,this.sendUpdate(a,this.reverse,e));break;case "visibility":hmiWidget.prototype.setValue.call(this,"visibility",d,e);
break;default:hmiWidget.prototype.setValue.call(this,a,d,e)}f&&$hmi.addToRender(this);return!0};b.prototype.setParentBounds=function(a,d,e,f,g){hmiWidget.prototype.setParentBounds.call(this,a,d,e,f,g);this._renderMask|=b._renderFlags.UPDATESVG;$hmi.addToRender(this)};b.prototype.destroy=function(){return hmiWidget.prototype.destroy.call(this)};b._renderFlags={REDRAW:1,STWIDTH:2,STCOLOR:4,UPDATESVG:8};b.jmType="ScaleWgt";return b}(hmiWidget);
Object.defineProperty(hmiScale.prototype,"form",{get:function(){return this._form},set:function(a){switch(a){case "vertical":this._form=ScaleFormType.VERTICAL;break;case "horizontal":this._form=ScaleFormType.HORIZONTAL;break;case "round":this._form=ScaleFormType.ROUND}}});$hmi.fn.hmiScale=function(a,b,c,d){return new hmiScale(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiScale",hmiScale);
var hmiMsgText=function(a){function b(b,d,e,f,g){b=a.call(this,b.wgtId,d,e,f,g)||this;b.setDefaultState();b._renderMask=0;b.authCode=b.getAuthorizations();b.numStates=b.getSpanElems().length;b.initDataIdxToIdxMap();b.ml=!0;b.invokablePropsList=["fill","fontColor"];return b}__extends(b,a);b.prototype.setDefaultState=function(){this.value=void 0===this.value?null:this.value;this.numStates=void 0===this.numStates?0:this.numStates;this.messages=void 0===this.messages?null:this.messages;this.permission=
void 0===this.permission?"rw":this.permission;this.editable=void 0===this.editable?!1:this.editable;this.comboBoxStatus=void 0===this.comboBoxStatus?0:this.comboBoxStatus;this.mlAttributeLinked=void 0===this.mlAttributeLinked?!1:this.mlAttributeLinked};b.prototype.getSpanElems=function(){return this.elem.getElementsByTagName("span")};b.prototype.initDataIdxToIdxMap=function(){this.dataIdxToIdx={};for(var a=this.getSpanElems(),b=0;b<a.length;b++){var e=a[b];null!=e&&(e=parseInt(e.getAttribute("data-idx")),
isNaN(e)||(this.dataIdxToIdx[e]=b))}};b.prototype.render=function(){a.prototype.render.call(this);if(this._renderMask&b._renderFlags.INITWRAP){var c=this,d=this.getParentBounds();this._closeButton=generateCloseButton(d.y-15,d.x-15);$(this._closeButton).bind("touchstart click",function(a){a.stopPropagation();c._hideCombobox()});$hmi.modernBrowser&&($(this.elem).hasClass("hacklayer")||$(this.elem).addClass("hacklayer"));this._createNode();this._attachEvents()}if(this._renderMask&b._renderFlags.VALUE&&
0<this.numStates){for(var d=this.getSpanElems(),e,f=0;f<d.length;f++)e=d[f],f==this.dataIdxToIdx[this.value]?"block"!=e.style.display&&(e.style.display="block"):"none"!=e.style.display&&(e.style.display="none");this.combowrap&&this.updateWrapper()}this._renderMask&b._renderFlags.FNCOLOR&&(this.elem.style.color=this.fill);this._renderMask&b._renderFlags.MSGES&&this.setGroupMessages();this._renderMask&b._renderFlags.UPLANG&&this._updateTextsLanguage();this._renderMask=0};b.prototype.updateSelectedIndex=
function(){this.select.selectedIndex=null!=this.dataIdxToIdx[this.value]?this.dataIdxToIdx[this.value]:-1};b.prototype.setValue=function(a,d,e,f){f=!1;if("value"==a){if(this.isBadValue(d,!1,e))return!1;d=parseFloat(d);if(isNaN(d))return!1;this.value!=d&&(this.value=d,this.select&&this.updateSelectedIndex(),this._renderMask|=b._renderFlags.VALUE,f=!0,this.sendUpdate(a,this.value,e))}else if("messages"==a)this.messages!=d&&(this.messages="string"==typeof d?d.split(","):d instanceof Array?d:"",this._renderMask|=
b._renderFlags.MSGES,f=!0,this.sendUpdate(a,this.messages instanceof Array?this.messages.join(","):this.messages,e));else if("fill"==a||"fontColor"==a){var g="#000";this.isBadValue(d,!0,e)?f=!0:this.fill!=d&&(/^rgb\(\s*\d+,\s*\d+\s*,\s*\d+\s*\)$/.test(d)?(g=d,f=!0):"string"==typeof d&&0==d.indexOf("#")&&1<d.length&&8>=d.length&&(g=d,f=!0),this.fill=g,this.sendUpdate(a,g,e));f&&(this._renderMask|=b._renderFlags.FNCOLOR)}else hmiWidget.prototype.setValue.call(this,a,d,e);f&&$hmi.addToRender(this);return!0};
b.prototype.setGroupMessages=function(){var a=[];if(void 0!=this.messages){var b;b=this.messages;1<b.length?a=b.slice(0):"null"==b[0]?a.push(" "):a.push(b[0]);b=this.getSpanElems();var e=this.min;this.dataIdxToIdx={};for(var f=0;f<a.length;f++){if(b[f])b[f].setAttribute("data-idx",e.toString()),b[f].innerHTML=a[f];else{var g=b[f-1].cloneNode(!1);g.setAttribute("data-idx",e.toString());g.innerHTML=a[f];this.elem.appendChild(g)}this.dataIdxToIdx[e++]=f}this.numStates=b.length;for(e=0;e<b.length;e++)b[e].style.display=
e==this.dataIdxToIdx[this.value]?"block":"none";this.numStates!=a.length&&this.rmUnusedSpan(this.numStates-a.length);this.updateMsgSelect()}};b.prototype.rmUnusedSpan=function(a){for(var b=0;b<a;b++)$("span:last-child",this.elem).remove();this.numStates=this.getSpanElems().length;this.setValue("value",this.value,null)};b.prototype.updateMsgSelect=function(){this.editable&&($(this.select).remove(),this._hideCombobox(),this.combowrap&&this.combowrap.removeWrapper(),this._createNode())};b.prototype.getValue=
function(a){switch(a){case "viewindex":a=this.viewindex;break;case "fill":case "fontColor":a=this.fill;break;case "messages":a=this.messages instanceof Array?this.messages.join(","):this.messages;break;default:a=hmiWidget.prototype.getValue.call(this,a)}return a};b.prototype.updateLanguage=function(){1!=this.mlAttributeLinked&&(this._renderMask|=b._renderFlags.UPLANG,$hmi.addToRender(this))};b.prototype._updateTextsLanguage=function(){if(1!=this.mlAttributeLinked){var a=this.getPageMLTextMgr(),b=
a.getCurrentFont(),e=this.elem.getElementsByTagName("span");this.elem.style.fontFamily!=b&&(this.elem.style.fontFamily="'"+b+"'");if((b=a.getText(0,this,"messages"))&&b instanceof Array)this.setValue("messages",b,Tag.prototype.QUALITY_GOOD);else for(var b=0,f=e.length;b<f;b++){var g=e[b].getAttribute("data-textid"),g=a.getText(g);if(null!=g){var h=e[b].childNodes[0];h?h.textContent!=g&&(h.textContent=g):""!=g&&(g=document.createTextNode(g),e[b].appendChild(g))}}this.updateMsgSelect()}};b.prototype._createNode=
function(){var a,b,e,f,g;this.select=document.createElement("select");for(var h=this.getSpanElems(),k=0;k<this.numStates;k++)g="",b=h[k],e=document.createElement("option"),f=document.createElement("p"),a=parseInt(b.getAttribute("data-idx")),this.viewindex&&(g=""+a+" - "),g+=b.textContent,a=document.createTextNode(g),f.appendChild(a),e.appendChild(f),this.select.appendChild(e);this.select.selectedIndex=this.value;this._isNativeSelectCompatible()?this.authCode!=this.umgr.wgtAuth.RDONLY&&(this.combowrap=
new ComboWrapper(this),this.updateWrapper(),this.combowrap.hideWrapper(),this.combowrap.bindEvents()):(this._attachChangeEvent(),this.select.setAttribute("style","position:absolute;width:"+(this.width+2)+"px;height:"+(this.height+2)+"px;left:-1px;top:-1px;z-index:9999;display:none"),$(this.elem).prepend(this.select))};b.prototype._showCombobox=function(){this._detachEvents();this._closeOpenedSelect();this._isNativeSelectCompatible()?this.combowrap.showWrapper():this.select.style.display="block";this._addCloseButton();
this.comboBoxStatus=1};b.prototype._hideCombobox=function(){0!=this.comboBoxStatus&&(this._attachEvents(),this._isNativeSelectCompatible()?(this.combowrap.detachClone(),this.combowrap.hideWrapper()):this.select.style.display="none",this._removeCloseButton(),this.comboBoxStatus=0)};b.prototype._addCloseButton=function(){$(this.parentPage.elem).append(this._closeButton)};b.prototype._removeCloseButton=function(){$(this._closeButton).detach()};b.prototype._attachEvents=function(){this.events={mousedown:!0,
touchstart:!0}};b.prototype._detachEvents=function(){this.events={mousedown:!1,touchstart:!1}};b.prototype.doMouseUp=function(a,b){b.preventDefault();if(this.authCode==this.umgr.wgtAuth.RDONLY||"r"==this.permission||this.disabled)return!1;this._showCombobox();return!0};b.prototype.doMouseDown=function(a,b){b.preventDefault();return this.authCode==this.umgr.wgtAuth.RDONLY||"r"==this.permission||this.disabled?!1:!0};b.prototype.addDataLink=function(a){hmiWidget.prototype.addDataLink.call(this,a);"value"==
a.attr&&this.hasPropInDatalinks("Value");a.tgtWgt==this&&this.initDataLinkSideEffects(a,a.attr)};b.prototype.initDataLinkSideEffects=function(a,d){if("value"==d)if("r"==a.rw)this.permission="r";else{if(this.authCode==this.umgr.wgtAuth.FULL||this.authCode==this.umgr.wgtAuth.DEFAULT)this.editable=!0,this._renderMask|=b._renderFlags.INITWRAP,$hmi.addToRender(this)}else"messages"==d&&(this.mlAttributeLinked=!0)};b.prototype._attachChangeEvent=function(){var a=this;$(this.select).change(function(b){a.select.selectedIndex!=
a.value&&(a.setValue("value",a.select.selectedIndex,null,null),a.doWriteValue("value",a.select.selectedIndex),a._hideCombobox())})};b.prototype.onChange=function(a){a=this.getSpanElems()[a].getAttribute("data-idx");this.setValue("value",parseInt(a),null,null);this.doWriteValue("value",parseInt(a));this._hideCombobox()};b.prototype.onClose=function(){this.combowrap&&this.combowrap.detachClone()};b.prototype.updateWrapper=function(){this.updateSelectedIndex();this.combowrap.update(this.select.selectedIndex)};
b.prototype._closeOpenedSelect=function(){var a=this.parentPage,d;for(d in a.wgts)a.wgts[d].constructor==b&&a.wgts[d].elem.id!=this.elem.id&&a.wgts[d]._hideCombobox()};b.prototype.destroy=function(){if(this.destroyed)return!1;this.combowrap&&(this.combowrap.removeObjects(),delete this.combowrap);this._closeButton&&($(this._closeButton).remove(),delete this._closeButton);this._detachEvents();return hmiWidget.prototype.destroy.call(this)};b.jmType="MsgTextWgt";b._renderFlags={VALUE:2,MSGES:4,FNCOLOR:8,
INITWRAP:16,UPLANG:32,CREATEBTN:64};return b}(hmiWidget);$hmi.fn.hmiMsgText=function(a,b,c,d){return new hmiMsgText(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiMsgText",hmiMsgText);function hmiIWidget(a){this.wgt=a;var b=this.wgt.getInvokablePropsList();if(b)for(a=0;a<b.length;a++)Object.defineProperty(this,b[a],this._generateGetterAndSetter(b[a]));if(b=this.wgt.getInvokableFunList())for(a=0;a<b.length;a++){var c=b[a];this[c]=this._generateFun(c)}}
hmiIWidget.prototype._generateGetterAndSetter=function(a){return{get:function(){return this.wgt.getValue(a)},set:function(b){this.wgt.setValue(a,b)}}};hmiIWidget.prototype._generateFun=function(a){var b=this.wgt;return function(){return b[a].apply(b,arguments)}};Object.defineProperty(hmiIWidget.prototype,"objectName",{get:function(){return this.wgt.studioId}});Object.defineProperty(hmiIWidget.prototype,"id",{get:function(){return this.wgt.studioId}});
Object.defineProperty(hmiIWidget.prototype,"Id",{get:function(){return this.wgt.studioId}});Object.defineProperty(hmiIWidget.prototype,"x",{get:function(){return parseFloat(this.wgt.getValue("x"))},set:function(a){this.wgt.setValue("x",a)}});Object.defineProperty(hmiIWidget.prototype,"y",{get:function(){return parseFloat(this.wgt.getValue("y"))},set:function(a){"number"==typeof a&&this.wgt.setValue("y",a)}});
Object.defineProperty(hmiIWidget.prototype,"width",{get:function(){return this.wgt.boundingRect.width},set:function(a){2>a&&(a=2);this.wgt.setParentBounds(this.wgt.left,this.wgt.top,a,this.wgt.boundingRect.height)}});Object.defineProperty(hmiIWidget.prototype,"height",{get:function(){return this.wgt.boundingRect.height},set:function(a){2>a&&(a=2);this.wgt.setParentBounds(this.wgt.left,this.wgt.top,this.wgt.boundingRect.width,a)}});
Object.defineProperty(hmiIWidget.prototype,"opacity",{get:function(){return parseFloat(this.wgt.getValue("opacity"))},set:function(a){"number"==typeof a&&this.wgt.setValue("opacity",a)}});Object.defineProperty(hmiIWidget.prototype,"rotation",{get:function(){return parseFloat(this.wgt.getValue("currentRot"))},set:function(a){"number"==typeof a&&this.wgt.setValue("rot",a)}});
Object.defineProperty(hmiIWidget.prototype,"value",{get:function(){return this.wgt.getValue("value")},set:function(a){this.wgt.setValue("value",a)}});Object.defineProperty(hmiIWidget.prototype,"userValue",{get:function(){return this.wgt._userValue},set:function(a){this.wgt._userValue=a}});hmiIWidget.prototype.getProperty=function(a,b){return this[a]?this[a]:this.wgt.getProperty(a,b)};hmiIWidget.prototype.getParameter=function(a,b){return this.getProperty(a,b)};
hmiIWidget.prototype.setProperty=function(a,b,c){this.wgt&&this.wgt.setValue(a,b)};hmiIWidget.prototype.getWidget=function(a){(a=this.wgt.getWidget(a,!0,this.isTemplate))&&(a=new hmiIWidget(a));return a};hmiIWidget.prototype.update=function(){this.wgt&&this.wgt.update()};function hmiIPage(a,b){hmiIWidget.call(this,a);this._timeoutIDs={};this.isTemplate=b}hmiIPage.prototype=Object.create(hmiIWidget.prototype);hmiIPage.prototype.constructor=hmiIPage;
Object.defineProperty(hmiIPage.prototype,"backgroundColor",{get:function(){return this.wgt.getValue("backgroundColor")},set:function(a){this.wgt.setValue("color",a)}});Object.defineProperty(hmiIPage.prototype,"width",{get:function(){return this.wgt.getValue("width")}});Object.defineProperty(hmiIPage.prototype,"height",{get:function(){return this.wgt.getValue("height")}});
hmiIPage.prototype.setTimeout=function(a,b){"string"==typeof a&&(a=-1!=a.indexOf("(")&&a.indexOf("(")?this.wgt.__eval__(a.split("(")[0]):this.wgt.__eval__(a));var c=setTimeout(a,b);this._timeoutIDs[c]=1;return c};hmiIPage.prototype.clearTimeout=function(a){clearTimeout(a);delete this._timeoutIDs[a]};hmiIPage.prototype.setInterval=function(a,b){"string"==typeof a&&(a=-1!=a.indexOf("(")&&a.indexOf("(")?this.__eval__(a.split("(")[0]):this.__eval__(a));var c=setInterval(a,b);this._timeoutIDs[c]=1;return c};
hmiIPage.prototype.clearInterval=function(a){clearInterval(a);delete this._timeoutIDs[a]};hmiIPage.prototype.clearAllTimeouts=function(){for(var a in this._timeoutIDs)clearTimeout(a),clearInterval(a)};hmiIPage.prototype.getWidget=function(a){(a=this.wgt.getWidget(a,!0,this.isTemplate))&&(a=new hmiIWidget(a));return a};hmiIPage.prototype.getProperty=function(a,b){return this[a]?this[a]:this.wgt.getValue(a)};hmiIPage.prototype.bindJSCallback=function(a){this.wgt.bindJSCallback(a)};
function hmiIProject(a){hmiIPage.call(this,a);this.wgt=a}hmiIProject.prototype=Object.create(hmiIPage.prototype);hmiIProject.prototype.constructor=hmiIProject;hmiIProject.prototype._doAction=function(a,b,c){$hmi.isProjectReady&&(c?a.execute(b,c):a.execute(b))};hmiIProject.prototype.nextPage=function(){var a=$hmi.getAction("hmiActionNextPage");this._doAction(a,$hmi.focusPage.wgtId)};hmiIProject.prototype.prevPage=function(){var a=$hmi.getAction("hmiActionPrevPage");this._doAction(a,$hmi.focusPage.wgtId)};
hmiIProject.prototype.homePage=function(){var a=$hmi.getAction("hmiActionHomePage");this._doAction(a,$hmi.focusPage.wgtId)};hmiIProject.prototype.loadPage=function(a){var b=$hmi.getAction("hmiActionLoadPage");a=a.split(".jmx")[0].toLowerCase();this._doAction(b,$hmi.focusPage.wgtId,{pg:pageMgr.map[a]})};hmiIProject.prototype.showDialog=function(a){var b=$hmi.getAction("hmiActionShowDialog");a=a.split(".jmx")[0].toLowerCase();this._doAction(b,null,{pg:pageMgr.map[a]})};
hmiIProject.prototype.showMessage=function(a){var b=$hmi.getAction("hmiActionShowMessage");this._doAction(b,null,{msg:a})};hmiIProject.prototype.closeDialog=function(a){a=$hmi.getAction("hmiActionCloseDialog");this._doAction(a,null,{pg:$hmi.focusPage.studioId.toLowerCase()})};hmiIProject.prototype.lastVisitedPage=function(){var a=$hmi.getAction("hmiActionLastPage");a.execute($hmi.focusPage.wgtId);this._doAction(a,$hmi.focusPage.wgtId)};hmiIProject.prototype.ackAlarms=function(){$hmi.getAction("hmiActionAckAlarm").execute()};
hmiIProject.prototype.enableAlarms=function(){$hmi.getAction("hmiActionEnableAlarms").execute()};hmiIProject.prototype.downloadRecipe=function(a,b){var c=$hmi.getAction("hmiActionDownLoadRecipe");this._doAction(c,$hmi.focusPage.wgtId,{r:a,s:b})};hmiIProject.prototype.uploadRecipe=function(a,b){var c=$hmi.getAction("hmiActionUpLoadRecipe");this._doAction(c,$hmi.focusPage.wgtId,{r:a,s:b})};
hmiIProject.prototype.getRecipeItem=function(a,b,c){return this.wgt.getWidget("_RecipeMgr",!0).getValue(a+"."+b+"."+c+".Value")};hmiIProject.prototype.setRecipeItem=function(a,b,c,d){return this.wgt.getWidget("_RecipeMgr",!0).setValue(a+"."+b+"."+c+".Value",d)};hmiIProject.prototype.selectAllAlarms=function(a){var b=$hmi.getAction("hmiActionSelectAllAlarms"),c;"undefined"!=typeof a&&(c={enable:a});b.execute(null,c)};hmiIProject.prototype.resetAlarms=function(){$hmi.getAction("hmiActionResetAlarm").execute()};
hmiIProject.prototype.getTag=function(a,b,c,d,e){return this.wgt.getTag(a,b,c,d,e)};hmiIProject.prototype.setTag=function(a,b,c,d){return this.wgt.setTag(a,b,c,d)};hmiIProject.prototype.getGroup=function(a,b,c){return this.wgt.getGroup(a,b,c)};hmiIProject.prototype.getClientType=function(){return this.wgt.getClientType()};hmiIProject.prototype.on=function(a,b){return this.wgt.on(a,b)};hmiIProject.prototype.off=function(a){return this.wgt.off(a)};hmiIProject.prototype.changePageAnimation=function(a){this.wgt.changePageAnimation(a)};
hmiIProject.prototype.bindJSCallback=function(a){this.wgt.bindJSCallback(a)};function hmiXform(a,b,c,d,e){Linkable.call(this);this.wgtId=a;this.studioId=b;this.parentPage=d;this.parentWidget=e;this.parentPage.addXForm(this.wgtId,this);for(var f in c)this[f]=c[f];this.dLink=null}hmiXform.prototype=Object.create(Linkable.prototype);hmiXform.prototype.constructor=hmiXform;hmiXform.prototype.setDLink=function(a){this.dLink=a;this.updateDataLink()};
hmiXform.prototype.updateDataLink=function(){if(null!=this.dLink){var a=null,b=this.dLink.tagIndex,c=$hmi.cache.getTag(this.dLink.tag);c&&(a=c.value instanceof Array?c.value[b]:c.value,this.dLink.setWgtValue(a,b,c.getQuality()))}};hmiXform.prototype.addDataLink=function(a){Linkable.prototype.addDataLink.call(this,a)};hmiXform.prototype.destroy=function(){this.dLink=null;Linkable.prototype.destroy.call(this)};$hmi.addWidgetDefinition("hmiXform",hmiXform);
function hmiBitIndexXForm(a,b,c,d,e){hmiXform.call(this,a.wgtId,b,c,d,e)}hmiBitIndexXForm.prototype=Object.create(hmiXform.prototype);hmiBitIndexXForm.prototype.constructor=hmiBitIndexXForm;hmiBitIndexXForm.prototype.setValue=function(a,b){this[a.toLowerCase()]=b;isNaN(this.bitIndex)||this.updateDataLink()};hmiBitIndexXForm.prototype.getValue=function(){return{bitIndex:this.bitIndex}};
hmiBitIndexXForm.prototype.execute=function(a,b,c,d){var e=b;0!=b%1&&(b=Math.round(b));if(null!=d){d=parseInt(d.bitIndex);e=1<<d;if("w"==c)return c=a.getTagValue(),a=Tag.prototype.getNumberOfBits(a.getTagType())-1,0>b||1<b||d>a?c:1==b?c|e:c&~e;e=(b&e)>>d}return e};$hmi.fn.hmiBitIndexXForm=function(a,b,c,d){return new hmiBitIndexXForm(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiBitIndexXForm",hmiBitIndexXForm);function hmiByteIndexXForm(a,b,c,d,e){hmiXform.call(this,a.wgtId,b,c,d,e)}
hmiByteIndexXForm.prototype=Object.create(hmiXform.prototype);hmiByteIndexXForm.prototype.constructor=hmiByteIndexXForm;hmiByteIndexXForm.prototype.setValue=function(a,b){this[a.toLowerCase()]=b;isNaN(this.byteIndex)||this.updateDataLink()};hmiByteIndexXForm.prototype.getValue=function(){return{byteIndex:this.byteIndex}};
hmiByteIndexXForm.prototype.execute=function(a,b,c,d){var e=b,f=!1;0!=b%1&&(b=Math.round(b));if(null!=d){d=8*parseInt(d.byteIndex);var g;32<=d?f=!0:g=255<<d;e=0;e=a.getTagValue();if("w"==c){if(f)return e;e=(e&~g)+(b<<d)}else if(f){if(64<=d)return 0;if(56<=d&&0>e)return-1;g=this._leftShift(255,d);e=this._rightShift(this._and(b,g),d)}else e=(b&g)>>>d}return e};hmiByteIndexXForm.prototype._leftShift=function(a,b){return a*Math.pow(2,b)};
hmiByteIndexXForm.prototype._rightShift=function(a,b){return a/Math.pow(2,b)};hmiByteIndexXForm.prototype._and=function(a,b){for(var c=0,d=0,e=0;64>e;){var f=a&1073741823&b;a=Math.floor(a/1073741824);b=Math.floor(b/1073741824);for(var g=c++;g--;)f*=1073741824;d+=f;e+=30}return d};hmiByteIndexXForm.prototype._not=function(a){0>a&&(a>>>=0);for(var b=0,c=0;0!=a;){var d=~(1073741823&a);a=Math.floor(a/1073741824);for(var e=b++;e--;)d*=1073741824;c+=d}return c};
$hmi.fn.hmiByteIndexXForm=function(a,b,c,d){return new hmiByteIndexXForm(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiByteIndexXForm",hmiByteIndexXForm);function hmiColorPaletteCustomXForm(a,b,c,d,e){hmiXform.call(this,a.wgtId,b,c,d,e)}hmiColorPaletteCustomXForm.prototype=Object.create(hmiXform.prototype);hmiColorPaletteCustomXForm.prototype.constructor=hmiColorPaletteCustomXForm;
hmiColorPaletteCustomXForm.prototype.setValue=function(a,b){this[a.toLowerCase()]=b;isNaN(this.colorPalette)||isNaN(this.colorMap)||this.updateDataLink()};hmiColorPaletteCustomXForm.prototype.getValue=function(){return{colorPalette:this.colorPalette,colorMap:this.colorMap}};
hmiColorPaletteCustomXForm.prototype.execute=function(a,b,c,d){a=d.colorPalette;d=d.colorMap;c=a.length;if(null!=b&&null!=a&&0!=a.length&&(1!=a.length||""!=a[0]))return null!=d?a[this.getPaletteIndexFromColorMap(b,d)%c]:a[this.getPaletteIndexFromPalette(b)%c]};hmiColorPaletteCustomXForm.prototype.isValueInInterval=function(a,b){return b>=a.min&&b<=a.max?!0:!1};hmiColorPaletteCustomXForm.prototype.getIntervalMinMax=function(a){return{min:parseFloat(a.split("-")[0]),max:parseFloat(a.split("-")[1])}};
hmiColorPaletteCustomXForm.prototype.isSingleValueValid=function(a,b){return isNaN(parseFloat(a))&&b==a||fuzzyCompare(b,parseFloat(a))?!0:!1};hmiColorPaletteCustomXForm.prototype.getPaletteIndexFromPalette=function(a){return"string"==typeof a?isNaN(parseFloat(a))?0:parseFloat(a):a};
hmiColorPaletteCustomXForm.prototype.getPaletteIndexFromColorMap=function(a,b){for(var c=null,d=0;d<b.length;d++)for(var e=b[d].v.split(","),f=0;f<e.length;f++){var g=e[f].trim();if(-1!=g.indexOf("-")){g=this.getIntervalMinMax(g);if(this.isValueInInterval(g,a))return b[d].i;a>g.max&&(c=d)}else if(this.isSingleValueValid(g,a))return b[d].i}return"string"==typeof a?isNaN(parseFloat(a))?0:parseFloat(a):null==c?a:c};
$hmi.fn.hmiColorPaletteCustomXForm=function(a,b,c,d){return new hmiColorPaletteCustomXForm(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiColorPaletteCustomXForm",hmiColorPaletteCustomXForm);function hmiRangeXForm(a,b,c,d,e){hmiXform.call(this,a.wgtId,b,c,d,e)}hmiRangeXForm.prototype=Object.create(hmiXform.prototype);hmiRangeXForm.prototype.constructor=hmiRangeXForm;
hmiRangeXForm.prototype.setValue=function(a,b){this[a.toLowerCase()]=b;isNaN(this.inputMin)||isNaN(this.inputMax)||isNaN(this.outputMin)||isNaN(this.outputMax)||this.updateDataLink()};hmiRangeXForm.prototype.getValue=function(){return{inputMin:this.inputMin,inputMax:this.inputMax,outputMin:this.outputMin,outputMax:this.outputMax}};
hmiRangeXForm.prototype.execute=function(a,b,c,d){var e,f;"w"==c?(a=this.outputMin,d=this.outputMax,c=this.inputMin,f=this.inputMax):(a=this.inputMin,d=this.inputMax,c=this.outputMin,f=this.outputMax);0!=d-a&&(e=(f-c)/(d-a),e=e*b+(c-e*a));return e};$hmi.fn.hmiRangeXForm=function(a,b,c,d){return new hmiRangeXForm(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiRangeXForm",hmiRangeXForm);function hmiScaleXForm(a,b,c,d,e){hmiXform.call(this,a.wgtId,b,c,d,e)}hmiScaleXForm.prototype=Object.create(hmiXform.prototype);
hmiScaleXForm.prototype.constructor=hmiScaleXForm;hmiScaleXForm.prototype.setValue=function(a,b){this[a.toLowerCase()]=b;isNaN(this.scale)||isNaN(this.mod)||isNaN(this.offset)||this.updateDataLink()};hmiScaleXForm.prototype.getValue=function(){return{scale:this.scale,offset:this.offset,mod:this.mod}};hmiScaleXForm.prototype.addDataLink=function(a){"local"!=this.timeSpec&&hmiWidget.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};
hmiScaleXForm.prototype.initDataLinkSideEffects=function(a,b){"value"==b&&(this.rw=a.rw)};hmiScaleXForm.prototype.execute=function(a,b,c,d){a=b;if(null!=d){var e=parseFloat(d.scale),f=parseFloat(d.offset);d=parseFloat(d.mod);if(Array.isArray(b))if(b[0]instanceof Object)for(var g=0,h=b.length;g<h;g++)a[g].v=this.scaleValue(c,e,f,d,b[g].v);else for(g=0,h=b.length;g<h;g++)a[g]=this.scaleValue(c,e,f,d,b[g]);else a=this.scaleValue(c,e,f,d,b)}return a};
hmiScaleXForm.prototype.scaleValue=function(a,b,c,d,e){"w"==a?0!=b&&(e=d/b*(e-c)):0!=d&&(e=b/d*e+c);return e};$hmi.fn.hmiScaleXForm=function(a,b,c,d){return new hmiScaleXForm(this,a,b,c,d)};$hmi.addWidgetDefinition("hmiScaleXForm",hmiScaleXForm);function hmiFormulaXForm(a,b,c,d,e){this.parameters="";this.$Vars={};this.map$AttrLink={};this.num$AttrLink=0;hmiXform.call(this,a.wgtId,b,c,d,e)}hmiFormulaXForm.prototype=Object.create(hmiXform.prototype);hmiFormulaXForm.prototype.constructor=hmiFormulaXForm;
hmiFormulaXForm.prototype.setValue=function(a,b){void 0===b||0!=a.indexOf("$")||null!=this.$Vars[a]&&this.$Vars[a]==b||(this.$Vars[a]=b,null!=this.map$AttrLink[a]&&this.updateExpressionParams())};
hmiFormulaXForm.prototype.updateExpressionParams=function(){var a=this.parameters;this.parameters="var ";var b=0,c=this.num$AttrLink-1,d;for(d in this.map$AttrLink){var e=this.map$AttrLink[d];this.parameters=e.tagType===Tag.prototype.enumType.INT64?this.parameters+(d+"=fromString('"+this.$Vars[d]+"')"):e.tagType===Tag.prototype.enumType.UINT64?this.parameters+(d+"=fromString('"+this.$Vars[d]+"',true,10)"):e.tagType===Tag.prototype.enumType.STRING?this.parameters+(d+"='"+this.$Vars[d]+"'"):this.parameters+
(d+" = "+this.$Vars[d]);this.parameters=b==c?this.parameters+";":this.parameters+", ";b++}this.parameters!=a&&this.updateDataLink()};hmiFormulaXForm.prototype.updateDataLink=function(){if(null!=this.dLink){var a=null,b=this.dLink.tagIndex,c=$hmi.cache.getTag(this.dLink.tag);c&&(a=c.value instanceof Array?c.value[b]:c.value);this.dLink.setWgtValue(a,Tag.prototype.QUALITY_GOOD)}};hmiFormulaXForm.prototype.getValue=function(){return{compiledExpression:this.compiledExpression}};
hmiFormulaXForm.prototype.addDataLink=function(a){hmiXform.prototype.addDataLink.call(this,a);this.initDataLinkSideEffects(a,a.attr)};hmiFormulaXForm.prototype.initDataLinkSideEffects=function(a,b){0==b.indexOf("$")&&(this.map$AttrLink[b]=a,this.num$AttrLink++,void 0!==this.$Vars[b]&&this.updateExpressionParams())};hmiFormulaXForm.prototype.removeDataLink=function(a){0==a.attr.indexOf("$")&&(delete this.map$AttrLink[a.attr],this.num$AttrLink--);hmiXform.prototype.removeDataLink.call(this,a)};
hmiFormulaXForm.prototype.execute=function(a,b,c,d){a=b;if(null!=d){d="(function(){"+this.parameters+"return "+d.compiledExpression+"; })();";try{a=eval(d)}catch(e){}}return a};$hmi.fn.hmiFormulaXForm=function(a,b,c,d){return new hmiFormulaXForm(this,a,b,c,d)};
